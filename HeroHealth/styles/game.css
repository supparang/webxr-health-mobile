/* === Hero Health Academy — styles/game.css (Plate tracker + Penalty FX + Quests + Bursts) === */
html, body {
  margin:0; padding:0; height:100%; width:100%;
  overflow:hidden; background:#0a0f1a;
  color:#fff; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
canvas#c { position:fixed; inset:0; z-index:0; pointer-events:none; }

/* ---------- Header ---------- */
header.brand {
  position:fixed; top:0; left:0; right:0; z-index:50;
  display:flex; align-items:center; gap:8px;
  padding:10px 12px; background:linear-gradient(180deg, rgba(8,12,24,.85), rgba(8,12,24,.35));
  backdrop-filter:saturate(120%) blur(6px);
}
header .spacer{ flex:1 1 auto; }
header .btn, .menu .btn, .menu .tag {
  background:#162033; color:#cfe9ff; border:1px solid #26324d; border-radius:10px;
  padding:8px 12px; font-weight:800; cursor:pointer;
}
header .btn:active, .menu .btn:active, .menu .tag:active { transform:translateY(1px); }

/* ---------- HUD ---------- */
.hud {
  position:fixed; z-index:60; top:64px; left:12px; right:12px;
  display:flex; flex-direction:column; gap:6px;
  text-shadow:0 2px 8px #000;
}
.bar { background:#0e1730; border-radius:999px; overflow:hidden; height:10px; border:1px solid #1c2a4d; }
.bar.slim { height:8px; }
#feverBar { height:100%; width:0%; background:linear-gradient(90deg, #ffd54a, #ff6d00); }
.fever { font:900 18px/1 ui-rounded, system-ui; color:#ffd54a; }

/* Power bar */
.powerbar { display:flex; gap:8px; align-items:center; margin-top:4px; }
.powerbar .pseg {
  position:relative; display:flex; align-items:center; justify-content:center;
  width:40px; height:40px; border-radius:12px;
  background:#15213a; border:1px solid #25365c; cursor:pointer;
  box-shadow:0 2px 10px rgba(0,0,0,.25) inset, 0 2px 10px rgba(0,0,0,.2);
  transition:transform .12s, filter .12s, opacity .12s;
  overflow:hidden;
}
.powerbar .pseg:hover { transform:translateY(-1px) scale(1.03); }
.powerbar .pseg:active { transform:translateY(0) scale(.98); }
.powerbar .pseg[aria-disabled="true"] { opacity:.45; pointer-events:none; }
.powerbar .pseg span { font-size:18px; font-weight:900; }
.powerbar .pseg[data-k="x2"] span { font-size:16px; }
.powerbar .pseg i {
  position:absolute; inset:auto 0 0 0; height:0%;
  background:linear-gradient(180deg, rgba(255,213,74,.85), rgba(255,109,0,.85));
  transition:height .2s linear;
}
.powerbar .pseg.busy i { height:100%; }
.powerbar .pseg.ready { outline:2px solid #4ade80; }

/* Mode target badge (used by groups) */
#targetWrap{
  font-weight:800; background:#0d172b; border:1px solid #203155; border-radius:10px;
  padding:6px 10px; display:inline-flex; align-items:center; gap:8px; width:max-content;
}

/* ---------- Menu ---------- */
.menu{
  position:fixed; left:0; right:0; bottom:0; z-index:70;
  background:linear-gradient(0deg, rgba(8,12,24,.8), rgba(8,12,24,.3));
  backdrop-filter:saturate(120%) blur(6px);
  padding:8px 12px; display:flex; flex-direction:column; gap:6px;
}
.menu .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
.modeLabel{ margin-left:auto; opacity:.85; font-weight:800; }

/* ---------- Modal (result/help/stats/daily) ---------- */
.modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  z-index: 9999; background:rgba(0,0,0,.45); backdrop-filter: blur(2px);
}
.modal .card{
  max-width:min(92vw,720px); width:clamp(280px,88vw,560px);
  max-height:min(86vh,680px); overflow:auto; padding:16px; border-radius:16px;
  background:#0d172b; border:1px solid #203155; color:#e9f3ff;
  box-shadow:0 18px 48px rgba(0,0,0,.45);
}
.modal .card.scroll{ overflow:auto; }
.modal .btn,[data-result]{ cursor:pointer; }

/* ---------- Countdown overlay ---------- */
#cdOverlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9900; pointer-events:none; }
#cdNum{ font:900 72px/1 ui-rounded,system-ui; color:#fff; text-shadow:0 2px 14px #000c; }

/* ---------- Floating score bursts ---------- */
.scoreBurst{
  will-change: transform, opacity;
  pointer-events:none;
}

/* ============================================================
   Healthy Plate Tracker (Quota bars)
   ============================================================ */
#plateTracker{
  position:fixed; z-index:62; top:64px; right:12px; min-width:240px;
  background:#0d172b; border:1px solid #203155; border-radius:12px;
  padding:8px 10px; display:none;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
#plateTracker h4{ margin:4px 0 8px; font:800 13px/1 ui-rounded,system-ui; opacity:.9; }
#platePills{ display:flex; flex-direction:column; gap:6px; }
#platePills .pill{
  display:grid; grid-template-columns: 1fr auto; align-items:center;
  gap:8px; position:relative; padding:6px 8px; border-radius:10px;
  background:#0b1426; border:1px solid #1a2a4d;
}
#platePills .pill b{ font:800 12px/1 ui-rounded,system-ui; opacity:.9; }
/* NOTE: plate.js renders a plain <span>, not .qty → target the span */
#platePills .pill span{ font:800 12px/1 ui-rounded,system-ui; opacity:.9; }
#platePills .pill i{
  position:absolute; left:6px; right:6px; bottom:6px; height:6px; border-radius:999px;
  background:linear-gradient(90deg,#7da7ff,#43e3ff); opacity:.85;
}
#platePills .pill.ok{
  border-color:#285a3a;
  background:linear-gradient(180deg,#0f1f1a,#0b1410);
}
#platePills .pill.ok i{
  background:linear-gradient(90deg,#41f1a3,#a3ffcf);
}

/* ============================================================
   Penalty FX — flash red / dim overlay
   ============================================================ */
body.flash-danger::after{
  content:''; position:fixed; inset:0; background:rgba(255,40,40,.35);
  animation:flashRed .25s ease-out;
  pointer-events:none; z-index:9998;
}
@keyframes flashRed{ 0%{opacity:.85;} 100%{opacity:0;} }

body.dim-penalty::before{
  content:''; position:fixed; inset:0; background:rgba(0,0,0,.5);
  animation:dimPen .4s ease-out forwards;
  pointer-events:none; z-index:9997;
}
@keyframes dimPen{ 0%{opacity:.8;} 100%{opacity:0;} }

/* ============================================================
   Mission line (used in Plate)
   ============================================================ */
#missionLine{
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  font:900 22px/1.3 ui-rounded,system-ui;
  padding:8px 16px; background:rgba(0,0,0,.55);
  border-radius:12px; color:#fff; text-shadow:0 2px 10px #000;
  display:none; z-index:9999;
}

/* ============================================================
   Hydration Bar (Low/OK/High) with FEVER flames
   ============================================================ */
#hydroWrap{
  position:fixed; z-index:65; left:12px; right:12px; top:114px;
  display:block; pointer-events:none;
}
.hydroBar{
  position:relative; height:24px; border-radius:999px; overflow:hidden;
  border:1px solid #203155; background:#0d172b;
  box-shadow: inset 0 2px 8px rgba(0,0,0,.35);
}
.hydroBar .seg{
  position:absolute; top:0; bottom:0; display:flex; align-items:center; justify-content:center;
  font:800 11px/1 ui-rounded,system-ui; letter-spacing:.2px; color:#e9f3ff; opacity:.85;
  text-shadow:0 1px 3px #0009;
}
.hydroBar .seg.low  { left:0;   width:35%; background:linear-gradient(180deg,#12223d,#0f1b33); }
.hydroBar .seg.ok   { left:35%; width:30%; background:linear-gradient(180deg,#123d2a,#0f3324); }
.hydroBar .seg.high { left:65%; width:35%; background:linear-gradient(180deg,#3d1212,#330f0f); }

.hydroBar .needle{
  position:absolute; top:-4px; width:12px; height:32px; border-radius:6px;
  background:linear-gradient(180deg,#cfe9ff,#5ab0ff);
  box-shadow:0 0 10px rgba(90,176,255,.7), 0 2px 10px rgba(0,0,0,.35);
  transition:left .18s ease;
}

/* outline color by zone */
.hydroBar[data-zone="LOW"]  { outline:2px solid rgba(90,176,255,.35); }
.hydroBar[data-zone="OK"]   { outline:2px solid rgba(127,255,212,.45); }
.hydroBar[data-zone="HIGH"] { outline:2px solid rgba(255,109,0,.45); }

/* FEVER flames */
.hydroBar .flame{
  position:absolute; bottom:-8px; width:20px; height:28px; pointer-events:none;
  filter: drop-shadow(0 4px 8px rgba(255,109,0,.55));
}
.hydroBar .flame i{
  position:absolute; bottom:0; left:50%; width:10px; height:14px; margin-left:-5px;
  background: radial-gradient(closest-side, #ffd54a, #ff6d00);
  border-radius:999px 999px 6px 6px;
  animation: flameUp .8s infinite ease-in-out;
  opacity:.95;
}
.hydroBar .flame i:nth-child(2){ width:8px; height:12px; margin-left:-2px; animation-duration:.75s; opacity:.9; }
.hydroBar .flame i:nth-child(3){ width:6px; height:10px; margin-left:-7px; animation-duration:.7s;  opacity:.85; }

@keyframes flameUp{
  0%   { transform: translateY(6px) scale(0.9); opacity:.9; }
  50%  { transform: translateY(-2px) scale(1.05); opacity:1; }
  100% { transform: translateY(-8px) scale(0.85); opacity:0; }
}

/* ============================================================
   Quest chips (shown by HUD via Quests.bindToMain)
   ============================================================ */
#questChips{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
}
.questChip{
  display:flex; flex-direction:column; gap:4px; min-width:120px;
  padding:8px 10px; border-radius:10px; background:#0b1426; border:1px solid #1a2a4d;
}
.questChip .qLabel{ font:800 12px/1.2 ui-rounded,system-ui; opacity:.95; }
.questChip .qProg{ font:800 12px/1 ui-rounded,system-ui; opacity:.8; text-align:right; }
.questChip .qBar{ position:relative; height:6px; border-radius:999px; overflow:hidden; background:#0e1730; border:1px solid #1c2a4d; }
.questChip .qBar i{ position:absolute; inset:0; width:0%; background:linear-gradient(90deg,#7da7ff,#43e3ff); }
.questChip.done{ border-color:#285a3a; background:linear-gradient(180deg,#0f1f1a,#0b1410); }
.questChip.done .qBar i{ background:linear-gradient(90deg,#41f1a3,#a3ffcf); }

/* ---------- Accessibility helpers ---------- */
:focus-visible { outline:2px solid #7fffd4; outline-offset:2px; }
/* === Hero Health Academy — styles/game.css (alerts for plate/hydration/target + gaze reticle) === */

/* --- เพิ่มจากของเดิม: เอฟเฟกต์เตือน & Gaze Reticle --- */

/* Plate: pill เขียวเมื่อครบ, แดงสั่นเมื่อ overfill */
#platePills .pill.warn {
  border-color:#9b2c2c !important;
  box-shadow:0 0 0 2px rgba(255,64,64,.25);
  animation: plateShake .2s linear 1;
}
@keyframes plateShake {
  0%{ transform:translateX(0) }
  25%{ transform:translateX(-3px) }
  50%{ transform:translateX(2px) }
  75%{ transform:translateX(-2px) }
  100%{ transform:translateX(0) }
}

/* Hydration: flash สีที่ปลายทางเมื่อข้ามโซนผิดฝั่ง */
.hydroBar.flash-bad::after{
  content:''; position:absolute; inset:0; background:linear-gradient(90deg, transparent, rgba(255,64,64,.25), transparent);
  animation: hydroFlash .25s ease-out 1;
  pointer-events:none;
}
@keyframes hydroFlash{ from{ opacity:.9 } to{ opacity:0 } }

/* Target badge pulse (โหมด groups) */
#targetWrap.pulse {
  animation: targetPulse .45s ease-out 1;
  box-shadow:0 0 0 2px rgba(103,232,249,.35);
}
@keyframes targetPulse{
  0%{ transform:scale(1); }
  40%{ transform:scale(1.04); }
  100%{ transform:scale(1); }
}

/* Gaze reticle (ตัวจริงสร้างจาก JS แต่กัน CSS ทับไว้) */
#hhaReticle{ /* สไตล์หลักถูกตั้งจาก JS เพื่อความเข้ากันได้ทุกสภาพแวดล้อม */ }
#hhaReticle.hidden{ opacity:0; }

/* ปุ่มเมนู/โมดัล: ให้กดด้วย gaze ได้ง่ายขึ้น */
button.btn, .item, [data-action], [data-result], [data-modal-open], [data-modal-close]{
  touch-action: manipulation;
}

/* ป้องกัน overlay บังโมดัลปุ่ม */
.modal{ z-index: 9999; }
/* === additions for alerts & gaze reticle === */

/* Micro toast (target changed / plate done) */
.toast {
  position: fixed; left: 50%; top: 18%;
  transform: translate(-50%, -10px);
  background: rgba(0,0,0,.55);
  border: 1px solid #203155;
  color: #fff;
  font: 800 14px/1.2 ui-rounded, system-ui;
  padding: 8px 12px; border-radius: 10px; z-index: 9999;
  opacity: 0; transition: opacity .18s, transform .18s;
}
.toast.show { opacity: 1; transform: translate(-50%, 0); }

/* Target change glow */
html[data-hha-mode="groups"] #targetWrap.glow {
  box-shadow: 0 0 0 2px #67e8f980, 0 0 18px #67e8f9;
}

/* Plate over-quota lock cue */
body.overlock .item[aria-disabled="true"] {
  filter: grayscale(1) brightness(.6);
  cursor: not-allowed;
}

/* Gaze reticle */
#gazeReticle { pointer-events: none; }
#gazeReticle i, #gazeReticle b {
  position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%);
  border-radius: 999px;
}
#gazeReticle i { width: 28px; height: 28px; border: 2px solid #cfe9ff; box-shadow: 0 0 8px #000; }
#gazeReticle b {
  width: 0%; height: 6px; background: linear-gradient(90deg, #7fffd4, #4de1ff);
  border-radius: 999px; top: calc(50% + 22px);
}
/* === add-ons (append to your game.css) === */

/* ปิดคลิกพื้นหลังเมื่อมีโมดัลเปิด */
body.modal-open #menuBar,
body.modal-open .item,
body.modal-open [data-action],
body.modal-open [data-modal-open] { pointer-events:none; }

/* Toast มินิ */
.toast{
  position:fixed; left:50%; top:18%; transform:translateX(-50%);
  background:rgba(0,0,0,.6); color:#fff; padding:8px 12px; border-radius:10px;
  font:800 14px ui-rounded,system-ui; z-index:9999; opacity:0; transition:opacity .2s, transform .2s;
}
.toast.show{ opacity:1; transform:translate(-50%, -4px); }

/* เป้าใหม่มี glow สั้น ๆ */
#targetWrap.glow{ box-shadow:0 0 20px #4ade80; transition:box-shadow .95s; }

/* ชิปเควสต์สั่นเมื่อสำเร็จ */
.questChip.done { animation: chipDone .6s ease; }
@keyframes chipDone { 0%{transform:scale(1)} 50%{transform:scale(1.07)} 100%{transform:scale(1)} }

/* Badge สีบนไอเท็ม (ช่วยเด็ก ป.5 แยกดี/ขยะ) */
.item[data-good="1"]{ text-shadow: 0 0 10px rgba(100,255,200,.6); }
.item .badge{
  position:absolute; top:6px; right:6px; font:900 10px ui-rounded;
  background:#0d172b; border:1px solid #203155; color:#7fffd4; padding:2px 6px; border-radius:8px;
}
.item.bad .badge{ border-color:#402222; color:#ff9b9b; }
/* --- Clickability Hotfix --- */

/* อนุญาตให้ปุ่ม/เมนูรับคลิกเสมอ */
#menuBar, #resultModal, #coachHUD .controls, [data-ui="menu"], [data-ui="dialog"] {
  pointer-events: auto !important;
}

/* HUD แสดงผลอย่างเดียว ไม่กินคลิก ขณะเล่นเกม */
.hud-passive,
#hudWrap.hud-passive,
#platePills.hud-passive,
#missionLine.hud-passive,
#toast.hud-passive,
#targetWrap.hud-passive {
  pointer-events: none !important;
}

/* กัน overlay/blocker บังทั้งจอ */
#screenBlocker, #cover, .modal-backdrop {
  pointer-events: none !important;
}

/* ปุ่มที่ตั้งค่าไว้เป็น data-action ให้รับคลิกแน่นอน */
button[data-action], .btn[data-action], [role="button"][data-action] {
  pointer-events: auto !important;
  cursor: pointer;
}

/* จัด z-index ให้เมนูอยู่บน gameplay เมื่อโหมดเมนู */
body.ui-mode-menu #menuBar,
body.ui-mode-result #resultModal {
  z-index: 1000;
}

/* gameplay อยู่บน background แต่ใต้เมนู/ไดอะล็อก */
#gameLayer, canvas, a-scene, .a-canvas { z-index: 1; position: relative; }
/* === HHA hotfix (click & centering) === */
html,body{height:100%;}
body{margin:0;background:#0b0f14;color:#fff;overflow:hidden;}

#stage{
  position:relative;
  width:100vw; height:100vh;
  display:grid; place-items:center; /* กลางจอทั้งแนวตั้ง-แนวนอน */
}

#gameLayer{
  position:relative;
  width:min(92vmin, 820px);
  height:min(92vmin, 820px);
  /* กลางจออยู่แล้วเพราะอยู่ใน #stage */
  z-index:10;
  pointer-events:auto;
  touch-action:manipulation;
}

#spawnHost{
  position:absolute; inset:0;
  pointer-events:auto; /* เปิดรับคลิก */
}

.spawn-emoji{
  position:absolute;
  background:transparent; border:0; padding:0; margin:0;
  font-size: clamp(32px, 6vmin, 56px);
  line-height:1; cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

.hud-passive{ pointer-events:none !important; }
#menuBar, #resultModal, [data-ui="menu"], [data-ui="dialog"]{
  pointer-events:auto !important; z-index:50;
}

/* กัน HUD ชนพื้นที่คลิก: ให้ HUD ผ่านคลิกเมื่อเล่น */
body.ui-mode-playing #hudWrap,
body.ui-mode-playing #coachHUD,
body.ui-mode-playing #targetWrap,
body.ui-mode-playing #plateTracker{
  pointer-events:none !important;
}

/* Toast / mission line อยู่บนสุด แต่ไม่บังคลิก */
#toast, #missionLine{ z-index:60; pointer-events:none; }

/* ป้องกัน overlay เผลอบังคลิกทั้งหมด */
.overlay, .modal, .drawer{ z-index:40; }
/* ==== Clickability & Layer Fixes (final global patch) ==== */

/* Canvas ไม่บังคลิก */
#c {
  pointer-events: none !important;
  z-index: 0 !important;
}

/* HUD อยู่บนแต่ไม่บังคลิกเว้นจุดที่อนุญาต */
.hud { z-index: 20 !important; }

/* ปิดคลิกเฉพาะส่วนที่เป็นข้อมูล ไม่ใช่ปุ่ม */
.hud .cardlike,
.hud #feverBarWrap,
.hud #fever,
.hud #questChips,
.hud #targetWrap,
.hud #plateTracker,
.hud #hydroWrap,
.hud #missionLine,
.hud #coachHUD {
  pointer-events: none !important;
}

/* เปิดคลิกเฉพาะที่จำเป็นใน HUD (เช่น power-ups) */
#powerBar,
#powerBar * {
  pointer-events: auto !important;
}

/* เมนู/หัวเกม คลิกได้เสมอ */
header.brand {
  z-index: 25 !important;
  pointer-events: auto !important;
}
.menu {
  z-index: 30 !important;
  pointer-events: auto !important;
}
.menu .btn,
.menu .tag {
  pointer-events: auto !important;
}

/* พื้นที่เล่นเกม */
.game-wrap,
#gameLayer {
  position: relative;
  z-index: 28; /* เหนือ canvas ใต้เมนู */
}

/* โฮสต์ของเป้า ต้องเต็มพื้นที่และไม่ดักคลิก */
#spawnHost {
  position: absolute;
  inset: 0;
  pointer-events: none !important; /* host ไม่รับคลิก */
  z-index: 28;
}

/* ปุ่มเป้า (ไอคอนอาหาร ฯลฯ) คลิกได้จริงบนทุกแพลตฟอร์ม */
.spawn-emoji {
  position: absolute;
  font-size: clamp(24px, 5.5vmin, 42px);
  line-height: 1;
  border: none;
  background: transparent;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  pointer-events: auto !important;
  z-index: 29;
}

/* โมดัลอยู่บนสุดเสมอ */
.modal { z-index: 40 !important; }
