<!doctype html>
<html lang="th" data-hha-mode="goodjunk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Hero Health Academy</title>
  <!-- ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ path ‡πÉ‡∏´‡πâ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ô‡∏ö‡∏ô GitHub Pages / ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏¢‡πà‡∏≠‡∏¢ -->
  <base href="./" />

  <!-- Styles (‡∏£‡∏ß‡∏° fix: HUD-safe, Ready? center, spawn click-through) -->
  <link rel="stylesheet" href="styles/game.css" />
  <link rel="stylesheet" href="styles/groups.css" />

  <!-- iOS/Android PWA niceties (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0b1220" />
</head>
<body data-mode="goodjunk">
  <!-- ====== GLOBAL AUDIO (‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á sfx.js) ====== -->
  <audio id="sfx-good"     preload="auto" src="assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"      preload="auto" src="assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect"  preload="auto" src="assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"     preload="auto" src="assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup"  preload="auto" src="assets/sfx/power.mp3"></audio>
  <audio id="bgm-main"     preload="auto" src="assets/bgm/main.mp3" loop></audio>

  <!-- ====== GAME LAYER ====== -->
  <main id="gameLayer" role="main" aria-label="Hero Health Academy">
    <!-- Spawn host (DOM-spawn) -->
    <div id="spawnHost" aria-hidden="true"></div>

    <!-- ===== HUD (score/time/combo/fever) ===== -->
    <div id="hudWrap" class="hud">
      <div class="hud-pill"><span id="modeName">Good vs Junk</span></div>
      <div class="hud-pill">‚è± <span id="time">45</span>s</div>
      <div class="hud-pill">‚≠ê <span id="score">0</span></div>
      <div class="hud-pill">üîó <span id="combo">0</span>x</div>
      <div class="hud-pill" id="feverBarWrap" aria-label="fever">
        <span>FEVER</span>
        <div id="feverBar" style="margin-left:8px;width:120px;height:6px;border-radius:8px;background:#ffffff20;overflow:hidden;">
          <i id="feverFill" style="display:block;height:100%;width:0%;background:linear-gradient(90deg,#ffd54a,#ff7f50)"></i>
        </div>
      </div>
      <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î Groups -->
      <div id="targetWrap" class="hud-pill" style="display:none;">
        üéØ <span id="targetBadge">‡∏ú‡∏±‡∏Å ‚Ä¢ 0/8</span>
      </div>
    </div>

    <!-- ===== Hydration HUD (‡πÇ‡∏´‡∏°‡∏î hydration) ===== -->
    <div id="hydroWrap" style="display:none;">
      <div class="hydroBar" aria-label="hydration-bar">
        <div class="seg low"><span>‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ</span></div>
        <div class="seg ok"><span>‡∏û‡∏≠‡∏î‡∏µ</span></div>
        <div class="seg high"><span>‡∏°‡∏≤‡∏Å‡πÑ‡∏õ</span></div>
        <div class="needle" role="presentation"></div>
        <div class="flame" role="presentation" hidden><i></i><i></i><i></i></div>
      </div>
    </div>

    <!-- ===== Plate tracker (‡πÇ‡∏´‡∏°‡∏î plate) ===== -->
    <div id="plateTracker" style="display:none;">
      <div id="platePills"></div>
    </div>

    <!-- ===== Mission line / Toast ===== -->
    <div id="missionLine" aria-live="polite" style="display:none;"></div>
    <div id="toast" class="toast" aria-live="polite"></div>

    <!-- ===== Coach Bubble (‡∏û‡∏£‡πâ‡∏≠‡∏° fix ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á) ===== -->
    <section id="coachHUD" class="coach" aria-live="polite">
      <div class="bubble" id="coachText">Ready?</div>
    </section>

    <!-- ===== MENU (Start & selectors) ===== -->
    <nav id="menuBar" class="menu" aria-label="Game Menu" style="
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      z-index:100;display:flex;flex-direction:column;align-items:center;gap:14px;">

      <h1 style="margin:0 0 6px 0">Hero Health Academy</h1>

      <!-- Mode selector -->
      <div id="modeSelector" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
        <button type="button" id="m_goodjunk" class="btn mode">ü•¶ Good vs Junk</button>
        <button type="button" id="m_groups"   class="btn mode">üç± 5 Food Groups</button>
        <button type="button" id="m_hydration" class="btn mode">üíß Hydration</button>
        <button type="button" id="m_plate"     class="btn mode">üçΩÔ∏è Healthy Plate</button>
      </div>

      <!-- Difficulty selector -->
      <div id="diffSelector" style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
        <button type="button" id="d_easy"   class="btn diff">Easy</button>
        <button type="button" id="d_normal" class="btn diff is-active">Normal</button>
        <button type="button" id="d_hard"   class="btn diff">Hard</button>
      </div>

      <!-- Toggles -->
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
        <button type="button" id="langToggle"  class="btn">TH/EN</button>
        <button type="button" id="soundToggle" class="btn">üîä</button>
        <button type="button" id="gfxToggle"   class="btn">üé®</button>
        <button type="button" id="btn_help"    class="btn">‚ùì Help</button>
      </div>

      <!-- Start -->
      <div style="margin-top:6px;">
        <button type="button" id="btn_start" class="btn btn-primary" style="min-width:220px;height:48px;font-weight:900;">
          ‚ñ∂Ô∏è Start
        </button>
      </div>
    </nav>

    <!-- ===== RESULT MODAL ===== -->
    <section id="result" class="modal" aria-modal="true" role="dialog" style="display:none;">
      <div class="modal-body">
        <h2 id="h_result">Result</h2>
        <div id="resultStats">
          <!-- main.js ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏î‡∏≤‡∏ß/‡πÄ‡∏Å‡∏£‡∏î -->
        </div>
        <div class="modal-actions" style="display:flex;gap:10px;justify-content:center;">
          <button type="button" data-result="replay" class="btn">‚Üª Replay</button>
          <button type="button" data-result="home"   class="btn">üè† Home</button>
        </div>
      </div>
    </section>

    <!-- ===== HELP MODAL ===== -->
    <section id="help" class="modal" aria-modal="true" role="dialog" style="display:none;">
      <div class="modal-body" style="max-width:760px;">
        <h2 id="h_help">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h2>
        <pre id="helpBody" style="white-space:pre-wrap;font-family:inherit;"></pre>
        <div style="text-align:center;margin-top:10px;">
          <button type="button" id="btn_ok" class="btn btn-primary">OK</button>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== Boot loader (‡∏à‡∏∞ ping main.js ‡πÅ‡∏•‡∏∞ import) ===== -->
  <script type="module" src="game/boot.js"></script>
  <!-- ===== UI bindings (Start flow, How-to, Tutorial, toggles) ===== -->
  <script type="module" src="game/ui.js"></script>

  <!-- ===== Start Fallback (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ ui.js ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å ‚Äî ‡πÉ‡∏´‡πâ Start ‡∏ï‡∏¥‡∏î‡πÅ‡∏ô‡πà) ===== -->
  <script>
    (function ensureStartWorks(){
      const btn = document.getElementById('btn_start');
      if(!btn) return;

      // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô overlay/blocker
      btn.style.pointerEvents = 'auto';
      btn.setAttribute('tabindex','0');
      btn.addEventListener('click', tryStart, {capture:true});
      btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); tryStart(); }});

      function tryStart(){
        // ‡∏•‡πâ‡∏≤‡∏á warning boot (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const w = document.getElementById('bootWarn'); if(w) w.style.display='none';

        // ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å: ui.js -> startFlow()
        if (typeof window.startFlow === 'function') { window.startFlow(); return; }
        // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö main.js ‡πÅ‡∏ö‡∏ö global API
        if (window.preStartFlow) { window.preStartFlow(); return; }
        if (window.HHA && typeof window.HHA.startGame === 'function'){ window.HHA.startGame({demoPassed:true}); return; }
        if (typeof window.start === 'function'){ window.start({demoPassed:true}); return; }

        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ main.js ‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ ready
        const menu = document.getElementById('menuBar');
        if (menu) menu.style.display = 'none';
        console.warn('[StartFallback] No start function yet ‚Äî hiding menu and waiting for main.js');
      }
    })();
  </script>

  <!-- ===== Minimal button styles (‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏ß‡∏¢/‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏Å‡∏°.css) ===== -->
  <style>
    .btn{
      appearance:none;border:0;border-radius:12px;padding:8px 14px;font-weight:800;
      background:#22314d;color:#e8f0ff;cursor:pointer;box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }
    .btn:hover{ filter:brightness(1.08); }
    .btn:active{ transform:translateY(1px); }
    .btn-primary{ background: linear-gradient(180deg,#3b82f6,#2563eb); color:#fff; }
    .btn.mode{ background:#1b263b; }
    .btn.diff.is-active{ outline:2px solid #7fffd4; }

    .modal{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(5,8,15,.55); z-index:101;
    }
    .modal-body{
      background:rgba(15,20,35,.9); color:#eaf2ff; padding:16px 18px; border-radius:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      max-width:92vw;
    }
  </style>

  <noscript>
    <div style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#111;color:#fff;z-index:9999">
      ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ
    </div>
  </noscript>
</body>
</html>
