<!-- Loader: import main.js แบบเดี่ยว มี fallback และข้อความดีบั๊ก -->
<script type="module">
  // กันโหลดซ้ำ
  if (window.__HHA_MAIN_ATTEMPTED) {
    console.warn('[HHA] main loader already attempted; skip duplicate');
  } else {
    window.__HHA_MAIN_ATTEMPTED = true;

    const ABS = 'https://supparang.github.io/webxr-health-mobile/HeroHealth/game/main.js?v=live';
    const REL = './game/main.js'; // ✅ ตัวระบุที่ถูกต้อง (มี ./)

    const warn = (() => {
      let el = document.getElementById('bootWarn');
      if (!el) {
        el = document.createElement('div');
        el.id = 'bootWarn';
        el.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;padding:10px 12px;font-weight:700;z-index:9999;white-space:pre-wrap;display:none';
        document.body.appendChild(el);
      }
      return {
        show(msg){ el.textContent = msg; el.style.display = 'block'; },
        hide(){ el.style.display = 'none'; }
      };
    })();

    let lastErr = null;
    let ok = false;

    // 1) ลอง absolute URL ที่ยืนยันว่าใช้ได้
    try {
      await import(ABS);
      ok = true;
    } catch (e1) {
      lastErr = e1;
      console.warn('[HHA] import fail ABS:', ABS, e1);
      // 2) สำรอง: path สัมพัทธ์จาก index.html
      try {
        await import(REL);
        ok = true;
      } catch (e2) {
        lastErr = e2;
        console.warn('[HHA] import fail REL:', REL, e2);
      }
    }

    // รอให้ main.js ตั้ง flag แล้วค่อยตัดสิน
    setTimeout(() => {
      if (ok && window.__HHA_BOOT_OK === true) return;
      const detail = (lastErr && (lastErr.message || String(lastErr))) || 'unknown';
      warn.show(
`⚠️ โหลดสคริปต์ไม่สำเร็จ

พยายาม:
- ${ABS}
- ${REL}

สาเหตุล่าสุด: ${detail}

Tips:
• ตรวจว่ามีไฟล์ /HeroHealth/game/main.js จริง (ตัวพิมพ์ตรง)
• Network: สถานะ 200 และ MIME = javascript
• ถ้าเป็น SyntaxError ให้ดู Console บรรทัดที่พังใน main.js`);
    }, 200);
  }
</script>
