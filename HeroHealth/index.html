<!DOCTYPE html>
<html lang="th" data-hha-mode="goodjunk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Hero Health Academy</title>

  <!-- IMPORTANT: ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á path ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏ô GitHub Pages -->
  <base href="/webxr-health-mobile/HeroHealth/">

  <!-- External styles (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô repo) -->
  <link rel="stylesheet" href="styles/game.css" />
  <link rel="stylesheet" href="styles/groups.css" />

  <style>
    /* ====== Minimal base (‡∏Å‡∏±‡∏ô overlay/‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å + layout ‡∏´‡∏•‡∏±‡∏Å) ====== */
    :root{
      --hud-z:95; --coach-z:96; --items-z:29; --modal-z:99; --menu-z:97;
      --bg:#0b1220; --fg:#eaf5ff; --muted:#9fb5d6;
    }
    html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,Segoe UI,Inter,Arial;}
    #app{position:relative;min-height:100dvh;overflow:hidden;}

    /* Game layer + spawn host */
    #gameLayer{position:relative; height:calc(100dvh - 72px); /* below menu */ }
    #spawnHost{position:absolute; inset:0; pointer-events:none;} /* children buttons will be pointer-events:auto */
    #spawnHost > *{pointer-events:auto;}

    /* HUD */
    #hudWrap{
      position:fixed; left:0; right:0; top:56px; z-index:var(--hud-z);
      display:flex; align-items:center; justify-content:center; gap:16px; pointer-events:none;
    }
    .hud-pill{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
      border-radius:999px; padding:6px 10px; font-weight:800; letter-spacing:.3px; color:#dfeaff;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
    }
    #targetWrap{ display:none; pointer-events:none; }
    #targetBadge{ font-weight:900; letter-spacing:.2px; }

    /* Plate tracker (‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ö pill ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô) */
    #plateTracker{ position:fixed; left:50%; transform:translateX(-50%); top:56px; z-index:93; display:none; }
    #platePills{ display:flex; gap:10px; pointer-events:none; }
    #platePills .pill{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:6px 10px; color:#dfeaff; display:flex; align-items:center; gap:8px; position:relative;
    }
    #platePills .pill i{ position:absolute; left:0; bottom:0; height:3px; width:0; background:#2bd9a2; border-bottom-left-radius:12px; border-bottom-right-radius:12px; }
    #platePills .pill.ok{ border-color:#2bd9a2aa; }

    /* Hydration HUD placeholder (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å hydration.js ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏≠‡∏á) */
    #hydroWrap{ position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:93; pointer-events:none; }

    /* Coach bubble */
    #coachHUD{ position:fixed; left:0; right:0; top:86px; z-index:var(--coach-z); display:flex; justify-content:center; pointer-events:none; }
    #coachHUD .bubble{
      pointer-events:auto; background:linear-gradient(180deg,#10203b,#0f1b33);
      border:1px solid #ffffff20; box-shadow:0 8px 22px #0006, inset 0 1px 0 #ffffff15;
      color:#dfeaff; padding:10px 12px; border-radius:12px; font-weight:800; letter-spacing:.2px; display:none;
    }
    #coachHUD.show .bubble{ display:inline-block; }

    /* Mission line / Toast */
    #missionLine{
      position:fixed; left:50%; transform:translateX(-50%); top:120px; z-index:93;
      display:none; background:#132545; border:1px solid #ffffff14; color:#dfeaff; padding:6px 10px; border-radius:10px; pointer-events:none;
      font-weight:900;
    }
    .toast{
      position:fixed; left:50%; transform:translate(-50%,-10px); top:84px; background:#132545;
      border:1px solid #ffffff1a; color:#dfeaff; padding:6px 12px; border-radius:10px; z-index:98; opacity:0; transition:opacity .18s, transform .18s; pointer-events:none;
    }
    .toast.show{ opacity:1; transform:translate(-50%,0); }

    /* Result modal */
    #result{ position:fixed; inset:0; background:rgba(4,10,18,.72); backdrop-filter:blur(10px); z-index:var(--modal-z); display:none; align-items:center; justify-content:center; }
    #result .card{
      width:min(560px,92vw); background:linear-gradient(180deg,#0f1b33,#0b1325);
      border:1px solid #ffffff22; border-radius:14px; box-shadow:0 12px 30px #0007, inset 0 1px 0 #ffffff1a;
      padding:16px; color:#eaf5ff;
    }
    #result .row{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px; }
    #result [data-result]{ padding:9px 14px; border:0; border-radius:10px; font-weight:900; cursor:pointer; }
    #result [data-result="replay"]{ background:#2bd9a2; color:#04141b; }
    #result [data-result="home"]{ background:#243a72; color:#eaf5ff; }

    /* Help modal */
    #help{ position:fixed; inset:0; background:rgba(4,10,18,.72); backdrop-filter:blur(10px); z-index:var(--modal-z); display:none; align-items:center; justify-content:center;}
    #help .card{
      width:min(720px,94vw); background:linear-gradient(180deg,#0f1b33,#0b1325);
      border:1px solid #ffffff22; border-radius:14px; box-shadow:0 12px 30px #0007, inset 0 1px 0 #ffffff1a;
      padding:16px; color:#eaf5ff; max-height:80dvh; overflow:auto;
    }
    #h_help{ margin:0 0 10px; }
    #helpBody{ white-space:pre-wrap; font-size:14px; color:#d7e5ff; }
    #btn_ok{ margin-top:12px; padding:9px 14px; border:0; border-radius:10px; font-weight:900; background:#2bd9a2; color:#04141b; cursor:pointer; }

    /* Flash on penalty */
    .flash-danger{ animation:flash .16s; }
    @keyframes flash{ from{ background-color:#3c1120; } to{ background-color:var(--bg);} }

    /* ===== Pretty Menu (glassmorphism, segmented, round icons) ===== */
    .menu.glass{
      position:sticky; top:0; z-index:var(--menu-z);
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; padding:10px 14px;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, #0b1220cc, #0b1220b3);
      border-bottom: 1px solid #ffffff1a;
    }
    .menu-left{ display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
    .brand{ display:flex; align-items:center; gap:10px; padding-right:6px; border-right:1px solid #ffffff14; }
    .logo{ width:36px; height:36px; display:grid; place-items:center; font-size:20px;
      background: radial-gradient(closest-side, #2be4a2, #177e62);
      color:#04141b; border-radius:10px; box-shadow: 0 6px 18px #0005, inset 0 1px 0 #fff3; }
    .titles{ display:flex; flex-direction:column; line-height:1.1; }
    .titles .app{ color:#eaf5ff; letter-spacing:.2px; }
    .titles .mode{ color:#9fb5d6; font-size:12px; }

    .segmented{
      display:flex; gap:0; background:#0f1a33; border-radius:12px; padding:4px;
      border:1px solid #ffffff1f; box-shadow: inset 0 1px 0 #ffffff0d;
    }
    .segmented.tight{ padding:3px; }
    .seg-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border:0; border-radius:9px; background:transparent; color:#dfeaff;
      font-weight:700; cursor:pointer; line-height:1; user-select:none;
      transition: background .15s, color .15s, transform .12s;
    }
    .seg-btn .ico{ font-size:16px; line-height:1; }
    .seg-btn:hover{ background:#1a2a55; }
    .seg-btn:active{ transform: translateY(1px); }
    .seg-btn.active,
    .seg-btn[aria-selected="true"]{
      background: linear-gradient(180deg, #3857ee, #2c45c9);
      color:#fff; box-shadow: 0 6px 16px rgba(56,87,238,.35), inset 0 1px 0 #ffffff33;
    }

    .menu-right{ display:flex; align-items:center; gap:10px; }
    .rounds{ display:flex; gap:8px; }
    .round{
      width:38px; height:38px; border-radius:999px; border:0; cursor:pointer;
      display:grid; place-items:center;
      background:#111a33; color:#e8f1ff;
      border:1px solid #ffffff1f; box-shadow: inset 0 1px 0 #ffffff12, 0 4px 12px #0005;
      transition: transform .12s, background .15s;
      user-select:none;
    }
    .round:hover{ background:#172241; }
    .round:active{ transform: translateY(1px); }
    .round span{ font-weight:800; font-size:11px; letter-spacing:.3px; }

    .cta{
      padding:10px 16px; border:0; border-radius:12px; font-weight:900; letter-spacing:.2px;
      background: linear-gradient(90deg, #2bd9a2, #3a6ff8);
      color:#04141b; text-shadow:0 1px 0 #fff7;
      box-shadow: 0 10px 26px rgba(43,217,162,.35), 0 8px 20px rgba(58,111,248,.25);
      cursor:pointer; transition: transform .12s, filter .15s;
    }
    .cta:hover{ filter:brightness(1.05); }
    .cta:active{ transform: translateY(1px); }

    @media (max-width:1024px){
      .segmented .seg-btn span { display:none; }
      .segmented .seg-btn .ico{ font-size:18px; }
    }
    @media (max-width:720px){
      .brand .app{ font-size:14px; }
      .menu.glass{ padding:8px 10px; gap:10px; }
      .round{ width:34px; height:34px; }
      .cta{ padding:9px 14px; }
    }
    @media (max-width:520px){
      .brand{ border-right:0; padding-right:0; }
      .menu-left{ gap:10px; }
      .segmented{ overflow:auto hidden; max-width:68vw; }
    }
  </style>
</head>
<body data-mode="goodjunk">
  <div id="app">
    <!-- ========== MENU (glass) ========== -->
    <nav id="menuBar" class="menu glass">
      <div class="menu-left">
        <div class="brand">
          <div class="logo">üçè</div>
          <div class="titles">
            <strong class="app">Hero Health Academy</strong>
            <span class="mode" id="modeName">Good vs Junk</span>
          </div>
        </div>

        <!-- Segmented: Modes -->
        <div class="segmented" role="tablist" aria-label="Game Modes">
          <button id="m_goodjunk" class="seg-btn active" role="tab" aria-selected="true">
            <span class="ico">ü•¶</span><span>Good vs Junk</span>
          </button>
          <button id="m_groups"   class="seg-btn" role="tab" aria-selected="false">
            <span class="ico">üß©</span><span>5 Food Groups</span>
          </button>
          <button id="m_hydration" class="seg-btn" role="tab" aria-selected="false">
            <span class="ico">üíß</span><span>Hydration</span>
          </button>
          <button id="m_plate"     class="seg-btn" role="tab" aria-selected="false">
            <span class="ico">üç±</span><span>Healthy Plate</span>
          </button>
        </div>

        <!-- Segmented: Difficulty -->
        <div class="segmented tight" role="tablist" aria-label="Difficulty">
          <button id="d_easy"   class="seg-btn" role="tab" aria-selected="false">Easy</button>
          <button id="d_normal" class="seg-btn active" role="tab" aria-selected="true">Normal</button>
          <button id="d_hard"   class="seg-btn" role="tab" aria-selected="false">Hard</button>
        </div>
      </div>

      <div class="menu-right">
        <div class="rounds">
          <button id="langToggle"  class="round" aria-label="Language"><span>TH/EN</span></button>
          <button id="soundToggle" class="round" aria-label="Sound">üîä</button>
          <button id="gfxToggle"   class="round" aria-label="Graphics">‚ú®</button>
          <button id="btn_help"    class="round" aria-label="How to Play">?</button>
        </div>
        <button id="btn_start" class="cta">‚ñ∂ Start</button>
      </div>
    </nav>

    <!-- ========== HUD / OVERLAYS ========== -->
    <div id="hudWrap" class="hud">
      <div id="timeWrap" class="hud-pill">‚è± <span id="time">45</span>s</div>
      <div id="scoreWrap" class="hud-pill">‚≠ê <span id="score">0</span></div>
      <div id="targetWrap" class="hud-pill"><span id="targetBadge">‚Äî</span></div>
      <div id="feverBarWrap" class="hud-pill" aria-hidden="true" style="display:none;">
        FEVER <span id="feverPct">0%</span>
      </div>
    </div>

    <!-- Plate tracker (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏´‡∏°‡∏î plate) -->
    <div id="plateTracker">
      <div id="platePills"></div>
    </div>

    <!-- Hydration HUD container -->
    <div id="hydroWrap"></div>

    <!-- Coach bubble -->
    <div id="coachHUD"><div id="coachText" class="bubble"></div></div>

    <!-- Mission line + toast placeholder -->
    <div id="missionLine"></div>
    <div id="toast"></div>

    <!-- ========== GAME LAYER (for DOM-spawn) ========== -->
    <div id="gameLayer">
      <div id="spawnHost" aria-live="polite"></div>
      <!-- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™‡∏à‡∏≤‡∏Å engine/three ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (‡∏≠‡∏¢‡πà‡∏≤‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å) -->
      <canvas id="c"></canvas>
    </div>

    <!-- ========== RESULT MODAL ========== -->
    <div id="result" class="modal">
      <div class="card">
        <h2 style="margin:0 0 6px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô / Result</h2>
        <div id="resultBody">...</div>
        <div class="row">
          <button data-result="replay">‚ü≤ Replay</button>
          <button data-result="home">‚åÇ Home</button>
        </div>
      </div>
    </div>

    <!-- ========== HELP MODAL ========== -->
    <div id="help" class="modal">
      <div class="card">
        <h2 id="h_help">How to Play</h2>
        <div id="helpBody">...</div>
        <button id="btn_ok">OK</button>
      </div>
    </div>

    <!-- ========== AUDIO (SFX/BGM) ========== -->
    <audio id="sfx-good"     src="assets/sfx/good.mp3"    preload="auto"></audio>
    <audio id="sfx-bad"      src="assets/sfx/bad.mp3"     preload="auto"></audio>
    <audio id="sfx-perfect"  src="assets/sfx/perfect.mp3" preload="auto"></audio>
    <audio id="sfx-tick"     src="assets/sfx/tick.mp3"    preload="auto"></audio>
    <audio id="sfx-powerup"  src="assets/sfx/powerup.mp3" preload="auto"></audio>
    <audio id="bgm-main"     src="assets/bgm/main.mp3"    preload="auto" loop></audio>
  </div>

  <!-- ========== UI helpers (non-module) ========== -->
  <script src="game/ui.js"></script>

  <!-- ========== Boot loader (‡∏à‡∏∞ fetch + import game/main.js ‡∏û‡∏£‡πâ‡∏≠‡∏° error banner) ========== -->
  <script src="game/boot.js"></script>

  <!-- ========== Small inline helpers: sync attributes & active states ========== -->
  <script>
    // ‡πÉ‡∏´‡πâ <body data-mode=‚Ä¶> & <html data-hha-mode=‚Ä¶> ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤/‡πÉ‡∏´‡∏°‡πà)
    (function syncBodyMode(){
      const map = ['goodjunk','groups','hydration','plate'];
      function set(k){
        document.body.setAttribute('data-mode', k);
        document.documentElement.setAttribute('data-hha-mode', k);
      }
      map.forEach(k=>{
        const b = document.getElementById('m_'+k);
        if (b) b.addEventListener('click', ()=> set(k));
      });
      set('goodjunk');
    })();

    // Sync active ‡∏Ç‡∏≠‡∏á difficulty segmented
    (function syncDifficulty(){
      const ids = ['d_easy','d_normal','d_hard'];
      function setActive(id){
        ids.forEach(x=>{
          const b = document.getElementById(x);
          if (!b) return;
          const on = (x===id);
          b.classList.toggle('active', on);
          b.setAttribute('aria-selected', on?'true':'false');
        });
        // ‡∏ö‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ main.js (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å window.__HHA_DIFF)
        window.__HHA_DIFF = id==='d_easy'?'Easy' : id==='d_hard'?'Hard' : 'Normal';
      }
      ids.forEach(x=>{
        const b = document.getElementById(x);
        if (b) b.addEventListener('click', ()=> setActive(x));
      });
      setActive('d_normal');
    })();

    // Sync active aria-selected ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î
    (function syncModeAria(){
      const keys = ['goodjunk','groups','hydration','plate'];
      function mark(k){
        keys.forEach(id=>{
          const b = document.getElementById('m_'+id);
          if (b){
            const on = (id===k);
            b.classList.toggle('active', on);
            b.setAttribute('aria-selected', on?'true':'false');
          }
        });
      }
      keys.forEach(k=>{
        const b = document.getElementById('m_'+k);
        if (b) b.addEventListener('click', ()=> mark(k));
      });
      mark('goodjunk');
    })();

    // Guard: ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏° Start ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (log ‡πÉ‡∏ô console ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏µ‡∏ö‡∏±‡∏Å)
    (function probeOverlay(){
      setTimeout(()=>{
        const b = document.getElementById('btn_start'); if(!b) return;
        const r = b.getBoundingClientRect(); const cx=r.left+r.width/2, cy=r.top+r.height/2;
        const stack = document.elementsFromPoint(cx, cy);
        if(stack && stack[0] !== b){ console.warn('[Overlay Detected on Start]', stack[0]); }
      }, 700);
    })();
  </script>
</body>
</html>
