<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hero Health Academy</title>

  <!-- IMPORTANT: base ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå HeroHealth ‡∏ö‡∏ô GitHub Pages -->
  <base href="/webxr-health-mobile/HeroHealth/">

  <link rel="stylesheet" href="styles/game.css" />

  <!-- UI overrides ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô/‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå -->
  <style>
    /* ‡∏Å‡∏±‡∏ô canvas ‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏™‡∏°‡∏≠ */
    #c { z-index: 1 !important; pointer-events: none !important; }

    /* ‡∏ä‡∏±‡πâ‡∏ô UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
    .hud, .menu, .modal, .coach, .item {
      z-index: 100 !important;
      pointer-events: auto !important;
    }
    /* HUD ‡πÉ‡∏´‡∏ç‡πà+‡∏Ñ‡∏≠‡∏ô‡∏ó‡∏£‡∏≤‡∏™‡∏ï‡πå‡∏™‡∏π‡∏á ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    .hud { 
      font-size: 18px; 
      gap: 8px;
      text-shadow: 0 2px 8px rgba(0,0,0,.6);
    }
    .hud > div {
      background: rgba(8,10,20,.62) !important;
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 12px;
      padding: 8px 12px;
      font-weight: 900;
    }
    #feverBarWrap { background: rgba(0,0,0,.4) !important; }

    /* ‡∏õ‡πâ‡∏≤‡∏¢ ‚Äú‡πÇ‡∏´‡∏°‡∏î/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‚Äù ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î */
    .menu .modeLabel{
      color:#fff !important; font-weight:900;
      padding:4px 8px; border-radius:8px;
      background: rgba(0,0,0,.45);
      text-shadow: 0 2px 6px rgba(0,0,0,.75);
    }

    /* ‡πÄ‡∏°‡∏ô‡∏π‚Äî‡∏•‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ */
    #menuBar{
      position:fixed !important; left:10px !important; bottom:10px !important;
      top:auto !important; transform:none !important; width:auto !important;
      max-width:48vw; background:rgba(10,12,20,.92);
      border-radius:12px; padding:10px; backdrop-filter: blur(6px);
    }
    #menuBar .row{ gap:8px; }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏•‡∏¥‡∏Å‡∏™‡∏ö‡∏≤‡∏¢ */
    .btn,.tag{
      padding:8px 12px; border-radius:12px; font-weight:800; cursor:pointer;
      background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.25);
    }
    .btn:hover,.tag:hover{ background:rgba(255,255,255,.22) }

    /* ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
    .item{
      font-size: clamp(34px, 5.6vw, 60px) !important;
      min-width: 60px !important; min-height: 60px !important;
      padding: 8px 12px !important; border-radius:14px !important;
    }

    /* Coach ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ .show */
    #coachHUD.show{ display:block !important; }

    /* Fallback ‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏±‡∏•‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    .modal .card{
      background: rgba(20,24,44,.95);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.15);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="brand">
    <div id="brandTitle">HERO HEALTH ACADEMY</div>
    <div class="spacer"></div>
    <button id="langToggle" class="btn">üáπüá≠ TH/EN</button>
    <button id="gfxToggle" class="btn">üéõÔ∏è ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å: ‡∏õ‡∏Å‡∏ï‡∏¥</button>
    <button id="soundToggle" class="btn">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î</button>
  </header>

  <!-- Canvas -->
  <canvas id="c"></canvas>

  <!-- HUD -->
  <section class="hud">
    <div>
      <span id="t_score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>: <b id="score">0</b> |
      <span id="t_combo">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö</span>: <b id="combo">x0</b> |
      <span id="t_time">‡πÄ‡∏ß‡∏•‡∏≤</span>: <b id="time">60</b>s
    </div>

    <!-- Fever Bar -->
    <div id="feverBarWrap" class="bar slim">
      <div id="feverBar" style="width:0%"></div>
    </div>

    <!-- Mission -->
    <div id="missionLine" style="display:none; font-weight:800;">‚Äî</div>

    <!-- Target / Plate / Hydration -->
    <div id="targetWrap" style="display:none">üéØ <span id="t_target">‡∏´‡∏°‡∏ß‡∏î</span>: <span id="targetBadge">‚Äî</span></div>
    <div id="plateTracker" style="display:none">üç± <span id="t_quota">‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤</span>: <span id="platePills"></span></div>
    <div id="hydroWrap" style="display:none">üíß <span id="t_hydro">‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥</span>: <span id="hydroLabel">‚Äî</span>
      <div class="bar"><div id="hydroBar"></div></div>
    </div>

    <div id="fever" class="fever" style="display:none">FEVER!</div>
  </section>

  <!-- Coach -->
  <div id="coachHUD" class="coach" style="display:none">
    <div id="coachText">...</div>
  </div>

  <!-- Menu -->
  <section id="menuBar" class="menu">
    <div class="row">
      <button class="tag" data-action="mode" data-value="goodjunk"  id="m_goodjunk">ü•ó ‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</button>
      <button class="tag" data-action="mode" data-value="groups"    id="m_groups">üçΩÔ∏è ‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà</button>
      <button class="tag" data-action="mode" data-value="hydration" id="m_hydration">üíß ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥</button>
      <button class="tag" data-action="mode" data-value="plate"     id="m_plate">üç± ‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</button>
    </div>
    <div class="row">
      <button class="tag" data-action="diff" data-value="Easy"   id="d_easy">‡∏á‡πà‡∏≤‡∏¢</button>
      <button class="tag" data-action="diff" data-value="Normal" id="d_normal">‡∏õ‡∏Å‡∏ï‡∏¥</button>
      <button class="tag" data-action="diff" data-value="Hard"   id="d_hard">‡∏¢‡∏≤‡∏Å</button>

      <span class="modeLabel">
        <span id="t_mode">‡πÇ‡∏´‡∏°‡∏î</span>: <b id="modeName">‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</b> ‚Ä¢
        <span id="t_diff">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</span>: <b id="difficulty">‡∏õ‡∏Å‡∏ï‡∏¥</b>
      </span>
    </div>
    <div class="row">
      <button class="btn" data-action="start"   id="btn_start">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
      <button class="btn" data-action="pause"   id="btn_pause">‚è∏ ‡∏û‡∏±‡∏Å</button>
      <button class="btn" data-action="restart" id="btn_restart">‚Üª ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      <button class="btn" data-action="help"    id="btn_help">‚ùì ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
    </div>
  </section>

  <!-- Help Modal -->
  <div id="help" class="modal" style="display:none">
    <div class="card">
      <h3 id="h_help">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h3>
      <pre id="helpBody">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Üí ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏î‡∏±‡∏Å</pre>
      <button class="btn" data-action="helpClose" id="btn_ok">‡πÇ‡∏≠‡πÄ‡∏Ñ</button>
    </div>
  </div>

  <!-- Result Modal -->
  <div id="result" class="modal" style="display:none">
    <div class="card">
      <h3 id="h_summary">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
      <div id="resCore"></div>
      <div id="resBreakdown"></div>
      <div id="resBoard"></div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" data-result="replay" id="btn_replay">‚Üª ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn" data-result="home"   id="btn_home">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- SFX -->
  <audio id="sfx-good"     preload="auto" src="assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"      preload="auto" src="assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect"  preload="auto" src="assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"     preload="auto" src="assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup"  preload="auto" src="assets/sfx/powerup.mp3"></audio>

  <!-- main.js ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° -->
  <script type="module" src="game/main.js"></script>

  <!-- Fallback: ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏Å main.js ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î -->
  <script>
    (function(){
      const w=document.createElement('div');
      w.id='bootWarn';
      w.style.cssText='position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;padding:10px 12px;font-weight:700;z-index:1000;display:none';
      w.textContent='‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏ï‡∏£‡∏ß‡∏à path game/main.js ‡∏´‡∏£‡∏∑‡∏≠ base href';
      document.body.appendChild(w);
      setTimeout(()=>{ if(!window.__HHA_BOOT_OK){ w.style.display='block'; } }, 2000);
    })();
  </script>

  <!-- Hard-fix: bind ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πâ‡∏≥ + ‡∏ó‡∏≥ HUD ‡πÇ‡∏ú‡∏•‡πà + ‡∏ï‡∏£‡∏ß‡∏à overlay -->
  <script>
    (function hardFix(){
      function ensureLayers(){
        const c = document.getElementById('c');
        if(c){ c.style.pointerEvents='none'; c.style.zIndex='1'; }
        ['hud','menu','modal','coach','item'].forEach(cls=>{
          document.querySelectorAll('.'+cls).forEach(el=>{
            el.style.pointerEvents='auto'; el.style.zIndex='100';
          });
        });
        const menu = document.getElementById('menuBar');
        if(menu){
          Object.assign(menu.style,{ position:'fixed', left:'10px', bottom:'10px', top:'auto', transform:'none' });
        }
      }
      function bindButtons(){
        const start = document.getElementById('btn_start');
        if(start){
          start.addEventListener('click', (e)=> {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏°‡∏µ preStartFlow ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°, ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá startGame ‡∏ï‡∏£‡∏á
            if(window.preStartFlow) window.preStartFlow();
            else if(window.HHA?.startGame) window.HHA.startGame({demoPassed:true});
            else if(window.start) window.start();
          }, {passive:true});
        }
      }
      function ensureHUD(){
        const hud = document.querySelector('.hud');
        if(hud){ hud.style.display='flex'; hud.style.visibility='visible'; hud.style.opacity='1'; }
      }
      function probeOverlay(){
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏° start
        const b = document.getElementById('btn_start');
        if(!b) return;
        const r = b.getBoundingClientRect();
        const cx = r.left + r.width/2, cy = r.top + r.height/2;
        const stack = document.elementsFromPoint(cx, cy);
        // log ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏≠‡∏á
        if(stack && stack[0] !== b){
          console.warn('[Overlay Detected] Top element over Start:', stack[0]);
        }
      }

      document.addEventListener('DOMContentLoaded', ()=>{
        ensureLayers(); bindButtons(); ensureHUD(); probeOverlay();
        // re-assert ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡∏±‡∏ô stylesheet/renderer ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
        setTimeout(()=>{ ensureLayers(); bindButtons(); ensureHUD(); probeOverlay(); }, 500);
      });
    })();
  </script>
</body>
</html>
