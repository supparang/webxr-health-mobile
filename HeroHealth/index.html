<!doctype html>
<html lang="th" data-hha-mode="goodjunk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health Academy</title>

  <!-- Styles (base + per-mode) -->
  <link rel="stylesheet" href="./styles/game.css" />
  <link rel="stylesheet" href="./styles/groups.css" />
  <style>
    /* Minimal layout guards (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å) */
    #gameLayer{position:relative; width:100%; height:calc(100dvh - 120px); overflow:hidden;}
    #spawnHost{position:absolute; inset:0; pointer-events:none;}
    #spawnHost > *{pointer-events:auto;}
    #menuBar{position:relative; z-index:97; display:flex; flex-wrap:wrap; gap:8px; align-items:center; padding:10px; background:#0b1220; color:#e6f0ff;}
    #menuBar button{padding:8px 12px; border:0; border-radius:10px; font-weight:700; background:#1c2742; color:#e6f0ff; cursor:pointer}
    #menuBar button.active{background:#3a6ff8; color:#fff}
    #hudWrap{position:fixed; left:0; right:0; top:48px; z-index:95; display:flex; justify-content:center; gap:10px; pointer-events:none}
    #targetWrap{background:#0b1220cc; color:#fff; padding:6px 10px; border-radius:999px; display:none}
    #plateTracker{display:none; pointer-events:none}
    #platePills{display:flex; gap:6px; background:#0b1220cc; padding:6px; border-radius:12px}
    #platePills .pill{display:flex; align-items:center; gap:6px; background:#11182c; color:#e6f0ff; padding:6px 8px; border-radius:10px; position:relative}
    #platePills .pill i{position:absolute; left:0; bottom:0; height:3px; background:#7fffd4; border-radius:0 0 10px 10px}
    #missionLine{position:fixed; top:90px; left:50%; transform:translateX(-50%); background:#11182c; color:#fff; padding:6px 10px; border-radius:10px; display:none; z-index:93; pointer-events:none}
    #coachHUD{position:fixed; inset:auto 0 18px 0; display:flex; justify-content:center; z-index:96; pointer-events:none}
    #coachHUD .bubble{background:#11182c; color:#fff; padding:8px 12px; border-radius:14px; box-shadow:0 8px 24px #0006; opacity:0; transition:.2s}
    #coachHUD.show .bubble{opacity:1}
    /* Result modal */
    #result{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:98; background:#0009}
    #result .box{background:#0b1220; color:#e6f0ff; padding:18px; border-radius:16px; width:min(560px,92vw)}
    #result .row{display:flex; justify-content:space-between; margin:8px 0}
    #help{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:98; background:#0009}
    #help .box{background:#0b1220; color:#e6f0ff; padding:16px; border-radius:14px; width:min(680px,92vw); white-space:pre-wrap}
    /* Toast */
    .toast{position:fixed; left:50%; top:16%; transform:translateX(-50%); background:#11182c; color:#fff; padding:6px 10px; border-radius:10px; z-index:93; opacity:0; transition:.18s}
    .toast.show{opacity:1}
    /* Danger flash */
    .flash-danger{animation:flash .16s}
    @keyframes flash{from{background:#ff4d4d20} to{background:transparent}}
    /* Canvas (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å */
    #c{position:absolute; inset:0; pointer-events:none; z-index:1}
  </style>
</head>
<body data-mode="goodjunk">
  <!-- Top Menu / Controls -->
  <nav id="menuBar" class="menu">
    <strong id="modeName">Good vs Junk</strong>
    <div style="margin-left:auto"></div>

    <!-- Mode selectors (ui.js ‡∏≠‡πà‡∏≤‡∏ô id m_*) -->
    <button id="m_goodjunk" class="active">Good vs Junk</button>
    <button id="m_groups">5 Food Groups</button>
    <button id="m_hydration">Hydration</button>
    <button id="m_plate">Healthy Plate</button>

    <!-- Difficulty selectors (ui.js ‡∏≠‡πà‡∏≤‡∏ô id d_*) -->
    <button id="d_easy">Easy</button>
    <button id="d_normal" class="active">Normal</button>
    <button id="d_hard">Hard</button>

    <!-- Toggles / Actions -->
    <button id="langToggle">TH/EN</button>
    <button id="soundToggle">üîä</button>
    <button id="gfxToggle">GFX</button>
    <button id="btn_help">?</button>
    <button id="btn_start" style="background:#29b36b">‚ñ∂ Start</button>
  </nav>

  <!-- HUD cluster -->
  <div id="hudWrap" class="hud">
    <div id="targetWrap"><span id="targetBadge">Target ‚Ä¢ 0/0</span></div>
    <div id="plateTracker">
      <div id="platePills"></div>
    </div>
    <div id="missionLine"></div>
  </div>

  <!-- Coach bubble -->
  <div id="coachHUD" class="coach">
    <div class="bubble"><span id="coachText">...</span></div>
  </div>

  <!-- Game Layer / Spawn host -->
  <main id="gameLayer" aria-label="game-layer">
    <canvas id="c" aria-hidden="true"></canvas>
    <div id="spawnHost" aria-hidden="false"></div>
  </main>

  <!-- Result modal -->
  <section id="result" data-modal="result" class="modal result">
    <div class="box">
      <h2 style="margin:0 0 8px">Result</h2>
      <div class="row"><span>Mode</span><b data-field="mode">‚Äî</b></div>
      <div class="row"><span>Score</span><b data-field="score">0</b></div>
      <div class="row"><span>Stars</span><b data-field="stars">0</b></div>
      <div class="row"><span>Grade</span><b data-field="grade">‚Äî</b></div>
      <div class="row"><span>Best Combo</span><b data-field="combo">0</b></div>
      <div class="row"><span>Time</span><b data-field="time">0</b></div>
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px">
        <button data-result="replay">‚Üª Replay</button>
        <button data-result="home">‚åÇ Home</button>
      </div>
    </div>
  </section>

  <!-- How-to-Play modal -->
  <section id="help" class="modal">
    <div class="box">
      <h3 id="h_help" style="margin:0 0 8px">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h3>
      <div id="helpBody" style="min-height:120px; font-family:ui-rounded,system-ui,sans-serif"></div>
      <div style="text-align:right; margin-top:12px">
        <button id="btn_ok">OK</button>
      </div>
    </div>
  </section>

  <!-- Audio (SFX + BGM) -->
  <audio id="sfx-good"     preload="auto" src="./assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"      preload="auto" src="./assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect"  preload="auto" src="./assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"     preload="auto" src="./assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup"  preload="auto" src="./assets/sfx/powerup.mp3"></audio>
  <audio id="bgm-main"     preload="auto" loop src="./assets/bgm/main.mp3"></audio>

  <!-- Boot then UI (boot ‡∏à‡∏∞ fetch ‡πÅ‡∏•‡∏∞ import game/main.js ‡πÅ‡∏ö‡∏ö‡∏Å‡∏±‡∏ô cache) -->
  <script type="module" src="./game/boot.js"></script>
  <script type="module" src="./game/ui.js"></script>

  <!-- Sync body[data-mode] ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ CSS per-mode ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô -->
  <script>
    (function syncBodyMode(){
      const map = ['goodjunk','groups','hydration','plate'];
      function setMode(m){
        document.body.setAttribute('data-mode', m);
        document.documentElement.setAttribute('data-hha-mode', m); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ legacy css
        // ‡∏õ‡∏£‡∏±‡∏ö active class ‡∏õ‡∏∏‡πà‡∏°
        map.forEach(k=>{
          const b = document.getElementById('m_'+k);
          if (b) b.classList.toggle('active', k===m);
        });
      }
      map.forEach(k=>{
        const b = document.getElementById('m_'+k);
        if (b) b.addEventListener('click', ()=> setMode(k));
      });
      // default
      setMode('goodjunk');
      // ‡πÄ‡∏ù‡πâ‡∏≤‡∏î‡∏π‡∏à‡∏≤‡∏Å ui.js ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô
      window.addEventListener('hha:set-mode', (e)=> setMode(e.detail||'goodjunk'));
    })();
  </script>

  <!-- Fallback guard: ‡∏ñ‡πâ‡∏≤ main.js ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ bind ‡∏õ‡∏∏‡πà‡∏° Start ‡πÉ‡∏´‡πâ ui.js ‡∏ó‡∏≥‡πÅ‡∏ó‡∏ô -->
  <script>
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà result/blank
    document.addEventListener('DOMContentLoaded', ()=>{
      const res = document.getElementById('result');
      if (res) { res.style.display='none'; res.hidden=true; }
    });
  </script>
</body>
</html>
