<!doctype html>
<html lang="th" data-hha-mode="">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Hero Health Academy</title>

  <!-- Styles -->
  <link rel="stylesheet" href="./styles/game.css">
  <link rel="stylesheet" href="./styles/groups.css">

  <!-- iOS PWA safe area -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0f1a">
</head>
<body data-mode="goodjunk">
  <!-- ===== HUD ===== -->
  <div id="hudWrap" class="hud">
    <div id="scoreWrap" class="hudBox"><b>Score</b> <span id="score">0</span></div>
    <div id="timeWrap"  class="hudBox"><b>Time</b>  <span id="time">45</span>s</div>
    <div id="targetWrap" class="hudBox" style="display:none"></div>
    <div id="plateTracker" class="hudBox" style="display:none">
      <div id="platePills"></div>
    </div>
  </div>

  <!-- ===== Coach ===== -->
  <div id="coachHUD" class="coach" aria-live="polite" aria-atomic="true">
    <div id="coachBubble"><span id="coachText">Ready?</span></div>
  </div>

  <!-- ===== Menu (Mode & Difficulty & Start) ===== -->
  <div id="menuBar" class="menu">
    <div class="menuRow">
      <div class="menuCol">
        <h3>Mode</h3>
        <div class="seg">
          <button id="m_goodjunk"  data-mode="goodjunk"  class="segBtn is-active">Good vs Junk</button>
          <button id="m_groups"    data-mode="groups"    class="segBtn">5 Food Groups</button>
          <button id="m_hydration" data-mode="hydration" class="segBtn">Hydration</button>
          <button id="m_plate"     data-mode="plate"     class="segBtn">Healthy Plate</button>
        </div>
      </div>
      <div class="menuCol">
        <h3>Difficulty</h3>
        <div class="seg">
          <button id="d_easy"   data-diff="Easy"   class="segBtn">Easy</button>
          <button id="d_normal" data-diff="Normal" class="segBtn is-active">Normal</button>
          <button id="d_hard"   data-diff="Hard"   class="segBtn">Hard</button>
        </div>
      </div>
    </div>

    <div class="menuRow center">
      <div class="pill nowPlaying">
        <span id="lblMode">Good vs Junk</span> â€¢
        <span id="lblDiff">Normal</span>
      </div>
    </div>

    <div class="menuRow center">
      <button id="btn_start" class="cta">Start</button>
    </div>
  </div>

  <!-- ===== Game Layer / Spawn Host ===== -->
  <div id="gameLayer" class="layer">
    <div id="spawnHost" class="host"></div>
    <!-- mission/toast lines (click-through) -->
    <div id="missionLine" class="missionLine" aria-live="polite"></div>
    <div id="toast" class="toast"></div>
  </div>

  <!-- ===== Audio (SFX/BGM) ===== -->
  <audio id="sfx-good"    preload="auto" src="./assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"     preload="auto" src="./assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect" preload="auto" src="./assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"    preload="auto" src="./assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup" preload="auto" src="./assets/sfx/power.mp3"></audio>
  <audio id="bgm-main"    preload="auto" loop src="./assets/bgm/main.mp3"></audio>

  <!-- ===== Boot warning banner (auto by boot.js on error) ===== -->
  <div id="bootWarn" style="display:none"></div>

  <!-- ===== Scripts ===== -->
  <script src="./game/ui.js" defer></script>
  <script src="./game/boot.js" defer></script>
  <script type="module">
    /* Guard: ensure Start always works even if ui.js binding is overridden */
    (function ensureStartWires(){
      const btn = document.getElementById('btn_start');
      if (!btn) return;
      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        // prefer HHA.startGame from main.js; fallback to ui.js startFlow if present
        if (window.HHA && typeof window.HHA.startGame === 'function') {
          window.HHA.startGame({ demoPassed:true });
        } else if (typeof window.startFlow === 'function') {
          window.startFlow();
        } else {
          // minimal fallback: remove menu
          document.getElementById('menuBar')?.setAttribute('data-hidden','1');
        }
      }, { capture:true });
    })();
  </script>
</body>
</html>
