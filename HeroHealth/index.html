<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hero Health Academy</title>

  <!-- р╣Гр╕лр╣Йр╕Кр╕╡р╣Йр╕бр╕▓р╕Чр╕╡р╣Ир╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М HeroHealth р╕Ър╕Щ GitHub Pages -->
  <base href="/webxr-health-mobile/HeroHealth/">

  <link rel="stylesheet" href="styles/game.css" />
  <style>
    /* р╕Бр╕▒р╕Щ canvas р╕Ър╕▒р╕Зр╕Др╕ер╕┤р╕Б */
    #c{ z-index:1 !important; pointer-events:none !important; }
    /* р╕Кр╕▒р╣Йр╕Щ UI р╣Гр╕лр╣Йр╕Др╕ер╕┤р╕Бр╣Др╕Фр╣Йр╣Ар╕кр╕бр╕н */
    .hud,.menu,.modal,.coach,.item{ z-index:120 !important; pointer-events:auto !important; }
    /* р╕Ыр╕╕р╣Ир╕бр╣Гр╕лр╕Нр╣Ир╕Вр╕╢р╣Йр╕Щр╕Др╕ер╕┤р╕Бр╕Зр╣Ир╕▓р╕в */
    .btn,.tag{ font-weight:800; border-radius:12px; padding:8px 12px; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="brand">
    <div id="brandTitle">HERO HEALTH ACADEMY</div>
    <div class="spacer"></div>
    <button id="langToggle" class="btn" type="button">ЁЯЗ╣ЁЯЗн TH/EN</button>
    <button id="gfxToggle"  class="btn" type="button">ЁЯОЫя╕П р╕Бр╕гр╕▓р╕Яр╕┤р╕Б: р╕Ыр╕Бр╕Хр╕┤</button>
    <button id="soundToggle"class="btn" type="button">ЁЯФК р╣Ар╕кр╕╡р╕вр╕З: р╣Ар╕Ыр╕┤р╕Ф</button>
  </header>

  <!-- Canvas -->
  <canvas id="c"></canvas>

  <!-- HUD -->
  <section class="hud">
    <div class="hud-line">
      <span id="t_score">р╕Др╕░р╣Бр╕Щр╕Щ</span>: <b id="score">0</b> |
      <span id="t_combo">р╕Др╕нр╕бр╣Вр╕Ъ</span>: <b id="combo">x0</b> |
      <span id="t_time">р╣Ар╕зр╕ер╕▓</span>: <b id="time">60</b>s
    </div>
    <div id="feverBarWrap" class="bar slim"><div id="feverBar" style="width:0%"></div></div>
    <div id="missionLine" style="display:none;font-weight:800;">тАФ</div>
    <div id="targetWrap" style="display:none">ЁЯОп <span id="t_target">р╕лр╕бр╕зр╕Ф</span>: <span id="targetBadge">тАФ</span></div>
    <div id="plateTracker" style="display:none">ЁЯН▒ <span id="t_quota">р╣Вр╕Др╕зр╕Хр╕▓</span>: <span id="platePills"></span></div>
    <div id="hydroWrap" style="display:none">ЁЯТз <span id="t_hydro">р╕кр╕бр╕Фр╕╕р╕ер╕Щр╣Йр╕│</span>: <span id="hydroLabel">тАФ</span>
      <div class="bar"><div id="hydroBar" style="width:0%"></div></div>
    </div>
    <div id="fever" class="fever" style="display:none">FEVER!</div>
  </section>

  <!-- Coach -->
  <div id="coachHUD" class="coach" style="display:none">
    <div id="coachText">...</div>
  </div>

  <!-- Menu (р╕Ыр╕╕р╣Ир╕б type="button" р╕Бр╕▒р╕Щ submit) -->
  <section id="menuBar" class="menu">
    <div class="row">
      <button class="tag" type="button" data-action="mode" data-value="goodjunk"  id="m_goodjunk">ЁЯеЧ р╕Фр╕╡ vs р╕Вр╕вр╕░</button>
      <button class="tag" type="button" data-action="mode" data-value="groups"    id="m_groups">ЁЯН╜я╕П р╕Ир╕▓р╕Щ 5 р╕лр╕бр╕╣р╣И</button>
      <button class="tag" type="button" data-action="mode" data-value="hydration" id="m_hydration">ЁЯТз р╕кр╕бр╕Фр╕╕р╕ер╕Щр╣Йр╕│</button>
      <button class="tag" type="button" data-action="mode" data-value="plate"     id="m_plate">ЁЯН▒ р╕Ир╕▒р╕Фр╕Ир╕▓р╕Щр╕кр╕╕р╕Вр╕ар╕▓р╕Ю</button>
    </div>
    <div class="row">
      <button class="tag" type="button" data-action="diff" data-value="Easy"   id="d_easy">р╕Зр╣Ир╕▓р╕в</button>
      <button class="tag" type="button" data-action="diff" data-value="Normal" id="d_normal">р╕Ыр╕Бр╕Хр╕┤</button>
      <button class="tag" type="button" data-action="diff" data-value="Hard"   id="d_hard">р╕вр╕▓р╕Б</button>
      <span class="modeLabel"><span id="t_mode">р╣Вр╕лр╕бр╕Ф</span>: <b id="modeName">р╕Фр╕╡ vs р╕Вр╕вр╕░</b> тАв <span id="t_diff">р╕Др╕зр╕▓р╕бр╕вр╕▓р╕Б</span>: <b id="difficulty">р╕Ыр╕Бр╕Хр╕┤</b></span>
    </div>
    <div class="row">
      <button class="btn" type="button" data-action="start"   id="btn_start">тЦ╢ р╕Юр╕гр╣Йр╕нр╕бр╕ер╕╕р╕в</button>
      <button class="btn" type="button" data-action="pause"   id="btn_pause">тП╕ р╕Юр╕▒р╕Б</button>
      <button class="btn" type="button" data-action="restart" id="btn_restart">тЖ╗ р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣И</button>
      <button class="btn" type="button" data-action="help"    id="btn_help">тЭУ р╕зр╕┤р╕Шр╕╡р╣Ар╕ер╣Ир╕Щ</button>
    </div>
  </section>

  <!-- Help -->
  <div id="help" class="modal" style="display:none">
    <div class="card">
      <h3 id="h_help">р╕зр╕┤р╕Шр╕╡р╣Ар╕ер╣Ир╕Щ</h3>
      <pre id="helpBody">р╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕лр╕бр╕Ф тЖТ р╣Ар╕Бр╣Зр╕Ър╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З тЖТ р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▒р╕Ър╕Фр╕▒р╕Б</pre>
      <button class="btn" type="button" data-action="helpClose" id="btn_ok">р╣Вр╕нр╣Ар╕Д</button>
    </div>
  </div>

  <!-- Result -->
  <div id="result" class="modal" style="display:none">
    <div class="card">
      <h3 id="h_summary">р╕кр╕гр╕╕р╕Ыр╕Ьр╕е</h3>
      <div id="resCore"></div>
      <div id="resBreakdown"></div>
      <div id="resBoard"></div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn" type="button" data-result="replay" id="btn_replay">тЖ╗ р╣Ар╕ер╣Ир╕Щр╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З</button>
        <button class="btn" type="button" data-result="home"   id="btn_home">ЁЯПа р╕лр╕Щр╣Йр╕▓р╕лр╕ер╕▒р╕Б</button>
      </div>
    </div>
  </div>

  <!-- SFX/BGM -->
  <audio id="sfx-good"     preload="auto" src="assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"      preload="auto" src="assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect"  preload="auto" src="assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"     preload="auto" src="assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup"  preload="auto" src="assets/sfx/powerup.mp3"></audio>
  <audio id="bgm-main"     preload="auto" src="assets/bgm/stage1.mp3" loop></audio>

  <!-- р╣Ар╕Бр╕бр╕лр╕ер╕▒р╕Б -->
  <script type="module" src="game/main.js"></script>

  <!-- Boot warn р╕Цр╣Йр╕▓ main.js р╣Др╕бр╣Ир╕Вр╕╢р╣Йр╕Щ -->
  <script>
    (function(){
      const w=document.createElement('div');
      w.id='bootWarn';
      w.style.cssText='position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;padding:10px 12px;font-weight:700;z-index:9999;display:none';
      w.textContent='тЪая╕П р╣Вр╕лр╕ер╕Фр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И: р╕Хр╕гр╕зр╕И path game/main.js р╕лр╕гр╕╖р╕н base href';
      document.body.appendChild(w);
      setTimeout(()=>{ if(!window.__HHA_BOOT_OK){ w.style.display='block'; } }, 1800);
    })();
  </script>

  <!-- Start Bridge: р╕Ир╕▒р╕Ър╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕бр╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Ър╕Ър╣Ар╕Ир╕▓р╕░р╕Ир╕Зр╣Бр╕ер╕░р╣Бр╕гр╕Зр╕кр╕╕р╕Ф -->
  <script>
    (function startBridge(){
      function ensureLayers(){
        const c=document.getElementById('c'); if(c){ c.style.pointerEvents='none'; c.style.zIndex='1'; }
        ['hud','menu','modal','coach','item'].forEach(cls=>{
          document.querySelectorAll('.'+cls).forEach(el=>{
            el.style.pointerEvents='auto';
            el.style.zIndex = Math.max(120, parseInt(getComputedStyle(el).zIndex||'0',10));
          });
        });
      }
      function bindStart(){
        const btn=document.getElementById('btn_start');
        if(!btn) return;
        const clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        clone.addEventListener('click', (e)=>{
          e.preventDefault(); e.stopPropagation();
          try{
            if (window.start) window.start();
            else if (window.preStartFlow) window.preStartFlow();
            else console.error('start() is not available');
          }catch(err){ console.error('[Start error]', err); }
        }, {capture:true});
      }
      function probe(){
        const b=document.getElementById('btn_start'); if(!b) return;
        const r=b.getBoundingClientRect(); const cx=r.left+r.width/2, cy=r.top+r.height/2;
        const top=document.elementsFromPoint(cx,cy)[0];
        if(top!==b) console.warn('[Overlay over Start]', top);
      }
      const boot=()=>{ ensureLayers(); bindStart(); setTimeout(()=>{ensureLayers(); bindStart(); probe();}, 400); };
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', boot);
      else boot();
    })();
  </script>
</body>
</html>
