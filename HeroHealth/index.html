<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hero Health Academy</title>

  <base href="/webxr-health-mobile/HeroHealth/">
  <link rel="stylesheet" href="styles/game.css" />

  <!-- Bootloader (р╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б) -->
  <script type="module">
    (async () => {
      const warn = document.createElement('div');
      warn.id = 'bootWarn';
      warn.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;padding:10px 12px;font-weight:700;z-index:2000;display:none';
      warn.textContent = 'р╣Вр╕лр╕ер╕Фр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И: р╕Хр╕гр╕зр╕И path ./game/main.js';
      document.addEventListener('DOMContentLoaded', ()=>document.body.appendChild(warn));

      const chip = document.createElement('div');
      chip.id = 'bootChip';
      chip.style.cssText = 'position:fixed;right:12px;bottom:12px;background:#1b5e20;color:#fff;padding:8px 10px;border-radius:999px;font-weight:800;font-size:12px;z-index:2001;display:none;box-shadow:0 2px 8px rgba(0,0,0,.25)';
      chip.textContent = 'тЬЕ JS Loaded';
      document.addEventListener('DOMContentLoaded', ()=>document.body.appendChild(chip));

      const bases = [document.baseURI, new URL('./', location.href).href, 'https://supparang.github.io/webxr-health-mobile/HeroHealth/'];
      const paths = ['game/main.js', './game/main.js', 'game/main.js?v=live'];
      const candidates = [];
      for (const b of bases) for (const p of paths) candidates.push(new URL(p, b).href);

      let loaded = false, lastErr = null;
      for (const url of candidates) {
        try {
          const bust = url.includes('?') ? url + '&cb=' + Date.now() : url + '?cb=' + Date.now();
          await import(bust);
          loaded = true;
          setTimeout(() => {
            if (window.__HHA_BOOT_OK) {
              const w = document.getElementById('bootWarn'); if (w) w.style.display = 'none';
              const c = document.getElementById('bootChip'); if (c) c.style.display = 'inline-block';
            }
          }, 100);
          break;
        } catch (e) { lastErr = e; }
      }
      if (!loaded) {
        const w = document.getElementById('bootWarn');
        if (w) { w.textContent = 'р╣Вр╕лр╕ер╕Фр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И: р╕Хр╕гр╕зр╕И path / р╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М game/main.js (р╕Хр╕▒р╕зр╕Юр╕┤р╕бр╕Юр╣Мр╣Ар╕ер╣Зр╕Б/р╣Гр╕лр╕Нр╣И) тАв р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф: ' + (lastErr && (lastErr.message || String(lastErr))); w.style.display = 'block'; }
      }
    })();
  </script>
</head>
<body>
  <!-- Brand -->
  <header class="brand">
    <div id="brandTitle">HERO HEALTH ACADEMY</div>
    <div class="spacer"></div>
    <button id="langToggle"   class="btn" type="button">ЁЯЗ╣ЁЯЗн TH/EN</button>
    <button id="gfxToggle"    class="btn" type="button">ЁЯОЫя╕П р╕Бр╕гр╕▓р╕Яр╕┤р╕Б: р╕Ыр╕Бр╕Хр╕┤</button>
    <button id="soundToggle"  class="btn" type="button">ЁЯФК р╣Ар╕кр╕╡р╕вр╕З: р╣Ар╕Ыр╕┤р╕Ф</button>
  </header>

  <!-- Render -->
  <canvas id="c"></canvas>

  <!-- HUD -->
  <section class="hud">
    <div>
      <span id="t_score">р╕Др╕░р╣Бр╕Щр╕Щ</span>: <b id="score">0</b> |
      <span id="t_combo">р╕Др╕нр╕бр╣Вр╕Ъ</span>: <b id="combo">x0</b> |
      <span id="t_time">р╣Ар╕зр╕ер╕▓</span>: <b id="time">60</b>s
    </div>

    <!-- Fever Progress Bar -->
    <div id="feverBarWrap" class="bar slim"><div id="feverBar" style="width:0%"></div></div>
    <div id="fever" class="fever" style="display:none">FEVER!</div>

    <!-- Sub-HUD р╣Гр╕Хр╣Й FEVER -->
    <div id="subHUD">
      <!-- р╕Кр╕┤р╕Ыр╕ар╕▓р╕гр╕Бр╕┤р╕И/р╣Вр╕Ыр╕гр╣Ар╕Бр╕гр╕к -->
      <div id="questChip" class="chip" style="display:none">тАФ</div>
      <!-- Power-up bar -->
      <div id="powerBar" class="chip pow" style="display:none">
        <span id="powerLabel">тАФ</span>
        <div id="powerTime"><div></div></div>
      </div>
    </div>

    <!-- р╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в/р╣Вр╕Др╕зр╕Хр╕▓/р╕Щр╣Йр╕│ -->
    <div id="targetWrap" style="display:none">ЁЯОп <span id="t_target">р╕лр╕бр╕зр╕Ф</span>: <span id="targetBadge">тАФ</span></div>
    <div id="plateTracker" style="display:none">ЁЯН▒ <span id="t_quota">р╣Вр╕Др╕зр╕Хр╕▓</span>: <span id="platePills"></span></div>
    <div id="hydroWrap" style="display:none">
      ЁЯТз <span id="t_hydro">р╕кр╕бр╕Фр╕╕р╕ер╕Щр╣Йр╕│</span>:
      <span id="hydroLabel">тАФ</span>
      <div class="bar"><div id="hydroBar"></div></div>
    </div>

    <!-- р╣Ар╕кр╣Йр╕Щр╕ар╕▓р╕гр╕Бр╕┤р╕И/р╕кр╕Цр╕▓р╕Щр╕░р╕вр╣Ир╕нр╕в -->
    <div id="missionLine" class="mission-line" style="display:none">тАФ</div>
  </section>

  <!-- р╣Вр╕Др╣Йр╕К (р╣Гр╕Хр╣Й FEVER/subHUD) -->
  <div id="coachHUD" class="coach under-fever" style="display:none"><div id="coachText">...</div></div>

  <!-- р╣Ар╕бр╕Щр╕╣ -->
  <section id="menuBar" class="menu">
    <div class="row">
      <button class="tag" data-action="mode" data-value="goodjunk"  id="m_goodjunk"  type="button">ЁЯеЧ р╕Фр╕╡ vs р╕Вр╕вр╕░</button>
      <button class="tag" data-action="mode" data-value="groups"    id="m_groups"    type="button">ЁЯН╜я╕П р╕Ир╕▓р╕Щ 5 р╕лр╕бр╕╣р╣И</button>
      <button class="tag" data-action="mode" data-value="hydration" id="m_hydration" type="button">ЁЯТз р╕кр╕бр╕Фр╕╕р╕ер╕Щр╣Йр╕│</button>
      <button class="tag" data-action="mode" data-value="plate"     id="m_plate"     type="button">ЁЯН▒ р╕Ир╕▒р╕Фр╕Ир╕▓р╕Щр╕кр╕╕р╕Вр╕ар╕▓р╕Ю</button>
    </div>
    <div class="row">
      <button class="tag" data-action="diff" data-value="Easy"   id="d_easy"   type="button">р╕Зр╣Ир╕▓р╕в</button>
      <button class="tag" data-action="diff" data-value="Normal" id="d_normal" type="button">р╕Ыр╕Бр╕Хр╕┤</button>
      <button class="tag" data-action="diff" data-value="Hard"   id="d_hard"   type="button">р╕вр╕▓р╕Б</button>
      <span class="modeLabel"><span id="t_mode">р╣Вр╕лр╕бр╕Ф</span>: <b id="modeName">р╕Фр╕╡ vs р╕Вр╕вр╕░</b> тАв <span id="t_diff">р╕Др╕зр╕▓р╕бр╕вр╕▓р╕Б</span>: <b id="difficulty">р╕Ыр╕Бр╕Хр╕┤</b></span>
    </div>
    <div class="row">
      <button class="btn" data-action="start"   id="btn_start"   type="button">тЦ╢ р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Бр╕б</button>
      <button class="btn" data-action="pause"   id="btn_pause"   type="button">тП╕ р╕Юр╕▒р╕Б</button>
      <button class="btn" data-action="restart" id="btn_restart" type="button">тЖ╗ р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣И</button>
      <button class="btn" data-action="help"    id="btn_help"    type="button">тЭУ р╕зр╕┤р╕Шр╕╡р╣Ар╕ер╣Ир╕Щ</button>
      <button class="btn" data-action="helpScene" id="btn_helpScene" type="button">ЁЯУШ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕гр╕зр╕б</button>
    </div>
  </section>

  <!-- Help Modal -->
  <div id="help" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="h_help">
    <div class="card">
      <h3 id="h_help">р╕зр╕┤р╕Шр╕╡р╣Ар╕ер╣Ир╕Щ</h3>
      <pre id="helpBody">р╣Ар╕Бр╣Зр╕Ър╕Вр╕нр╕Зр╕Фр╕╡ (ЁЯежЁЯНО) р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Вр╕нр╕Зр╕Вр╕вр╕░ (ЁЯНФЁЯНЯЁЯед)\nMini-Quest 3 р╕Зр╕▓р╕Щ/р╕гр╕нр╕Ъ р╣Гр╕Хр╣Йр╣Бр╕Цр╕Ъ FEVER\nPower-up: ├Ч2, Freeze, Clean Sweep</pre>
      <button class="btn" data-action="helpClose" id="btn_ok" type="button">р╣Вр╕нр╣Ар╕Д</button>
    </div>
  </div>

  <!-- Result Modal -->
  <div id="result" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="h_summary">
    <div class="card">
      <h3 id="h_summary">р╕кр╕гр╕╕р╕Ыр╕Ьр╕е</h3>
      <div id="resCore"></div>
      <div id="resBreakdown"></div>
      <div id="resBoard"></div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" data-result="replay" id="btn_replay" type="button">тЖ╗ р╣Ар╕ер╣Ир╕Щр╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З</button>
        <button class="btn" data-result="home"   id="btn_home"   type="button">ЁЯПа р╕лр╕Щр╣Йр╕▓р╕лр╕ер╕▒р╕Б</button>
      </div>
    </div>
  </div>

  <!-- Help Scene -->
  <div id="helpScene" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="hs_title">
    <div class="card" style="max-width:960px; width:90%;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h3 id="hs_title" style="margin:0">р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕гр╕зр╕б</h3>
        <button class="btn" data-action="helpSceneClose" id="btn_helpSceneClose" type="button">тЬЦ р╕Ыр╕┤р╕Ф</button>
      </div>
      <div id="hs_body" class="hs-grid" style="margin-top:12px;">
        <div class="hs-block"><h4>р╕Фр╕╡ vs р╕Вр╕вр╕░</h4><p>р╣Ар╕Бр╣Зр╕Ър╕Вр╕нр╕Зр╕Фр╕╡ р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▒р╕Ър╕Фр╕▒р╕Б р╕Чр╕│р╣Ар╕Др╕зр╕к 3 р╕Зр╕▓р╕Щр╕Ир╕▓р╕Б 5 р╣Бр╕Ър╕Ъ р╕кр╕╕р╣Ир╕бр╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕З</p></div>
        <div class="hs-block"><h4>р╕Ир╕▓р╕Щ 5 р╕лр╕бр╕╣р╣И</h4><p>р╕Хр╕▓р╕бр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕вр╕лр╕бр╕зр╕Фр╕Ър╕Щ HUD</p></div>
        <div class="hs-block"><h4>р╕кр╕бр╕Фр╕╕р╕ер╕Щр╣Йр╕│</h4><p>р╕гр╕▒р╕Бр╕йр╕▓р╣Бр╕Цр╕Ъ 45тАУ65%</p></div>
        <div class="hs-block"><h4>р╕Ир╕▒р╕Фр╕Ир╕▓р╕Щр╕кр╕╕р╕Вр╕ар╕▓р╕Ю</h4><p>р╣Ар╕Хр╕┤р╕бр╣Вр╕Др╕зр╕Хр╕▓р╣Гр╕лр╣Йр╕Др╕гр╕Ъ</p></div>
      </div>
    </div>
  </div>

  <!-- SFX -->
  <audio id="sfx-good"     preload="auto" src="./assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"      preload="auto" src="./assets/sfx/bad.mp3"></audio>
  <audio id="sfx-perfect"  preload="auto" src="./assets/sfx/perfect.mp3"></audio>
  <audio id="sfx-tick"     preload="auto" src="./assets/sfx/tick.mp3"></audio>
  <audio id="sfx-powerup"  preload="auto" src="./assets/sfx/powerup.mp3"></audio>

  <noscript><div style="position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;padding:10px 12px;font-weight:700;z-index:2000">р╕Ир╕│р╣Ар╕Ыр╣Зр╕Щр╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Й JavaScript</div></noscript>
</body>
</html>
