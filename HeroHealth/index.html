<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Hero Health Academy</title>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1020;--fg:#e8f3ff;--muted:#94a3b8;--accent:#22d3ee;}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 800px at 50% -10%,#173056 10%,var(--bg) 55%);color:var(--fg);
font:500 16px/1.5 ui-rounded,system-ui,Segoe UI,Arial,sans-serif;-webkit-tap-highlight-color:transparent}
.game-wrap{position:relative;min-height:100dvh;overflow:hidden;}
/* ‡∏Å‡∏±‡∏ô canvas ‡∏Ç‡∏ß‡∏≤‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ */
canvas,canvas#c{pointer-events:none !important;z-index:1;position:fixed;inset:0}
#gameLayer,#spawnHost{position:fixed;inset:0;}
#menuBar{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;
background:linear-gradient(#0b1020d0,#0b1020d0);pointer-events:auto;}
.menu-card{width:min(860px,94vw);background:#0e1930;border:1px solid #132a4f;border-radius:16px;
padding:18px;box-shadow:0 18px 60px rgba(0,0,0,.45);}
.row{display:flex;flex-wrap:wrap;gap:10px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;
border-radius:12px;background:#0f1e38;color:#e6f2ff;border:1px solid #16325d;cursor:pointer;user-select:none}
.btn:hover{filter:brightness(1.08)}
.btn[data-mode].active,.btn[data-diff].active{outline:2px solid var(--accent);box-shadow:0 0 0 4px #22d3ee22}

#hudTop{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;gap:8px;z-index:50;pointer-events:none}
.badge{background:#0f1e38;border:1px solid #16325d;border-radius:10px;padding:6px 10px;pointer-events:auto}
#scoreVal{font-weight:900}

.toast{position:fixed;left:50%;top:68px;transform:translateX(-50%);background:#0e1930;border:1px solid #214064;
color:#e8f3ff;padding:8px 12px;border-radius:10px;opacity:0;transition:opacity .3s;z-index:60}
.toast.show{opacity:1}

/* ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏î‡∏µ‡∏ö‡∏±‡∏Å */
#bootWarn{position:fixed;inset:auto 0 0 0;background:#b00020;color:#fff;padding:10px 12px;
font:700 14px ui-sans-serif;z-index:10000;display:none}
#bootDebug{position:fixed;top:8px;left:8px;max-width:90vw;z-index:10001;background:#0a0f1a;border:1px solid #fff3;
border-radius:10px;color:#fff;padding:8px;font:12px ui-monospace;display:none;white-space:pre-wrap}
</style>
</head>
<body>

<div class="game-wrap">
  <div id="gameLayer"></div>
  <div id="spawnHost"></div>

  <div id="hudTop">
    <div class="badge">Mode: <b id="modeBadge">goodjunk</b> ‚Ä¢ Diff: <b id="diffBadge">Normal</b></div>
    <div class="badge">Score: <span id="scoreVal">0</span></div>
  </div>

  <div id="menuBar" aria-label="Main menu">
    <div class="menu-card">
      <h2 style="margin:4px 0 12px;font:900 22px ui-rounded">Hero Health Academy</h2>

      <h3>Play Mode</h3>
      <div class="row" role="group" aria-label="Mode">
        <div class="btn active" data-mode="goodjunk">ü•ó Good vs Junk</div>
        <div class="btn" data-mode="groups">üß∫ 5 Food Groups</div>
        <div class="btn" data-mode="hydration">üíß Hydration</div>
        <div class="btn" data-mode="plate">üçΩÔ∏è Healthy Plate</div>
      </div>

      <hr style="margin:12px 0;border-color:#133"/>

      <h3>Difficulty</h3>
      <div class="row" role="group" aria-label="Difficulty">
        <div class="btn" data-diff="Easy">Easy</div>
        <div class="btn active" data-diff="Normal">Normal</div>
        <div class="btn" data-diff="Hard">Hard</div>
      </div>

      <hr style="margin:12px 0;border-color:#133"/>

      <div class="row">
        <!-- ‡∏õ‡∏∏‡πà‡∏° Start ‡πÅ‡∏ö‡∏ö‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î -->
        <button id="btn_start" class="btn" data-action="start" type="button" tabindex="0" aria-label="Start game">‚ñ∂Ô∏è Start</button>
        <div class="btn" data-action="howto" role="button" tabindex="0">‚ùì How to Play</div>
        <div class="btn" data-action="sound" role="button" tabindex="0">üîä Sound</div>
      </div>
    </div>
  </div>
</div>

<!-- SFX tags (‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å mute/ignore) -->
<audio id="sfx-good" preload="auto"></audio>
<audio id="sfx-bad" preload="auto"></audio>
<audio id="sfx-perfect" preload="auto"></audio>
<audio id="sfx-tick" preload="auto"></audio>
<audio id="sfx-powerup" preload="auto"></audio>

<!-- Toast + Boot warn + Debug -->
<div id="toast" class="toast"></div>
<div id="bootWarn"></div>
<pre id="bootDebug"></pre>

<!-- ‚úÖ Boot script: ‡πÇ‡∏´‡∏•‡∏î main.js ‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏î‡∏µ‡∏ö‡∏±‡∏Å/‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á + strong-bind ‡∏õ‡∏∏‡πà‡∏° Start -->
<script type="module">
const $ = (s)=>document.querySelector(s);
const $$= (s)=>document.querySelectorAll(s);

function showWarn(lines){
  const w = $('#bootWarn'); w.innerHTML = (Array.isArray(lines)?lines:[lines]).map(t=>`<div>${t}</div>`).join('');
  w.style.display='block';
}
function log(line){
  const d = $('#bootDebug');
  d.style.display='block';
  d.textContent += (line + '\n');
}
function toast(t){
  let el = $('#toast'); el.textContent = t; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 1200);
}

// ‡∏Å‡∏±‡∏ô canvas ‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å
setTimeout(()=>{ document.querySelectorAll('canvas').forEach(c=>{ try{ c.style.pointerEvents='none'; c.style.zIndex='1'; }catch{} }); },0);

// ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å mode/diff
(function bindMenu(){
  const mb = $('#menuBar'); if(!mb) return;
  function setActive(sel, el){ mb.querySelectorAll(sel).forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
  mb.addEventListener('click',(ev)=>{
    const t = ev.target.closest('.btn'); if(!t) return;
    if (t.hasAttribute('data-mode')){ setActive('[data-mode]', t); document.body.setAttribute('data-mode', t.getAttribute('data-mode')); $('#modeBadge').textContent=t.getAttribute('data-mode'); return; }
    if (t.hasAttribute('data-diff')){ setActive('[data-diff]', t); document.body.setAttribute('data-diff', t.getAttribute('data-diff')); $('#diffBadge').textContent=t.getAttribute('data-diff'); return; }
    if (t.dataset.action==='howto'){ toast('‡πÅ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏î‡∏µ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î'); return; }
    if (t.dataset.action==='sound'){
      const someUnmuted = Array.from(document.querySelectorAll('audio')).some(a=>!a.muted);
      document.querySelectorAll('audio').forEach(a=>{ try{ a.muted = someUnmuted; }catch{} });
      t.textContent = someUnmuted ? 'üîá Sound' : 'üîä Sound';
      toast(someUnmuted?'‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡∏õ‡∏¥‡∏î':'‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î'); return;
    }
  }, false);
})();

// ‡πÇ‡∏´‡∏•‡∏î main.js ‡πÅ‡∏ö‡∏ö‡∏°‡∏µ fallback/‡∏î‡∏µ‡∏ö‡∏±‡∏Å
async function bootMain(){
  const url = new URL('./game/main.js', location.href).href;
  log('[boot] try ' + url);
  try{
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á (‡∏Å‡∏±‡∏ô path ‡∏ú‡∏¥‡∏î)
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok){ throw new Error(`HTTP ${res.status} ${res.statusText}`); }
  }catch(e){
    showWarn(['‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ./game/main.js', String(e?.message||e)]);
    return;
  }

  try{
    await import(url + `?v=${Date.now()}`);
    log('[boot] imported main ‚úì');
  }catch(e){
    showWarn(['‚ö†Ô∏è ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô main.js', String(e?.message||e)]);
    return;
  }

  if (!window.HHA || typeof window.HHA.startGame!=='function'){
    showWarn('‡πÇ‡∏´‡∏•‡∏î main.js ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö HHA.startGame');
  }
}

// ‡∏õ‡∏∏‡πà‡∏° Start: strong-bind (capture + pointerup + touchend + key)
(function bindStartStrong(){
  const btn = document.getElementById('btn_start');
  if (!btn) return;
  const clone = btn.cloneNode(true);
  btn.replaceWith(clone);
  const fire = (e)=>{ e.preventDefault(); e.stopPropagation();
    try{
      if (window.HHA?.startGame){ window.HHA.startGame(); return; }
      // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‚Üí boot ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
      bootMain().then(()=>{ if (window.HHA?.startGame){ window.HHA.startGame(); } else { showWarn('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡πÑ‡∏°‡πà‡∏°‡∏µ HHA.startGame'); } });
    }catch(err){ showWarn(['‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', String(err?.message||err)]); }
  };
  ['click','pointerup','touchend'].forEach(ev=> clone.addEventListener(ev, fire, {capture:true, passive:false}));
  clone.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); fire(e); }}, {capture:true});
})();

// ‡πÄ‡∏£‡∏¥‡πà‡∏° boot ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°)
bootMain();

// global onerror ‚Üí ‡πÑ‡∏°‡πà‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß
window.addEventListener('error', (e)=>{
  showWarn('‚ö†Ô∏è Runtime error: ' + (e.message||'script error'));
  log('[error] ' + (e.filename||'') + ':' + (e.lineno||0) + ' ' + (e.message||''));
});
window.addEventListener('unhandledrejection', (e)=>{
  showWarn('‚ö†Ô∏è Unhandled Promise: ' + String(e.reason));
  log('[unhandledrejection] ' + String(e.reason));
});
</script>
</body>
</html>
