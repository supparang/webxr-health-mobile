<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hero Health Academy</title>

  <base href="/webxr-health-mobile/HeroHealth/">
  <link rel="stylesheet" href="styles/game.css" />

  <style>
    #c{position:fixed;inset:0;z-index:1;pointer-events:none}
    .hud,.menu,.modal,.coach,.item{z-index:200;pointer-events:auto}
    .hud{font-size:18px;font-weight:800;text-shadow:0 2px 6px #000}
    .item{font-size:56px;min-width:56px;min-height:56px}
    #statusLine{position:fixed;top:76px;left:50%;transform:translateX(-50%);
      background:rgba(0,0,0,.45);color:#fff;padding:6px 12px;border-radius:10px;
      font-weight:900;z-index:300}
    #bootWarn{position:fixed;top:0;left:0;right:0;background:#b00020;color:#fff;
      padding:10px 12px;font-weight:700;z-index:9999;display:none;white-space:pre-wrap}
    #devStub{position:fixed;left:12px;bottom:12px;background:#242a;color:#fff;
      border:1px solid #444;padding:10px 12px;border-radius:10px;z-index:950;display:none}
  </style>
</head>
<body>
  <header class="brand">
    <div id="brandTitle">HERO HEALTH ACADEMY</div>
    <div class="spacer"></div>
    <button id="langToggle" class="btn">üáπüá≠ TH/EN</button>
    <button id="gfxToggle" class="btn">üéõÔ∏è ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å: ‡∏õ‡∏Å‡∏ï‡∏¥</button>
    <button id="soundToggle" class="btn">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î</button>
  </header>

  <canvas id="c"></canvas>

  <section class="hud">
    <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="score">0</b> | ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö: <b id="combo">x0</b> | ‡πÄ‡∏ß‡∏•‡∏≤: <b id="time">60</b>s</div>
    <div id="feverBarWrap" class="bar slim"><div id="feverBar" style="width:0%"></div></div>
    <div id="missionLine" style="display:none;">‚Äî</div>
    <div id="targetWrap" style="display:none"></div>
    <div id="plateTracker" style="display:none"></div>
    <div id="hydroWrap" style="display:none">
      üíß ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥: <span id="hydroLabel">‚Äî</span>
      <div class="bar"><div id="hydroBar" style="width:50%"></div></div>
    </div>
  </section>

  <div id="statusLine">‡πÇ‡∏´‡∏°‡∏î: ‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞ ‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‡∏õ‡∏Å‡∏ï‡∏¥</div>

  <div id="coachHUD" class="coach" style="display:none"><div id="coachText">...</div></div>

  <section id="menuBar" class="menu">
    <div class="row">
      <button class="tag" data-action="mode" data-value="goodjunk"  id="m_goodjunk">ü•ó ‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</button>
      <button class="tag" data-action="mode" data-value="groups"    id="m_groups">üçΩÔ∏è ‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà</button>
      <button class="tag" data-action="mode" data-value="hydration" id="m_hydration">üíß ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥</button>
      <button class="tag" data-action="mode" data-value="plate"     id="m_plate">üç± ‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</button>
    </div>
    <div class="row">
      <button class="tag" data-action="diff" data-value="Easy"   id="d_easy">‡∏á‡πà‡∏≤‡∏¢</button>
      <button class="tag" data-action="diff" data-value="Normal" id="d_normal">‡∏õ‡∏Å‡∏ï‡∏¥</button>
      <button class="tag" data-action="diff" data-value="Hard"   id="d_hard">‡∏¢‡∏≤‡∏Å</button>
      <span class="modeLabel"><span id="t_mode">‡πÇ‡∏´‡∏°‡∏î</span>: <b id="modeName">‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</b> ‚Ä¢ <span id="t_diff">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</span>: <b id="difficulty">‡∏õ‡∏Å‡∏ï‡∏¥</b></span>
    </div>
    <div class="row">
      <button class="btn" data-action="start"   id="btn_start">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
      <button class="btn" data-action="pause"   id="btn_pause">‚è∏ ‡∏û‡∏±‡∏Å</button>
      <button class="btn" data-action="restart" id="btn_restart">‚Üª ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      <button class="btn" data-action="help"    id="btn_help">‚ùì ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
    </div>
  </section>

  <div id="help" class="modal" style="display:none">
    <div class="card">
      <h3 id="h_help">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h3>
      <pre id="helpBody">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Üí ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏î‡∏±‡∏Å</pre>
      <button class="btn" id="btn_ok">‡πÇ‡∏≠‡πÄ‡∏Ñ</button>
    </div>
  </div>

  <div id="result" class="modal" style="display:none">
    <div class="card">
      <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
      <div id="resCore"></div>
      <div style="margin-top:12px;display:flex;gap:8px;">
        <button class="btn" id="btn_replay">‚Üª ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn" id="btn_home">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
      </div>
    </div>
  </div>

  <audio id="sfx-good"    preload="auto" src="assets/sfx/good.mp3"></audio>
  <audio id="sfx-bad"     preload="auto" src="assets/sfx/bad.mp3"></audio>
  <audio id="sfx-powerup" preload="auto" src="assets/sfx/powerup.mp3"></audio>

  <div id="bootWarn"></div>
  <div id="devStub">‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô: main.js ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏à‡∏≤‡∏Å Pages<br>UI/‡∏õ‡∏∏‡πà‡∏°/‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</div>

  <!-- Loader: ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà + ‡πÄ‡∏õ‡∏¥‡∏î dev stub ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö -->
  <script type="module">
    (async () => {
      window.__HHA_BOOT_OK = false;
      const tried = [];
      const candidates = [
        // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á
        'https://supparang.github.io/webxr-health-mobile/HeroHealth/game/main.js',
        // ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        'game/main.js','./game/main.js','/webxr-health-mobile/HeroHealth/game/main.js',
        // ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        'game/index.js','game/bundle.js','game/main.mjs','game/app.js',
        // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á build ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        'dist/main.js','dist/assets/index.js','assets/index.js'
      ];
      const warn = document.getElementById('bootWarn');

      for (const url of candidates) {
        try {
          tried.push(url);
          await import(url + '?v=' + Date.now());
          warn.style.display = 'none';
          console.log('[Loader] OK:', url);
          return;
        } catch (e) {
          console.warn('[Loader] Fail:', url, e);
        }
      }

      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á -> ‡πÄ‡∏õ‡∏¥‡∏î dev stub ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
      warn.textContent = '‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‡∏•‡∏≠‡∏á URL ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:\n- ' + tried.join('\n- ') + '\n‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏≤‡∏ò/‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà-‡πÄ‡∏•‡πá‡∏Å ‡πÅ‡∏•‡∏∞‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å publish ‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏ô Pages';
      warn.style.display = 'block';
      document.getElementById('devStub').style.display='block';

      // === Dev stub: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Start/Help/Replay ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡πà‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ===
      const $ = (s)=>document.querySelector(s);
      const $$= (s)=>document.querySelectorAll(s);
      let running=false, timeLeft=60, score=0, combo=0, spawnId=0, tickId=0;

      function setHUD(){ $('#score').textContent=score; $('#combo').textContent='x'+combo; $('#time').textContent=timeLeft; }
      function place(el){ el.style.left=(8+Math.random()*84)+'vw'; el.style.top=(18+Math.random()*70)+'vh'; }
      function spawn(){
        if(!running) return;
        const b=document.createElement('button');
        b.className='item'; b.textContent=Math.random()<0.7?'üçé':'üçî';
        b.style.position='fixed'; b.style.zIndex='220';
        b.style.minWidth='56px'; b.style.minHeight='56px';
        place(b);
        b.onclick=()=>{ if(b.textContent==='üçé'){ score+=5; combo++; } else { score-=3; combo=0; } setHUD(); b.remove(); };
        document.body.appendChild(b);
        setTimeout(()=>b.remove(), 2800);
        spawnId=setTimeout(spawn, 700);
      }
      function tick(){
        if(!running) return;
        timeLeft--; setHUD();
        if(timeLeft<=0){ end(); return; }
        tickId=setTimeout(tick,1000);
      }
      function start(){
        end(true); running=true; timeLeft=60; score=0; combo=0; setHUD(); spawn(); tick();
        $('#statusLine').textContent='‡πÇ‡∏´‡∏°‡∏î: (dev stub) ‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‡∏õ‡∏Å‡∏ï‡∏¥';
      }
      function end(silent=false){
        running=false; clearTimeout(spawnId); clearTimeout(tickId);
        $$('.item').forEach(el=>el.remove());
        if(!silent){ $('#resCore').innerHTML=`<p>(dev stub)</p><p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b>${score}</b> ‚Ä¢ ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö: <b>x${combo}</b></p>`; $('#result').style.display='flex'; }
      }

      document.addEventListener('click',(e)=>{
        const btn=e.target.closest('#menuBar button'); if(!btn) return;
        const a=btn.dataset.action;
        if(a==='start') start();
        if(a==='pause'){ running=!running; if(running){ spawn(); tick(); } }
        if(a==='restart'){ start(); }
        if(a==='help'){ $('#help').style.display='flex'; }
      });
      $('#btn_ok')?.addEventListener('click',()=>$('#help').style.display='none'));
      $('#btn_replay')?.addEventListener('click',()=>{ $('#result').style.display='none'; start(); });
      $('#btn_home')?.addEventListener('click',()=>{ $('#result').style.display='none'; });

      // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô canvas ‡∏ö‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å
      const c=document.getElementById('c'); if(c){ c.style.pointerEvents='none'; c.style.zIndex='1'; }
    })();
  </script>
</body>
</html>
