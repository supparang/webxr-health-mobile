<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Hero Health Academy</title>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:#0b1020;--fg:#e8f3ff;--muted:#94a3b8;--accent:#22d3ee;}
body{margin:0;background:radial-gradient(1200px 800px at 50% -10%,#173056 10%,var(--bg) 55%);color:var(--fg);
font:500 16px/1.5 ui-rounded,system-ui,Segoe UI,Arial,sans-serif;}
.game-wrap{position:relative;min-height:100dvh;overflow:hidden;}
#gameLayer,#spawnHost{position:fixed;inset:0;}
#menuBar{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;
background:linear-gradient(#0b1020d0,#0b1020d0);pointer-events:auto;}
.menu-card{width:min(860px,94vw);background:#0e1930;border:1px solid #132a4f;border-radius:16px;
padding:18px;box-shadow:0 18px 60px rgba(0,0,0,.45);}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;
border-radius:12px;background:#0f1e38;color:#e6f2ff;border:1px solid #16325d;cursor:pointer;}
.btn:hover{filter:brightness(1.08)}
#powerBarWrap{position:fixed;left:12px;bottom:12px;z-index:18;width:min(380px,92vw);}
#powerBar{position:relative;height:14px;border-radius:999px;background:#0a1931;border:1px solid #0f2a54;overflow:hidden;}
#powerFill{position:absolute;inset:0;width:0%;}
.fire{position:absolute;left:0;top:0;bottom:0;width:100%;
background:radial-gradient(30px 24px at 20% 110%,rgba(255,200,0,.9),rgba(255,130,0,.65)55%,rgba(255,80,0,.0)70%),
radial-gradient(26px 20px at 45% 110%,rgba(255,210,80,.85),rgba(255,120,0,.55)55%,rgba(255,80,0,.0)70%),
radial-gradient(34px 26px at 70% 110%,rgba(255,190,40,.9),rgba(255,110,0,.55)55%,rgba(255,80,0,.0)70%),
linear-gradient(0deg,rgba(255,140,0,.65),rgba(255,100,0,.25));
mix-blend-mode:screen;animation:fireRise .9s ease-in-out infinite;}
@keyframes fireRise{0%{transform:translateY(8px) scaleY(.9)}50%{transform:translateY(0) scaleY(1)}100%{transform:translateY(8px) scaleY(.9)}}
</style>
</head>
<body>

<div class="game-wrap">
  <div id="gameLayer"></div>
  <div id="spawnHost"></div>

  <div id="menuBar">
    <div class="menu-card">
      <h2 style="margin:4px 0 12px;font:900 22px ui-rounded">Hero Health Academy</h2>
      <div>
        <h3>Play Mode</h3>
        <div class="btn" data-mode="goodjunk">ü•ó Good vs Junk</div>
        <div class="btn" data-mode="groups">üß∫ 5 Food Groups</div>
        <div class="btn" data-mode="hydration">üíß Hydration</div>
        <div class="btn" data-mode="plate">üçΩÔ∏è Healthy Plate</div>
      </div>
      <hr style="margin:12px 0;border-color:#133"/>
      <div>
        <h3>Difficulty</h3>
        <div class="btn" data-diff="Easy">Easy</div>
        <div class="btn" data-diff="Normal">Normal</div>
        <div class="btn" data-diff="Hard">Hard</div>
      </div>
      <hr style="margin:12px 0;border-color:#133"/>
      <div class="btn" data-action="start">‚ñ∂Ô∏è Start</div>
      <div class="btn" data-action="howto">‚ùì How to Play</div>
    </div>
  </div>

  <div id="powerBarWrap"><div id="powerBar"><div id="powerFill"><div class="fire"></div></div></div></div>
</div>

<!-- SFX -->
<audio id="sfx-good" preload="auto" src="assets/sfx/good.mp3"></audio>
<audio id="sfx-bad" preload="auto" src="assets/sfx/bad.mp3"></audio>
<audio id="sfx-perfect" preload="auto" src="assets/sfx/perfect.mp3"></audio>
<audio id="sfx-tick" preload="auto" src="assets/sfx/tick.mp3"></audio>
<audio id="sfx-powerup" preload="auto" src="assets/sfx/powerup.mp3"></audio>

<script type="module">
import { sfx as SFX } from './core/sfx.js';
import { Engine } from './core/engine.js';
import * as goodjunk from './game/modes/goodjunk.js';
import * as groups from './game/modes/groups.js';
import * as hydration from './game/modes/hydration.js';
import * as plate from './game/modes/plate.js';

const engine = new Engine();
engine.sfx = SFX;
SFX.loadIds(['sfx-good','sfx-bad','sfx-perfect','sfx-tick','sfx-powerup']);

const MODS = {goodjunk,groups,hydration,plate};
let current = {mode:'goodjunk',diff:'Normal'};

window.hha_start = ()=> startGame(current.mode,current.diff);
window.hha_setMode = (m)=> current.mode=m;
window.hha_setDiff = (d)=> current.diff=d;

function startGame(mode,diff){
  alert('üéÆ Start: '+mode+' ('+diff+')');
  document.getElementById('menuBar').style.display='none';
  SFX.good();
}

// HOTFIX: universal click/touch delegate
(function(){
  const mb=document.getElementById('menuBar');
  function closest(ev,sel){return ev.target.closest(sel);}
  function onHit(ev){
    let el;
    if(el=closest(ev,'[data-mode]')){window.hha_setMode(el.dataset.mode);return;}
    if(el=closest(ev,'[data-diff]')){window.hha_setDiff(el.dataset.diff);return;}
    if(el=closest(ev,'[data-action="start"]')){window.hha_start();return;}
    if(el=closest(ev,'[data-action="howto"]')){alert('‡πÅ‡∏ï‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏î‡∏µ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î!');return;}
  }
  ['click','touchend','pointerup'].forEach(e=>mb.addEventListener(e,onHit,{passive:true}));
})();

// error display
window.addEventListener('error',e=>{
  const box=document.createElement('div');
  box.style.cssText='position:fixed;left:0;right:0;bottom:0;z-index:10000;background:#7f1d1d;color:#fff;padding:8px 12px;font:600 13px ui-rounded';
  box.textContent='‚ö†Ô∏è '+(e.message||'Script error');
  document.body.appendChild(box);
});
</script>
</body>
</html>
