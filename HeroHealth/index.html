<!doctype html>
<html lang="th" data-hha-mode="goodjunk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hero Health Academy — Hub</title>

  <!-- Styles -->
  <link rel="stylesheet" href="./styles/game.css" />
  <link rel="stylesheet" href="./styles/groups.css" />

  <!-- Meta base so boot.js ใช้ path สม่ำเสมอ -->
  <base href="./" />
</head>
<body data-mode="goodjunk">
  <div id="app">
    <!-- Header/Hero -->
    <header id="hero">
      <h1>Hero Health Academy</h1>
      <p class="sub">Games: Good vs Junk · 5 Food Groups · Hydration · Healthy Plate</p>
    </header>

    <!-- Hub Menu -->
    <nav id="menuBar" class="menu" aria-label="Game Selection">
      <div class="grid">
        <button id="m_goodjunk"   class="tile active" data-mode="goodjunk">
          <i>🥦</i><b>Good vs Junk</b><small>Tap the healthy, dodge the junk</small>
        </button>
        <button id="m_groups"     class="tile" data-mode="groups">
          <i>🎯</i><b>5 Food Groups</b><small>Match the target group</small>
        </button>
        <button id="m_hydration"  class="tile" data-mode="hydration">
          <i>💧</i><b>Hydration</b><small>Keep 45–65%</small>
        </button>
        <button id="m_plate"      class="tile" data-mode="plate">
          <i>🍱</i><b>Healthy Plate</b><small>Fill quotas without overfill</small>
        </button>
      </div>

      <div class="row">
        <div class="seg">
          <span class="lbl">Mode</span>
          <span id="modeName" class="value">Good vs Junk</span>
        </div>
        <div class="seg">
          <span class="lbl">Difficulty</span>
          <div class="btns">
            <button id="d_easy"   class="chip" data-diff="Easy">Easy</button>
            <button id="d_normal" class="chip active" data-diff="Normal">Normal</button>
            <button id="d_hard"   class="chip" data-diff="Hard">Hard</button>
          </div>
        </div>
        <div class="seg">
          <span class="lbl">Language</span>
          <button id="langToggle" class="chip">TH</button>
        </div>
      </div>

      <div class="cta">
        <button id="btn_start" class="start">Start</button>
      </div>
    </nav>

    <!-- HUD -->
    <div id="hudWrap" class="hud" aria-live="polite">
      <div id="targetWrap" class="pill" style="display:none">—</div>
      <div id="scoreTime">
        <div class="pill">🧮 <span id="score">0</span></div>
        <div class="pill">⏱️ <span id="time">45</span>s</div>
      </div>
      <!-- Mini Quests -->
      <div id="questBar" aria-label="Mini Quests">
        <ul id="questChips"></ul>
      </div>
    </div>

    <!-- Coach bubble -->
    <div id="coachHUD" class="coach">
      <div id="coachText">Ready?</div>
    </div>

    <!-- Mission / Toast lines (click-safe) -->
    <div id="missionLine" class="missionLine" role="status" aria-live="polite"></div>
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Game layer (DOM-spawn target host) -->
    <div id="gameLayer">
      <div id="spawnHost" aria-hidden="true"></div>
    </div>

    <!-- Audio (SFX/BGM) -->
    <audio id="sfx-good"     preload="auto" src="./assets/sfx/good.mp3"></audio>
    <audio id="sfx-bad"      preload="auto" src="./assets/sfx/bad.mp3"></audio>
    <audio id="sfx-perfect"  preload="auto" src="./assets/sfx/perfect.mp3"></audio>
    <audio id="sfx-tick"     preload="auto" src="./assets/sfx/tick.mp3"></audio>
    <audio id="sfx-powerup"  preload="auto" src="./assets/sfx/powerup.mp3"></audio>
    <audio id="bgm-main"     preload="auto" src="./assets/bgm/loop.mp3" loop></audio>
  </div>

  <!-- Boot (ตรวจ main.js แล้วค่อย import) -->
  <script type="module" src="./game/boot.js"></script>
  <!-- Main runtime -->
  <script type="module" src="./game/main.js"></script>

  <!-- Hub wiring (เลือกโหมด/ความยาก + sync label) -->
  <script>
    (function(){
      const $ = s => document.querySelector(s);
      const $$= s => document.querySelectorAll(s);

      window.__HHA_MODE = window.__HHA_MODE || 'goodjunk';
      window.__HHA_DIFF = window.__HHA_DIFF || 'Normal';

      function setMode(m){
        window.__HHA_MODE = m;
        document.documentElement.setAttribute('data-hha-mode', m);
        document.body.setAttribute('data-mode', m);
        $$('.tile').forEach(t=>t.classList.toggle('active', t.dataset.mode===m));
        const mapTH = {goodjunk:'ดี vs ขยะ', groups:'จาน 5 หมู่', hydration:'สมดุลน้ำ', plate:'จัดจานสุขภาพ'};
        const mapEN = {goodjunk:'Good vs Junk', groups:'5 Food Groups', hydration:'Hydration', plate:'Healthy Plate'};
        const lang = (localStorage.getItem('hha_lang')||'TH').toUpperCase();
        const L = lang==='TH' ? mapTH : mapEN;
        const name = $('#modeName'); if (name) name.textContent = L[m];
      }
      function setDiff(d){
        window.__HHA_DIFF = d;
        $$('.chip[data-diff]').forEach(c=>c.classList.toggle('active', c.dataset.diff===d));
      }

      // bind mode buttons
      $$('#menuBar .tile').forEach(b=>{
        b.addEventListener('click', ()=> setMode(b.dataset.mode));
      });
      // bind diff buttons
      $$('#menuBar .chip[data-diff]').forEach(b=>{
        b.addEventListener('click', ()=> setDiff(b.dataset.diff));
      });

      // lang toggle (UI only; main.js จะอ่านอีกครั้ง)
      $('#langToggle')?.addEventListener('click', ()=>{
        const cur=(localStorage.getItem('hha_lang')||'TH').toUpperCase();
        const nxt = cur==='TH' ? 'EN' : 'TH';
        localStorage.setItem('hha_lang', nxt);
        $('#langToggle').textContent = nxt;
        setMode(window.__HHA_MODE); // refresh label
      });

      // ensure initial
      setMode(window.__HHA_MODE);
      setDiff(window.__HHA_DIFF);

      // Start button — call runtime
      const start = document.getElementById('btn_start');
      if (start){
        const clone = start.cloneNode(true);
        start.parentNode.replaceChild(clone, start);
        clone.addEventListener('click', (e)=>{
          e.preventDefault();
          if (window.HHA?.startGame) window.HHA.startGame();
          else if (window.start) window.start();
        }, {capture:true});
      }
    })();
  </script>
</body>
</html>
