<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Hero Health VR</title>

  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame + Troika (stable) -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-troika-text@0.11.0/dist/aframe-troika-text.min.js"></script>

  <style>
    :root { color-scheme: light dark; }
    html,body {
      margin:0; padding:0; height:100%;
      background:#000;
      font-family: system-ui, Segoe UI, Inter, Roboto, "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji", sans-serif;
    }
    .game-wrap { position:fixed; inset:0; overflow:hidden; }

    /* HUD */
    #hudRoot { position:fixed; inset:0; pointer-events:none; z-index:500; }
    .hud-top {
      position:absolute; left:50%; top:14px; transform:translateX(-50%);
      display:flex; gap:10px; align-items:flex-start; pointer-events:none;
    }
    .score-box {
      pointer-events:auto; background:#0b1220cc; backdrop-filter:blur(6px);
      border:1px solid #334155; border-radius:14px; padding:10px 12px;
      color:#e2e8f0; min-width:180px; display:flex; flex-direction:column; gap:6px;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .score-row { display:flex; justify-content:space-between; gap:10px; font-weight:800; }
    .score-row .k { color:#93c5fd; }
    .score-row .v { color:#f8fafc; }
    #feverBarDock { margin-top:6px; }

    /* TIME pill (top-right) */
    #timePill {
      position:fixed; right:18px; top:12px; z-index:560;
      padding:6px 10px; border-radius:999px;
      background:#0b1220cc; color:#fff; font:800 12px system-ui;
      border:1px solid #334155; box-shadow:0 4px 16px rgba(0,0,0,.35);
      letter-spacing:.2px; user-select:none; -webkit-user-select:none;
      transition:filter .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
    }
    /* glow 10s ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ */
    #timePill.warn {
      filter: drop-shadow(0 0 10px rgba(250,204,21,.65));
      box-shadow:0 0 20px rgba(250,204,21,.25);
      background: #1f2937; color:#fde68a; border-color:#fbbf24;
      animation: glowPulse 1s ease-in-out infinite;
    }
    /* ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÄ‡∏£‡πá‡∏ß 5s ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ */
    #timePill.danger {
      filter: drop-shadow(0 0 12px rgba(239,68,68,.8));
      box-shadow:0 0 24px rgba(239,68,68,.35);
      background:#111827; color:#fecaca; border-color:#ef4444;
      animation: dangerPulse .5s ease-in-out infinite;
    }
    @keyframes glowPulse {
      0%,100% { transform:translateZ(0) scale(1);   }
      50%     { transform:translateZ(0) scale(1.06);}
    }
    @keyframes dangerPulse {
      0%,100% { transform:translateZ(0) scale(1);    opacity:1; }
      50%     { transform:translateZ(0) scale(1.10); opacity:.75; }
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (Desktop) */
    .start-fab {
      position:absolute; right:16px; bottom:16px; z-index:520; pointer-events:auto;
      background:#2563eb; color:#fff; border:0; border-radius:999px;
      padding:12px 16px; font-weight:900;
      box-shadow:0 10px 30px rgba(0,0,0,.45); cursor:pointer;
    }

    /* Countdown overlay 3-2-1-GO (ID ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö main.js => #countOverlay) */
    #countOverlay{
      position:fixed; inset:0; z-index:700; display:none;
      background:rgba(0,0,0,.45); backdrop-filter:blur(2px);
      align-items:center; justify-content:center;
    }
    #countOverlay .num{
      font:900 clamp(64px,12vw,160px) system-ui; color:#e5edff;
      text-shadow:0 10px 32px rgba(0,0,0,.6);
      transform:scale(.8); opacity:0; will-change:transform,opacity;
      animation: cdPop .65s ease forwards;
    }
    #countOverlay.go .num{ color:#86efac; text-shadow:0 10px 40px rgba(16,185,129,.45); }
    @keyframes cdPop {
      0%   { transform:scale(.6); opacity:0; }
      40%  { transform:scale(1.15); opacity:1; }
      100% { transform:scale(1.0); opacity:1; }
    }

    #spawnHost { position:absolute; inset:0; pointer-events:none; z-index:650; }
    @media (max-width:640px){ .score-box{ min-width:160px; } }
  </style>
</head>
<body>
  <div class="game-wrap">
    <a-scene renderer="antialias:true; colorManagement:true"
             background="color: #101826">
      <a-assets></a-assets>

      <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
      <a-entity position="0 1.6 0">
        <a-camera wasd-controls-enabled="false"></a-camera>
      </a-entity>

      <!-- ‡πÅ‡∏™‡∏á -->
      <a-entity light="type:ambient; intensity:0.55"></a-entity>
      <a-entity light="type:directional; intensity:0.9" position="0 2 1"></a-entity>

      <!-- ‡πÅ‡∏ú‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° -->
      <a-entity id="startPanel" position="0 1.4 -1.6" visible="true">
        <a-entity geometry="primitive:plane; width:1.6; height:0.6"
                  material="color:#0b1220; opacity:0.85; side:double"></a-entity>
        <a-entity id="startLbl"
          troika-text="value: ‡πÄ‡∏£‡∏¥‡πà‡∏°: GOODJUNK; color:#93C5FD; fontSize:0.18; maxWidth:1.4; anchor:center; baseline:top;"
          position="0 0.16 0.02"></a-entity>
        <a-entity id="vrStartBtn"
          geometry="primitive:plane; width:0.9; height:0.22"
          material="color:#2563EB" position="0 -0.12 0.02"
          class="clickable"></a-entity>
        <a-entity troika-text="value: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°; color:#FFFFFF; fontSize:0.12; anchor:center; baseline:middle;"
          position="0 -0.12 0.03"></a-entity>
      </a-entity>

      <!-- ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î -->
      <a-entity id="modeMenu" position="-0.9 1.2 -1.6" visible="false">
        <a-entity geometry="primitive:plane; width:1.2; height:0.9"
                  material="color:#0b1220; opacity:0.85"></a-entity>
        <a-entity troika-text="value: ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°; color:#E2E8F0; fontSize:0.14; anchor:center;"
                  position="0 0.35 0.02"></a-entity>

        <a-entity data-mode="goodjunk" position="0 0.18 0.02"
                  geometry="primitive:plane; width:1.0; height:0.18"
                  material="color:#1E293B" class="clickable"></a-entity>
        <a-entity troika-text="value: Good vs Junk; color:#A5B4FC; fontSize:0.12; anchor:center;"
                  position="0 0.18 0.03"></a-entity>

        <a-entity data-mode="groups" position="0 -0.02 0.02"
                  geometry="primitive:plane; width:1.0; height:0.18"
                  material="color:#1E293B" class="clickable"></a-entity>
        <a-entity troika-text="value: Food Groups; color:#FDE68A; fontSize:0.12; anchor:center;"
                  position="0 -0.02 0.03"></a-entity>

        <a-entity data-mode="hydration" position="0 -0.22 0.02"
                  geometry="primitive:plane; width:1.0; height:0.18"
                  material="color:#1E293B" class="clickable"></a-entity>
        <a-entity troika-text="value: Hydration; color:#93C5FD; fontSize:0.12; anchor:center;"
                  position="0 -0.22 0.03"></a-entity>

        <a-entity data-mode="plate" position="0 -0.42 0.02"
                  geometry="primitive:plane; width:1.0; height:0.18"
                  material="color:#1E293B" class="clickable"></a-entity>
        <a-entity troika-text="value: Balanced Plate; color:#86EFAC; fontSize:0.12; anchor:center;"
                  position="0 -0.42 0.03"></a-entity>
      </a-entity>

      <!-- ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• VR -->
      <a-entity id="resultLbl" position="0 1.9 -2" visible="false"
        troika-text="value: ‡∏à‡∏ö‡πÄ‡∏Å‡∏°; color:#F8FAFC; fontSize:0.22; anchor:center;">
      </a-entity>
    </a-scene>

    <!-- HUD DOM Overlay -->
    <div id="hudRoot">
      <div id="hudTop" class="hud-top">
        <div class="score-box" data-hud="scorebox">
          <div class="score-row"><span class="k">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span><span id="hudScore" class="v">0</span></div>
          <div class="score-row"><span class="k">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö</span><span id="hudCombo" class="v">0</span></div>
          <div id="feverBarDock"></div>
        </div>
      </div>
    </div>

    <div id="spawnHost"></div>
    <div id="timePill">TIME 60s</div>
    <!-- üëá id ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô countOverlay ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö main.js -->
    <div id="countOverlay"><div class="num">3</div></div>
    <button id="btnStart" class="start-fab">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
  </div>

  <!-- Bridge VR start button to DOM start -->
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      const vrBtn=document.getElementById('vrStartBtn');
      const domBtn=document.getElementById('btnStart');
      if(vrBtn&&domBtn){
        vrBtn.addEventListener('click',e=>{
          e.preventDefault(); domBtn.click();
        });
      }
    });
  </script>

  <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Quest HUD ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ Goal/Mini ‡∏Ç‡∏∂‡πâ‡∏ô -->
  <script type="module">
    import '../vr/quest-hud.js';
  </script>

  <!-- ‚úÖ TimePill shim: sync ‡πÄ‡∏ß‡∏•‡∏≤/‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏ö bubble ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
  <script>
    (function(){
      const pill = document.getElementById('timePill');
      function setTimePill(sec){
        if(!pill) return;
        pill.textContent = `TIME ${Math.max(0, sec|0)}s`;
        pill.classList.toggle('warn',   sec<=10 && sec>5);
        pill.classList.toggle('danger', sec<=5);
      }
      window.addEventListener('hha:time', (e)=>{
        const sec = (e.detail?.sec|0);
        setTimePill(sec);
      });
      // ‡∏ñ‡πâ‡∏≤ main.js ‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á #hudTimeBubble ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡∏ñ‡∏≠‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥
      const rm = ()=>{ const b=document.getElementById('hudTimeBubble'); if(b) b.remove(); };
      document.addEventListener('DOMContentLoaded', rm);
      setTimeout(rm, 1000);
    })();
  </script>

  <!-- Entrypoint -->
  <script type="module" src="./game/main.js"></script>
</body>
</html>
