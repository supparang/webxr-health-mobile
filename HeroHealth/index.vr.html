<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Hero Health Academy VR</title>
  <meta name="color-scheme" content="light dark"/>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Three.js ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏• -->
  <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>

  <style>
    body { margin:0; background:#0b0d14; overflow:hidden; }
    #hudOverlay { position:absolute; top:0; left:0; width:100%; color:#fff; font-family:sans-serif; text-align:center; pointer-events:none; }
    #hudOverlay .status { position:absolute; bottom:1rem; left:0; width:100%; font-size:1.1rem; color:#ddd; }
    button { background:#22c55e; border:none; padding:0.8rem 1.4rem; border-radius:0.5rem; color:#fff; font-size:1rem; cursor:pointer; }
    button:hover { background:#16a34a; }
    .menuWrap { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; gap:1rem; }
  </style>
</head>

<body>
  <a-scene background="color:#0b0d14" cursor="rayOrigin: mouse" raycaster="objects: .clickable" vr-mode-ui="enabled: true">
    <a-entity id="spawnZone" position="0 1.2 -1.2"></a-entity>
  </a-scene>

  <!-- ‚úÖ HUD Overlay -->
  <div id="hudOverlay">
    <div id="hubMenu" class="menuWrap">
      <h2 style="color:#fff;">‡πÄ‡∏£‡∏¥‡πà‡∏°: HERO HEALTH ACADEMY</h2>

      <div>
        <label style="color:#ccc;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î:</label>
        <select id="selMode">
          <option value="goodjunk">Good vs Junk</option>
          <option value="groups">Food Groups</option>
          <option value="hydration">Hydration</option>
          <option value="plate">Healthy Plate</option>
        </select>
      </div>

      <div>
        <label style="color:#ccc;">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</label>
        <select id="selDiff">
          <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
          <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
          <option value="hard">‡∏¢‡∏≤‡∏Å</option>
        </select>
      </div>

      <button id="btnStart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>

    <div class="status">
      <span id="bootStatus">Status: Preparing...</span>
    </div>
  </div>

  <!-- ‚úÖ ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å -->
  <script type="module">
    const statusEl = document.getElementById('bootStatus');
    const setStatus = (m)=>{ if(statusEl) statusEl.textContent = m; console.log(m); };

    window.addEventListener('error', e=> setStatus('JS Error: '+(e.message||'unknown')));
    window.addEventListener('unhandledrejection', e=> setStatus('Promise Error: '+(e.reason?.message||e.reason||'unknown')));

    const MODE_URL = {
      goodjunk: './modes/goodjunk.safe.js',
      groups: './modes/groups.safe.js',
      hydration: './modes/hydration.safe.js',
      plate: './modes/plate.safe.js'
    };

    const btnStart = document.getElementById('btnStart');
    const selMode  = document.getElementById('selMode');
    const selDiff  = document.getElementById('selDiff');
    const hubMenu  = document.getElementById('hubMenu');

    btnStart.addEventListener('click', async ()=>{
      const mode = selMode.value || 'goodjunk';
      const diff = selDiff.value || 'normal';
      const host = document.getElementById('spawnZone');
      const url  = MODE_URL[mode] || MODE_URL.goodjunk;

      setStatus(`Status: Loading ${mode} (${diff})...`);
      hubMenu.style.display = 'none';

      try{
        const mod = await import(url + '?v=' + Date.now());
        if (!mod?.boot) throw new Error('No boot() in '+url);
        await mod.boot({ host, difficulty: diff, goal: 40 });
        setStatus(`Status: Running (${mode}/${diff})`);
      }catch(err){
        console.error(err);
        setStatus('Error: '+(err?.message||err));
        // üî∏ fallback demo
        try{
          const scene = document.querySelector('a-scene');
          const box = document.createElement('a-box');
          box.setAttribute('color','#22c55e');
          box.setAttribute('depth','0.3');
          box.setAttribute('height','0.3');
          box.setAttribute('width','0.3');
          box.setAttribute('position','0 1.2 -1.2');
          box.classList.add('clickable');
          scene.appendChild(box);
          box.addEventListener('click', ()=>box.setAttribute('color','#60a5fa'));
          setStatus('Fallback demo ready (click box)');
        }catch(e2){
          setStatus('Fallback failed: '+(e2?.message||e2));
        }
      }
    });

    setStatus('Status: Ready');
  </script>
</body>
</html>
