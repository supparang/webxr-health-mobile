<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Play – Shadow Breaker</title>

  <!-- ===== Styles ===== -->
  <link rel="stylesheet" href="src/styles.css"/>

  <!-- ===== A-Frame ===== -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ===== FIX: โหลด components.js แบบ Fallback ป้องกัน path พัง ===== -->
  <script>
  (function(){
    const paths = [
      "src/components.js?v=5",
      "./src/components.js?v=5",
      "../src/components.js?v=5",
      "/src/components.js?v=5"
    ];
    function reattachComponent(){
      const scene = document.querySelector("a-scene");
      if (!scene) return setTimeout(reattachComponent, 100);
      scene.removeAttribute("shadow-breaker-game");
      setTimeout(()=>scene.setAttribute("shadow-breaker-game",""), 0);
    }
    function load(i){
      if(i>=paths.length){
        alert("ERROR: ไม่พบ src/components.js – ตรวจสอบโฟลเดอร์ src");
        return;
      }
      const s = document.createElement("script");
      s.src = paths[i];
      s.async = false;
      s.onload = () => {
        console.log("[OK] Loaded:", paths[i]);
        reattachComponent();
      };
      s.onerror = () => load(i+1);
      document.head.appendChild(s);
    }
    load(0);
  })();
  </script>
</head>
<body>

  <!-- ===== HUD Top ===== -->
  <div class="hud" id="hudTop">
    <div class="badge" id="hudGame">Shadow Breaker</div>
    <div class="badge" id="hudScore">Score: 0</div>
    <div class="badge" id="hudCombo">Combo: x1</div>
    <div class="badge" id="hudTime">Time: 60</div>
    <div class="badge" id="hudArcane">Arcane: 0%</div>
    <div class="badge" id="hudCal">Cal: 0.0</div>
    <div class="badge" id="hudLvl">Lv.1</div>
    <div class="badge interactive">
      <a href="index.html" style="color:#8bd8ff;text-decoration:none" id="backLink">Back</a>
    </div>
    <div class="badge interactive">
      <button id="btnTH" class="mini">ไทย</button>
      <button id="btnEN" class="mini">English</button>
    </div>
    <div class="badge" id="hudDBG">DBG</div>
  </div>

  <!-- ===== HUD Bottom ===== -->
  <div class="hud bottom">
    <div class="badge" id="hudHP">ENERGY: 100</div>
    <div class="badge" id="hudOverload">Overload: 0%</div>
    <div class="badge" id="hudBoss">Boss HP: —</div>
    <div class="badge interactive"><button id="btnSkillWheel">Skill Wheel (Q)</button></div>
  </div>

  <div id="toast" class="toast"></div>
  <div id="objective" class="objective"></div>
  <div id="questPanel" class="quest-panel">
    <div id="qTitle" class="quest-title">Daily Quests</div>
    <div id="qList" class="quest-list"></div>
  </div>

  <!-- ===== A-Frame Scene ===== -->
  <a-scene renderer="colorManagement: true" shadow-breaker-game>
    <a-assets>
      <img id="bg" src="https://images.unsplash.com/photo-1499346030926-9a72daac6c63?q=80&w=1920&auto=format&fit=crop" crossorigin="anonymous">
    </a-assets>
    <a-sky src="#bg"></a-sky>
    <a-entity id="spawner"></a-entity>
    <a-entity id="rig" position="0 1.6 0">
      <a-camera id="camera" wasd-controls-enabled="false"></a-camera>
      <a-entity cursor="rayOrigin: mouse; fuse:false"
                raycaster="objects: .clickable; far: 30; interval: 0"></a-entity>
      <a-entity laser-controls="hand: right"
                raycaster="objects: .clickable; far: 30; interval: 0"></a-entity>
      <a-entity laser-controls="hand: left"
                raycaster="objects: .clickable; far: 30; interval: 0"></a-entity>
    </a-entity>
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; intensity: 0.6" position="0 4 -2"></a-entity>
  </a-scene>

  <!-- ===== Helpers ===== -->
  <script>
    (function wireLang(){
      const th=document.getElementById('btnTH'), en=document.getElementById('btnEN');
      const apply=(v)=>{ localStorage.setItem('sb_lang', v);
        if (window.__shadowBreakerSetLang) window.__shadowBreakerSetLang(v);
      };
      if (th) th.onclick = ()=>apply('th');
      if (en) en.onclick = ()=>apply('en');
    })();

    (function ensureHUD(){
      const timeEl = document.getElementById('hudTime');
      const hudTop = document.getElementById('hudTop');
      if (!timeEl) return;
      timeEl.style.display='inline-flex';
      hudTop.style.zIndex='10050';
    })();

    (function autoTestTargets(){
      let count=0;
      const iv = setInterval(()=>{
        if(document.querySelectorAll('.clickable').length===0){
          const sp=document.getElementById('spawner');
          if(sp){
            const e=document.createElement('a-entity');
            e.setAttribute('geometry','primitive: sphere; radius: 0.22');
            e.setAttribute('material','color:#39c5bb; emissive:#0af');
            e.setAttribute('position', `${Math.random()*1-0.5} 1.4 -2.2`);
            e.classList.add('clickable');
            sp.appendChild(e);
          }
        }
        if(++count>5) clearInterval(iv);
      },2000);
    })();
  </script>

  <!-- ===== Extra Safe Component Attach ===== -->
  <script>
  window.addEventListener('load', ()=>{
    const scn = document.querySelector('a-scene');
    if (!scn) return;
    const ok = scn.components && scn.components['shadow-breaker-game'];
    if (!ok){
      scn.removeAttribute('shadow-breaker-game');
      setTimeout(()=>scn.setAttribute('shadow-breaker-game',''), 100);
    }
  });
  </script>
  <!-- ===== EMERGENCY INLINE COMPONENT (runs only if src/components.js missing) ===== -->
<script>
(function(){
  // รอให้ A-Frame โหลดก่อน
  function afterAF(){ return new Promise(r=>{
    if (window.AFRAME) return r();
    const iv=setInterval(()=>{ if(window.AFRAME){ clearInterval(iv); r(); } },50);
  });}

  afterAF().then(()=>{

    // ถ้า shadow-breaker-game ยังไม่ถูก register ให้ลงตัว Fallback นี้
    if (!AFRAME.components['shadow-breaker-game']) {
      console.warn('[SB:FALLBACK] external components.js not detected -> using inline fallback');

      AFRAME.registerComponent('shadow-breaker-game',{
        init:function(){
          // สถานะเริ่มต้น
          this.playing = true;
          this.score = 0;
          this.combo = 1;
          this.timeLeft = 60;      // โหมดจับเวลา
          this.last = performance.now();
          this.spawnEvery = 1000;  // ms
          this.spawnT = performance.now() - this.spawnEvery - 1;

          // HUD ขั้นต่ำให้แสดงแน่
          const S=(id,txt)=>{ const el=document.getElementById(id); if(el){ el.style.display='inline-flex'; el.textContent=txt; } };
          S('hudTime','Time: 60');
          S('hudScore','Score: 0');
          S('hudCombo','Combo: x1');

          this.loop();
        },

        loop:function(){
          if(!this.playing) return;
          requestAnimationFrame(this.loop.bind(this));
          const now=performance.now();
          const dt=(now-this.last)/1000; this.last=now;

          // เดินเวลา
          this.timeLeft = Math.max(0, this.timeLeft - dt);
          const tEl=document.getElementById('hudTime');
          if(tEl) tEl.textContent = 'Time: ' + Math.ceil(this.timeLeft);
          if(this.timeLeft<=0){ this.playing=false; toast('Finished • Score: '+this.score, 2000); return; }

          // สปอว์นเป้า
          if (now - this.spawnT > this.spawnEvery) {
            this.spawnT = now;
            this.spawnTarget();
          }
        },

        spawnTarget:function(){
          const sp=document.getElementById('spawner'); if(!sp) return;
          const e=document.createElement('a-entity');
          e.setAttribute('geometry','primitive: sphere; radius: 0.25');
          e.setAttribute('material','color:#39c5bb; emissive:#0af; metalness:0.1; roughness:0.4');
          const rx=(Math.random()*2-1)*0.9, ry=1.2+Math.random()*0.6, rz=-2.0-Math.random()*0.5;
          e.setAttribute('position', {x:rx,y:ry,z:rz});
          e.classList.add('clickable');
          e.setAttribute('animation__pulse','property: scale; to:1.12 1.12 1.12; dir:alternate; loop:true; dur:650');

          // ยิงแล้วบวกคะแนน
          e.addEventListener('click', ()=>{
            if(!this.playing) return;
            this.combo = Math.min(20, this.combo+1);
            const add = 100 + (this.combo-1)*10;
            this.score += add;
            const sEl=document.getElementById('hudScore'); if(sEl) sEl.textContent='Score: '+this.score;
            const cEl=document.getElementById('hudCombo'); if(cEl) cEl.textContent='Combo: x'+this.combo;
            toast('Great! +'+add, 700);
            e.remove();
          });

          // หมดเวลาเป้าหาย/คอมโบแตก
          setTimeout(()=>{
            if(e.parentNode){
              e.remove();
              this.combo=1;
              const cEl=document.getElementById('hudCombo'); if(cEl) cEl.textContent='Combo: x1';
            }
          }, 2800);

          sp.appendChild(e);
        }
      });

      // ถ้าซีนถูกสร้างไปแล้ว ให้ “ติดตั้ง” component และบูตทันที
      const scn=document.querySelector('a-scene');
      if (scn) {
        scn.removeAttribute('shadow-breaker-game');
        setTimeout(()=>scn.setAttribute('shadow-breaker-game',''),0);
      }
    } else {
      console.log('[SB:FALLBACK] external component found; inline fallback not used');
    }
  });

  // Toast แบบสั้น (สำรอง)
  function toast(m,ms){ let t=document.getElementById('toast'); if(!t){ t=document.createElement('div'); t.id='toast'; t.style.cssText='position:fixed;left:50%;top:16%;transform:translateX(-50%);background:rgba(0,0,0,.65);color:#dff5ff;border:1px solid rgba(255,255,255,.15);padding:10px 14px;border-radius:12px;z-index:10030;font-weight:800;letter-spacing:.3px;'; document.body.appendChild(t); } t.textContent=m; t.style.display='block'; setTimeout(()=>t.style.display='none',ms||900); }
})();
</script>

  <!-- ===== EMERGENCY INLINE COMPONENT V2 (supports 4 modes) ===== -->
<script>
(function(){
  function afterAF(){ return new Promise(r=>{
    if (window.AFRAME) return r();
    const iv=setInterval(()=>{ if(window.AFRAME){ clearInterval(iv); r(); } },50);
  });}

  // mini toast (fallback)
  function toast(m,ms){ let t=document.getElementById('toast'); 
    if(!t){ t=document.createElement('div'); t.id='toast';
      t.style.cssText='position:fixed;left:50%;top:16%;transform:translateX(-50%);background:rgba(0,0,0,.65);color:#dff5ff;border:1px solid rgba(255,255,255,.15);padding:10px 14px;border-radius:12px;z-index:10030;font-weight:800;letter-spacing:.3px;';
      document.body.appendChild(t);
    }
    t.textContent=m; t.style.display='block'; setTimeout(()=>t.style.display='none',ms||900);
  }

  function setHUD(id,txt){ const el=document.getElementById(id); if(el){ el.style.display='inline-flex'; el.textContent=txt; } }

  afterAF().then(()=>{
    // ใช้ Fallback ก็ต่อเมื่อ components.js ไม่ได้โหลด/ไม่ register
    if (AFRAME.components['shadow-breaker-game']) {
      console.log('[SB:FALLBACK] external component found; inline fallback not used');
      return;
    }
    console.warn('[SB:FALLBACK] external components.js not detected -> using INLINE V2 (4 modes)');

    const q = new URLSearchParams(location.search);
    const GAME = (q.get('game')||'combat').toLowerCase();   // combat | dash | impact | flow
    const MODE = (q.get('mode')||'timed').toLowerCase();    // timed | practice

    AFRAME.registerComponent('shadow-breaker-game',{
      init:function(){
        // shared state
        this.game = GAME;
        this.mode = MODE;
        this.playing = true;
        this.score = 0;
        this.combo = 1;
        this.timeLeft = (this.mode==='timed'?60:9999);
        this.last = performance.now();

        setHUD('hudGame', 'Shadow Breaker (Fallback)');
        setHUD('hudScore','Score: 0');
        setHUD('hudCombo','Combo: x1');
        setHUD('hudTime',  'Time: ' + (this.mode==='timed'?this.timeLeft:'∞'));

        // create per-mode
        if (this.game==='combat') this.initCombat();
        if (this.game==='dash')   this.initDash();
        if (this.game==='impact') this.initImpact();
        if (this.game==='flow')   this.initFlow();

        this.loop();
      },

      // ====== COMBAT (ยิงเป้า) ======
      initCombat:function(){
        this.spawnEvery = 1000; this.spawnT = performance.now()-1001;
        const o=document.getElementById('objective'); if(o) o.textContent='[Combat] ยิงเป้าสะสมคะแนน';
      },
      spawnTarget:function(){
        const sp=document.getElementById('spawner'); if(!sp) return;
        const e=document.createElement('a-entity');
        e.setAttribute('geometry','primitive: sphere; radius: 0.25');
        e.setAttribute('material','color:#39c5bb; emissive:#0af; metalness:0.1; roughness:0.4');
        const rx=(Math.random()*2-1)*0.9, ry=1.2+Math.random()*0.6, rz=-2.0-Math.random()*0.5;
        e.setAttribute('position', {x:rx,y:ry,z:rz});
        e.classList.add('clickable');
        e.setAttribute('animation__pulse','property: scale; to:1.12 1.12 1.12; dir:alternate; loop:true; dur:650');
        e.addEventListener('click', ()=>{
          if(!this.playing) return;
          this.combo=Math.min(20,this.combo+1);
          const add=100+(this.combo-1)*10;
          this.score+=add;
          setHUD('hudScore','Score: '+this.score);
          setHUD('hudCombo','Combo: x'+this.combo);
          toast('Great! +'+add, 700);
          e.remove();
        });
        setTimeout(()=>{ if(e.parentNode){ e.remove(); this.combo=1; setHUD('hudCombo','Combo: x1'); } }, 2800);
        sp.appendChild(e);
      },

      // ====== DASH (วิ่งหลบสิ่งกีดขวาง) ======
      initDash:function(){
        const o=document.getElementById('objective'); if(o) o.textContent='[Dash] ↑ กระโดด • ↓ หมอบ • ←/→ หลบข้าง • SHIFT บูสต์';
        this.hazards = [];
        this.spawnGap = 900; this.spawnT = performance.now()-901;
        this.jumpT=0; this.crouch=false; this.side=0; this.sideT=0; this.burst=0; this.burstCD=0;
        window.addEventListener('keydown',(e)=>{
          if(e.key==='ArrowUp'||e.code==='Space'){ if(this.jumpT<=0) this.jumpT=0.6; }
          if(e.key==='ArrowDown'){ this.crouch=true; }
          if(e.key==='ArrowLeft'){ this.side=-1; this.sideT=0.35; }
          if(e.key==='ArrowRight'){ this.side=1; this.sideT=0.35; }
          if(e.key==='Shift'&&this.burstCD<=0){ this.burst=0.28; this.burstCD=2.0; toast('Burst!',400); }
        });
        window.addEventListener('keyup',(e)=>{ if(e.key==='ArrowDown') this.crouch=false; });
      },
      spawnHazard:function(){
        const sp=document.getElementById('spawner'); if(!sp) return;
        const r=Math.random(); let type='mid';
        if(r<0.25) type='low'; else if(r<0.5) type='high'; else if(r<0.7) type='left'; else if(r<0.9) type='right'; else type='shock';
        const e=document.createElement('a-entity'); e.classList.add('hazard');
        let x=0,y=0,geo='',mat='';
        if(type==='low'){ y=0.35; geo='primitive: box; width: 2.2; height:0.32; depth:0.22'; mat='color:#8bd8ff; emissive:#3cf;'; }
        else if(type==='high'){ y=1.45; geo='primitive: box; width: 2.2; height:0.32; depth:0.22'; mat='color:#8bd8ff; emissive:#3cf;'; }
        else if(type==='left'){ x=-0.7; y=1.0; geo='primitive: box; width: 0.25; height:1.8; depth:0.25'; mat='color:#ff8b8b; emissive:#f55;'; }
        else if(type==='right'){ x=0.7; y=1.0; geo='primitive: box; width: 0.25; height:1.8; depth:0.25'; mat='color:#ff8b8b; emissive:#f55;'; }
        else { y=0.95; geo='primitive: dodecahedron; radius:0.38'; mat='color:#ffd36b; emissive:#fa0;'; }
        e.dataset.type=type; e.dataset.x=x; e.dataset.y=y; e.dataset.z=-3.5;
        e.setAttribute('geometry',geo); e.setAttribute('material',mat);
        e.setAttribute('position',`${x} ${y} -3.5`);
        sp.appendChild(e);
        this.hazards.push(e);
      },
      tickDash:function(dt,now){
        // simple movement on rig
        const rig=document.getElementById('rig'); if(rig){
          const baseY=1.6;
          const y=(this.jumpT>0)?baseY+0.42*Math.sin((0.6-this.jumpT)/0.6*Math.PI):(this.crouch?baseY-0.38:baseY);
          const x=(this.side!==0?this.side*0.6*(this.sideT/0.35):0)+(this.burst>0?(this.side||1)*0.25:0);
          rig.setAttribute('position',`${x.toFixed(3)} ${y.toFixed(3)} 0`);
        }
        if(this.jumpT>0) this.jumpT=Math.max(0,this.jumpT-dt);
        if(this.sideT>0) this.sideT=Math.max(0,this.sideT-dt); else this.side=0;
        if(this.burst>0) this.burst=Math.max(0,this.burst-dt);
        if(this.burstCD>0) this.burstCD=Math.max(0,this.burstCD-dt);

        if(now-this.spawnT>this.spawnGap){ this.spawnT=now; this.spawnHazard(); }

        // move hazards & check pose
        this.hazards = this.hazards.filter(h=>{
          const speed=2.4, z = (parseFloat(h.dataset.z)||-3.5) + speed*dt*(this.burst>0?1.25:1.0);
          h.dataset.z = z; h.setAttribute('position', `${h.dataset.x} ${h.dataset.y} ${z.toFixed(3)}`);
          if(z>-0.2){
            // judge pose
            const type=h.dataset.type;
            const ok=(type==='low'&&this.jumpT>0) || (type==='high'&&this.crouch) ||
                     (type==='left'&&this.side>0) || (type==='right'&&this.side<0) ||
                     (type==='shock'&&this.burst>0);
            if(ok){ this.score+=150; this.combo=Math.min(20,this.combo+1); toast('+150',350); }
            else { this.combo=1; toast('HIT!',350); }
            setHUD('hudScore','Score: '+this.score); setHUD('hudCombo','Combo: x'+this.combo);
            h.remove(); return false;
          }
          return true;
        });
      },

      // ====== IMPACT (ชาร์จแล้วปล่อย) ======
      initImpact:function(){
        const o=document.getElementById('objective'); if(o) o.textContent='[Impact] กดเมาส์ค้างเพื่อชาร์จ แล้วปล่อยเพื่อทำคะแนน';
        this.coreAlive=false; this.chargeStart=0;
        window.addEventListener('mousedown',()=>{ this.chargeStart=performance.now(); });
        window.addEventListener('mouseup',()=>{ this.releaseImpact(); });
      },
      spawnCore:function(){
        const sp=document.getElementById('spawner'); if(!sp) return;
        const e=document.createElement('a-entity');
        e.setAttribute('geometry','primitive: dodecahedron; radius:0.6');
        e.setAttribute('material','color:#ffb36b; emissive:#f80;');
        e.setAttribute('position','0 1.3 -2.2'); e.classList.add('impact-core');
        sp.appendChild(e); this.coreAlive=true;
      },
      releaseImpact:function(){
        if(!this.coreAlive) return;
        const held = this.chargeStart>0 ? (performance.now()-this.chargeStart)/1000 : 0;
        this.chargeStart=0;
        const clamped = Math.max(0, Math.min(2, held));
        const add = Math.round(200*clamped);
        this.score += add; this.combo=Math.min(20,this.combo+1);
        setHUD('hudScore','Score: '+this.score);
        setHUD('hudCombo','Combo: x'+this.combo);
        toast('Impact +' + add, 700);
        const core=document.querySelector('.impact-core'); if(core) core.remove();
        this.coreAlive=false; setTimeout(()=>this.spawnCore(),500);
      },

      // ====== FLOW (กด A/S/D ตามจังหวะ) ======
      initFlow:function(){
        const o=document.getElementById('objective'); if(o) o.textContent='[Flow] กด A / S / D ให้ตรงจังหวะ';
        this.flowNext = performance.now()+900;
        window.addEventListener('keydown',(e)=>{
          if('aA'.includes(e.key)) this.hitFlow('A');
          if('sS'.includes(e.key)) this.hitFlow('S');
          if('dD'.includes(e.key)) this.hitFlow('D');
        });
      },
      spawnFlowNote:function(lane,now){
        let wrap=document.getElementById('flowWrap');
        if(!wrap){
          wrap=document.createElement('div'); wrap.id='flowWrap';
          Object.assign(wrap.style,{position:'fixed',left:'50%',transform:'translateX(-50%)',top:'12%',zIndex:'10006',pointerEvents:'none',width:'360px'});
          wrap.innerHTML=`<div style="display:flex;gap:14px;justify-content:center"><div class="badge">A</div><div class="badge">S</div><div class="badge">D</div></div>`;
          document.body.appendChild(wrap);
        }
        const n=document.createElement('div'); n.className='flow-note badge'; n.dataset.t0=String(now); n.dataset.key=lane;
        Object.assign(n.style,{position:'absolute',left:lane==='A'?'20%':(lane==='S'?'45%':'70%'),top:'10%',
                               background:'rgba(0,0,0,.55)',border:'1px solid #49b'}); n.textContent=lane; wrap.appendChild(n);
      },
      tickFlowDom:function(now){
        document.querySelectorAll('.flow-note').forEach(n=>{
          const born=Number(n.dataset.t0||0), age=now-born, life=900, y=Math.min(100,(age/life)*100);
          n.style.top=(10+y*0.6)+'%'; if(age>life+200){ n.remove(); this.combo=1; }
        });
      },
      hitFlow:function(key){
        const notes=[...document.querySelectorAll('.flow-note')].filter(n=>n.dataset.key===key);
        if(!notes.length) return;
        notes.sort((a,b)=>parseFloat(b.style.top)-parseFloat(a.style.top));
        const n=notes[0]; const now=performance.now(), born=Number(n.dataset.t0||0), life=900, delta=Math.abs((now-born)-life);
        if(delta<=200){ const add=(delta<80?150:100); this.score+=add; this.combo=Math.min(20,this.combo+1); toast('+'+add,350); n.remove(); }
        else{ this.combo=1; toast('MISS',300); }
        setHUD('hudScore','Score: '+this.score); setHUD('hudCombo','Combo: x'+this.combo);
      },

      // ====== LOOP ======
      loop:function(){
        if(!this.playing) return;
        requestAnimationFrame(this.loop.bind(this));
        const now=performance.now(); const dt=(now-this.last)/1000; this.last=now;

        // clock
        if(this.mode==='timed'){
          this.timeLeft = Math.max(0, this.timeLeft - dt);
          setHUD('hudTime', 'Time: ' + Math.ceil(this.timeLeft));
          if(this.timeLeft<=0){ this.playing=false; toast('Finished • Score: '+this.score, 2000); return; }
        } else {
          setHUD('hudTime','Time: ∞');
        }

        // per-mode tick
        if(this.game==='combat'){
          if(now - this.spawnT > this.spawnEvery){ this.spawnT=now; this.spawnTarget(); }
        }
        if(this.game==='dash'){
          this.tickDash(dt, now);
        }
        if(this.game==='impact'){
          if(!this.coreAlive) this.spawnCore();
          // show charge %
          if(this.chargeStart>0){
            const pct = Math.min(100, Math.round((now-this.chargeStart)/1000/2*100));
            setHUD('hudArcane','CHARGE: '+pct+'%');
          } else {
            setHUD('hudArcane','Arcane: 0%');
          }
        }
        if(this.game==='flow'){
          if(now >= this.flowNext){ const lanes=['A','S','D']; this.spawnFlowNote(lanes[Math.floor(Math.random()*3)], now); this.flowNext=now+900; }
          this.tickFlowDom(now);
        }
      }
    });

    // ติดตั้ง component ลง scene ถ้ายังไม่ได้ติด
    const scn=document.querySelector('a-scene');
    if (scn) {
      scn.removeAttribute('shadow-breaker-game');
      setTimeout(()=>scn.setAttribute('shadow-breaker-game',''),0);
    }
  });
})();
</script>

</body>
</html>
