<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>EXO · Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="./core/exo-ui.css">
  <script src="./core/exo-i18n.js"></script>
  <script src="./core/exo-core.js"></script>
  <script src="./core/exo-settings.js"></script>

  <style>
    .wrap{max-width:760px;margin:14px auto}
    .card{padding:14px;border:1px solid #112848;background:rgba(14,20,36,.8);border-radius:14px;margin-bottom:12px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .row > * {flex:1 1 180px}
    .danger{color:#ff9a9a}
  </style>
</head>
<body>
<div class="wrap">
  <h1>EXO · Settings</h1>

  <div class="card">
    <h3>Language</h3>
    <div class="row">
      <select id="selLang">
        <option value="th">ไทย (TH)</option>
        <option value="en">English (EN)</option>
      </select>
      <button class="btn" id="btnApplyLang">Apply</button>
      <span id="langStatus"></span>
    </div>
    <p class="small">* จะมีผลทันทีและถูกจำไว้ (localStorage + EXO_SETTINGS)</p>
  </div>

  <div class="card">
    <h3>Audio</h3>
    <div class="row">
      <label><input type="checkbox" id="chkMusic"> Music</label>
      <label><input type="checkbox" id="chkSfx"> SFX</label>
      <button class="btn" id="btnSaveAudio">Save</button>
      <span id="audioStatus"></span>
    </div>
  </div>

  <div class="card">
    <h3>Gameplay Defaults</h3>
    <div class="row">
      <label>Default Difficulty
        <select id="selDiff">
          <option value="easy">EASY</option>
          <option value="normal">NORMAL</option>
          <option value="hard">HARD</option>
        </select>
      </label>
      <label>Default Time
        <select id="selTime">
          <option>30</option><option selected>60</option><option>90</option>
        </select>
      </label>
      <button class="btn" id="btnSaveGame">Save</button>
      <span id="gameStatus"></span>
    </div>
    <p class="small">* หน้า Hub สามารถอ่านค่านี้ไปตั้งค่าเริ่มต้นได้ตามต้องการ</p>
  </div>

  <div class="row" style="justify-content:flex-end">
    <a class="btn" href="./index.html">⟵ Hub</a>
  </div>
</div>

<script>
(function(){
  // โหลดสถานะจาก EXO_SETTINGS (ถ้าไม่มีให้คืนค่า default)
  const S = (EXO_SETTINGS.get && EXO_SETTINGS.get()) || {};
  const byId = id => document.getElementById(id);

  // Language
  const currentLang = EXO_I18N.get();
  byId('selLang').value = currentLang;
  byId('btnApplyLang').onclick = ()=>{
    const lang = byId('selLang').value;
    EXO_I18N.set(lang); // จะ bind DOM อัตโนมัติให้หน้าอื่น
    const curr = EXO_SETTINGS.get() || {};
    EXO_SETTINGS.set({...curr, lang});
    byId('langStatus').textContent = '✓ Applied ('+lang.toUpperCase()+')';
    setTimeout(()=> byId('langStatus').textContent='', 1200);
  };

  // Audio
  byId('chkMusic').checked = S.music !== false; // default = true
  byId('chkSfx').checked   = S.sfx   !== false; // default = true
  byId('btnSaveAudio').onclick = ()=>{
    const curr = EXO_SETTINGS.get() || {};
    EXO_SETTINGS.set({
      ...curr,
      music: byId('chkMusic').checked,
      sfx:   byId('chkSfx').checked
    });
    byId('audioStatus').textContent = '✓ Saved';
    setTimeout(()=> byId('audioStatus').textContent='', 1200);
  };

  // Gameplay defaults
  byId('selDiff').value = S.defaultDiff || 'normal';
  byId('selTime').value = S.defaultTime || '60';
  byId('btnSaveGame').onclick = ()=>{
    const curr = EXO_SETTINGS.get() || {};
    EXO_SETTINGS.set({
      ...curr,
      defaultDiff: byId('selDiff').value,
      defaultTime: byId('selTime').value
    });
    byId('gameStatus').textContent = '✓ Saved';
    setTimeout(()=> byId('gameStatus').textContent='', 1200);
  };

})();
</script>

</body>
</html>
