<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>EXO Training Protocol — Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="core/exo-ui.css">
  <style>
    .grid{max-width:960px;margin:84px auto 40px;padding:0 16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:rgba(14,20,36,.85);border:1px solid #112848;border-radius:12px;padding:14px}
    .card h3{margin:.2rem 0 .6rem 0}
    .row{display:flex;gap:8px;align-items:center;margin:.35rem 0}
    select,input[type="number"],input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid #1a315a;background:#0b1325;color:#e6f2ff}
    .muted{color:#7f8ea3;font-size:12px}
    .btn.wide{width:100%;text-align:center}
    .hint{font-size:12px;color:#a7c5ff;margin-top:6px}
  </style>
</head>
<body>

  <header class="hud">
    <div class="box"><strong>EXO TRAINING PROTOCOL</strong></div>
  </header>

  <main class="grid">
    <!-- Combat Reflex -->
    <section class="card">
      <h3>Combat Reflex</h3>
      <p class="muted">เกม 1 — ตอบสนองไว ตีเป้าเข้า Hit Line</p>
      <a class="btn wide" href="shadow-breaker/play.html">▶ Play</a>
    </section>

    <!-- Rhythm Sync with Difficulty + Chart -->
    <section class="card" id="rhythmCard">
      <h3>Rhythm Sync</h3>
      <p class="muted">เกม 2 — ตามจังหวะ BPM + Chart (เลือกโหมด/ชาร์ตได้)</p>

      <div class="row">
        <label style="min-width:84px">Difficulty</label>
        <select id="diff">
          <option value="easy">Easy</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
        </select>
      </div>

      <div class="row">
        <label style="min-width:84px">BPM</label>
        <input id="bpm" type="number" value="110" min="60" max="220" step="1">
      </div>

      <div class="row">
        <label style="min-width:84px">Chart</label>
        <select id="chartPreset">
          <option value="">(ใช้ชาร์ตเริ่มต้นตามโหมด)</option>
          <option value="rhythm-rider/charts/easy.json">charts/easy.json</option>
          <option value="rhythm-rider/charts/normal.json">charts/normal.json</option>
          <option value="rhythm-rider/charts/hard.json">charts/hard.json</option>
          <option value="__custom__">Custom URL…</option>
        </select>
      </div>

      <div class="row" id="customWrap" style="display:none">
        <label style="min-width:84px">URL</label>
        <input id="chartUrl" type="text" placeholder="เช่น https://your.host/chart.json">
      </div>

      <div class="hint">Tips: ใส่ `?diff=…&bpm=…&chart=…` เข้า `rhythm-rider/play.html` อัตโนมัติ</div>

      <div class="row" style="margin-top:.6rem">
        <button id="btnRhythm" class="btn wide">▶ Play Rhythm Sync</button>
      </div>
    </section>

    <!-- Mobility Dash -->
    <section class="card">
      <h3>Mobility Dash</h3>
      <p class="muted">เกม 3 — สลับเลนหลบสิ่งกีดขวาง</p>
      <a class="btn wide" href="cardio-sprint/play.html">▶ Play</a>
    </section>

    <!-- Power Control -->
    <section class="card">
      <h3>Power Control</h3>
      <p class="muted">เกม 4 — ย่อ/ยืน ผ่านวงแหวนให้ถูก</p>
      <a class="btn wide" href="sky-squats/play.html">▶ Play</a>
    </section>
  </main>

  <script>
    // Rhythm UI logic
    const diffSel   = document.getElementById('diff');
    const bpmInput  = document.getElementById('bpm');
    const presetSel = document.getElementById('chartPreset');
    const customWrap= document.getElementById('customWrap');
    const urlInput  = document.getElementById('chartUrl');
    const playBtn   = document.getElementById('btnRhythm');

    presetSel.addEventListener('change', () => {
      const v = presetSel.value;
      customWrap.style.display = (v === '__custom__') ? 'flex' : 'none';
    });

    playBtn.addEventListener('click', () => {
      const diff = (diffSel.value || 'normal').toLowerCase();
      const bpm  = Math.max(60, Math.min(220, parseInt(bpmInput.value || '110', 10)));
      let url = 'rhythm-rider/play.html?diff=' + encodeURIComponent(diff) + '&bpm=' + encodeURIComponent(bpm);

      const preset = presetSel.value;
      if (preset) {
        if (preset === '__custom__') {
          const cu = urlInput.value.trim();
          if (cu) url += '&chart=' + encodeURIComponent(cu);
        } else {
          url += '&chart=' + encodeURIComponent(preset);
        }
      }
      location.href = url;
    });
  </script>

  <p style="text-align:center;color:#6d7a8a;font-size:12px;margin-top:10px;">
    Prototype WebXR Fitness System – EXO Training Protocol
  </p>
</body>
</html>
