<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>Toothbrush — Mobile</title>
<link rel="stylesheet" href="../assets/css/style.css"/>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="../assets/js/helpers.js"></script>
<style>html,body{margin:0;height:100%;overflow:hidden}</style>
</head>
<body>
<div class="mobile-cta hide-on-desktop">
  <button id="motionBtn" class="primary">อนุญาตเซนเซอร์ (iOS)</button>
  <button id="startBtn" class="secondary">Start</button>
  <button id="finishBtn" class="danger">Finish</button>
</div>
<div class="joy hide-on-desktop"><div class="stick"></div></div>
<div class="right-pad hide-on-desktop">
  <button id="actionBtn">Action</button>
</div>

<a-scene renderer="antialias:true;precision:mediump;alpha:true" xr-mode-ui="enabled: true">
  <a-entity light="type:ambient;intensity:0.8"></a-entity>
  <a-entity light="type:directional;intensity:0.6" position="1 1 0"></a-entity>
  <a-plane position="0 0 -1" rotation="-90 0 0" width="30" height="30" color="#f4f4f5"></a-plane>
  <a-sky color="#eef2ff"></a-sky>

  <a-entity position="0 1.9 -2"><a-text value="Toothbrush" color="#22c55e" align="center" width="4"></a-text></a-entity>
  <a-entity position="0 1.6 -2"><a-text value="แตะเพื่อแปรง (เดโม)" color="#0f172a" align="center" width="4"></a-text></a-entity>

  <a-sphere id="ball" position="0 1.2 -3" radius="0.25" color="#60a5fa" visible="false"></a-sphere>

  <a-entity position="0 1.6 0"><a-camera wasd-controls-enabled="true"></a-camera></a-entity>
</a-scene>

<script>
MobileReady.enableMotionIfNeeded('motionBtn');

let startTime=null, loop=null, score=0;
const ball = document.getElementById('ball');
const actionBtn = document.getElementById('actionBtn');
const startBtn = document.getElementById('startBtn');
const finishBtn = document.getElementById('finishBtn');

function post(type, extra={}){ try{ parent.postMessage(Object.assign({type},extra),'*'); }catch(e){} }
function begin(){ ball.setAttribute('visible', true); score=0; startTime=performance.now(); post('TOOTH_READY'); if(loop) clearInterval(loop); let t=0; loop=setInterval(()=>{ t+=0.08; const x=Math.sin(t)*0.8; ball.setAttribute('position', x+' 1.2 -3'); }, 50); }
function finish(){ const seconds=startTime?Math.round((performance.now()-startTime)/1000):0; clearInterval(loop); post('TOOTH_COMPLETE', {score, seconds}); alert('จบเกม! คะแนน '+score+' | '+seconds+' วิ'); }
startBtn.addEventListener('click', begin);
finishBtn.addEventListener('click', finish);
ball.addEventListener('click', ()=>{ score+=10; ball.setAttribute('color', score%20===0?'#34d399':'#60a5fa'); });
actionBtn.addEventListener('click', ()=>{ score+=5; });

// Joystick → หมุนกล้องเล็กน้อย (demo)
MobileReady.joystick((nx, ny)=>{ try{ const cam=document.querySelector('a-camera'); const rot=cam.getAttribute('rotation')||{x:0,y:0,z:0}; rot.y += nx*2; cam.setAttribute('rotation', rot); }catch(_e){} });
</script>
</body>
</html>