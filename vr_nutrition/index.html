<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>WebGL Probe Pack</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js" defer></script>
<style>
  html,body{margin:0;height:100%;background:#0a0f16;color:#0ff;font-family:system-ui}
  .wrap{max-width:980px;margin:20px auto;padding:12px}
  .card{background:#0b1220;border:1px solid #0ff3;border-radius:12px;padding:12px 14px;margin-bottom:12px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  canvas{background:#07101a;border:1px solid #0ff3;border-radius:8px}
  .tag{display:inline-block;padding:2px 8px;border:1px solid #0ff;border-radius:10px;margin-right:6px}
  .btn{display:inline-block;padding:8px 12px;border:1px solid #0ff;border-radius:10px;background:transparent;color:#0ff;cursor:pointer}
  pre{white-space:pre-wrap;word-break:break-word}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div style="font-size:18px;font-weight:700">WebGL Probe Pack</div>
    <div>แพ็กนี้ช่วยตรวจว่า WebGL ใช้งานได้ไหม และ A‑Frame เรนเดอร์หรือไม่</div>
    <div id="banner" style="margin-top:6px">
      <span class="tag" id="tWebGL2">webgl2=?</span>
      <span class="tag" id="tWebGL1">webgl1=?</span>
      <span class="tag" id="tAFScene">aframeSceneLoaded=?</span>
      <span class="tag" id="tDraw">drawTriangle=?</span>
    </div>
  </div>

  <div class="row">
    <div class="card" style="flex:1;min-width:320px">
      <div style="font-weight:600;margin-bottom:6px">A) Pure WebGL1 Triangle</div>
      <canvas id="glc" width="400" height="260"></canvas>
      <div style="margin-top:8px">
        <button class="btn" id="btnTri">วาดสามเหลี่ยม</button>
      </div>
    </div>

    <div class="card" style="flex:1;min-width:320px">
      <div style="font-weight:600;margin-bottom:6px">B) A‑Frame Rotating Box</div>
      <div style="height:260px;position:relative">
        <a-scene id="scene" embedded style="position:absolute;inset:0" background="color:#050910" loading-screen="enabled:false"
                 renderer="antialias:true;precision:mediump;powerPreference:high-performance;colorManagement:true">
          <a-entity light="type: ambient; color: #BBB"></a-entity>
          <a-entity light="type: hemisphere; color: #fffff0; groundColor: #222; intensity: 0.9"></a-entity>
          <a-entity position="0 1.6 2" camera></a-entity>
          <a-box position="0 1.6 -3" depth="1" height="1" width="1" color="#39d"
                 animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
        </a-scene>
      </div>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:600;margin-bottom:6px">C) GPU/Driver Readout</div>
    <pre id="info">loading…</pre>
  </div>

  <div class="card">
    <div style="font-weight:600;margin-bottom:6px">วิธีแก้ถ้า WebGL ไม่ขึ้น</div>
    <ol>
      <li>Chrome → Settings → System → เปิด <b>Use hardware acceleration</b> แล้วรีสตาร์ต</li>
      <li>พิมพ์ <code>chrome://gpu</code> → หัวข้อ WebGL ต้องเป็น <b>Hardware accelerated</b></li>
      <li>ปิดส่วนขยายที่แตะ DOM/กราฟิกชั่วคราว (ad blocker, privacy guard, force dark ฯลฯ)</li>
      <li>อัปเดตไดรเวอร์การ์ดจอ (NVIDIA/AMD/Intel)</li>
      <li>ถ้าบนองค์กร: อาจมีนโยบายปิด WebGL → ใช้โหมด Canvas 2D แทนชั่วคราว</li>
    </ol>
  </div>
</div>

<script>
(function(){
  const $=s=>document.querySelector(s);
  const set=(id,val)=>{ $(id).textContent = $(id).textContent.split('=')[0] + '=' + val; };

  // TRIANGLE
  function drawTriangle(){
    const c=$("#glc");
    const gl = c.getContext('webgl') || c.getContext('experimental-webgl');
    set('#tWebGL1', gl?'1':'0');
    if(!gl){ return false; }
    const vsrc=`attribute vec2 p; void main(){ gl_Position=vec4(p,0.0,1.0);} `;
    const fsrc=`precision mediump float; void main(){ gl_FragColor=vec4(0.2,0.8,1.0,1.0);} `;
    function sh(type,src){ const s=gl.createShader(type); gl.shaderSource(s,src); gl.compileShader(s); if(!gl.getShaderParameter(s,gl.COMPILE_STATUS)){ throw new Error(gl.getShaderInfoLog(s)); } return s; }
    const prog=gl.createProgram(); gl.attachShader(prog, sh(gl.VERTEX_SHADER,vsrc)); gl.attachShader(prog, sh(gl.FRAGMENT_SHADER,fsrc)); gl.linkProgram(prog);
    if(!gl.getProgramParameter(prog, gl.LINK_STATUS)){ throw new Error(gl.getProgramInfoLog(prog)); }
    gl.useProgram(prog);
    const buf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buf);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0,0.8, -0.8,-0.8, 0.8,-0.8]), gl.STATIC_DRAW);
    const loc=gl.getAttribLocation(prog,'p'); gl.enableVertexAttribArray(loc); gl.vertexAttribPointer(loc,2,gl.FLOAT,false,0,0);
    gl.viewport(0,0,c.width,c.height); gl.clearColor(0.03,0.08,0.12,1); gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawArrays(gl.TRIANGLES,0,3);
    return true;
  }

  // PROBE
  function probe(){
    // WebGL2?
    let w2=false, w1=false;
    try{ w2 = !!(document.createElement('canvas').getContext('webgl2')); }catch(_){}
    try{ w1 = !!(document.createElement('canvas').getContext('webgl')||document.createElement('canvas').getContext('experimental-webgl')); }catch(_){}
    set('#tWebGL2', w2?'1':'0'); set('#tWebGL1', w1?'1':'0');

    // GPU strings
    const inf = [];
    try{
      const c=document.createElement('canvas');
      const gl=c.getContext('webgl')||c.getContext('experimental-webgl');
      if(gl){
        const dbgInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if(dbgInfo){
          const ven = gl.getParameter(dbgInfo.UNMASKED_VENDOR_WEBGL);
          const ren = gl.getParameter(dbgInfo.UNMASKED_RENDERER_WEBGL);
          inf.push('UNMASKED_VENDOR_WEBGL: '+ven);
          inf.push('UNMASKED_RENDERER_WEBGL: '+ren);
        } else {
          inf.push('WEBGL_debug_renderer_info: not available');
        }
        inf.push('gl.VERSION: '+gl.getParameter(gl.VERSION));
        inf.push('gl.SHADING_LANGUAGE_VERSION: '+gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
      } else {
        inf.push('No WebGL context created.');
      }
    }catch(e){ inf.push('Probe error: '+e.message); }
    $("#info").textContent = inf.join('\n');
  }

  // Scene loaded?
  document.getElementById('scene').addEventListener('loaded',()=>{ set('#tAFScene','1'); });

  $('#btnTri').addEventListener('click', ()=>{
    try{ const ok = drawTriangle(); set('#tDraw', ok?'1':'0'); }
    catch(e){ set('#tDraw','0'); const t=document.getElementById('info'); t.textContent += '\nTriangle error: '+e.message; }
  });

  // init
  probe();
  set('#tAFScene','0'); set('#tDraw','0');
})();
</script>
</body>
</html>
