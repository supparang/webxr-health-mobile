<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fitness Adventure VR (Fitness-Duo)</title>
    <!-- A-Frame CDN -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Optional hand-tracking (if device supports) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="./game.js"></script>
    <style>
      .hud { position: fixed; left: 0; right: 0; top: 0; padding: 8px 12px; font-family: system-ui, Arial; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,.7); pointer-events: none; z-index: 10000; }
      .hud .badge { background: rgba(0,0,0,.35); border-radius: 8px; padding: 6px 10px; display: inline-block; margin-right: 8px; }
      .panel { z-index: 9999;
        position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%);
        width: min(92vw, 720px); background: rgba(20, 24, 28, .92);
        color: #fff; border-radius: 16px; padding: 18px; font-family: system-ui, Arial;
        box-shadow: 0 10px 30px rgba(0,0,0,.4);
      }
      .panel h1 { margin: 0 0 10px; font-size: 28px; }
      .panel p { opacity: .9; line-height: 1.5; }
      .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
      .btn {
        flex: 1 1 180px; background: #2b74f7; color: #fff; border: 0; border-radius: 12px;
        padding: 12px 14px; font-size: 16px; cursor: pointer; box-shadow: 0 6px 14px rgba(43,116,247,.35);
      }
      .btn.secondary { background: #444c56; box-shadow: none; }
      .theme-chip {
        flex: 1 1 160px; background: #20262e; border-radius: 12px; padding: 8px; cursor: pointer;
        border: 2px solid transparent;
      }
      .theme-chip.active { border-color: #2b74f7; }
      .theme-chip img { width: 100%; border-radius: 8px; display:block; }
      .theme-chip label { display:block; text-align:center; padding:6px 0; font-weight:600; }
      .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 16px; background: rgba(0,0,0,.75); color:#fff; padding:10px 14px; border-radius: 999px; font-family: system-ui; display:none; z-index: 10000;}
      .result { text-align:center; }
      .stars { font-size: 28px; letter-spacing: 4px; }
      .kbd { background:#111; padding:2px 6px; border-radius:6px; }
      a { color: #7fb3ff; }
      @media (max-width:520px){ .panel{ padding:14px } .panel h1{font-size:22px} }
    </style>
  </head>
  <body>
    <!-- Menu Panel -->
    <div id="menuPanel" class="panel">
      <h1>Fitness Adventure VR</h1>
      <p>Pick a theme, read the quick guide, and start! Works on mobile (gaze/tap) and VR headsets (controller trigger).</p>

      <div class="row" id="themeRow">
        <div class="theme-chip" data-theme="jungle" onclick="APP.selectTheme('jungle')">
          <img src="assets/backgrounds/jungle.png" alt="Jungle" />
          <label>Jungle</label>
        </div>
        <div class="theme-chip" data-theme="city" onclick="APP.selectTheme('city')">
          <img src="assets/backgrounds/city.png" alt="City" />
          <label>City</label>
        </div>
        <div class="theme-chip" data-theme="space" onclick="APP.selectTheme('space')">
          <img src="assets/backgrounds/space.png" alt="Space" />
          <label>Space</label>
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="APP.startGame({mode:'timed'})">Start (Timed)</button>
        <button class="btn secondary" onclick="APP.startGame({mode:'practice'})">Practice (No Timer)</button>
        <button class="btn secondary" onclick="APP.openWeeklyMission()">Weekly Mission</button>
      </div>

      <details style="margin-top:10px">
        <summary>How to Play</summary>
        <p>Hit the floating targets as they appear. Gaze and tap (mobile) or use controller trigger to <span class="kbd">click</span>. Score combos to earn stars (1–3). Avoid missing targets!</p>
        <p>To switch themes later, open the pause menu in-game.</p>
      </details>
    </div>

    <!-- Result Panel -->
    <div id="resultPanel" class="panel" style="display:none">
      <div class="result">
        <h1>Great Job!</h1>
        <div id="scoreLine">Score: 0</div>
        <div id="starLine" class="stars">☆ ☆ ☆</div>
        <p id="summaryLine">—</p>
        <div class="row">
          <button class="btn" onclick="APP.restart()">Play Again</button>
          <button class="btn secondary" onclick="APP.backToMenu()">Back to Menu</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- HUD -->
    <div id="hud" class="hud" style="display:none">
      <span class="badge" id="hudMode">Practice</span>
      <span class="badge" id="hudTime">Time: 60</span>
      <span class="badge" id="hudScore">Score: 0</span>
      <span class="badge" id="hudCombo">Combo: x1</span>
      <span class="badge"><a href="#" onclick="APP.pause();return false;">Pause</a></span>
    </div>

    
<!-- Floating Menu Button -->
<button id="floatMenuBtn" onclick="APP.backToMenu()" 
  style="position:fixed; right:12px; top:12px; z-index:10001; 
         background:#2b74f7; color:#fff; border:none; 
         padding:10px 12px; border-radius:10px; 
         font-family: system-ui, Arial; box-shadow:0 6px 14px rgba(43,116,247,.35);">
  Menu
</button>

    <!-- A-Frame Scene -->
    <a-scene renderer="colorManagement: true">
      <a-assets timeout="10000">
        <img id="bg-jungle" src="assets/backgrounds/jungle.png" crossorigin="anonymous" />
        <img id="bg-city"   src="assets/backgrounds/city.png" crossorigin="anonymous" />
        <img id="bg-space"  src="assets/backgrounds/space.png" crossorigin="anonymous" />
        <a-asset-item id="click-sound" src=""></a-asset-item>
      </a-assets>

      <!-- Sky will be set by APP.setThemeSky(...) -->
      <a-sky id="sky" color="#111122"></a-sky>

      <!-- Target container -->
      <a-entity id="spawner"></a-entity>

      <!-- Camera rig with cursor for mobile/desktop -->
      <a-entity id="rig" position="0 1.6 0">
        <a-camera id="camera" wasd-controls-enabled="false" look-controls="pointerLockEnabled: false">
          <a-cursor
            id="cursor"
            fuse="true"
            fuse-timeout="600"
            material="shader: flat; opacity: 0.85"
            geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.01">
          </a-cursor>
        </a-camera>
      </a-entity>

      <!-- Lights -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="0 4 -2"></a-entity>
    </a-scene>
  </body>
</html>