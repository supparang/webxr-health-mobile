<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>VR Nutrition ‚Äî 4 Games</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js" defer></script>
<style>
  html,body{margin:0;height:100%;background:#000}
  a-scene,canvas.a-canvas{position:fixed;inset:0;z-index:0!important}
  a-scene, canvas.a-canvas, .a-enter-vr{pointer-events:none!important}
  body.game-running a-scene, body.game-running canvas.a-canvas, body.game-running .a-enter-vr{pointer-events:auto!important}

  .hud,#menuBar,.overlay,#toast,.modal{position:fixed;z-index:2147483647!important;pointer-events:auto!important;
    font-family:system-ui,sans-serif;color:#0ff;text-shadow:0 0 8px rgba(0,255,255,.8)}
  .hud{left:50%;transform:translateX(-50%);top:10px;text-align:center}
  .hud .row{margin:6px 0}
  #menuBar{bottom:12px;left:50%;transform:translateX(-50%);text-align:center}
  .btn,.tag{display:inline-block;padding:10px 14px;margin:0 6px;border:1px solid #0ff;border-radius:12px;
    background:rgba(0,0,0,.35);color:#0ff;cursor:pointer;user-select:none;font-size:16px}
  .tag{border-style:dashed}
  .btn:hover,.tag:hover{background:rgba(0,255,255,.12)}

  .overlay{inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);pointer-events:none}
  .overlay.show{display:flex;pointer-events:auto}
  .card{background:rgba(8,10,20,.96);border:1px solid #0ff;border-radius:16px;padding:18px 20px;color:#0ff;width:min(94vw,640px);text-align:center}

  #toast{left:50%;transform:translateX(-50%);bottom:64px;background:rgba(0,0,0,.7);border:1px solid #0ff;border-radius:10px;padding:8px 12px;display:none}
  #toast.show{display:block}

  /* ---------- HOW MODAL ---------- */
  #howModal{inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55)}
  #howModal.show{display:flex}
  .how-card{background:rgba(10,14,26,.98);border:1px solid #0ff;border-radius:16px;padding:18px 20px;width:min(94vw,720px);max-height:80vh;overflow:auto;color:#0ff}
  .how-title{font-size:20px;margin-bottom:10px}
  .how-grid{display:grid;grid-template-columns: 1fr; gap:10px}
  .how-actions{margin-top:12px;text-align:right}
  .how-btn{padding:8px 12px;border:1px solid #0ff;border-radius:10px;background:rgba(0,0,0,.35);color:#0ff;cursor:pointer}
  .how-btn:hover{background:rgba(0,255,255,.12)}
</style>

<script>
/* ---------- Enforce pointer-events ---------- */
function enforcePE(){const on=document.body.classList.contains('game-running');const want=on?'auto':'none';
  document.querySelectorAll('a-scene,canvas.a-canvas,.a-enter-vr').forEach(el=>{if(getComputedStyle(el).pointerEvents!==want) el.style.pointerEvents=want;});}
const mo=new MutationObserver(enforcePE);
window.addEventListener('DOMContentLoaded',()=>{mo.observe(document.documentElement,{childList:true,subtree:true,attributes:true,attributeFilter:['class','style']});enforcePE();});

/* ---------- Toast ---------- */
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(toast._h);toast._h=setTimeout(()=>t.classList.remove('show'),1200);}

/* ---------- HOW MODAL (‡πÅ‡∏ó‡∏ô alert) ---------- */
function openHow(textHTML){
  const m=document.getElementById('howModal'); const body=document.body;
  document.getElementById('howBody').innerHTML=textHTML;
  m.classList.add('show');
  body.classList.remove('game-running'); // ‡∏Å‡∏±‡∏ô‡∏â‡∏≤‡∏Å‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡∏ö
  enforcePE();
}
function closeHow(){
  const m=document.getElementById('howModal'); m.classList.remove('show');
}
window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeHow(); });
function clickHowBackdrop(e){ if(e.target.id==='howModal') closeHow(); }

/* ---------- Fallback buttons ---------- */
function callUI(name,...args){
  try{ if(window.GAME_UI && typeof window.GAME_UI[name]==='function'){ return window.GAME_UI[name](...args); } }catch(e){console.error(e)}
  if(name==='start'||name==='restart'){ document.body.classList.add('game-running'); enforcePE(); toast(name==='start'?'Starting‚Ä¶':'Restarting‚Ä¶'); }
  else if(name==='pause'){ toast('Pause (engine pending)'); }
  else if(name==='how'){ 
    openHow(`<div class="how-grid">
      <div><b>‡πÇ‡∏´‡∏°‡∏î ‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞:</b> ‡∏à‡πâ‡∏≠‡∏á/‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏¢‡∏∞ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö</div>
      <div><b>‡πÇ‡∏´‡∏°‡∏î ‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà:</b> ‡∏î‡∏π‡∏´‡∏°‡∏π‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏´‡∏°‡∏π‡πà</div>
      <div><b>‡πÇ‡∏´‡∏°‡∏î Hydration:</b> ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥ üíß ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô ‡∏™‡∏∞‡∏™‡∏°‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤</div>
      <div><b>‡πÇ‡∏´‡∏°‡∏î Build Plate:</b> ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤ Plate (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) ‡∏Ñ‡∏£‡∏ö‡∏ä‡∏∏‡∏î‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™</div>
      <div><b>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°:</b> ‡πÄ‡∏°‡∏≤‡∏™‡πå/‡πÅ‡∏ï‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡πâ‡∏≠‡∏á‡πÉ‡∏ô VR ‡∏à‡∏ô‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô‡∏Ñ‡∏£‡∏ö</div>
    </div>`); 
  }
  else { toast(name+' (queued)'); }
}

/* ---------- Stub ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á ---------- */
window.GAME_UI=window.GAME_UI||{
  _q:[],_ready:false,
  _bind(real){this._real=real;this._ready=true;this._q.forEach(fn=>{try{fn()}catch(e){}});this._q=[];},
  _call(n,...a){const go=()=>{try{this._real[n](...a)}catch(e){console.error(e)}};this._ready?go():this._q.push(go)},
  start(){callUI('start');this._call('start')},pause(){callUI('pause');this._call('pause')},
  restart(){callUI('restart');this._call('restart')},how(){callUI('how');this._call('how')},
  setMode(m){callUI('setMode',m);this._call('setMode',m)},setDiff(d){callUI('setDiff',d);this._call('setDiff',d)},
  toggleLang(){/* ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ */},toggleVoice(){/* ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ */}
};
</script>
</head>
<body>
  <!-- HUD -->
  <div class="hud" id="hud">
    <div class="row">
      <span id="lblScore">Score</span>: <span id="score">0</span> |
      <span id="lblCombo">Combo</span>: <span id="combo">x1</span> |
      <span id="lblTime">Time</span>: <span id="time">60</span>s |
      <span id="lblBest">Best</span>: <span id="best">0</span>
    </div>
    <div class="row">
      <span id="lblMode">Mode</span>: <span id="modeName">Good vs Junk</span> |
      <span id="lblDiff">Difficulty</span>: <span id="difficulty">Normal</span>
      <span class="tag">Daily Mission</span>
    </div>
  </div>

  <!-- ‡πÄ‡∏°‡∏ô‡∏π -->
  <div id="menuBar">
    <div style="margin-bottom:6px">
      <span class="tag" onclick="callUI('setMode','goodjunk')">ü•ó ‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</span>
      <span class="tag" onclick="callUI('setMode','groups')">üçΩÔ∏è ‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà</span>
      <span class="tag" onclick="callUI('setMode','hydration')">üíß Hydration</span>
      <span class="tag" onclick="callUI('setMode','plate')">üç± Build Plate</span>
    </div>
    <div style="margin:8px 0">
      <span class="tag" onclick="callUI('setDiff','Easy')">Easy</span>
      <span class="tag" onclick="callUI('setDiff','Normal')">Normal</span>
      <span class="tag" onclick="callUI('setDiff','Hard')">Hard</span>
    </div>
    <div>
      <button class="btn" onclick="callUI('start')">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
      <button class="btn" onclick="callUI('pause')">‚è∏ ‡∏û‡∏±‡∏Å</button>
      <button class="btn" onclick="callUI('how')">‚ùì ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
      <button class="btn" onclick="callUI('restart')">‚Üª ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>

  <div id="toast">clicked</div>

  <!-- HOW MODAL -->
  <div id="howModal" class="modal" onclick="clickHowBackdrop(event)">
    <div class="how-card">
      <div class="how-title">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</div>
      <div id="howBody" class="how-body">‚Ä¶</div>
      <div class="how-actions">
        <button class="how-btn" onclick="closeHow()">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <!-- Summary -->
  <div class="overlay" id="summary">
    <div class="card">
      <b id="sumTitle" style="font-size:20px">Summary</b>
      <div id="sumStars" style="font-size:28px;margin:8px 0 4px">‚òÖ‚òÜ‚òÜ</div>
      <div id="sumBody">Score: 0 ‚Ä¢ Combo Max: x1 ‚Ä¢ Mode: ‚Äî ‚Ä¢ Diff: ‚Äî</div>
      <div style="margin-top:12px"><button class="btn" onclick="callUI('restart')">‚Üª ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button></div>
    </div>
  </div>

  <!-- Scene -->
  <a-scene id="scene" vr-mode-ui="enabled: true"
           renderer="colorManagement: true; antialias: false; highRefreshRate: true; physicallyCorrectLights: true"
           xr="foveationLevel: 2" background="color:#02040a">

    <a-assets>
      <img id="apple" src="assets/images/apple.png">
      <img id="broccoli" src="assets/images/veggies.png">
      <img id="water" src="assets/images/water.png">
      <img id="burger" src="assets/images/burger.png">
      <img id="soda" src="assets/images/soda.png">
      <img id="donut" src="assets/images/donut.png">
      <img id="g_grains"  src="assets/images/grains.png">
      <img id="g_protein" src="assets/images/protein.png">
      <img id="g_veggies" src="assets/images/veggies.png">
      <img id="g_fruits"  src="assets/images/fruits.png">
      <img id="g_dairy"   src="assets/images/dairy.png">
      <img id="p_time"   src="assets/images/time.png">
      <img id="p_fever"  src="assets/images/fever.png">
      <img id="p_shield" src="assets/images/shield.png">
      <img id="p_slow"   src="assets/images/slow.png">
      <img id="p_bomb"   src="assets/images/bomb.png">
    </a-assets>

    <a-sky color="#050910"></a-sky>

    <a-entity id="playerCam" camera look-controls
              raycaster="objects: .clickable; far: 12"
              cursor="rayOrigin: entity; fuse: true; fuseTimeout: 750">
      <a-entity id="gazeRing" position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.008"
                material="color:#0ff;shader:flat;opacity:0.9"></a-entity>
    </a-entity>

    <a-entity id="mouseRig" cursor="rayOrigin: mouse"
              raycaster="objects: .clickable; far: 12"></a-entity>

    <a-entity id="spawnerRoot" position="0 1.6 -2.2"></a-entity>
  </a-scene>

  <script src="game.js" defer></script>
</body>
</html>
