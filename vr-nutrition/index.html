<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Healthy Hero VR ‚Äî ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏õ.5 (ONLINE ‚Ä¢ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£)</title>
  <!-- ONLINE: A-Frame CDN -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#F4FBFF}
    #banner{position:fixed;left:0;right:0;top:0;background:#10b981;color:#fff;padding:8px 12px;font-size:13px;z-index:9999}
    #banner.warn{background:#f59e0b}
    #banner.err{background:#ef4444}
  </style>
</head>
<body>
  <div id="banner" class="warn">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏° (ONLINE)‚Ä¶ ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ Chrome/Edge ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°</div>

  <a-scene renderer="colorManagement:true; antialias:true" background="color: #F4FBFF">
    <!-- lights -->
    <a-entity light="type: ambient; intensity:0.8"></a-entity>
    <a-entity light="type: directional; intensity:0.9" position="1 2 0"></a-entity>
    <a-plane position="0 0 -1" rotation="-90 0 0" width="24" height="24" color="#EAF7EF"></a-plane>

    <!-- rig & cursors -->
    <a-entity id="rig" position="0 1.6 2">
      <a-entity id="cam" camera look-controls>
        <a-entity id="cursor" cursor="fuse:true; fuseTimeout:850" raycaster="objects:.clickable"
          position="0 0 -1" geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.016"
          material="color:#111; shader:flat"></a-entity>
      </a-entity>
      <a-entity laser-controls="hand: left" raycaster="objects: .clickable"></a-entity>
      <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>
    </a-entity>
    <a-entity id="mouseCursor" cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>

    <!-- HUD -->
    <a-entity id="hud" position="0 2.6 -1.2">
      <a-plane width="2.6" height="0.78" color="#FFFFFF" opacity="0.96"></a-plane>
      <a-text id="hudText" value="‡πÇ‡∏´‡∏°‡∏î: A  ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0  ‡πÄ‡∏ß‡∏•‡∏≤: 45s" color="#0a2" width="2.4" align="center" position="0 0 0.01"></a-text>
    </a-entity>

    <!-- Splash -->
    <a-entity id="splash" position="0 1.8 -1.7">
      <a-plane width="2.9" height="2.0" color="#FFFFFF" opacity="0.98"></a-plane>
      <a-text value="Healthy Hero VR" align="center" width="2.6" color="#10b981" position="0 0.8 0.01"></a-text>
      <a-text value="‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏õ.5 ‚Äî ‡πÇ‡∏´‡∏°‡∏î A (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£)" align="center" width="2.6" color="#2563eb" position="0 0.6 0.01"></a-text>

      <a-entity class="clickable btn" position="0 0.2 0.01" ui-button="label: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô; color:#10b981; action:start"></a-entity>
      <a-entity class="clickable btn" position="0 -0.3 0.01" ui-button="label: ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô; color:#94a3b8; action:how"></a-entity>
    </a-entity>

    <!-- How -->
    <a-entity id="how" position="0 1.8 -1.7" visible="false">
      <a-plane width="2.9" height="1.8" color="#FFFFFF" opacity="0.98"></a-plane>
      <a-text value="‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)" align="center" width="2.6" color="#111" position="0 0.6 0.01"></a-text>
      <a-text id="howBody" value="‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏° ‚Üí ‡πÅ‡∏ï‡∏∞/‡∏ä‡∏µ‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û) = +10 ‚Ä¢ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞) = ‚àí5 ‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤ 45 ‡∏ß‡∏¥" align="center" width="2.6" color="#334155" position="0 0.25 0.01"></a-text>
      <a-entity class="clickable btn" position="0 -0.4 0.01" ui-button="label: ‡∏Å‡∏•‡∏±‡∏ö; color:#f59e0b; action:back"></a-entity>
    </a-entity>

    <!-- Stage -->
    <a-entity id="stage" position="0 1.25 -2.6" visible="false">
      <a-box width="3.6" height="0.1" depth="2.2" color="#F3F4F6" position="0 0 0"></a-box>
      <a-entity id="spawn" position="0 0.15 0"></a-entity>
    </a-entity>

    <!-- Result -->
    <a-entity id="result" position="0 1.8 -1.7" visible="false">
      <a-plane width="2.9" height="1.8" color="#FFFFFF" opacity="0.98"></a-plane>
      <a-text value="‡∏à‡∏ö‡πÄ‡∏Å‡∏°!" align="center" width="2.6" color="#111" position="0 0.6 0.01"></a-text>
      <a-text id="resBody" value="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0" align="center" width="2.6" color="#334155" position="0 0.2 0.01"></a-text>
      <a-entity class="clickable btn" position="-0.6 -0.4 0.01" ui-button="label: ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á; color:#10b981; action:restart"></a-entity>
      <a-entity class="clickable btn" position="0.6 -0.4 0.01" ui-button="label: ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π; color:#2563eb; action:back"></a-entity>
    </a-entity>

    <script>
// === UI Button ===
AFRAME.registerComponent('ui-button', {
  schema: { label:{type:'string'}, color:{type:'string', default:'#10b981'}, action:{type:'string'} },
  init: function(){
    const d=this.data, el=this.el;
    const p=document.createElement('a-plane'); p.setAttribute('width','2'); p.setAttribute('height','0.45'); p.setAttribute('color', d.color);
    p.setAttribute('opacity','0.98'); p.setAttribute('material','shader: flat'); p.classList.add('clickable');
    const t=document.createElement('a-text'); t.setAttribute('value', d.label); t.setAttribute('align','center'); t.setAttribute('width','1.9'); t.setAttribute('color','#fff'); t.setAttribute('position','0 0 0.01');
    el.appendChild(p); el.appendChild(t);
    el.addEventListener('click', ()=> el.sceneEl.emit('ui', {action:d.action}));
  }
});

// === Food Icon Token ===
// Uses emoji on a rounded card (green = healthy, red = junk)
AFRAME.registerComponent('food-icon', {
  schema:{ healthy:{default:true}, label:{default:''}, emoji:{default:'üçé'} },
  init: function(){
    const d=this.data, el=this.el;
    // card background
    const card=document.createElement('a-rounded'); // a-rounded exists in extras; fallback to plane if missing
    if(card.tagName.toLowerCase()==='a-rounded'){
      card.setAttribute('width','0.9'); card.setAttribute('height','0.9'); card.setAttribute('radius','0.12');
    } else {
      // fallback to plane (in case extras not loaded)
      const p=document.createElement('a-plane'); p.setAttribute('width','0.9'); p.setAttribute('height','0.9'); card.replaceWith?.(p);
    }
    card.setAttribute('color', d.healthy ? '#D1FAE5' : '#FEE2E2');
    card.setAttribute('material','shader: flat');
    el.appendChild(card);

    // emoji
    const em=document.createElement('a-text');
    em.setAttribute('value', d.healthy ? (d.emoji||'üçé') : (d.emoji||'ü•§'));
    em.setAttribute('align','center'); em.setAttribute('width','1.4'); em.setAttribute('color','#111');
    em.setAttribute('position','0 0.15 0.01'); em.setAttribute('font','https://cdn.aframe.io/fonts/mozillavr.fnt');
    el.appendChild(em);

    // label
    const tx=document.createElement('a-text');
    tx.setAttribute('value', d.label || (d.healthy ? '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û' : '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞'));
    tx.setAttribute('align','center'); tx.setAttribute('width','1.2'); tx.setAttribute('color', d.healthy? '#065f46':'#7f1d1d');
    tx.setAttribute('position','0 -0.25 0.01'); tx.setAttribute('wrap-count','12');
    el.appendChild(tx);

    el.classList.add('clickable');
    el.addEventListener('click', ()=> el.sceneEl.emit('hit', { healthy:d.healthy, entity:el }));
  }
});

// === Game ===
AFRAME.registerComponent('game', {
  init: function(){
    const scene=this.el;
    this.banner=document.getElementById('banner');
    this.hud=document.getElementById('hudText');
    this.splash=document.getElementById('splash');
    this.how=document.getElementById('how');
    this.stage=document.getElementById('stage');
    this.spawn=document.getElementById('spawn');
    this.result=document.getElementById('result');
    this.resBody=document.getElementById('resBody');

    this.score=0; this.time=45;
    this.timer=null; this.spawnInt=null;

    scene.addEventListener('ui', (e)=> this.onUI(e.detail.action));
    scene.addEventListener('hit', (e)=> this.onHit(e.detail));

    // CDN check
    setTimeout(()=>{
      if(window.AFRAME){ this.banner.textContent='‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô (ONLINE ‚Ä¢ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£)'; this.banner.className=''; setTimeout(()=> this.banner.style.display='none', 1200); }
      else { this.banner.className='err'; this.banner.textContent='‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‚Äî ‡πÉ‡∏ä‡πâ Chrome/Edge ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï'; }
    }, 1000);
  },

  onUI: function(a){
    if(a==='start') return this.start();
    if(a==='how') return this.showHow();
    if(a==='back') return this.showSplash();
    if(a==='restart') return this.start();
  },

  showSplash: function(){
    this.stopAll(); this.clear();
    this.splash.setAttribute('visible', true);
    this.how.setAttribute('visible', false);
    this.stage.setAttribute('visible', false);
    this.result.setAttribute('visible', false);
    this.updateHUD();
  },
  showHow: function(){
    this.splash.setAttribute('visible', false);
    this.how.setAttribute('visible', true);
    this.stage.setAttribute('visible', false);
    this.result.setAttribute('visible', false);
  },

  start: function(){
    this.stopAll(); this.clear();
    this.splash.setAttribute('visible', false);
    this.how.setAttribute('visible', false);
    this.stage.setAttribute('visible', true);
    this.result.setAttribute('visible', false);
    this.score=0; this.time=45; this.updateHUD();

    const healthySet = [
      {label:'‡∏ú‡∏±‡∏Å', emoji:'ü•¶'}, {label:'‡∏ú‡∏•‡πÑ‡∏°‡πâ', emoji:'üçé'}, {label:'‡∏ô‡∏°‡∏à‡∏∑‡∏î', emoji:'ü•õ'},
      {label:'‡∏õ‡∏•‡∏≤', emoji:'üêü'}, {label:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á', emoji:'üçö'}
    ];
    const junkSet = [
      {label:'‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°', emoji:'ü•§'}, {label:'‡∏Ç‡∏≠‡∏á‡∏ó‡∏≠‡∏î', emoji:'üçü'}, {label:'‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô', emoji:'üç∞'},
      {label:'‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á‡πÅ‡∏ú‡πà‡∏ô', emoji:'üçò'}, {label:'‡∏ä‡∏≤‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô', emoji:'üßã'}
    ];

    this.timer=setInterval(()=>{ if(this.time<=0){ this.end(); return; } this.time--; this.updateHUD(); }, 1000);
    const once=()=>{
      if(this.time<=0) return;
      const good = Math.random() < 0.6;
      const pick = (arr)=> arr[Math.floor(Math.random()*arr.length)];
      const data = good ? pick(healthySet) : pick(junkSet);
      const ent=document.createElement('a-entity');
      ent.setAttribute('food-icon',{healthy:good,label:data.label,emoji:data.emoji});
      const p=this.rpos(1.4,0.9); ent.setAttribute('position', `${p.x} 0 ${p.z}`);
      this.spawn.appendChild(ent);
      setTimeout(()=>{ try{ ent.parentNode && ent.parentNode.removeChild(ent);}catch(e){} }, 5200);
    };
    once();
    this.spawnInt=setInterval(()=>{ once(); if(Math.random()<0.42) once(); }, 1100);
  },

  end: function(){
    this.stopAll(); this.stage.setAttribute('visible', false);
    this.result.setAttribute('visible', true);
    this.resBody.setAttribute('value', `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${this.score}`);
  },

  onHit: function(d){ if(this.time<=0) return; this.score += d.healthy ? 10 : -5; this.updateHUD(); try{ d.entity.parentNode && d.entity.parentNode.removeChild(d.entity);}catch(e){} },

  updateHUD: function(){ this.hud.setAttribute('value', `‡πÇ‡∏´‡∏°‡∏î: A  ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${this.score}  ‡πÄ‡∏ß‡∏•‡∏≤: ${this.time}s`); },
  stopAll: function(){ if(this.timer){ clearInterval(this.timer); this.timer=null; } if(this.spawnInt){ clearInterval(this.spawnInt); this.spawnInt=null; } },
  clear: function(){ while(this.spawn.firstChild){ this.spawn.removeChild(this.spawn.firstChild); } },
  rpos: function(w,d){ return { x:(Math.random()*(w*2)-w), z:(Math.random()*(d*2)-d)}; }
});

document.addEventListener('DOMContentLoaded', ()=>{
  const scene=document.querySelector('a-scene');
  scene.setAttribute('game','');
});
    </script>
  </a-scene>
</body>
</html>
