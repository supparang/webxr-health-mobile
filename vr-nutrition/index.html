<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
  <title>VR Nutrition ‚Äî 4 Games (VR + Mouse)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js" defer></script>
  <style>
    html, body { margin:0; height:100%; background:#000; }
    /* ‡∏â‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î */
    a-scene, canvas.a-canvas { position:fixed; inset:0; z-index:0 !important; }
    /* ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏•‡∏¥‡∏Å canvas ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô */
    canvas.a-canvas { pointer-events: none !important; }
    /* ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏´‡πâ canvas */
    body.game-running canvas.a-canvas { pointer-events: auto !important; }

    /* UI ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    .hud, #menuBar, .overlay, .targetBox, .quotaBox, #toast {
      position: fixed; z-index: 2147483647 !important; pointer-events: auto !important;
      font-family: system-ui, sans-serif; color: #0ff; text-shadow: 0 0 8px rgba(0,255,255,.8);
    }
    .hud { left:50%; transform:translateX(-50%); top:10px; text-align:center }
    .hud .row { margin:6px 0; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #0ff; margin-left:6px }

    #menuBar { bottom:12px; left:50%; transform:translateX(-50%); text-align:center; }
    button.btn, .tag {
      display:inline-block; padding:10px 14px; margin:0 6px; border:1px solid #0ff; border-radius:12px;
      background:rgba(0,0,0,.35); color:#0ff; cursor:pointer; user-select:none; font-size:16px;
    }
    button.btn:hover, .tag:hover { background: rgba(0,255,255,0.12); }
    .tag { border-style: dashed; }

    .targetBox { right:10px; top:10px; text-align:right; color:#fff }
    .targetBox .tlabel { font-size:14px; opacity:0.8 }
    .targetName { font-size:18px }
    .quotaBox { right:10px; top:76px; text-align:right; color:#fff; display:none }

    /* Overlay: ‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ï‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏ô */
    .overlay { inset:0; display:none; align-items:center; justify-content:center;
               background:rgba(0,0,0,0.6); pointer-events: none; }
    .overlay.show { display:flex; pointer-events:auto; }
    .card { background:rgba(8,10,20,0.96); border:1px solid #0ff; border-radius:16px; padding:18px 20px; color:#0ff; width:min(94vw,640px); text-align:center }
    .stars { font-size:28px; margin:8px 0 4px }

    /* Toast debug ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏î‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ô‡πà ‡πÜ */
    #toast { left:50%; transform:translateX(-50%); bottom:64px; background:rgba(0,0,0,.7);
             border:1px solid #0ff; border-radius:10px; padding:8px 12px; display:none; }
    #toast.show { display:block; }
  </style>

  <!-- Fallback ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏°‡πâ GAME_UI ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° -->
  <script>
    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö pointer-events ‡∏Ç‡∏≠‡∏á canvas ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà A-Frame ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà (Chrome ‡∏ä‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà)
    const enforceCanvasPE = () => {
      document.querySelectorAll('canvas.a-canvas').forEach(cv=>{
        const on = document.body.classList.contains('game-running');
        const want = on ? 'auto' : 'none';
        if (getComputedStyle(cv).pointerEvents !== want) cv.style.pointerEvents = want;
      });
    };
    const mo = new MutationObserver(() => enforceCanvasPE());
    window.addEventListener('DOMContentLoaded', () => {
      mo.observe(document.documentElement, { childList:true, subtree:true, attributes:true, attributeFilter:['class','style'] });
      enforceCanvasPE();
    });

    // Toast ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏≠‡∏Å‡∏ú‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    function toast(msg){ const t=document.getElementById('toast'); if(!t) return;
      t.textContent = msg; t.classList.add('show'); clearTimeout(toast._h);
      toast._h = setTimeout(()=> t.classList.remove('show'), 1200);
    }

    // Hard fallback: ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ game.js
    function callUI(name, ...args){
      try {
        if (window.GAME_UI && typeof window.GAME_UI[name]==='function') {
          return window.GAME_UI[name](...args);
        }
      } catch(e){ console.error(e); }
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ GAME_UI ‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ï‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á
      if (name==='start') { document.body.classList.add('game-running'); enforceCanvasPE(); toast('Starting (engine loading)'); }
      else if (name==='pause') { toast('Paused (engine not ready)'); }
      else if (name==='restart') { document.body.classList.add('game-running'); enforceCanvasPE(); toast('Restart (engine loading)'); }
      else if (name==='how') { alert('‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏ô‡∏à‡∏¥‡∏ô)'); }
      else if (name==='setMode') { toast('Mode set'); }
      else if (name==='setDiff') { toast('Difficulty set'); }
      else if (name==='toggleLang') { toast('Toggle language'); }
      else if (name==='toggleVoice') { toast('Toggle voice'); }
    }

    // Stub ‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö bind ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
    window.GAME_UI = window.GAME_UI || {
      _q: [], _ready:false,
      _bind(real){ this._real=real; this._ready=true; this._q.forEach(fn=>{try{fn()}catch(e){}}); this._q=[]; },
      _call(name,...args){ const go=()=>{ try{ this._real[name](...args); }catch(e){ console.error(e); } };
        this._ready? go() : this._q.push(go); },
      start(){ callUI('start'); this._call('start'); },
      pause(){ callUI('pause'); this._call('pause'); },
      restart(){ callUI('restart'); this._call('restart'); },
      how(){ callUI('how'); this._call('how'); },
      setMode(m){ callUI('setMode',m); this._call('setMode',m); },
      setDiff(d){ callUI('setDiff',d); this._call('setDiff',d); },
      toggleLang(){ callUI('toggleLang'); this._call('toggleLang'); },
      toggleVoice(){ callUI('toggleVoice'); this._call('toggleVoice'); }
    };
  </script>
</head>
<body>
  <!-- HUD -->
  <div class="hud" id="hud">
    <div class="row">
      <span id="lblScore">Score</span>: <span id="score">0</span> |
      <span id="lblCombo">Combo</span>: <span id="combo">x1</span> |
      <span id="lblTime">Time</span>: <span id="time">60</span>s |
      <span id="lblBest">Best</span>: <span id="best">0</span>
    </div>
    <div class="row">
      <span id="lblMode">Mode</span>: <span id="modeName">Good vs Junk</span> |
      <span id="lblDiff">Difficulty</span>: <span id="difficulty">Normal</span>
      <span class="badge" id="missionTag">Daily Mission</span>
    </div>
  </div>

  <!-- Target / Quota -->
  <div class="targetBox" id="targetBox" style="display:none">
    <div class="tlabel" id="lblTarget">Target</div>
    <div class="targetName" id="targetName">‚Äî</div>
  </div>
  <div class="quotaBox" id="quotaBox">
    <div class="tlabel" id="lblQuota">Plate Quota</div>
    <div class="targetName" id="quotaText">‚Äî</div>
  </div>

  <!-- ‡πÄ‡∏°‡∏ô‡∏π -->
  <div id="menuBar">
    <div id="modeBar" style="margin-bottom:6px">
      <span class="tag" role="button" tabindex="0" onclick="callUI('setMode','goodjunk')">ü•ó <span data-i18n="modeGJ">‡∏î‡∏µ vs ‡∏Ç‡∏¢‡∏∞</span></span>
      <span class="tag" role="button" tabindex="0" onclick="callUI('setMode','groups')">üçΩÔ∏è <span data-i18n="modeGroups">‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà</span></span>
      <span class="tag" role="button" tabindex="0" onclick="callUI('setMode','hydration')">üíß <span data-i18n="modeHydra">Hydration</span></span>
      <span class="tag" role="button" tabindex="0" onclick="callUI('setMode','plate')">üç± <span data-i18n="modePlate">Build Plate</span></span>
    </div>
    <div id="diffBar" style="margin:8px 0">
      <span class="tag" role="button" tabindex="0" onclick="callUI('setDiff','Easy')">Easy</span>
      <span class="tag" role="button" tabindex="0" onclick="callUI('setDiff','Normal')">Normal</span>
      <span class="tag" role="button" tabindex="0" onclick="callUI('setDiff','Hard')">Hard</span>
    </div>
    <div>
      <button class="btn" id="btnStart"  onclick="callUI('start')">‚ñ∂ <span data-i18n="start">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</span></button>
      <button class="btn" id="btnPause"  onclick="callUI('pause')">‚è∏ <span data-i18n="pause">‡∏û‡∏±‡∏Å</span></button>
      <button class="btn" id="btnHow"    onclick="callUI('how')">‚ùì <span data-i18n="how">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</span></button>
      <button class="btn" id="btnLang"   onclick="callUI('toggleLang')">üåê <span id="langText">‡πÑ‡∏ó‡∏¢/English</span></button>
      <button class="btn" id="btnVoice"  onclick="callUI('toggleVoice')">üîä <span data-i18n="voiceOn">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î: ‡πÄ‡∏õ‡∏¥‡∏î</span></button>
    </div>
  </div>

  <!-- Toast ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å -->
  <div id="toast">clicked</div>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• -->
  <div class="overlay" id="summary">
    <div class="card">
      <div style="font-size:20px; margin-bottom:8px"><b id="sumTitle">Summary</b></div>
      <div class="stars" id="sumStars">‚òÖ‚òÜ‚òÜ</div>
      <div id="sumBody">Score: 0 ‚Ä¢ Combo Max: x1 ‚Ä¢ Mode: ‚Äî ‚Ä¢ Diff: ‚Äî</div>
      <div style="margin-top:8px"><span id="sumTips">VR: ‡∏à‡πâ‡∏≠‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏à‡∏ô‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô‡∏Ñ‡∏£‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span></div>
      <div style="margin-top:12px">
        <button class="btn" id="btnRestart" onclick="callUI('restart')">‚Üª <span data-i18n="restart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</span></button>
      </div>
    </div>
  </div>

  <!-- ‡∏â‡∏≤‡∏Å A-Frame -->
  <a-scene id="scene" vr-mode-ui="enabled: true"
           renderer="colorManagement: true; antialias: false; highRefreshRate: true; physicallyCorrectLights: true"
           xr="foveationLevel: 2"
           background="color: #02040a">

    <a-assets>
      <img id="apple" src="assets/images/apple.png">
      <img id="broccoli" src="assets/images/veggies.png">
      <img id="water" src="assets/images/water.png">
      <img id="burger" src="assets/images/burger.png">
      <img id="soda" src="assets/images/soda.png">
      <img id="donut" src="assets/images/donut.png">
      <img id="g_grains"  src="assets/images/grains.png">
      <img id="g_protein" src="assets/images/protein.png">
      <img id="g_veggies" src="assets/images/veggies.png">
      <img id="g_fruits"  src="assets/images/fruits.png">
      <img id="g_dairy"   src="assets/images/dairy.png">
      <img id="p_time"   src="assets/images/time.png">
      <img id="p_fever"  src="assets/images/fever.png">
      <img id="p_shield" src="assets/images/shield.png">
      <img id="p_slow"   src="assets/images/slow.png">
      <img id="p_bomb"   src="assets/images/bomb.png">
    </a-assets>

    <a-sky color="#050910"></a-sky>

    <a-entity id="playerCam"
              camera look-controls
              raycaster="objects: .clickable; far: 12"
              cursor="rayOrigin: entity; fuse: true; fuseTimeout: 750">
      <a-entity id="gazeRing" position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.008"
                material="color: #0ff; shader: flat; opacity: 0.9"></a-entity>
    </a-entity>

    <a-entity id="mouseRig"
              cursor="rayOrigin: mouse"
              raycaster="objects: .clickable; far: 12"></a-entity>

    <a-entity id="mouseLaser"
              line="start: 0 0 0; end: 0 0 -1; color: #0ff"
              visible="false"></a-entity>

    <a-entity id="spawnerRoot" position="0 1.6 -2.2"></a-entity>
    <a-entity id="emojiMenuRoot" position="0 1.55 -2"></a-entity>
  </a-scene>

  <script src="game.js" defer></script>
</body>
</html>
