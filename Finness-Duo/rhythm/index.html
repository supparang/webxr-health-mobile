<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>Rhythm Stretch VR — Fitness Duo</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    :root { --glass: rgba(0,0,0,.6); }
    html,body{margin:0;height:100%;background:#070022;font-family:system-ui,Arial,sans-serif;}
    a-scene, a-scene canvas { position:fixed; inset:0; z-index:1; }
    .hud, .ui, .back { position:fixed; z-index:2147483000; pointer-events:auto; }
    .hud { right:12px; top:12px; min-width:320px; background:var(--glass); color:#fff;
      padding:10px 14px; border-radius:12px; white-space:pre-line; }
    .hud h1{margin:0 0 6px 0; font-size:18px;}
    .ui { left:12px; bottom:12px; display:flex; gap:8px; flex-wrap:wrap; }
    .ui label, .ui button {
      background:#fff; color:#0b1220; border:none; border-radius:12px; padding:10px 12px; font-weight:700;
      box-shadow:0 2px 10px rgba(0,0,0,.25); cursor:pointer;
    }
    .ui button.primary{background:#7dfcc6; color:#052;}
    .back { left:12px; top:12px; background:var(--glass); color:#fff; padding:8px 12px; border-radius:10px; }
    .back a{color:#fff; text-decoration:none; font-weight:700;}
  </style>
</head>
<body>
  <div class="back">⬅ <a href="../index.html">กลับเมนูหลัก</a></div>

  <div class="hud">
    <h1 id="hudTitle">Rhythm Stretch VR</h1>
    <div id="hudText">กำลังโหลด…</div>
  </div>

  <div class="ui">
    <label>โหมด:
      <select id="mode">
        <option value="training">Training</option>
        <option value="challenge">Challenge</option>
      </select>
    </label>
    <label>BPM:
      <select id="bpm">
        <option value="100">100</option>
        <option value="110">110</option>
        <option value="120">120</option>
        <option value="130">130</option>
      </select>
    </label>
    <label>ธีม:
      <select id="theme">
        <option value="beach">Beach</option>
        <option value="city">City</option>
        <option value="galaxy">Galaxy</option>
      </select>
    </label>
    <button id="btnStart" class="primary">Start</button>
    <button id="btnReset">Reset</button>
  </div>

  <!-- พื้นที่เล่น Rhythm -->
  <a-scene background="color:#070022" renderer="antialias:true;colorManagement:true" raycaster="showLine:false">
    <a-entity id="rig" position="0 1.6 0">
      <a-entity id="cam" camera look-controls>
        <a-entity id="cursor"
                  cursor="rayOrigin: entity; fuse: true; fuseTimeout: 1000"
                  raycaster="objects: .selectable"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.012; radiusOuter: 0.022"
                  material="color:#7dfcc6; shader:flat; opacity:0.95"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="root" position="0 1.5 -3"></a-entity>

    <!-- สเตจ/วงแหวนแสง -->
    <a-entity id="stageLight" geometry="primitive: ring; radiusInner:0.35; radiusOuter:0.5"
              material="color:#7dfcc6; opacity:0.8; shader:flat"
              position="0 -0.2 -3"></a-entity>

    <a-sky id="sky" radius="24" color="#0b1220"></a-sky>
    <a-entity light="type: ambient; color: #ffffff; intensity: 1.0"></a-entity>
  </a-scene>

  <!-- เกม Rhythm (ไฟล์ของคุณสำหรับโหมด Rhythm) -->
  <script src="game.js"></script>

  <!-- ตัวตั้งค่าจาก Query -->
  <script>
    (function applyQueryToRhythm(){
      const q = new URLSearchParams(location.search);
      const mapVal = (elId, key, allow=[])=>{
        const v = q.get(key);
        if (!v) return;
        const el = document.getElementById(elId);
        if (!el) return;
        if (allow.length===0 || allow.includes(v)) {
          el.value = v;
          el.dispatchEvent(new Event('change'));
        }
      };
      mapVal('mode','mode',['training','challenge']);
      mapVal('bpm','bpm',['100','110','120','130']);
      mapVal('theme','theme',['beach','city','galaxy']);

      if (q.get('autostart') === '1') {
        const btn = document.getElementById('btnStart');
        if (btn) setTimeout(()=>btn.click(), 200);
      }
      const hudText = document.getElementById('hudText');
      if (hudText) hudText.textContent = 'พร้อมเริ่ม (ค่าถูกตั้งตามลิงก์แล้ว)';
    })();
  </script>
</body>
</html>
