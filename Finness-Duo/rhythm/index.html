<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>Rhythm Stretch VR — Fitness Duo</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    :root { --glass: rgba(0,0,0,.6); }
    html,body{margin:0;height:100%;background:#070022;font-family:system-ui,Arial,sans-serif;}
    a-scene, a-scene canvas { position:fixed; inset:0; z-index:1; }
    .hud, .ui, .back { position:fixed; z-index:2147483000; pointer-events:auto; }
    .hud { right:12px; top:12px; min-width:320px; background:var(--glass); color:#fff;
      padding:10px 14px; border-radius:12px; white-space:pre-line; }
    .hud h1{margin:0 0 6px 0; font-size:18px;}
    .ui { left:12px; bottom:12px; display:flex; gap:8px; flex-wrap:wrap; }
    .ui label, .ui button {
      background:#fff; color:#0b1220; border:none; border-radius:12px; padding:10px 12px; font-weight:700;
      box-shadow:0 2px 10px rgba(0,0,0,.25); cursor:pointer;
    }
    .ui button.primary{background:#7dfcc6; color:#052;}
    .back { left:12px; top:12px; background:var(--glass); color:#fff; padding:8px 12px; border-radius:10px; }
    .back a{color:#fff; text-decoration:none; font-weight:700;}
    .laneKeys { position:fixed; right:12px; bottom:12px; z-index:2147483000; display:flex; gap:8px; }
    .laneKeys button{ padding:10px 14px; border:none; border-radius:12px; font-weight:800; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,.25); }
    .U{background:#e6f0ff}.D{background:#ffe7e7}.L{background:#e2fbe2}.R{background:#fff1d6}
  </style>
</head>
<body>
  <div class="back">⬅ <a href="../index.html">กลับเมนูหลัก</a></div>

  <div class="hud">
    <h1 id="hudTitle">Rhythm Stretch VR</h1>
    <div id="hudText">กำลังโหลด…</div>
    <div id="hudScore" style="margin-top:6px;">คะแนน: 0 • Combo: 0</div>
  </div>

  <div class="ui">
    <label>โหมด:
      <select id="mode">
        <option value="training" selected>Training</option>
        <option value="challenge">Challenge</option>
      </select>
    </label>
    <label>BPM:
      <select id="bpm">
        <option value="100">100</option>
        <option value="110">110</option>
        <option value="120" selected>120</option>
        <option value="130">130</option>
      </select>
    </label>
    <label>ธีม:
      <select id="theme">
        <option value="beach" selected>Beach</option>
        <option value="city">City</option>
        <option value="galaxy">Galaxy</option>
      </select>
    </label>
    <button id="btnStart" class="primary">Start</button>
    <button id="btnReset">Reset</button>
  </div>

  <div class="laneKeys">
    <button id="keyU" class="U">Up</button>
    <button id="keyD" class="D">Down</button>
    <button id="keyL" class="L">Left</button>
    <button id="keyR" class="R">Right</button>
  </div>

  <a-scene background="color:#070022" renderer="antialias:true;colorManagement:true" raycaster="showLine:false">
    <a-assets timeout="30000"></a-assets>

    <!-- กล้อง + เคอร์เซอร์ fuse สำหรับ gaze select -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity id="cam" camera look-controls>
        <a-entity id="cursor"
          cursor="rayOrigin: entity; fuse: true; fuseTimeout: 800"
          raycaster="objects: .hit, .btn"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.012; radiusOuter: 0.022"
          material="color:#7dfcc6; shader:flat; opacity:0.95"></a-entity>
      </a-entity>
    </a-entity>

    <!-- เวทีและวงแหวน hit -->
    <a-entity id="root" position="0 1.2 -3"></a-entity>

    <a-entity id="hitU" class="hit" geometry="primitive: ring; radiusInner:0.20; radiusOuter:0.27"
              material="color:#9db6ff; opacity:0.95; shader:flat" position="0 0.7 0"></a-entity>
    <a-entity id="hitD" class="hit" geometry="primitive: ring; radiusInner:0.20; radiusOuter:0.27"
              material="color:#ffc1c1; opacity:0.95; shader:flat" position="0 -0.7 0"></a-entity>
    <a-entity id="hitL" class="hit" geometry="primitive: ring; radiusInner:0.20; radiusOuter:0.27"
              material="color:#bff7c6; opacity:0.95; shader:flat" position="-1.2 0 0"></a-entity>
    <a-entity id="hitR" class="hit" geometry="primitive: ring; radiusInner:0.20; radiusOuter:0.27"
              material="color:#ffe6b0; opacity:0.95; shader:flat" position="1.2 0 0"></a-entity>

    <!-- Sky สีตามธีม (ถ้าอยากใช้ภาพ 360° ใส่ src ได้) -->
    <a-sky id="sky" radius="24" color="#0b1220"></a-sky>
    <a-entity light="type: ambient; color: #ffffff; intensity: 1.0"></a-entity>
  </a-scene>

  <script src="game.js"></script>

  <!-- Apply query params -->
  <script>
    (function applyQuery(){
      const q = new URLSearchParams(location.search);
      const set=(id,key,allow)=>{ const v=q.get(key); if(!v) return; const el=document.getElementById(id);
        if(!el) return; if(!allow||allow.includes(v)){ el.value=v; el.dispatchEvent(new Event('change')); }};
      set('mode','mode',['training','challenge']);
      set('bpm','bpm',['100','110','120','130']);
      set('theme','theme',['beach','city','galaxy']);
      if(q.get('autostart')==='1'){ setTimeout(()=>document.getElementById('btnStart').click(),250); }
      const hudText=document.getElementById('hudText'); if(hudText) hudText.textContent='พร้อมเริ่ม (ค่าถูกตั้งตามลิงก์แล้ว)';
    })();
  </script>
</body>
</html>
