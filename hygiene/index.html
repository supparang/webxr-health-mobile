<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Universal Scene — PC/Mobile/VR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    /* HUD ปุ่ม/ทิปเล็ก ๆ */
    .hud {position:fixed;left:50%;transform:translateX(-50%);bottom:12px;
      background:rgba(17,24,39,.72);color:#fff;padding:8px 12px;border-radius:10px;
      font:14px/1.4 system-ui;z-index:9}
    .btn {border:1px solid #e5e7eb;background:#fff;color:#111;padding:6px 10px;border-radius:10px;cursor:pointer}
    .pad {position:fixed;right:10px;bottom:64px;display:none;gap:6px;z-index:9}
    .pad .btn {opacity:.9}
    @media (max-width: 820px){ .pad{display:flex} }
  </style>
</head>
<body>
  <div class="hud">
    <span id="hint">แตะ/คลิกที่วัตถุเพื่อโต้ตอบ • กด Enter VR บนเฮดเซ็ต</span>
    <button class="btn" id="recenter">Recenter</button>
  </div>
  <!-- ปุ่มช่วยเดินบนมือถือ (อย่างง่าย) -->
  <div class="pad">
    <button class="btn" data-move="forward">↑</button>
    <button class="btn" data-move="left">←</button>
    <button class="btn" data-move="right">→</button>
    <button class="btn" data-move="back">↓</button>
  </div>

  <a-scene background="color:#eef7ff" renderer="antialias:true">
    <!-- พื้นฐานฉาก -->
    <a-plane rotation="-90 0 0" color="#dff0ff" width="30" height="30"></a-plane>
    <a-box position="0 1 -3" color="#4CAF50" class="clickable">
      <a-text value="คลิก/เล็งค้าง" align="center" position="0 0 0.51" width="3"></a-text>
    </a-box>

    <!-- RIG + กล้อง + เคอร์เซอร์ แบบปรับตามแพลตฟอร์ม -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity id="head"
        camera
        look-controls="pointerLockEnabled:false; touchEnabled:true">
        <!-- เคอร์เซอร์รวม: PC ใช้เมาส์, มือถือ/VR ใช้คอร์เซอร์/ฟิวส์ -->
        <a-cursor id="cursor"
          raycaster="objects: .clickable"
          fuse="true" fuse-timeout="1100"
          material="color:#222">
        </a-cursor>
      </a-entity>

      <!-- คอนโทรลเลอร์ VR (เปิดอัตโนมัติเมื่อมีเฮดเซ็ต) -->
      <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>
      <a-entity laser-controls="hand: left"  raycaster="objects: .clickable"></a-entity>
    </a-entity>
  </a-scene>

  <script>
  // --- อะแดปต์เคอร์เซอร์ตามแพลตฟอร์ม ---
  (async function(){
    const cursor = document.getElementById('cursor');
    const rig = document.getElementById('rig');

    // PC: ให้ ray จากเมาส์ (คลิกแม่นกว่า), ปิดฟิวส์
    const isPC = !/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    if(isPC){
      cursor.setAttribute('cursor', 'fuse:false');
      cursor.setAttribute('raycaster', 'objects: .clickable; rayOrigin: mouse');
    }

    // VR: ถ้ามี immersive-vr → ใช้ Enter VR + laser controls
    let hasVR = false;
    try{
      hasVR = !!(navigator.xr && await navigator.xr.isSessionSupported('immersive-vr'));
    }catch(_){}

    // Mobile: เปิดปุ่มเดินอย่างง่าย + แตะหน้าจอเพื่อหมุน/มอง (touch look อยู่ใน look-controls)
    if(!isPC && !hasVR){
      const pad = document.querySelector('.pad');
      pad.style.display = 'flex';
      // เดินแบบง่าย: ปรับตำแหน่ง rig เล็กน้อยตามปุ่ม
      const step = 0.25;
      pad.addEventListener('click', (e)=>{
        const dir = e.target.dataset.move; if(!dir) return;
        const p = rig.object3D.position;
        switch(dir){
          case 'forward': p.z -= step; break;
          case 'back':    p.z += step; break;
          case 'left':    p.x -= step; break;
          case 'right':   p.x += step; break;
        }
      });
    }

    // กลับศูนย์มุมกล้อง (มีประโยชน์เมื่อกล้องเพี้ยนบนมือถือ)
    document.getElementById('recenter').addEventListener('click', ()=>{
      const head = document.getElementById('head');
      head.object3D.rotation.set(0,0,0);
    });

    // ตัวอย่างการคลิก (ทุกแพลตฟอร์ม): เปลี่ยนสีเมื่อคลิกวัตถุ .clickable
    const clickable = document.querySelector('.clickable');
    clickable.addEventListener('click', ()=>{
      clickable.setAttribute('color', '#3b82f6');
      // TODO: เรียกเปิด Result Modal หรือไปโซน/เกมต่อไป
    });

    // ปิด HUD บางส่วนเมื่อเข้า/ออก VR (ลดรบกวนสายตา)
    const scene = document.querySelector('a-scene');
    const hud = document.querySelector('.hud');
    scene.addEventListener('enter-vr', ()=> { hud.style.display='none'; });
    scene.addEventListener('exit-vr',  ()=> { hud.style.display='block'; });
  })();
  </script>
</body>
</html>