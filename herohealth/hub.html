<!-- === /herohealth/hub.html ===
HeroHealth ‚Äî Hub (3 Zones) ‚Äî PRODUCTION (Big Zone Status + Reset today + Auto-detect platform)
‚úÖ No forced ordering: play any game anytime
‚úÖ Shows BIG zone status bars/icons
‚úÖ Reset today clears all 3 zone daily gates
‚úÖ Adds MaskCough into Hygiene
‚úÖ Auto-detect platform (auto/vr/cvr) + remembers preference
‚úÖ Pass-through hub/run/diff/time/seed/studyId/phase/conditionGroup/log/view (+pid)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hub</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.70);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;

      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --cyan:#22d3ee; --violet:#a78bfa; --pink:#ff4fd8;

      --radius:22px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(1000px 600px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 520px at 55% 90%, rgba(167,139,250,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      overflow:auto;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:1160px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }

    /* Top header */
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      padding: 6px 6px 0 6px;
      flex-wrap:wrap;
    }
    .brand{ display:flex; flex-direction:column; gap:6px; }
    .title{
      margin:0;
      font-size: clamp(22px, 2.2vw, 30px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.4;
      max-width: 78ch;
    }
    .pillrow{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-end; }
    .pill{
      background: rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(8px);
      white-space:nowrap;
      user-select:none;
    }
    .pill b{ color:var(--text); font-weight:900; }

    /* Big zone status bar */
    .zonebar{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .zonebarHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px 14px;
      border-bottom:1px solid var(--stroke);
      background: rgba(2,6,23,.35);
      flex-wrap:wrap;
    }
    .zonebarHead .left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .bigPill{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size:13px;
      font-weight:900;
      white-space:nowrap;
    }
    .bigPill .dot{
      width:12px; height:12px; border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 18px rgba(245,158,11,.35);
    }
    .bigPill.ok .dot{ background: var(--good); box-shadow: 0 0 18px rgba(34,197,94,.35); }
    .bigPill.bad .dot{ background: var(--bad); box-shadow: 0 0 18px rgba(239,68,68,.35); }

    .actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; align-items:center;
    }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      padding:10px 12px;
      border-radius: 14px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, opacity .12s ease, border-color .12s ease, background .12s ease;
      display:flex; align-items:center; gap:8px;
      white-space:nowrap;
      font-weight:900;
      font-size:13px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.good{ border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .btn.warn{ border-color: rgba(245,158,11,.25); background: rgba(245,158,11,.08); }
    .btn.ghost{ color:var(--muted); }
    .btn.disabled{ opacity:.55; cursor:not-allowed; }

    .zonebarBody{
      padding: 12px 12px 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 10px;
    }
    @media (max-width: 980px){
      .zonebarBody{ grid-template-columns: 1fr; }
      .pillrow{ justify-content:flex-start; }
      .actions{ justify-content:flex-start; }
    }
    .zoneCard{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.40);
      border-radius: 18px;
      padding: 14px;
      position:relative;
      overflow:hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
      min-height: 160px;
    }
    .zoneCard h3{
      margin:0 0 6px 0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .zoneCard p{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.45;
    }
    .glow{
      position:absolute; inset:-40% -35% auto auto;
      width:240px; height:240px;
      background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.22), transparent 60%);
      filter: blur(10px);
      transform: rotate(14deg);
      pointer-events:none;
      opacity:.9;
    }
    .glow.cyan{ background: radial-gradient(circle at 30% 30%, rgba(34,211,238,.22), transparent 60%); }
    .glow.violet{ background: radial-gradient(circle at 30% 30%, rgba(167,139,250,.22), transparent 60%); }

    .miniStatus{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.28);
      color:var(--muted);
      font-size: 12px;
      font-weight:800;
      user-select:none;
      white-space:nowrap;
    }
    .chip b{ color:var(--text); font-weight:900; }
    .meter{
      height: 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      overflow:hidden;
      margin-top:10px;
    }
    .fill{
      height:100%;
      width:0%;
      background: rgba(34,197,94,.85);
      transition: width .14s ease;
    }
    .fill.cyan{ background: rgba(34,211,238,.85); }
    .fill.violet{ background: rgba(167,139,250,.85); }
    .fill.warn{ background: rgba(245,158,11,.88); }

    /* Section title pill */
    .sectionPill{
      width:fit-content;
      margin: 10px 0 0;
    }

    /* Game grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 12px;
      margin-top: 8px;
    }
    @media (max-width: 1100px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 560px){ .grid{ grid-template-columns: 1fr; } }

    .game{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.46);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.22);
      position:relative;
      overflow:hidden;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      min-height: 132px;
    }
    .game:hover{ border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.06); }
    .game:active{ transform: translateY(1px); }
    .gameTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .gameTitle{ font-weight:900; letter-spacing:.2px; margin:0; font-size: 15px; }
    .gameSub{ margin:6px 0 0 0; color:var(--muted); font-size: 12px; line-height:1.35; }
    .tag{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 11px;
      color: var(--text);
      font-weight:900;
      white-space:nowrap;
    }
    .tag.run{ border-color: rgba(255,255,255,.18); }
    .tag.launch{ border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .tag.new{ border-color: rgba(255,79,216,.28); background: rgba(255,79,216,.10); }

    /* Platform selector */
    .platformBar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .seg{
      display:inline-flex;
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      border-radius: 999px;
      overflow:hidden;
    }
    .seg button{
      appearance:none;
      border:0;
      background: transparent;
      color: var(--muted);
      padding: 10px 12px;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .seg button.active{
      color: var(--text);
      background: rgba(255,255,255,.08);
    }
    .seg small{
      opacity:.9;
      font-weight:900;
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + var(--sab));
      transform: translateX(-50%);
      background: rgba(2,6,23,.85);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      z-index: 9999;
      max-width: 92vw;
      font-size: 13px;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1 class="title">üè∞ HeroHealth ‚Äî Hub</h1>
        <p class="subtitle">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö Daily Gate ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° ‚Äú‡πÇ‡∏ã‡∏ô‚Äù ‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡πÇ‡∏ã‡∏ô
        </p>
      </div>

      <div class="pillrow" id="pillrow"></div>
    </div>

    <!-- BIG ZONE STATUS + RESET + PLATFORM -->
    <section class="zonebar" aria-label="Zone status">
      <div class="zonebarHead">
        <div class="left">
          <div class="bigPill" id="pillNutrition"><span class="dot"></span><span id="tNutrition">ü•ó Nutrition: ‚Äî</span></div>
          <div class="bigPill" id="pillHygiene"><span class="dot"></span><span id="tHygiene">üßº Hygiene: ‚Äî</span></div>
          <div class="bigPill" id="pillFitness"><span class="dot"></span><span id="tFitness">üèÉ Fitness: ‚Äî</span></div>
          <span class="pill"><b>today</b>: <span id="todayText">‚Äî</span></span>
        </div>

        <div class="actions">
          <div class="platformBar" title="Auto-detect platform (override ‡πÑ‡∏î‡πâ)">
            <span class="pill"><b>platform</b>: <span id="platText">‚Äî</span></span>
            <div class="seg" role="tablist" aria-label="Platform mode">
              <button id="modeAuto" type="button"><small>Auto</small></button>
              <button id="modeVR" type="button"><small>VR</small></button>
              <button id="modeCVR" type="button"><small>Cardboard</small></button>
            </div>
          </div>
          <div class="btn ghost" id="btnHow">‚ùì ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ú‡πà‡∏≤‡∏ô Daily Gate</div>
          <div class="btn warn" id="btnResetToday">‚ôªÔ∏è Reset today (‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô)</div>
        </div>
      </div>

      <div class="zonebarBody">
        <div class="zoneCard">
          <div class="glow"></div>
          <h3>ü•ó Nutrition</h3>
          <p>‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£: GoodJunk / Groups / Hydration / Plate</p>
          <div class="miniStatus">
            <span class="chip"><b>Gate</b>: <span id="cNutGate">‚Äî</span></span>
            <span class="chip"><b>Key</b>: HHA_ZONE_DONE::nutrition</span>
          </div>
          <div class="meter"><div class="fill" id="mNut"></div></div>
        </div>

        <div class="zoneCard">
          <div class="glow cyan"></div>
          <h3>üßº Hygiene</h3>
          <p>‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•: Hygiene VR (Handwash/Brush) + MaskCough</p>
          <div class="miniStatus">
            <span class="chip"><b>Gate</b>: <span id="cHygGate">‚Äî</span></span>
            <span class="chip"><b>Key</b>: HHA_ZONE_DONE::hygiene</span>
          </div>
          <div class="meter"><div class="fill cyan" id="mHyg"></div></div>
        </div>

        <div class="zoneCard">
          <div class="glow violet"></div>
          <h3>üèÉ Fitness</h3>
          <p>‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢: Shadow Breaker / Rhythm Boxer / Jump-Duck / Balance Hold</p>
          <div class="miniStatus">
            <span class="chip"><b>Gate</b>: <span id="cFitGate">‚Äî</span></span>
            <span class="chip"><b>Key</b>: HHA_ZONE_DONE::fitness</span>
          </div>
          <div class="meter"><div class="fill violet" id="mFit"></div></div>
        </div>
      </div>
    </section>

    <!-- ===================== NUTRITION ===================== -->
    <section aria-label="Nutrition games">
      <div class="pill sectionPill"><b>Nutrition games</b> (Root launchers ‡πÉ‡∏ô /herohealth)</div>

      <div class="grid">
        <div class="game" data-href="./goodjunk-vr-launcher.html" data-zone="nutrition">
          <div class="gameTop">
            <h3 class="gameTitle">üç≠ GoodJunk VR</h3>
            <span class="tag launch">Launcher</span>
          </div>
          <p class="gameSub">‡∏¢‡∏¥‡∏á/‡πÅ‡∏ï‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ-‡∏Ç‡∏¢‡∏∞ ‚Ä¢ missions/summary ‚Ä¢ Daily Gate ‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô</p>
        </div>

        <div class="game" data-href="./groups-vr.html" data-zone="nutrition">
          <div class="gameTop">
            <h3 class="gameTitle">üß© Food Groups VR</h3>
            <span class="tag launch">Launcher</span>
          </div>
          <p class="gameSub">‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏õ.5) ‚Ä¢ Director/Badges ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ</p>
        </div>

        <div class="game" data-href="./hydration-vr.html" data-zone="nutrition">
          <div class="gameTop">
            <h3 class="gameTitle">üíß Hydration VR</h3>
            <span class="tag launch">Launcher</span>
          </div>
          <p class="gameSub">‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ ‚Ä¢ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥/‡∏°‡∏¥‡∏ô‡∏¥‡∏ö‡∏≠‡∏™ ‚Ä¢ Daily Gate ‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô</p>
        </div>

        <div class="game" data-href="./plate-vr.html" data-zone="nutrition">
          <div class="gameTop">
            <h3 class="gameTitle">üçΩÔ∏è Plate VR</h3>
            <span class="tag launch">Launcher</span>
          </div>
          <p class="gameSub">‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô 5 ‡∏´‡∏°‡∏π‡πà ‚Ä¢ ‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î ‚Ä¢ Daily Gate ‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô</p>
        </div>
      </div>
    </section>

    <!-- ===================== HYGIENE ===================== -->
    <section aria-label="Hygiene games">
      <div class="pill sectionPill"><b>Hygiene games</b> (Run/VR pages)</div>

      <div class="grid">
        <div class="game" data-href="./hygiene-vr.html" data-zone="hygiene">
          <div class="gameTop">
            <h3 class="gameTitle">üßº Hygiene VR</h3>
            <span class="tag run">Run</span>
          </div>
          <p class="gameSub">‡πÇ‡∏´‡∏°‡∏î Handwash/Brush ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°</p>
        </div>

        <div class="game" data-href="./maskcough-vr.html" data-zone="hygiene">
          <div class="gameTop">
            <h3 class="gameTitle">üò∑ Mask & Cough VR</h3>
            <span class="tag new">NEW</span>
          </div>
          <p class="gameSub">‡πÉ‡∏™‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å + ‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡πÑ‡∏≠‡∏à‡∏≤‡∏° ‚Ä¢ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢/‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô ‚Ä¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö log</p>
        </div>
      </div>

      <p class="subtitle" style="margin:10px 6px 0;">
        Tip: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ó‡∏≥ Hygiene ‡πÉ‡∏´‡πâ‡∏°‡∏µ ‚ÄúRoot launcher + Gate‚Äù ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Nutrition ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏à‡∏±‡∏î‡πÅ‡∏û‡πá‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
      </p>
    </section>

    <!-- ===================== FITNESS ===================== -->
    <section aria-label="Fitness games">
      <div class="pill sectionPill"><b>Fitness games</b> (‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå /fitness)</div>

      <div class="grid">
        <!-- NOTE: ‡∏ï‡∏±‡πâ‡∏á data-href ‡πÄ‡∏õ‡πá‡∏ô path ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏à‡∏≠) ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -vr/-cvr ‡∏ï‡∏≤‡∏° platform -->
        <div class="game" data-href="../fitness/shadow-breaker.html" data-zone="fitness">
          <div class="gameTop">
            <h3 class="gameTitle">üï∂Ô∏è Shadow Breaker</h3>
            <span class="tag run">Run</span>
          </div>
          <p class="gameSub">reflex + ‡πÄ‡∏Å‡∏°‡πÄ‡∏á‡∏≤ ‚Ä¢ Auto ‡πÑ‡∏õ VR ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå -vr ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö</p>
        </div>

        <div class="game" data-href="../fitness/rhythm-boxer.html" data-zone="fitness">
          <div class="gameTop">
            <h3 class="gameTitle">ü•ä Rhythm Boxer</h3>
            <span class="tag run">Run</span>
          </div>
          <p class="gameSub">‡∏ï‡πà‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ ‚Ä¢ Auto ‡πÑ‡∏õ -cvr ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Cardboard</p>
        </div>

        <div class="game" data-href="../fitness/jump-duck.html" data-zone="fitness">
          <div class="gameTop">
            <h3 class="gameTitle">ü¶ò Jump-Duck</h3>
            <span class="tag run">Run</span>
          </div>
          <p class="gameSub">‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î/‡∏Å‡πâ‡∏°‡∏´‡∏•‡∏ö ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡∏à‡∏≠</p>
        </div>

        <div class="game" data-href="../fitness/balance-hold.html" data-zone="fitness">
          <div class="gameTop">
            <h3 class="gameTitle">üßò Balance Hold</h3>
            <span class="tag run">Run</span>
          </div>
          <p class="gameSub">‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏Ñ‡πâ‡∏≤‡∏á ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏õ.5 ‡πÑ‡∏î‡πâ</p>
        </div>
      </div>

      <p class="subtitle" style="margin:10px 6px 0;">
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Fitness ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á (‡πÄ‡∏ä‡πà‡∏ô‡∏°‡∏µ -vr/-cvr ‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠) ‡∏ö‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡∏õ‡∏£‡∏±‡∏ö routing ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞ 100%
      </p>
    </section>

  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  // ----------------- params/pass-through -----------------
  function pageUrl(){ return location.href.split('#')[0]; }
  function parseQS(){ try{ return new URL(pageUrl()).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = parseQS();
  const PASS_KEYS = ['pid','run','diff','time','seed','studyId','phase','conditionGroup','log','view'];

  function ymdLocal(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  // ----------------- zone daily gate -----------------
  function zoneDoneKey(zone){ return `HHA_ZONE_DONE::${zone}::${ymdLocal()}`; }
  function isZoneDoneToday(zone){
    try{ return localStorage.getItem(zoneDoneKey(zone)) === '1'; }catch(_){ return false; }
  }
  function clearZoneToday(zone){
    try{ localStorage.removeItem(zoneDoneKey(zone)); }catch(_){}
  }

  // ----------------- toast -----------------
  const toastEl = document.getElementById('toast');
  let toastTimer=null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    toastTimer = setTimeout(()=> toastEl.classList.remove('show'), 1400);
  }

  // ----------------- UI helpers -----------------
  function setPill(el, done){
    if(!el) return;
    el.classList.remove('ok','bad');
    el.classList.add(done ? 'ok' : 'bad');
  }
  function setText(id, v){
    const el = document.getElementById(id);
    if(el) el.textContent = v;
  }

  function syncBars(){
    const today = ymdLocal();
    setText('todayText', today);

    const nut = isZoneDoneToday('nutrition');
    const hyg = isZoneDoneToday('hygiene');
    const fit = isZoneDoneToday('fitness');

    setPill(document.getElementById('pillNutrition'), nut);
    setPill(document.getElementById('pillHygiene'), hyg);
    setPill(document.getElementById('pillFitness'), fit);

    setText('tNutrition', `ü•ó Nutrition: ${nut ? 'DONE TODAY' : 'NOT DONE'}`);
    setText('tHygiene',  `üßº Hygiene: ${hyg ? 'DONE TODAY' : 'NOT DONE'}`);
    setText('tFitness',  `üèÉ Fitness: ${fit ? 'DONE TODAY' : 'NOT DONE'}`);

    setText('cNutGate', nut ? 'DONE TODAY' : 'NEED GATE');
    setText('cHygGate', hyg ? 'DONE TODAY' : 'NEED GATE');
    setText('cFitGate', fit ? 'DONE TODAY' : 'NEED GATE');

    const mNut = document.getElementById('mNut');
    const mHyg = document.getElementById('mHyg');
    const mFit = document.getElementById('mFit');

    mNut.style.width = (nut ? 100 : 35) + '%';
    mHyg.style.width = (hyg ? 100 : 35) + '%';
    mFit.style.width = (fit ? 100 : 35) + '%';

    mNut.classList.toggle('warn', !nut);
    mHyg.classList.toggle('warn', !hyg);
    mFit.classList.toggle('warn', !fit);
  }

  // ----------------- platform detect + preference -----------------
  // HHA_VIEW_PREF: 'auto' | 'vr' | 'cvr'
  function getViewPref(){
    try{
      const v = (localStorage.getItem('HHA_VIEW_PREF') || '').toLowerCase();
      if(v === 'vr' || v === 'cvr' || v === 'auto') return v;
    }catch(_){}
    return 'auto';
  }
  function setViewPref(v){
    try{ localStorage.setItem('HHA_VIEW_PREF', v); }catch(_){}
  }

  function detectPlatform(){
    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua) || (navigator.maxTouchPoints > 1);
    const hasXR = !!navigator.xr; // presence only (we don't force requestSession here)
    const qsView = (QS.get('view') || '').toLowerCase();
    const pref = getViewPref();
    const mode = (qsView === 'cvr' || qsView === 'vr') ? qsView : pref; // explicit query wins
    const isCVR = (mode === 'cvr');

    return { isMobile, hasXR, mode, isCVR };
  }

  function renderPlatformBar(){
    const { isMobile, hasXR, mode, isCVR } = detectPlatform();
    const plat = [
      isMobile ? 'mobile' : 'pc',
      hasXR ? 'webxr' : 'no-xr',
      isCVR ? 'cardboard' : (mode === 'vr' ? 'vr' : 'auto')
    ].join(' ‚Ä¢ ');
    setText('platText', plat);

    const bAuto = document.getElementById('modeAuto');
    const bVR   = document.getElementById('modeVR');
    const bCVR  = document.getElementById('modeCVR');

    [bAuto,bVR,bCVR].forEach(b=> b.classList.remove('active'));
    if(mode === 'vr') bVR.classList.add('active');
    else if(mode === 'cvr') bCVR.classList.add('active');
    else bAuto.classList.add('active');

    // disable VR button if no XR (still allow, but mark disabled feel)
    if(!hasXR){
      bVR.style.opacity = .5;
      bVR.title = '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏û‡∏ö WebXR (‡∏¢‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≠‡πÑ‡∏î‡πâ)';
    }else{
      bVR.style.opacity = 1;
      bVR.title = '';
    }

    bAuto.onclick = ()=>{
      setViewPref('auto');
      toast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Platform: Auto');
      renderPlatformBar();
    };
    bVR.onclick = ()=>{
      setViewPref('vr');
      toast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Platform: VR');
      renderPlatformBar();
    };
    bCVR.onclick = ()=>{
      setViewPref('cvr');
      toast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Platform: Cardboard');
      renderPlatformBar();
    };
  }

  // ----------------- pass-through helper -----------------
  function applyPassThrough(href){
    const u = new URL(href, location.href);
    for (const k of PASS_KEYS){
      if (!u.searchParams.has(k) && QS.has(k)){
        const v = QS.get(k);
        if (v != null && String(v).trim() !== '') u.searchParams.set(k, v);
      }
    }
    if (!u.searchParams.has('hub') || String(u.searchParams.get('hub')||'').trim()===''){
      u.searchParams.set('hub', location.href);
    }
    return u.toString();
  }

  // ----------------- smart routing (auto-detect) -----------------
  // Rule: do NOT override if user already forced ?view= in target href
  function smartHref(base){
    const u = new URL(base, location.href);

    // if target already has view=, keep it
    const forced = (u.searchParams.get('view')||'').trim();
    if(forced) return u.toString();

    const { hasXR, mode } = detectPlatform();

    // If mode is 'vr' but device has no XR, we still allow; it will just open normal page.
    // Fitness routing based on your screenshot filenames:
    // - Rhythm Boxer has rhythm-boxer.html and rhythm-boxer-cvr.html
    // - Shadow Breaker has shadow-breaker.html and shadow-breaker-vr.html (exists in /fitness)
    // - Jump-Duck has jump-duck.html (single)
    // - Balance Hold has balance-hold.html (single)

    // Rhythm Boxer -> cVR file when mode=cvr
    if (u.pathname.endsWith('/fitness/rhythm-boxer.html') && mode === 'cvr'){
      u.pathname = u.pathname.replace('rhythm-boxer.html','rhythm-boxer-cvr.html');
      // add view=cvr so downstream knows (optional)
      u.searchParams.set('view','cvr');
    }

    // Shadow Breaker -> VR file when mode=vr OR (auto + hasXR)
    if (u.pathname.endsWith('/fitness/shadow-breaker.html')){
      const wantVR = (mode === 'vr') || (mode === 'auto' && hasXR);
      if(wantVR){
        // file exists in your /fitness list: shadow-breaker-vr.html
        u.pathname = u.pathname.replace('shadow-breaker.html','shadow-breaker-vr.html');
        u.searchParams.set('view','vr');
      }
    }

    // Hygiene / MaskCough are already VR pages (single) => no change
    return u.toString();
  }

  // ----------------- render pills (ctx) -----------------
  function renderPills(){
    const pills = [
      ['pid', QS.get('pid')],
      ['run', QS.get('run')],
      ['diff', QS.get('diff')],
      ['time', QS.get('time')],
      ['seed', QS.get('seed')],
      ['studyId', QS.get('studyId')],
      ['phase', QS.get('phase')],
      ['conditionGroup', QS.get('conditionGroup')],
      ['log', QS.get('log')],
      ['view', QS.get('view')],
    ].filter(x => x[1] != null && String(x[1]).trim() !== '');

    const el = document.getElementById('pillrow');
    el.innerHTML = (pills.length ? pills : [['ctx','none']])
      .slice(0, 12)
      .map(([k,v]) => `<span class="pill"><b>${k}</b>: ${String(v).replace(/</g,'&lt;')}</span>`)
      .join('');
  }

  // ----------------- click game cards -----------------
  function bindGames(){
    const cards = document.querySelectorAll('.game[data-href]');
    cards.forEach(card=>{
      card.addEventListener('click', ()=>{
        const href = card.getAttribute('data-href');
        if(!href) return;

        // 1) choose best file for device first
        const picked = smartHref(href);

        // 2) then apply pass-through context + hub param
        const url = applyPassThrough(picked);

        location.href = url;
      }, { passive:true });
    });
  }

  // ----------------- reset today + how -----------------
  function bindReset(){
    const btn = document.getElementById('btnResetToday');
    btn.addEventListener('click', ()=>{
      clearZoneToday('nutrition');
      clearZoneToday('hygiene');
      clearZoneToday('fitness');
      syncBars();
      toast('Reset today ‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô)');
    });

    const btnHow = document.getElementById('btnHow');
    btnHow.addEventListener('click', ()=>{
      toast('Daily Gate: ‡∏ó‡∏≥ Quest Gate ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô (Q1‚ÄìQ3 + Boss + Cooldown) ‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡πÇ‡∏ã‡∏ô');
    });
  }

  // ----------------- init -----------------
  renderPills();
  syncBars();
  renderPlatformBar();
  bindGames();
  bindReset();

})();
</script>

</body>
</html>