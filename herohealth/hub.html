<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hub (3 Zones)</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.70);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;
      --accent:#22c55e; --cyan:#22d3ee; --violet:#a78bfa; --amber:#f59e0b;
      --radius:22px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(1000px 600px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 520px at 55% 90%, rgba(167,139,250,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:1100px; margin:0 auto; }
    .top{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      padding: 14px 14px 0 14px;
    }
    .brand{
      display:flex; flex-direction:column; gap:6px;
    }
    .title{
      font-size: clamp(22px, 2.2vw, 30px);
      margin:0;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 14px;
      line-height:1.4;
    }
    .pillrow{
      display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;
    }
    .pill{
      background: rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .pill b{ color:var(--text); font-weight:700; }
    .panel{
      margin-top:14px;
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .zonebar{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--stroke);
      background: rgba(2,6,23,.35);
    }
    .tabs{ display:flex; gap:10px; flex-wrap:wrap; }
    .tab{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      color:var(--muted);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      display:flex; gap:8px; align-items:center;
      transition: transform .12s ease, background .12s ease, color .12s ease, border-color .12s ease;
    }
    .tab:active{ transform: translateY(1px); }
    .tab.active{
      color: var(--text);
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
    }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      padding:10px 12px;
      border-radius: 14px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
      display:flex; align-items:center; gap:8px;
    }
    .btn.secondary{ color: var(--muted); }
    .btn:active{ transform: translateY(1px); }

    .content{
      padding: 14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
    }
    @media (max-width: 900px){
      .content{ grid-template-columns: 1fr; }
      .pillrow{ justify-content:flex-start; }
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }
    @media (max-width: 560px){
      .cards{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.40);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      position:relative;
      overflow:hidden;
      cursor:pointer;
      user-select:none;
      min-height: 132px;
    }
    .card:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.045);
      border-color: rgba(255,255,255,.18);
    }
    .card:active{ transform: translateY(1px); }

    .card h3{
      margin:0 0 6px 0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .card p{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .tags{ margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
    .tag{
      border:1px solid var(--stroke);
      padding:6px 8px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      background: rgba(2,6,23,.30);
    }
    .glow{
      position:absolute; inset:-40% -30% auto auto;
      width:220px; height:220px;
      background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.35), transparent 60%);
      filter: blur(8px);
      transform: rotate(18deg);
      pointer-events:none;
      opacity:.9;
    }
    .glow.cyan{ background: radial-gradient(circle at 30% 30%, rgba(34,211,238,.32), transparent 60%); }
    .glow.violet{ background: radial-gradient(circle at 30% 30%, rgba(167,139,250,.32), transparent 60%); }
    .glow.amber{ background: radial-gradient(circle at 30% 30%, rgba(245,158,11,.30), transparent 60%); }

    .side{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.34);
      border-radius:18px;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height: 220px;
    }
    .side h4{ margin:0; font-size:14px; color: var(--text); }
    .kv{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .kv .box{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.30);
      border-radius:14px;
      padding:10px;
    }
    .kv .k{ color:var(--muted); font-size:12px; }
    .kv .v{ margin-top:4px; font-weight:700; font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .note{
      border:1px dashed rgba(148,163,184,.28);
      background: rgba(2,6,23,.24);
      border-radius:14px;
      padding:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .footer{
      padding: 12px 14px 16px 14px;
      border-top:1px solid var(--stroke);
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background: rgba(2,6,23,.25);
    }
    .linklike{
      text-decoration: underline;
      cursor:pointer;
      color: var(--text);
      opacity:.9;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1 class="title">üè´ HeroHealth ‚Äî Hub</h1>
        <p class="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢/‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏ö + ‡∏Å‡∏•‡∏±‡∏ö Hub ‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠)</p>
      </div>
      <div class="pillrow" id="pillrow"></div>
    </div>

    <div class="panel">
      <div class="zonebar">
        <div class="tabs" id="tabs"></div>
        <div class="actions">
          <div class="btn secondary" id="btnCopyLink">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Hub</div>
          <div class="btn" id="btnReset">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏ã‡∏ô</div>
        </div>
      </div>

      <div class="content">
        <div>
          <div class="cards" id="cards"></div>
        </div>
        <aside class="side">
          <h4>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ & ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h4>
          <div class="kv" id="kv"></div>
          <div class="note" id="note">
            ‚úÖ Hub ‡∏ô‡∏µ‡πâ ‚Äú‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‚Äù query ‡πÄ‡∏≠‡∏á (‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° hub= ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö)<br/>
            ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏ö (run/diff/time/seed/studyId/phase/conditionGroup/log ‡∏Ø‡∏•‡∏Ø)
          </div>
        </aside>
      </div>

      <div class="footer">
        <div>¬© HeroHealth ‚Äî 3 Zones Hub</div>
        <div><span class="linklike" id="btnShowDebug">‡∏î‡∏π Debug</span></div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  // ========= CONFIG: ‡πÅ‡∏Å‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì =========
  // NOTE: ‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô path ‡πÅ‡∏ö‡∏ö relative ‡∏à‡∏≤‡∏Å /herohealth/hub.html ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
  const ZONES = [
    {
      id: 'nutrition',
      icon: 'ü•ó',
      name: '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£',
      color: 'green',
      desc: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å 5 ‡∏´‡∏°‡∏π‡πà ‚Ä¢ ‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô ‚Ä¢ ‡∏ô‡πâ‡∏≥ ‚Ä¢ good vs junk',
      games: [
        {
          title: 'Food Groups VR',
          icon: 'üß©',
          desc: '‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å 5 ‡∏´‡∏°‡∏π‡πà ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô',
          href: './groups-vr.html', // (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ launcher) ‡∏´‡∏£‡∏∑‡∏≠ './vr-groups/groups.html'
          tags: ['PC/Mobile/VR', 'Aim Assist', 'FX+HUD']
        },
        {
          title: 'Balanced Plate VR',
          icon: 'üçΩÔ∏è',
          desc: '‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Ñ‡∏£‡∏ö‡∏´‡∏°‡∏π‡πà',
          href: './plate-vr.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏ä‡πà‡∏ô './plate/plate.html'
          tags: ['5 ‡∏´‡∏°‡∏π‡πà', 'Adaptive', 'Quest']
        },
        {
          title: 'Hydration Quest VR',
          icon: 'üíß',
          desc: '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤/‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
          href: './hydration-vr.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          tags: ['Time', 'Streak', 'Logging']
        },
        {
          title: 'GoodJunkVR',
          icon: 'üçé',
          desc: '‡πÅ‡∏¢‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ/‡∏Ç‡∏¢‡∏∞ + ‡πÄ‡∏Ñ‡∏ß‡∏™ + ‡∏ö‡∏≠‡∏™',
          href: './goodjunk-vr-launcher.html', // ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ launcher ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
          tags: ['Boss', 'Mini Quest', 'Research']
        }
      ]
    },
    {
      id: 'hygiene',
      icon: 'üßº',
      name: '‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
      color: 'cyan',
      desc: '‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠ ‚Ä¢ ‡πÅ‡∏õ‡∏£‡∏á‡∏ü‡∏±‡∏ô ‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚Ä¢ ‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢',
      games: [
        {
          title: 'Handwash VR',
          icon: 'ü´ß',
          desc: '‡∏ó‡∏≥‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤',
          href: './hygiene-vr/hygiene.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          tags: ['7 Steps', 'Quiz', 'FX']
        },
        {
          title: 'Tooth Brush (Idea)',
          icon: 'ü¶∑',
          desc: '‡πÅ‡∏õ‡∏£‡∏á‡∏ü‡∏±‡∏ô‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏≤‡∏ö + ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö + ‡∏ö‡∏≠‡∏™‡∏´‡∏¥‡∏ô‡∏õ‡∏π‡∏ô',
          href: '#',
          tags: ['Concept', 'Boss', 'Combo']
        },
        {
          title: 'Safety (Idea)',
          icon: 'üõ°Ô∏è',
          desc: '‡∏´‡∏•‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ/‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‚Ä¢ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡πá‡∏ß',
          href: '#',
          tags: ['Concept', 'Reaction', 'Scoring']
        },
        {
          title: 'Dress (Idea)',
          icon: 'üëï',
          desc: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå/‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‚Ä¢ ‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á',
          href: '#',
          tags: ['Concept', 'Logic', 'Timed']
        }
      ]
    },
    {
      id: 'fitness',
      icon: 'üèÉ',
      name: '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢',
      color: 'violet',
      desc: '‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡∏° ‚Ä¢ ‡∏£‡∏µ‡πÅ‡∏≠‡∏Ñ‡∏ä‡∏±‡∏ô ‚Ä¢ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ ‚Ä¢ ‡∏ö‡∏≠‡∏™‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ü‡∏™',
      games: [
        {
          title: 'Shadow Breaker',
          icon: 'ü•ä',
          desc: '‡∏ï‡πà‡∏≠‡∏¢‡πÄ‡∏á‡∏≤/‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô + ‡∏ö‡∏≠‡∏™',
          href: '../fitness/shadow-breaker.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          tags: ['Boss', 'Stamina', 'VR Ready']
        },
        {
          title: 'Jump-Duck',
          icon: 'ü¶ò',
          desc: '‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î/‡∏Å‡πâ‡∏°‡∏´‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ + ‡∏ö‡∏≠‡∏™ 3 ‡πÄ‡∏ü‡∏™',
          href: '../fitness/jump-duck.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          tags: ['Boss 3 Phases', 'AI Predictor', 'Fast']
        },
        {
          title: 'Rhythm Boxer',
          icon: 'üéµ',
          desc: '‡∏ä‡∏Å‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ (lane-based) ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°',
          href: '../fitness/rhythm-boxer.html', // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          tags: ['Rhythm', 'Multi-platform', 'cVR']
        },
        {
          title: 'Coming Soon',
          icon: '‚ö°',
          desc: '‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å + ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô',
          href: '#',
          tags: ['Standard', 'Logging', 'Coach']
        }
      ]
    }
  ];

  // ========= HELPERS =========
  const LS_LAST_ZONE = 'HHA_HUB_LAST_ZONE';
  const $ = (sel)=>document.querySelector(sel);

  function parseQS(){
    try{ return new URL(location.href).searchParams; }catch{ return new URLSearchParams(); }
  }

  function toObj(sp){
    const o = {};
    for (const [k,v] of sp.entries()) o[k]=v;
    return o;
  }

  function buildTargetUrl(baseHref){
    // baseHref ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô relative (./x.html) ‡∏´‡∏£‡∏∑‡∏≠ absolute
    const base = new URL(baseHref, location.href);
    const cur = parseQS();

    // ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏ö
    for (const [k,v] of cur.entries()){
      // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ß‡∏ô‡∏ã‡πâ‡∏≥ hub ‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÅ‡∏ï‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ override ‡πÄ‡∏õ‡πá‡∏ô hub ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
      if (k === 'hub') continue;
      base.searchParams.set(k, v);
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° hub= ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏°‡∏≠
    base.searchParams.set('hub', location.href.split('#')[0]);

    return base.toString();
  }

  function safeText(v, fallback='‚Äî'){
    const s = (v==null?'':String(v)).trim();
    return s ? s : fallback;
  }

  function detectView(){
    // ‡∏≠‡πà‡∏≤‡∏ô view ‡∏à‡∏≤‡∏Å query ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡πÑ‡∏°‡πà‡πÄ‡∏î‡∏≤‡πÉ‡∏´‡πâ (‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß ‚Äú‡∏´‡πâ‡∏≤‡∏° override‚Äù)
    const q = parseQS();
    const v = (q.get('view')||'').toLowerCase();
    if (v) return v;
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô pill ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå)
    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua) || (Math.min(screen.width, screen.height) <= 480);
    return isMobile ? 'mobile' : 'pc';
  }

  // ========= UI RENDER =========
  const tabsEl = $('#tabs');
  const cardsEl = $('#cards');
  const kvEl = $('#kv');
  const pillRow = $('#pillrow');

  const state = {
    zoneId: null,
    debug: false
  };

  function renderPills(){
    const q = parseQS();
    const view = detectView();
    const run = q.get('run');
    const diff = q.get('diff');
    const time = q.get('time');
    const seed = q.get('seed');
    const studyId = q.get('studyId');
    const phase = q.get('phase');
    const conditionGroup = q.get('conditionGroup');
    const log = q.get('log');

    const pills = [
      {k:'view', v:view},
      {k:'run', v:run},
      {k:'diff', v:diff},
      {k:'time', v:time},
      {k:'seed', v:seed},
      {k:'studyId', v:studyId},
      {k:'phase', v:phase},
      {k:'condition', v:conditionGroup},
      {k:'log', v:log},
    ];

    pillRow.innerHTML = pills
      .filter(x => x.v != null && String(x.v).trim() !== '')
      .slice(0, 10)
      .map(x => `<span class="pill"><b>${x.k}</b>: ${String(x.v).replace(/</g,'&lt;')}</span>`)
      .join('');
    if (!pillRow.innerHTML){
      pillRow.innerHTML = `<span class="pill"><b>params</b>: none</span>`;
    }
  }

  function renderKV(){
    const q = parseQS();
    const data = [
      ['view', detectView()],
      ['run', q.get('run')],
      ['diff', q.get('diff')],
      ['time', q.get('time')],
      ['seed', q.get('seed')],
      ['studyId', q.get('studyId')],
      ['phase', q.get('phase')],
      ['conditionGroup', q.get('conditionGroup')],
      ['log', q.get('log')],
      ['hub', location.href.split('#')[0]]
    ];

    kvEl.innerHTML = data.map(([k,v]) => `
      <div class="box">
        <div class="k">${k}</div>
        <div class="v" title="${String(v||'')}">${safeText(v)}</div>
      </div>
    `).join('');
  }

  function renderTabs(){
    tabsEl.innerHTML = '';
    ZONES.forEach(z => {
      const div = document.createElement('div');
      div.className = 'tab' + (z.id === state.zoneId ? ' active' : '');
      div.textContent = `${z.icon} ${z.name}`;
      div.addEventListener('click', ()=> setZone(z.id, true));
      tabsEl.appendChild(div);
    });
  }

  function renderCards(){
    const zone = ZONES.find(z => z.id === state.zoneId) || ZONES[0];
    cardsEl.innerHTML = '';

    zone.games.forEach(g => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="glow ${zone.color === 'cyan' ? 'cyan' : zone.color === 'violet' ? 'violet' : zone.color === 'amber' ? 'amber' : ''}"></div>
        <h3>${g.icon} ${g.title}</h3>
        <p>${g.desc}</p>
        <div class="tags">${(g.tags||[]).slice(0,6).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      `;

      const href = (g.href || '#').trim();
      card.addEventListener('click', ()=>{
        if (!href || href === '#'){
          toast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ href ‡πÉ‡∏ô ZONES ‡∏Å‡πà‡∏≠‡∏ô)');
          return;
        }
        location.href = buildTargetUrl(href);
      });

      cardsEl.appendChild(card);
    });
  }

  function setZone(zoneId, save){
    state.zoneId = zoneId;
    if (save){
      try{ localStorage.setItem(LS_LAST_ZONE, zoneId); }catch{}
    }
    renderTabs();
    renderCards();
    renderPills();
    renderKV();
  }

  // ========= UX helpers =========
  let toastTimer = null;
  function toast(msg){
    clearTimeout(toastTimer);
    let el = document.getElementById('hh-toast');
    if (!el){
      el = document.createElement('div');
      el.id = 'hh-toast';
      el.style.position='fixed';
      el.style.left='50%';
      el.style.bottom='18px';
      el.style.transform='translateX(-50%)';
      el.style.background='rgba(2,6,23,.85)';
      el.style.border='1px solid rgba(148,163,184,.22)';
      el.style.color='var(--text)';
      el.style.padding='10px 12px';
      el.style.borderRadius='14px';
      el.style.boxShadow='0 12px 40px rgba(0,0,0,.35)';
      el.style.backdropFilter='blur(8px)';
      el.style.zIndex='9999';
      el.style.maxWidth='92vw';
      el.style.fontSize='13px';
      document.body.appendChild(el);
    }
    el.textContent = msg;
    el.style.opacity='1';
    toastTimer = setTimeout(()=>{ el.style.opacity='0'; }, 1600);
  }

  // ========= Buttons =========
  $('#btnCopyLink').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(location.href);
      toast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå Hub ‡πÅ‡∏•‡πâ‡∏ß');
    }catch{
      toast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏•‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà)');
    }
  });

  $('#btnReset').addEventListener('click', ()=>{
    try{ localStorage.removeItem(LS_LAST_ZONE); }catch{}
    setZone(ZONES[0].id, false);
    toast('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏ã‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  });

  $('#btnShowDebug').addEventListener('click', ()=>{
    state.debug = !state.debug;
    const q = parseQS();
    const obj = toObj(q);
    if (state.debug){
      alert('DEBUG ‚Äî current query params:\n\n' + JSON.stringify(obj, null, 2));
    } else {
      toast('‡∏õ‡∏¥‡∏î Debug ‡πÅ‡∏•‡πâ‡∏ß');
    }
  });

  // ========= INIT =========
  function init(){
    let last = null;
    try{ last = localStorage.getItem(LS_LAST_ZONE); }catch{}
    const zoneId = ZONES.some(z=>z.id===last) ? last : ZONES[0].id;
    renderTabs();
    setZone(zoneId, false);
  }

  init();
})();
</script>
</body>
</html>