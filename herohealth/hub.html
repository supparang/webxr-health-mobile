<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health ‚Äî VR Nutrition Hub</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon">

  <style>
    :root{
      color-scheme: dark;
      --bg-main:#020617;
      --panel:#0b1120;
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
      --accent:#22c55e;
      --blue:#38bdf8;
      --radius:18px;
      --pill:999px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.22), transparent 55%),
        var(--bg-main);
      color:var(--text-main);
      padding:16px 10px 24px;
    }
    .shell{ max-width:1120px; margin:0 auto; }

    header{ display:flex; flex-wrap:wrap; gap:12px; justify-content:space-between; align-items:flex-start; }
    .title{ font-weight:900; letter-spacing:.04em; text-transform:uppercase; font-size:clamp(1.5rem, 3vw, 1.9rem); }
    .subtitle{ font-size:13px; color:var(--text-soft); margin-top:4px; }

    .pill{
      font-size:11px; padding:4px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:rgba(15,23,42,0.9);
      color:var(--text-soft);
      display:inline-flex; gap:6px; align-items:center;
    }

    .card{
      margin-top:14px;
      background:linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.9));
      border-radius:var(--radius);
      border:1px solid rgba(148,163,184,0.26);
      box-shadow:0 20px 40px rgba(15,23,42,0.9);
      padding:14px 16px;
    }

    .profile-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
      gap:10px 14px;
      margin-top:10px;
    }
    label{ display:block; font-size:11px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-soft); margin-bottom:2px; }
    input, select{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(30,64,175,0.6);
      background:rgba(15,23,42,0.9);
      padding:6px 9px;
      color:var(--text-main);
      font-size:13px;
      outline:none;
    }
    input:focus, select:focus{ border-color:var(--accent); box-shadow:0 0 0 1px rgba(34,197,94,0.35); }

    .btn{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      padding:7px 14px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      background:rgba(15,23,42,0.9);
      color:var(--text-main);
      display:inline-flex;
      gap:6px;
      align-items:center;
    }
    .btn-primary{
      border-color:rgba(34,197,94,0.9);
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;
    }
    .btn-research{
      border-color:rgba(59,130,246,0.9);
      background:linear-gradient(135deg,#38bdf8,#2563eb);
      color:#011627;
    }
    .zones{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:14px;
      margin-top:14px;
    }
    .game-card{
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.3);
      background:rgba(15,23,42,0.95);
      padding:10px;
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      align-items:center;
    }
    .game-name{ font-weight:800; display:flex; gap:8px; align-items:center; }
    .game-desc{ font-size:11px; color:var(--text-soft); margin-top:4px; }
    .controls{ display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
    .row{ display:flex; gap:8px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
    .pill-small{ font-size:10px; padding:2px 7px; border-radius:999px; border:1px solid rgba(148,163,184,0.45); color:var(--text-soft); }
    .select-small{ width:auto; min-width:100px; border-radius:999px; font-size:11px; padding:4px 8px; }

    .note{ font-size:11px; color:var(--text-soft); margin-top:10px; }
    .footer{ margin-top:12px; text-align:right; font-size:10px; color:var(--text-soft); }
    @media (max-width:640px){ .game-card{ grid-template-columns:1fr; } .controls{ align-items:flex-start; } }
  </style>
</head>

<body>
<div class="shell">

  <header>
    <div>
      <div class="title">Hero Health ‚Äî VR Nutrition Hub</div>
      <div class="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏° ‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö ‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î Play/Research ‚Ä¢ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</div>
    </div>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <div class="pill">ü•¶ Goodjunk ‚Ä¢ üíß Hydration ‚Ä¢ üçΩÔ∏è Plate ‚Ä¢ üß© Groups</div>
      <div class="pill">üìä ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô Google Sheet (Research)</div>
    </div>
  </header>

  <section class="card">
    <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
      <div style="font-weight:800;">üìã ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°)</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="btn-load">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô</button>
        <button class="btn btn-primary" id="btn-save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
      </div>
    </div>

    <div class="profile-grid">
      <div><label>Student ID</label><input id="p-id" autocomplete="off"></div>
      <div><label>Nickname</label><input id="p-name" autocomplete="off"></div>
      <div><label>Grade</label><input id="p-grade" placeholder="‡∏õ.5" autocomplete="off"></div>
      <div><label>Room</label><input id="p-room" placeholder="5/1" autocomplete="off"></div>
      <div><label>School</label><input id="p-school" autocomplete="off"></div>
      <div><label>Group</label><input id="p-group" placeholder="A / control / ..." autocomplete="off"></div>
    </div>

    <div class="note">
      * ‡πÇ‡∏´‡∏°‡∏î Research ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ Student ID ‡∏´‡∏£‡∏∑‡∏≠ Nickname ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
    </div>
  </section>

  <div class="zones">

    <section class="card">
      <div style="font-weight:900; letter-spacing:.14em; text-transform:uppercase; color:var(--text-soft);">Play Mode</div>

      <div class="game-card" style="margin-top:10px;">
        <div>
          <div class="game-name">üçΩÔ∏è Healthy Plate VR</div>
          <div class="game-desc">‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà + Quest + ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>
        </div>
        <div class="controls">
          <div class="row">
            <span class="pill-small">‡∏£‡∏∞‡∏î‡∏±‡∏ö</span>
            <select class="select-small" data-game="plate" data-role="diff">
              <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
              <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
              <option value="hard">‡∏¢‡∏≤‡∏Å</option>
            </select>
          </div>
          <div class="row">
            <span class="pill-small" id="time-label-plate">‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: 70 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
          </div>
          <div class="row">
            <button class="btn btn-primary" data-game="plate" data-run="play">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
          </div>
        </div>
      </div>

      <div class="note">* Play: ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</div>
    </section>

    <section class="card">
      <div style="font-weight:900; letter-spacing:.14em; text-transform:uppercase; color:var(--text-soft);">Research Mode</div>

      <div class="game-card" style="margin-top:10px; border-color:rgba(59,130,246,.55);">
        <div>
          <div class="game-name">üçΩÔ∏è Healthy Plate VR ‚Äî Research</div>
          <div class="game-desc">‡∏™‡πà‡∏á Session + Events ‡πÑ‡∏õ Google Sheet ‡∏ú‡πà‡∏≤‡∏ô Apps Script</div>
        </div>
        <div class="controls">
          <div class="row">
            <span class="pill-small">‡∏£‡∏∞‡∏î‡∏±‡∏ö</span>
            <select class="select-small" data-game="plate" data-role="diff-r">
              <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
              <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
              <option value="hard">‡∏¢‡∏≤‡∏Å</option>
            </select>
          </div>
          <div class="row">
            <span class="pill-small" id="time-label-plate-r">‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: 70 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
          </div>
          <div class="row">
            <button class="btn btn-research" data-game="plate" data-run="research">üß™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢</button>
          </div>
        </div>
      </div>

      <div class="note">* Research: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Student ID ‡∏´‡∏£‡∏∑‡∏≠ Nickname ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á log ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏µ‡∏ï</div>
    </section>

  </div>

  <div class="footer">Hero Health Hub ‚Ä¢ Hub-2025-12-16</div>
</div>

<script>
  // ‚úÖ ‡πÉ‡∏™‡πà endpoint ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Hub ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å sessionStorage ‡πÑ‡∏î‡πâ
  const LOG_ENDPOINT =
    'https://script.google.com/macros/s/AKfycby7IBVmpmEydNDp5BR3CMaSAjvF7ljptaDwvow_L781iDLsbtpuiFmKviGUnugFerDtQg/exec';

  const DIFF_TIME = {
    plate: { easy: 90, normal: 70, hard: 50 }
  };

  const $ = (sel) => document.querySelector(sel);
  const $all = (sel) => Array.from(document.querySelectorAll(sel));

  function readProfile() {
    const studentId = ($('#p-id')?.value || '').trim();
    const nickName  = ($('#p-name')?.value || '').trim();
    const gradeLevel = ($('#p-grade')?.value || '').trim();
    const classRoom  = ($('#p-room')?.value || '').trim();
    const schoolName = ($('#p-school')?.value || '').trim();
    const conditionGroup = ($('#p-group')?.value || '').trim();

    const studentKey = [schoolName, gradeLevel, classRoom, (studentId || nickName)]
      .filter(Boolean).join('-') || '';

    // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á logger (field ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
    return {
      studentKey,
      studentNo: studentId,
      nickName,
      gradeLevel,
      classRoom,
      schoolName,
      conditionGroup,
      source: 'VR-Nutrition-Hub',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
  }

  function hasResearchProfile(p) {
    return !!(p && (p.studentNo || p.nickName));
  }

  function saveProfile() {
    const p = readProfile();
    sessionStorage.setItem('HHA_STUDENT_PROFILE', JSON.stringify(p));
    sessionStorage.setItem('HHA_STUDENT_KEY', p.studentKey || '');
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
  }

  function loadProfile() {
    const raw = sessionStorage.getItem('HHA_STUDENT_PROFILE');
    if (!raw) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°');
    try {
      const p = JSON.parse(raw);
      if ($('#p-id')) $('#p-id').value = p.studentNo || '';
      if ($('#p-name')) $('#p-name').value = p.nickName || '';
      if ($('#p-grade')) $('#p-grade').value = p.gradeLevel || '';
      if ($('#p-room')) $('#p-room').value = p.classRoom || '';
      if ($('#p-school')) $('#p-school').value = p.schoolName || '';
      if ($('#p-group')) $('#p-group').value = p.conditionGroup || '';
      alert('‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
    } catch(e) {
      alert('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
    }
  }

  function updateTimeLabel(modeSuffix) {
    const sel = document.querySelector('select[data-game="plate"][data-role="' + (modeSuffix ? 'diff-r' : 'diff') + '"]');
    const diff = sel ? sel.value : 'normal';
    const time = (DIFF_TIME.plate[diff] || 70);

    const label = document.getElementById('time-label-plate' + (modeSuffix ? '-r' : ''));
    if (label) label.textContent = '‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ' + time + ' ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
    return time;
  }

  function getPlateUrl(diff, time, runMode) {
    return './plate-vr.html?diff=' + encodeURIComponent(diff) +
           '&time=' + encodeURIComponent(String(time)) +
           '&run=' + encodeURIComponent(runMode);
  }

  function launchPlate(runMode) {
    const isResearch = (runMode === 'research');

    // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ endpoint + runMode ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°
    sessionStorage.setItem('HHA_LOG_ENDPOINT', LOG_ENDPOINT);
    sessionStorage.setItem('HHA_RUN_MODE', runMode);

    const profile = readProfile();
    sessionStorage.setItem('HHA_STUDENT_PROFILE', JSON.stringify(profile));
    sessionStorage.setItem('HHA_STUDENT_KEY', profile.studentKey || '');

    if (isResearch && !hasResearchProfile(profile)) {
      alert('‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Student ID ‡∏´‡∏£‡∏∑‡∏≠ Nickname ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°');
      return;
    }

    const sel = document.querySelector('select[data-game="plate"][data-role="' + (isResearch ? 'diff-r' : 'diff') + '"]');
    const diff = sel ? sel.value : 'normal';
    const time = (DIFF_TIME.plate[diff] || 70);

    window.location.href = getPlateUrl(diff, time, runMode);
  }

  window.addEventListener('DOMContentLoaded', () => {
    $('#btn-save')?.addEventListener('click', saveProfile);
    $('#btn-load')?.addEventListener('click', loadProfile);

    updateTimeLabel(false);
    updateTimeLabel(true);

    document.querySelector('select[data-game="plate"][data-role="diff"]')
      ?.addEventListener('change', () => updateTimeLabel(false));

    document.querySelector('select[data-game="plate"][data-role="diff-r"]')
      ?.addEventListener('change', () => updateTimeLabel(true));

    $all('button[data-game="plate"][data-run]').forEach(btn => {
      btn.addEventListener('click', () => launchPlate(btn.getAttribute('data-run') || 'play'));
    });

    // prefill
    try {
      const raw = sessionStorage.getItem('HHA_STUDENT_PROFILE');
      if (raw) {
        const p = JSON.parse(raw);
        if ($('#p-id')) $('#p-id').value = p.studentNo || '';
        if ($('#p-name')) $('#p-name').value = p.nickName || '';
        if ($('#p-grade')) $('#p-grade').value = p.gradeLevel || '';
        if ($('#p-room')) $('#p-room').value = p.classRoom || '';
        if ($('#p-school')) $('#p-school').value = p.schoolName || '';
        if ($('#p-group')) $('#p-group').value = p.conditionGroup || '';
      }
    } catch(_) {}
  });
</script>

</body>
</html>
