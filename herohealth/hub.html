<!-- === /herohealth/hub.html ===
HeroHealth ‚Äî Hub (3 Zones) ‚Äî PRODUCTION (403-safe + Offline fallback)
‚úÖ No forced ordering: play any game anytime
‚úÖ Safe network: API 403 won't break hub
‚úÖ Shows offline banner + retry
‚úÖ Links to ROOT launchers in /herohealth (root):
   - ./goodjunk-vr-launcher.html
   - ./groups-vr.html
   - ./hydration-vr.html
   - ./plate-vr.html
   - ./hygiene-vr.html (now labeled "Handwash")
   - ./maskcough-vr.html (root launcher)
   - ./fitness-planner/planner.html (optional)
‚úÖ Pass-through hub/run/diff/time/seed/studyId/phase/conditionGroup/log/view/pid
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hub</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />

  <style>
    :root{
      --bg:#020617;
      --panel: rgba(2,6,23,.72);
      --panel2: rgba(15,23,42,.55);
      --stroke: rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --violet:#a78bfa;
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{min-height:100%;padding:calc(16px + var(--sat)) calc(14px + var(--sar)) calc(18px + var(--sab)) calc(14px + var(--sal));max-width:980px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg, rgba(34,211,238,.25), rgba(167,139,250,.18));border:1px solid var(--stroke);display:grid;place-items:center;font-weight:1000}
    .title{font-weight:1000;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;font-weight:800;margin-top:2px}
    .chiprow{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--stroke);background:rgba(2,6,23,.35);border-radius:999px;padding:7px 10px;font-size:12px;font-weight:900;color:rgba(229,231,235,.92)}
    .chip b{color:#fff}
    .grid{margin-top:14px;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    @media (max-width: 860px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width: 560px){ .grid{grid-template-columns:1fr;} }

    .card{border:1px solid var(--stroke);background:linear-gradient(180deg, rgba(2,6,23,.86), rgba(2,6,23,.55));border-radius:20px;padding:14px;box-shadow:0 14px 50px rgba(0,0,0,.35)}
    .card h3{margin:0;font-size:14px;font-weight:1000}
    .card p{margin:6px 0 0 0;color:rgba(229,231,235,.78);font-weight:750;font-size:12px;line-height:1.35}
    .btnrow{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border-radius:14px;border:1px solid var(--stroke);background:rgba(2,6,23,.35);font-weight:1000;font-size:13px}
    .btn.primary{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.16)}
    .btn.warn{border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.14)}
    .btn.bad{border-color:rgba(239,68,68,.35);background:rgba(239,68,68,.12)}
    .small{font-size:12px;color:var(--muted);font-weight:850;margin-top:10px}

    .banner{margin-top:14px;border:1px solid var(--stroke);border-radius:18px;padding:12px 12px;background:rgba(2,6,23,.35);display:flex;gap:10px;align-items:flex-start}
    .dot{width:10px;height:10px;border-radius:999px;margin-top:5px}
    .dot.ok{background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .banner h4{margin:0;font-size:13px;font-weight:1000}
    .banner p{margin:4px 0 0 0;font-size:12px;color:rgba(229,231,235,.78);font-weight:750;line-height:1.35}
    .banner .actions{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">HH</div>
        <div>
          <div class="title">HeroHealth ‚Äî Hub</div>
          <div class="sub">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏° ‚Ä¢ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏°‡πâ API ‡∏ï‡∏≠‡∏ö 403</div>
        </div>
      </div>

      <div class="chiprow" id="chipRow">
        <div class="chip">run: <b id="cRun">play</b></div>
        <div class="chip">diff: <b id="cDiff">normal</b></div>
        <div class="chip">time: <b id="cTime">80</b>s</div>
        <div class="chip">pid: <b id="cPid">anon</b></div>
      </div>
    </header>

    <!-- API status banner -->
    <div class="banner" id="apiBanner" aria-live="polite">
      <div class="dot warn" id="apiDot"></div>
      <div>
        <h4 id="apiTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‚Ä¶</h4>
        <p id="apiMsg">‡∏ñ‡πâ‡∏≤ API ‡∏•‡πà‡∏°/403 ‡∏´‡∏ô‡πâ‡∏≤ HUB ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°)</p>
      </div>
      <div class="actions">
        <a class="btn warn" href="#" id="btnRetry">Retry</a>
        <a class="btn" href="#" id="btnResetToday">Reset today</a>
      </div>
    </div>

    <div class="grid">

      <div class="card">
        <h3>ü•ó Nutrition Zone</h3>
        <p>GoodJunk ‚Ä¢ Food Groups ‚Ä¢ Hydration ‚Ä¢ Balanced Plate</p>
        <div class="btnrow">
          <a class="btn primary" id="goGoodJunk" href="./goodjunk-vr-launcher.html">GoodJunkVR</a>
          <a class="btn" id="goGroups" href="./groups-vr.html">GroupsVR</a>
          <a class="btn" id="goHydration" href="./hydration-vr.html">HydrationVR</a>
          <a class="btn" id="goPlate" href="./plate-vr.html">PlateVR</a>
        </div>
        <div class="small">* ‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå run/diff/time/seed/pid/hub ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
      </div>

      <div class="card">
        <h3>üßº Hygiene Zone</h3>
        <p><b>Handwash</b> ‚Ä¢ Brush ‚Ä¢ Mask & Cough</p>
        <div class="btnrow">
          <!-- rename label HygieneVR -> Handwash -->
          <a class="btn primary" id="goHandwash" href="./hygiene-vr.html">Handwash</a>
          <!-- use root launcher so params pass-through + hub back -->
          <a class="btn" id="goMaskCough" href="./maskcough-vr.html">MaskCough</a>
        </div>
        <div class="small">* Handwash (‡πÄ‡∏î‡∏¥‡∏° hygiene-vr.html) + MaskCough ‡∏ú‡πà‡∏≤‡∏ô root launcher</div>
      </div>

      <div class="card">
        <h3>üèÉ Fitness Zone</h3>
        <p>Planner ‚Ä¢ Shadow Breaker ‚Ä¢ Rhythm Boxer ‚Ä¢ Jump-Duck ‚Ä¢ Balance Hold</p>
        <div class="btnrow">
          <a class="btn primary" id="goPlanner" href="./fitness-planner/planner.html">Fitness Planner</a>
          <a class="btn" id="goShadow" href="../fitness/shadow-breaker.html">Shadow Breaker</a>
          <a class="btn" id="goRhythm" href="../fitness/rhythm-boxer.html">Rhythm Boxer</a>
        </div>
        <div class="small">* ‡∏•‡∏¥‡∏á‡∏Å‡πå fitness ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (../fitness/‚Ä¶)</div>
      </div>

    </div>
  </div>

  <script>
  'use strict';

  // ====== CONFIG ======
  // ‚úÖ HUB ‡∏ï‡πâ‡∏≠‡∏á "‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á" ‡πÅ‡∏°‡πâ endpoint ‡∏ú‡∏¥‡∏î/403 ‚Äî ‡πÉ‡∏ä‡πâ probe ‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≠‡∏ô ‡πÜ
  const API_ENDPOINT = 'https://sfd8q2ch3k.execute-api.us-east-2.amazonaws.com/'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ

  // ====== helpers ======
  function qs(k, d=''){
    try { return new URL(location.href).searchParams.get(k) ?? d; }
    catch { return d; }
  }
  function clamp(v,min,max){ v = Number(v); if(!Number.isFinite(v)) v=min; return Math.max(min, Math.min(max, v)); }
  function nowSeed(){ return String(Date.now()); }

  // ====== params (pass-through) ======
  const P = {
    run:  String(qs('run','play')).toLowerCase() || 'play',
    diff: String(qs('diff','normal')).toLowerCase() || 'normal',
    time: clamp(qs('time','80'), 20, 300),
    seed: String(qs('seed','') || nowSeed()),
    pid:  String(qs('pid','')).trim() || 'anon',
    view: String(qs('view','')).toLowerCase(),
    log:  String(qs('log','')),
    studyId: String(qs('studyId','')),
    phase: String(qs('phase','')),
    conditionGroup: String(qs('conditionGroup',''))
  };

  // show chips
  document.getElementById('cRun').textContent = P.run;
  document.getElementById('cDiff').textContent = P.diff;
  document.getElementById('cTime').textContent = String(P.time);
  document.getElementById('cPid').textContent = P.pid;

  // build hub url (self) for pass-through
  function buildHubUrl(){
    const u = new URL(location.href);
    u.search = '';
    const sp = u.searchParams;
    sp.set('run', P.run);
    sp.set('diff', P.diff);
    sp.set('time', String(P.time));
    sp.set('seed', P.seed);
    sp.set('pid', P.pid);
    if(P.view) sp.set('view', P.view);
    if(P.log) sp.set('log', P.log);
    if(P.studyId) sp.set('studyId', P.studyId);
    if(P.phase) sp.set('phase', P.phase);
    if(P.conditionGroup) sp.set('conditionGroup', P.conditionGroup);
    return u.toString();
  }

  function withCommonParams(url){
    const u = new URL(url, location.href);
    const sp = u.searchParams;
    sp.set('hub', buildHubUrl());
    sp.set('run', P.run);
    sp.set('diff', P.diff);
    sp.set('time', String(P.time));
    sp.set('seed', P.seed);
    sp.set('pid', P.pid);
    if(P.view) sp.set('view', P.view);
    if(P.log) sp.set('log', P.log);
    if(P.studyId) sp.set('studyId', P.studyId);
    if(P.phase) sp.set('phase', P.phase);
    if(P.conditionGroup) sp.set('conditionGroup', P.conditionGroup);
    return u.toString();
  }

  // patch all game links to include pass-through params
  const linkIds = [
    'goGoodJunk','goGroups','goHydration','goPlate',
    'goHandwash','goMaskCough',
    'goPlanner','goShadow','goRhythm'
  ];
  for(const id of linkIds){
    const a = document.getElementById(id);
    if(!a) continue;
    a.href = withCommonParams(a.getAttribute('href'));
  }

  // ====== Reset today (Zone gates; compatible with your newer hub style) ======
  function getLocalDayKey(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }
  function zoneDoneKey(zone){ return `HHA_ZONE_DONE::${zone}::${getLocalDayKey()}`; }

  function resetToday(){
    try{
      // clear zone done keys (the ones your big hub uses)
      localStorage.removeItem(zoneDoneKey('nutrition'));
      localStorage.removeItem(zoneDoneKey('hygiene'));
      localStorage.removeItem(zoneDoneKey('fitness'));
    }catch(_){}
  }

  document.getElementById('btnResetToday').addEventListener('click', (e)=>{
    e.preventDefault();
    resetToday();
    toast('Reset today ‚úÖ (‡∏•‡πâ‡∏≤‡∏á 3 ‡πÇ‡∏ã‡∏ô)');
  });

  // tiny toast
  let toastT = 0;
  function toast(msg){
    let el = document.getElementById('toast');
    if(!el){
      el = document.createElement('div');
      el.id = 'toast';
      el.style.position='fixed';
      el.style.left='50%';
      el.style.bottom='calc(14px + var(--sab))';
      el.style.transform='translateX(-50%)';
      el.style.zIndex='9999';
      el.style.padding='10px 12px';
      el.style.border='1px solid rgba(148,163,184,.18)';
      el.style.borderRadius='14px';
      el.style.background='rgba(2,6,23,.78)';
      el.style.color='#e5e7eb';
      el.style.fontWeight='950';
      el.style.fontSize='13px';
      el.style.boxShadow='0 14px 44px rgba(0,0,0,.35)';
      el.style.opacity='0';
      el.style.transition='opacity .18s ease';
      document.body.appendChild(el);
    }
    el.textContent = msg;
    el.style.opacity='1';
    clearTimeout(toastT);
    toastT = setTimeout(()=>{ el.style.opacity='0'; }, 1200);
  }

  // ====== 403-safe API probe (no Apollo needed) ======
  const apiDot = document.getElementById('apiDot');
  const apiTitle = document.getElementById('apiTitle');
  const apiMsg = document.getElementById('apiMsg');
  const btnRetry = document.getElementById('btnRetry');

  let probeLock = false;

  function setBanner(state, title, msg){
    apiDot.className = 'dot ' + (state==='ok' ? 'ok' : state==='bad' ? 'bad' : 'warn');
    apiTitle.textContent = title;
    apiMsg.textContent = msg;
  }

  async function probeAPI(){
    if(probeLock) return;
    probeLock = true;

    setBanner('warn', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‚Ä¶', '‡∏Å‡∏≥‡∏•‡∏±‡∏á ping API ‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡πÜ (‡∏ñ‡πâ‡∏≤ 403 ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)');
    try{
      // NOTE: endpoint ‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô /graphql ‡∏´‡∏£‡∏∑‡∏≠ /prod/graphql ‚Äî ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ probe ‡πÅ‡∏ö‡∏ö best-effort
      const res = await fetch(API_ENDPOINT, {
        method: 'POST',
        mode: 'cors',
        headers: { 'content-type':'application/json' },
        body: JSON.stringify({ ping: true })
      });

      if(res.status === 200){
        setBanner('ok', '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚úÖ', 'API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (Hub ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö)');
      }else if(res.status === 403){
        setBanner('bad', '403 Forbidden ‚ö†Ô∏è', 'API ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/Origin ‡πÅ‡∏ï‡πà Hub ‡∏¢‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏Å‡πâ CORS/Authorizer');
      }else{
        setBanner('warn', `API ‡∏ï‡∏≠‡∏ö ${res.status}`, 'Hub ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à route/headers');
      }
    }catch(_){
      setBanner('bad', '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå/‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'Hub ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢/CORS');
    }finally{
      probeLock = false;
    }
  }

  btnRetry.addEventListener('click', (e)=>{
    e.preventDefault();
    probeAPI();
  });

  probeAPI();
  </script>
</body>
</html>