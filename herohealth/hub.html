<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health ‚Äî VR Nutrition Hub</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: light dark;
      --bg-main:#020617;
      --panel:#020617;
      --panel-soft:#0b1120;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,0.22);
      --danger:#f97316;
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
      --radius-lg:18px;
      --radius-pill:999px;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.28), transparent 55%),
        var(--bg-main);
      color:var(--text-main);
    }

    .page-wrap{
      max-width:1120px;
      margin:0 auto;
      padding:16px 12px 24px;
    }

    header{
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
      margin-bottom:14px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .brand-title{
      font-size:clamp(1.4rem, 2.2vw, 1.8rem);
      font-weight:800;
      letter-spacing:.02em;
    }
    .brand-sub{
      font-size:13px;
      color:var(--text-soft);
    }
    .tag-pill{
      align-self:flex-start;
      padding:4px 10px;
      border-radius:16px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.14em;
      border:1px solid rgba(148,163,184,0.6);
      color:#e5e7eb;
      background:rgba(15,23,42,0.9);
    }

    /* ===== Layout: 2 column on desktop ===== */
    .layout-main{
      display:grid;
      grid-template-columns:minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap:14px;
    }
    @media (max-width:900px){
      .layout-main{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .card{
      background:linear-gradient(135deg, rgba(15,23,42,0.97), rgba(15,23,42,0.9));
      border-radius:var(--radius-lg);
      padding:12px 14px;
      border:1px solid rgba(148,163,184,0.22);
      box-shadow:0 18px 36px rgba(15,23,42,0.75);
    }

    /* ===== Profile form ===== */
    .card-title{
      font-size:14px;
      font-weight:700;
      letter-spacing:.04em;
      text-transform:uppercase;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .card-sub{
      font-size:12px;
      color:var(--text-soft);
      margin-bottom:10px;
    }

    .grid-2{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:8px;
    }
    .grid-3{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:8px;
    }
    @media (max-width:700px){
      .grid-2, .grid-3{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:3px;
      font-size:12px;
    }
    .field-row{
      display:flex;
      gap:8px;
    }
    label{
      font-size:11px;
      color:var(--text-soft);
    }
    .badge-required{
      color:#f97316;
      margin-left:2px;
    }
    input[type="text"],
    input[type="number"],
    select,
    textarea{
      font-family:inherit;
      font-size:13px;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.96);
      color:var(--text-main);
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    input:focus,
    select:focus,
    textarea:focus{
      border-color:rgba(34,197,94,0.9);
      box-shadow:0 0 0 1px rgba(34,197,94,0.7);
      background:#020617;
    }
    textarea{
      min-height:56px;
      resize:vertical;
    }

    .hint{
      font-size:11px;
      color:var(--text-soft);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:6px 14px;
      border-radius:var(--radius-pill);
      border:1px solid rgba(148,163,184,0.7);
      font-size:12px;
      font-weight:600;
      cursor:pointer;
      background:rgba(15,23,42,0.92);
      color:var(--text-main);
      transition:background .15s ease, box-shadow .15s ease, transform .1s ease;
    }
    .btn:hover{
      background:rgba(15,23,42,1);
      box-shadow:0 10px 22px rgba(15,23,42,0.9);
      transform:translateY(-1px);
    }
    .btn:active{
      transform:translateY(0);
      box-shadow:0 5px 14px rgba(15,23,42,0.75);
    }

    .btn-primary{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      border-color:rgba(187,247,208,0.9);
      color:#022c22;
    }
    .btn-primary:hover{
      background:linear-gradient(135deg,#4ade80,#22c55e);
    }

    .btn-sm{
      padding:5px 11px;
      font-size:11px;
    }

    .profile-actions{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
      justify-content:flex-end;
      align-items:center;
    }

    .status-pill{
      font-size:11px;
      padding:4px 8px;
      border-radius:var(--radius-pill);
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.9);
      color:var(--text-soft);
    }
    .status-pill.ok{
      border-color:rgba(34,197,94,0.9);
      color:#bbf7d0;
    }
    .status-pill.warn{
      border-color:rgba(248,113,113,0.9);
      color:#fed7aa;
    }

    /* ===== Game list ===== */
    .games-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
    }
    .games-header h2{
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--text-soft);
      margin:0;
    }
    .games-header small{
      font-size:11px;
      color:var(--text-soft);
    }

    .games-grid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:700px){
      .games-grid{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .game-card{
      background:radial-gradient(circle at top left, rgba(34,197,94,0.14), transparent 50%),
                 rgba(15,23,42,0.96);
      border-radius:16px;
      padding:10px 12px 11px;
      border:1px solid rgba(55,65,81,0.9);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .game-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .game-title{
      font-size:13px;
      font-weight:700;
    }
    .game-tag{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(52,211,153,0.7);
      background:rgba(6,78,59,0.5);
      color:#a7f3d0;
    }
    .game-desc{
      font-size:11px;
      color:var(--text-soft);
    }

    .game-ctrl-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      margin-top:4px;
    }
    .game-select{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
      font-size:11px;
      color:var(--text-soft);
    }
    .game-select select{
      min-width:90px;
    }

    .game-meta{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      font-size:11px;
      color:var(--text-soft);
      margin-top:2px;
    }

    .pill{
      border-radius:999px;
      padding:2px 8px;
      border:1px solid rgba(75,85,99,0.9);
      background:rgba(15,23,42,0.9);
    }

    footer{
      margin-top:16px;
      font-size:11px;
      color:var(--text-soft);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <header>
      <div class="brand">
        <div class="brand-title">Hero Health ‚Ä¢ VR Nutrition Hub</div>
        <div class="brand-sub">
          ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏° 4 ‡πÄ‡∏Å‡∏° VR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ù‡∏∂‡∏Å‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‚Äî ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÅ‡∏ß‡πà‡∏ô VR / ‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ / ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå<br/>
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ô Google Sheet ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </div>
      </div>
      <div class="tag-pill">Research Mode</div>
    </header>

    <div class="layout-main">
      <!-- ===== Card: Student Profile ===== -->
      <section class="card">
        <div class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢)</div>
        <div class="card-sub">
          ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1 ‡∏Ñ‡∏ô/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á <strong>studentKey</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏°
        </div>

        <form id="profile-form" autocomplete="off">
          <div class="grid-2" style="margin-bottom:8px;">
            <div class="field">
              <label>‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="badge-required">*</span></label>
              <input type="text" id="pf-schoolCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô CHN001" />
            </div>
            <div class="field">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
              <input type="text" id="pf-schoolName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏£.‡∏ö‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á" />
            </div>
          </div>

          <div class="grid-3" style="margin-bottom:8px;">
            <div class="field">
              <label>‡∏ä‡∏±‡πâ‡∏ô / ‡∏´‡πâ‡∏≠‡∏á <span class="badge-required">*</span></label>
              <input type="text" id="pf-classRoom" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.5/1" />
            </div>
            <div class="field">
              <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="badge-required">*</span></label>
              <input type="text" id="pf-studentNo" placeholder="‡πÄ‡∏ä‡πà‡∏ô 05" />
            </div>
            <div class="field">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô <span class="badge-required">*</span></label>
              <input type="text" id="pf-nickName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•" />
            </div>
          </div>

          <div class="grid-3" style="margin-bottom:8px;">
            <div class="field">
              <label>‡πÄ‡∏û‡∏®</label>
              <select id="pf-gender">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="M">‡∏ä‡∏≤‡∏¢</option>
                <option value="F">‡∏´‡∏ç‡∏¥‡∏á</option>
                <option value="O">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
              </select>
            </div>
            <div class="field">
              <label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
              <input type="number" id="pf-age" min="5" max="18" />
            </div>
            <div class="field">
              <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
              <input type="text" id="pf-gradeLevel" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.5" />
            </div>
          </div>

          <div class="grid-3" style="margin-bottom:8px;">
            <div class="field">
              <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label>
              <input type="number" id="pf-heightCm" min="80" max="200" step="0.1" />
            </div>
            <div class="field">
              <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label>
              <input type="number" id="pf-weightKg" min="15" max="120" step="0.1" />
            </div>
            <div class="field">
              <label>BMI (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</label>
              <input type="text" id="pf-bmi" readonly />
              <div class="hint" id="pf-bmiGroup-hint">‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: -</div>
            </div>
          </div>

          <div class="grid-2" style="margin-bottom:8px;">
            <div class="field">
              <label>‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ VR ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
              <select id="pf-vrExperience">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="never">‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢</option>
                <option value="rarely">‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢</option>
                <option value="often">‡∏ö‡πà‡∏≠‡∏¢</option>
              </select>
            </div>
            <div class="field">
              <label>‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</label>
              <select id="pf-gameFrequency">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="lt1">‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏ä‡∏°.</option>
                <option value="1-3">1‚Äì3 ‡∏ä‡∏°.</option>
                <option value="3-7">3‚Äì7 ‡∏ä‡∏°.</option>
                <option value="gt7">‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ä‡∏°.</option>
              </select>
            </div>
          </div>

          <div class="grid-2" style="margin-bottom:8px;">
            <div class="field">
              <label>‡∏ñ‡∏ô‡∏±‡∏î‡∏°‡∏∑‡∏≠</label>
              <select id="pf-handedness">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="right">‡∏ñ‡∏ô‡∏±‡∏î‡∏Ç‡∏ß‡∏≤</option>
                <option value="left">‡∏ñ‡∏ô‡∏±‡∏î‡∏ã‡πâ‡∏≤‡∏¢</option>
                <option value="both">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠</option>
              </select>
            </div>
            <div class="field">
              <label>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô</label>
              <select id="pf-visionIssue">
                <option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ / ‡∏õ‡∏Å‡∏ï‡∏¥</option>
                <option value="glasses">‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏™‡∏±‡πâ‡∏ô/‡∏¢‡∏≤‡∏ß (‡πÉ‡∏™‡πà‡πÅ‡∏ß‡πà‡∏ô)</option>
                <option value="color">‡∏ï‡∏≤‡∏ö‡∏≠‡∏î‡∏™‡∏µ</option>
                <option value="other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
              </select>
            </div>
          </div>

          <div class="field" style="margin-bottom:6px;">
            <label>‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <textarea id="pf-healthDetail" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏Ñ‡∏´‡∏≠‡∏ö‡∏´‡∏∑‡∏î ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏á‡πà‡∏≤‡∏¢ ‡∏Ø‡∏•‡∏Ø"></textarea>
          </div>

          <div class="grid-2">
            <div class="field">
              <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
              <select id="pf-consentParent">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="Y">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</option>
                <option value="N">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö / ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à</option>
              </select>
            </div>
            <div class="field">
              <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</label>
              <select id="pf-consentTeacher">
                <option value="">- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -</option>
                <option value="Y">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</option>
                <option value="N">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö / ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à</option>
              </select>
            </div>
          </div>

          <div class="profile-actions">
            <div id="profile-status" class="status-pill warn">
              ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ * ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô
            </div>
            <button type="button" class="btn btn-primary" id="btn-save-profile">
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </button>
            <button type="button" class="btn btn-sm" id="btn-clear-profile">
              ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ
            </button>
          </div>
        </form>
      </section>

      <!-- ===== Card: Game List (4 VR Games) ===== -->
      <section class="card">
        <div class="games-header">
          <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏° VR</h2>
          <small>‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ</small>
        </div>

        <div class="games-grid" id="games-grid">
          <!-- Game 1: Good vs Junk VR -->
          <article class="game-card"
                   data-game="goodjunk-vr.html"
                   data-time-easy="80"
                   data-time-normal="60"
                   data-time-hard="45">
            <div class="game-head">
              <div>
                <div class="game-title">Good vs Junk VR</div>
                <div class="game-desc">
                  ‡πÄ‡∏•‡πá‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ (‡∏ú‡∏±‡∏Å ‡∏ú‡∏•‡πÑ‡∏°‡πâ ‡∏ô‡∏°) ‡πÉ‡∏ô‡∏≠‡∏ß‡∏Å‡∏≤‡∏®‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞ ‚ú®
                </div>
              </div>
              <div class="game-tag">‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ</div>
            </div>

            <div class="game-meta">
              <span class="pill">Easy ‚âà 80s</span>
              <span class="pill">Normal ‚âà 60s</span>
              <span class="pill">Hard ‚âà 45s</span>
            </div>

            <div class="game-ctrl-row">
              <div class="game-select">
                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</span>
                <select class="game-diff">
                  <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
                  <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
                  <option value="hard">‡∏¢‡∏≤‡∏Å</option>
                </select>
              </div>
              <button type="button" class="btn btn-primary btn-sm game-start">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô VR
              </button>
            </div>
          </article>

          <!-- Game 2: Food Groups VR -->
          <article class="game-card"
                   data-game="groups-vr.html"
                   data-time-easy="90"
                   data-time-normal="70"
                   data-time-hard="50">
            <div class="game-head">
              <div>
                <div class="game-title">Food Groups VR</div>
                <div class="game-desc">
                  ‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏π‡πà‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏´‡∏°‡∏π‡πà ‡∏ù‡∏∂‡∏Å‡∏à‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° ü•¶üçöüêü
                </div>
              </div>
              <div class="game-tag">‡∏à‡∏≥‡∏´‡∏°‡∏π‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
            </div>

            <div class="game-meta">
              <span class="pill">Easy ‚âà 90s</span>
              <span class="pill">Normal ‚âà 70s</span>
              <span class="pill">Hard ‚âà 50s</span>
            </div>

            <div class="game-ctrl-row">
              <div class="game-select">
                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</span>
                <select class="game-diff">
                  <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
                  <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
                  <option value="hard">‡∏¢‡∏≤‡∏Å</option>
                </select>
              </div>
              <button type="button" class="btn btn-primary btn-sm game-start">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô VR
              </button>
            </div>
          </article>

          <!-- Game 3: Hydration VR -->
          <article class="game-card"
                   data-game="hydration-vr.html"
                   data-time-easy="80"
                   data-time-normal="60"
                   data-time-hard="45">
            <div class="game-head">
              <div>
                <div class="game-title">Hydration VR</div>
                <div class="game-desc">
                  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡πâ‡∏≥‡∏î‡∏µ‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô ‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏° ‡∏ù‡∏∂‡∏Å‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤ üíß
                </div>
              </div>
              <div class="game-tag">‡∏ù‡∏∂‡∏Å‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥</div>
            </div>

            <div class="game-meta">
              <span class="pill">Easy ‚âà 80s</span>
              <span class="pill">Normal ‚âà 60s</span>
              <span class="pill">Hard ‚âà 45s</span>
            </div>

            <div class="game-ctrl-row">
              <div class="game-select">
                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</span>
                <select class="game-diff">
                  <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
                  <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
                  <option value="hard">‡∏¢‡∏≤‡∏Å</option>
                </select>
              </div>
              <button type="button" class="btn btn-primary btn-sm game-start">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô VR
              </button>
            </div>
          </article>

          <!-- Game 4: Balanced Plate VR -->
          <article class="game-card"
                   data-game="plate-vr.html"
                   data-time-easy="90"
                   data-time-normal="70"
                   data-time-hard="55">
            <div class="game-head">
              <div>
                <div class="game-title">Balanced Plate VR</div>
                <div class="game-desc">
                  ‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‚Äì‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß‚Äì‡∏ú‡∏±‡∏Å‚Äì‡∏ú‡∏•‡πÑ‡∏°‡πâ ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£ üçΩÔ∏è
                </div>
              </div>
              <div class="game-tag">‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡∏™‡∏°‡∏î‡∏∏‡∏•</div>
            </div>

            <div class="game-meta">
              <span class="pill">Easy ‚âà 90s</span>
              <span class="pill">Normal ‚âà 70s</span>
              <span class="pill">Hard ‚âà 55s</span>
            </div>

            <div class="game-ctrl-row">
              <div class="game-select">
                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</span>
                <select class="game-diff">
                  <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
                  <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
                  <option value="hard">‡∏¢‡∏≤‡∏Å</option>
                </select>
              </div>
              <button type="button" class="btn btn-primary btn-sm game-start">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô VR
              </button>
            </div>
          </article>
        </div>
      </section>
    </div>

    <footer>
      <span>studentKey ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (sessionStorage) ‚Ä¢ 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á = 1 ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
      <span>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á studentKey + profile ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡∏ú‡πà‡∏≤‡∏ô hha-cloud-logger.js</span>
    </footer>
  </div>

<script>
  // ===== Storage key ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏Å‡∏° (VR Fitness / VR Nutrition) =====
  const KEY_PROFILE_NEW = 'hhaStudentProfile';     // ‡∏ó‡∏µ‡πà goodjunk-vr ‡πÉ‡∏ä‡πâ‡∏≠‡πà‡∏≤‡∏ô
  const KEY_KEY_NEW     = 'hhaStudentKey';

  const KEY_PROFILE_OLD = 'HHA_STUDENT_PROFILE';   // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πà‡∏≤
  const KEY_KEY_OLD     = 'HHA_STUDENT_KEY';

  // ===== Helper: BMI =====
  function computeBmi(hCm, wKg){
    const h = Number(hCm) / 100;
    const w = Number(wKg);
    if (!h || !w || h <= 0) return null;
    const bmi = w / (h*h);
    if (!Number.isFinite(bmi)) return null;
    return Math.round(bmi*10)/10;
  }

  function bmiGroup(bmi){
    if (bmi == null) return '';
    if (bmi < 18.5) return 'underweight';
    if (bmi < 23)   return 'normal';
    if (bmi < 25)   return 'overweight';
    return 'obese';
  }

  function makeStudentKey(p){
    const schoolCode = (p.schoolCode || 'SC').replace(/\s+/g,'');
    const classRoom  = (p.classRoom  || 'C').replace(/\s+/g,'');
    const studentNo  = (p.studentNo  || '00').replace(/\s+/g,'');
    return `${schoolCode}-${classRoom}-${studentNo}`;
  }

  // ===== Storage helpers (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á key ‡πÉ‡∏´‡∏°‡πà + ‡πÄ‡∏Å‡πà‡∏≤) =====
  function loadProfileFromStorage(){
    try{
      let raw = sessionStorage.getItem(KEY_PROFILE_NEW);
      if (!raw) raw = sessionStorage.getItem(KEY_PROFILE_OLD);
      if (!raw) return null;
      return JSON.parse(raw);
    }catch(e){
      return null;
    }
  }

  function saveProfileToStorage(profile){
    try{
      const json = JSON.stringify(profile);
      // ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ
      sessionStorage.setItem(KEY_PROFILE_NEW, json);
      sessionStorage.setItem(KEY_KEY_NEW, profile.studentKey || '');

      sessionStorage.setItem(KEY_PROFILE_OLD, json);
      sessionStorage.setItem(KEY_KEY_OLD, profile.studentKey || '');
    }catch(e){
      console.warn('Cannot save profile to storage', e);
    }
  }

  function clearProfileStorage(){
    try{
      sessionStorage.removeItem(KEY_PROFILE_NEW);
      sessionStorage.removeItem(KEY_KEY_NEW);
      sessionStorage.removeItem(KEY_PROFILE_OLD);
      sessionStorage.removeItem(KEY_KEY_OLD);
    }catch(e){}
  }

  function fillProfileForm(profile){
    if (!profile) return;
    document.getElementById('pf-schoolCode').value = profile.schoolCode || '';
    document.getElementById('pf-schoolName').value = profile.schoolName || '';
    document.getElementById('pf-classRoom').value  = profile.classRoom || '';
    document.getElementById('pf-studentNo').value  = profile.studentNo || '';
    document.getElementById('pf-nickName').value   = profile.nickName || '';
    document.getElementById('pf-gender').value     = profile.gender || '';
    document.getElementById('pf-age').value        = profile.age || '';
    document.getElementById('pf-gradeLevel').value = profile.gradeLevel || '';
    document.getElementById('pf-heightCm').value   = profile.heightCm || '';
    document.getElementById('pf-weightKg').value   = profile.weightKg || '';
    document.getElementById('pf-vrExperience').value = profile.vrExperience || '';
    document.getElementById('pf-gameFrequency').value = profile.gameFrequency || '';
    document.getElementById('pf-handedness').value = profile.handedness || '';
    document.getElementById('pf-visionIssue').value = profile.visionIssue || '';
    document.getElementById('pf-healthDetail').value = profile.healthDetail || '';
    document.getElementById('pf-consentParent').value = profile.consentParent || '';
    document.getElementById('pf-consentTeacher').value = profile.consentTeacher || '';

    const bmi = profile.bmi;
    document.getElementById('pf-bmi').value = bmi || '';
    const group = profile.bmiGroup || '';
    const hint = document.getElementById('pf-bmiGroup-hint');
    hint.textContent = group ? ('‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: ' + group) : '‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: -';

    const status = document.getElementById('profile-status');
    if (profile.studentKey){
      status.textContent = '‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‚Ä¢ studentKey = ' + profile.studentKey;
      status.classList.remove('warn');
      status.classList.add('ok');
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const statusEl = document.getElementById('profile-status');

    // auto load profile if exists
    let loaded = loadProfileFromStorage();
    if (loaded){
      fillProfileForm(loaded);
    }

    function recomputeBmiFromInputs(){
      const h = document.getElementById('pf-heightCm').value;
      const w = document.getElementById('pf-weightKg').value;
      const bmi = computeBmi(h, w);
      const bmiField = document.getElementById('pf-bmi');
      const hint = document.getElementById('pf-bmiGroup-hint');
      if (bmi == null){
        bmiField.value = '';
        hint.textContent = '‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: -';
      }else{
        bmiField.value = bmi;
        const g = bmiGroup(bmi);
        hint.textContent = '‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: ' + (g || '-');
      }
    }

    document.getElementById('pf-heightCm').addEventListener('input', recomputeBmiFromInputs);
    document.getElementById('pf-weightKg').addEventListener('input', recomputeBmiFromInputs);

    // Save profile
    document.getElementById('btn-save-profile').addEventListener('click', () => {
      const profile = {
        schoolCode: document.getElementById('pf-schoolCode').value.trim(),
        schoolName: document.getElementById('pf-schoolName').value.trim(),
        classRoom:  document.getElementById('pf-classRoom').value.trim(),
        studentNo:  document.getElementById('pf-studentNo').value.trim(),
        nickName:   document.getElementById('pf-nickName').value.trim(),
        gender:     document.getElementById('pf-gender').value,
        age:        document.getElementById('pf-age').value,
        gradeLevel: document.getElementById('pf-gradeLevel').value.trim(),
        heightCm:   document.getElementById('pf-heightCm').value,
        weightKg:   document.getElementById('pf-weightKg').value,
        vrExperience: document.getElementById('pf-vrExperience').value,
        gameFrequency: document.getElementById('pf-gameFrequency').value,
        handedness: document.getElementById('pf-handedness').value,
        visionIssue: document.getElementById('pf-visionIssue').value,
        healthDetail: document.getElementById('pf-healthDetail').value.trim(),
        consentParent: document.getElementById('pf-consentParent').value,
        consentTeacher: document.getElementById('pf-consentTeacher').value,
        source: 'VR-Nutrition-Hub'
      };

      // require minimal fields
      if (!profile.schoolCode || !profile.classRoom || !profile.studentNo || !profile.nickName){
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏ä‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà / ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
        statusEl.textContent = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ * ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
        statusEl.classList.remove('ok');
        statusEl.classList.add('warn');
        return;
      }

      const h = profile.heightCm;
      const w = profile.weightKg;
      const bmi = computeBmi(h, w);
      if (bmi != null){
        profile.bmi = bmi;
        profile.bmiGroup = bmiGroup(bmi);
      }

      const studentKey = makeStudentKey(profile);
      profile.studentKey = studentKey;

      // ‡πÄ‡∏ß‡∏•‡∏≤ client
      const nowIso = new Date().toISOString();
      profile.updatedAt = nowIso;
      if (!loaded || !loaded.createdAt){
        profile.createdAt = nowIso;
      }else{
        profile.createdAt = loaded.createdAt;
      }

      saveProfileToStorage(profile);
      loaded = profile; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ loaded ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
      fillProfileForm(profile);

      statusEl.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‚Ä¢ studentKey = ' + studentKey;
      statusEl.classList.remove('ok'); // reset ‡∏Å‡πà‡∏≠‡∏ô
      statusEl.classList.add('ok');
    });

    // Clear profile
    document.getElementById('btn-clear-profile').addEventListener('click', () => {
      if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      clearProfileStorage();
      document.getElementById('profile-form').reset();
      document.getElementById('pf-bmi').value = '';
      document.getElementById('pf-bmiGroup-hint').textContent = '‡∏Å‡∏•‡∏∏‡πà‡∏° BMI: -';
      loaded = null;
      statusEl.textContent = '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚Ä¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°';
      statusEl.classList.remove('ok');
      statusEl.classList.add('warn');
    });

    // Start game buttons (4 games) ‚Äî ‡∏™‡πà‡∏á diff + time + run=research
    document.querySelectorAll('.game-start').forEach((btn) => {
      btn.addEventListener('click', () => {
        const profile = loadProfileFromStorage();
        if (!profile || !profile.studentKey){
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°');
          statusEl.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö studentKey ‚Ä¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô';
          statusEl.classList.remove('ok');
          statusEl.classList.add('warn');
          return;
        }

        const card = btn.closest('.game-card');
        if (!card) return;

        const diffSel = card.querySelector('.game-diff');
        const diff = diffSel ? diffSel.value : 'normal';

        const ds = card.dataset;
        let dur = 60;
        if (diff === 'easy'  && ds.timeEasy)   dur = parseInt(ds.timeEasy,10);
        if (diff === 'normal'&& ds.timeNormal) dur = parseInt(ds.timeNormal,10);
        if (diff === 'hard'  && ds.timeHard)   dur = parseInt(ds.timeHard,10);
        if (!Number.isFinite(dur) || dur <= 0) dur = 60;

        const gamePath = card.dataset.game || '';
        if (!gamePath){
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏≤‡∏ò‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö data-game ‡πÉ‡∏ô hub.html');
          return;
        }

        const runMode = 'research'; // Hub ‡∏ô‡∏µ‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢

        // forward ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏° diff + time + run; ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å initCloudLogger() ‡∏ï‡πà‡∏≠
        const url = `${gamePath}?diff=${encodeURIComponent(diff)}&time=${dur}&run=${encodeURIComponent(runMode)}`;
        window.location.href = url;
      });
    });
  });
</script>
</body>
</html>
