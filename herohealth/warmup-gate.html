<!-- === /herohealth/warmup-gate.html ===
HeroHealth ‚Äî Warmup/Cooldown Gate (Boss Battle Tone)
Query:
  phase=warmup|cooldown
  dur=20
  view=pc|mobile|vr|cvr (optional, used for text only)
  hub=https://.../hub.html
  next=https://.../game.html?... (required for autonext)
  autonext=1|0
  debug=1 (optional)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî Gate</title>
  <meta name="color-scheme" content="dark"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    :root{
      --bg:#020617;
      --panel: rgba(2,6,23,.72);
      --stroke: rgba(148,163,184,.18);
      --text: #e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --violet:#a78bfa;
      --cyan:#22d3ee;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);

      --dur: 20;
      --p: 0; /* 0..1 */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",Arial,sans-serif;
    }
    body{ overflow:hidden; }

    /* Boss-battle ambiance */
    .bgfx{
      position:fixed; inset:-120px;
      background:
        radial-gradient(circle at 18% 18%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(circle at 82% 74%, rgba(168,85,247,.12), transparent 58%),
        radial-gradient(circle at 50% 50%, rgba(239,68,68,.10), transparent 60%),
        linear-gradient(180deg, rgba(2,6,23,1), rgba(2,6,23,.92));
      filter:saturate(1.1);
      animation: pulse 2.6s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); opacity: .95; }
      50%{ transform: scale(1.02); opacity: 1; }
    }

    .wrap{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
    }

    .panel{
      width:min(860px, 96vw);
      border:1px solid var(--stroke);
      background:var(--panel);
      border-radius:22px;
      box-shadow:0 28px 120px rgba(0,0,0,.60);
      backdrop-filter: blur(12px);
      padding:16px;
      position:relative;
      overflow:hidden;
    }

    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-weight:1000;
    }
    .brand .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(15,23,42,.55);
      border:1px solid rgba(148,163,184,.16);
      font-size:12px;
    }
    .brand .pill b{ font-weight:1100; }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(15,23,42,.55);
      border:1px solid rgba(148,163,184,.16);
      font-size:12px;
      color:rgba(229,231,235,.92);
    }

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width:860px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      border:1px solid rgba(148,163,184,.16);
      background:rgba(2,6,23,.35);
      border-radius:18px;
      padding:12px;
    }

    .title{
      font-weight:1100; font-size:16px;
      display:flex; align-items:center; gap:10px;
    }
    .sub{
      margin-top:6px;
      color:rgba(148,163,184,.96);
      font-size:12.5px; line-height:1.45;
      white-space:pre-line;
    }

    /* Countdown ring */
    .ringWrap{
      display:flex; align-items:center; justify-content:center;
      padding:10px 0 2px 0;
    }
    .ring{
      width:min(260px, 70vw);
      aspect-ratio: 1 / 1;
      border-radius:999px;
      position:relative;
      display:grid; place-items:center;
      background:
        radial-gradient(circle at 50% 50%, rgba(2,6,23,.85), rgba(2,6,23,.55)),
        conic-gradient(
          rgba(34,197,94,.80) calc(var(--p) * 360deg),
          rgba(148,163,184,.14) 0
        );
      border:1px solid rgba(148,163,184,.18);
      box-shadow: 0 18px 80px rgba(0,0,0,.45);
    }
    .ring::before{
      content:"";
      position:absolute; inset:10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.12);
      background:
        radial-gradient(circle at 30% 25%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(circle at 70% 75%, rgba(168,85,247,.12), transparent 58%),
        rgba(2,6,23,.55);
      box-shadow: inset 0 0 0 1px rgba(2,6,23,.2);
    }
    .ringInner{
      position:relative;
      text-align:center;
      padding:10px;
    }
    .sec{
      font-size:56px;
      font-weight:1200;
      letter-spacing:-1px;
      line-height:1;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }
    .label{
      margin-top:6px;
      font-size:12px;
      font-weight:1000;
      color:rgba(229,231,235,.88);
    }
    .hint{
      margin-top:6px;
      font-size:12px;
      color:rgba(148,163,184,.96);
      line-height:1.4;
    }

    /* Action buttons */
    .btnRow{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      cursor:pointer;
      border-radius:16px;
      padding:10px 12px;
      font-weight:1000;
      font-size:13px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.62);
      color:var(--text);
      flex: 1 1 180px;
    }
    .btn.primary{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.16); }
    .btn.warn{ border-color: rgba(245,158,11,.30); background: rgba(245,158,11,.14); }
    .btn.danger{ border-color: rgba(239,68,68,.30); background: rgba(239,68,68,.12); }

    .miniTips{
      margin-top:10px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:620px){
      .miniTips{ grid-template-columns:1fr; }
    }
    .tip{
      border:1px solid rgba(148,163,184,.14);
      border-radius:16px;
      padding:10px 12px;
      background: rgba(15,23,42,.50);
    }
    .tip .k{
      font-weight:1000; font-size:12px;
      color:rgba(229,231,235,.9);
      display:flex; align-items:center; gap:8px;
    }
    .tip .v{
      margin-top:6px;
      color:rgba(148,163,184,.96);
      font-size:12.5px;
      line-height:1.45;
      white-space:pre-line;
    }

    /* 3s final warning */
    body.urgent .ring{
      animation: shake .22s ease-in-out infinite;
      background:
        radial-gradient(circle at 50% 50%, rgba(2,6,23,.85), rgba(2,6,23,.55)),
        conic-gradient(
          rgba(239,68,68,.86) calc(var(--p) * 360deg),
          rgba(148,163,184,.14) 0
        );
    }
    @keyframes shake{
      0%{ transform:translate(0,0); }
      25%{ transform:translate(1px,0); }
      50%{ transform:translate(-1px,1px); }
      75%{ transform:translate(0,-1px); }
      100%{ transform:translate(0,0); }
    }

    /* Debug */
    .dbg{
      margin-top:10px;
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-size:12px;
      color:rgba(229,231,235,.90);
      white-space:pre-wrap;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(2,6,23,.35);
      border-radius:16px;
      padding:10px 12px;
      display:none;
    }
    body.debug .dbg{ display:block; }

    /* Tap-anywhere overlay hint */
    .tapHint{
      margin-top:10px;
      font-size:12px;
      color:rgba(148,163,184,.96);
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="bgfx" aria-hidden="true"></div>

  <div class="wrap" id="wrap">
    <div class="panel" role="dialog" aria-modal="true" aria-label="Gate">

      <div class="top">
        <div class="brand">
          <div class="pill" id="phasePill">‚öîÔ∏è GATE</div>
          <div class="pill">üëÅÔ∏è view: <b id="viewTxt">‚Äî</b></div>
          <div class="pill">‚è±Ô∏è dur: <b id="durTxt">20</b>s</div>
        </div>
        <div class="tag" id="nextTag">next: ‚Äî</div>
      </div>

      <div class="grid">
        <!-- Left: narrative -->
        <div class="card">
          <div class="title" id="title">‚öîÔ∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πà‡∏≤‡∏ô</div>
          <div class="sub" id="subtitle">‚Äî</div>

          <div class="miniTips" id="tips">
            <div class="tip">
              <div class="k">ü´Å Breathing</div>
              <div class="v" id="tipBreath">‚Äî</div>
            </div>
            <div class="tip">
              <div class="k">üßò Focus</div>
              <div class="v" id="tipFocus">‚Äî</div>
            </div>
            <div class="tip">
              <div class="k">ü§∏ Stretch</div>
              <div class="v" id="tipStretch">‚Äî</div>
            </div>
            <div class="tip">
              <div class="k">üõ°Ô∏è Boss Tip</div>
              <div class="v" id="tipBoss">‚Äî</div>
            </div>
          </div>

          <div class="btnRow">
            <button class="btn primary" id="btnStart">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á</button>
            <button class="btn warn" id="btnSkip">‚è≠Ô∏è ‡∏Ç‡πâ‡∏≤‡∏° (‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</button>
            <button class="btn danger" id="btnHub">üè† ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
          </div>

          <div class="tapHint" id="tapHint">‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>

          <div class="dbg" id="dbg"></div>
        </div>

        <!-- Right: ring -->
        <div class="card">
          <div class="ringWrap">
            <div class="ring" id="ring" aria-label="Countdown">
              <div class="ringInner">
                <div class="sec" id="sec">20</div>
                <div class="label" id="secLabel">SECONDS</div>
                <div class="hint" id="ringHint">‚Äî</div>
              </div>
            </div>
          </div>

          <div class="sub" style="text-align:center;margin-top:8px;">
            ‡πÇ‡∏´‡∏°‡∏î ‚Äú‡∏ö‡∏≠‡∏™‡πÅ‡∏ö‡∏ó‡πÄ‡∏ó‡∏¥‡∏•‚Äù: 3 ‡∏ß‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏à‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‚ö†Ô∏è
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  'use strict';

  const qs = (k, def=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? def; }catch{ return def; } };

  const phase = String(qs('phase','warmup')||'warmup').toLowerCase();
  const view  = String(qs('view','')||'').toLowerCase() || (/(android|iphone|ipad|ipod)/i.test(navigator.userAgent||'') ? 'mobile' : 'pc');
  const durIn = Number(qs('dur','20')||20) || 20;
  const dur   = Math.max(5, Math.min(120, durIn));
  const hub   = String(qs('hub','./hub.html')||'./hub.html');
  const next0 = qs('next', null);
  const autonext = String(qs('autonext','1')||'1');
  const debug = String(qs('debug','0')||'0');

  if (debug === '1' || debug === 'true') document.body.classList.add('debug');

  const $ = (id)=>document.getElementById(id);

  // UI binds
  $('viewTxt').textContent = view;
  $('durTxt').textContent  = String(dur);
  $('sec').textContent     = String(dur);

  const hasNext = !!(next0 && String(next0).trim().length > 0);
  $('nextTag').textContent = 'next: ' + (hasNext ? 'READY ‚úÖ' : '‚Äî (fallback HUB)');

  // Copy to CSS var (for visuals)
  document.documentElement.style.setProperty('--dur', String(dur));

  // Theme text
  const isWarm = (phase !== 'cooldown');
  $('phasePill').textContent = isWarm ? '‚öîÔ∏è WARMUP GATE' : 'üåô COOLDOWN GATE';
  $('title').textContent     = isWarm ? '‚öîÔ∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πà‡∏≤‡∏ô (Warmup)' : 'üåô ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏î‡πà‡∏≤‡∏ô (Cooldown)';

  const warmSub =
`‡∏≠‡∏µ‡∏Å ${dur}s ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°
‡πÇ‡∏ü‡∏Å‡∏±‡∏™: ‡∏´‡∏≤‡∏¢‡πÉ‡∏à + ‡∏¢‡∏∑‡∏î‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏î‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‚Äú‡∏ö‡∏≠‡∏™‡πÄ‡∏ü‡∏™‚Äù`;
  const coolSub =
`‡∏≠‡∏µ‡∏Å ${dur}s ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ HUB
‡πÇ‡∏ü‡∏Å‡∏±‡∏™: ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ä‡πâ‡∏≤ ‡πÜ + ‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠ ‡∏•‡∏î‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à`;

  $('subtitle').textContent = isWarm ? warmSub : coolSub;

  // Tips (boss-battle flavor, ‡πÄ‡∏´‡∏°‡∏≤‡∏∞ ‡∏õ.5)
  if (isWarm){
    $('tipBreath').textContent  = '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤ 3 ‡∏ß‡∏¥ ‚Ä¢ ‡∏Å‡∏•‡∏±‡πâ‡∏ô 1 ‡∏ß‡∏¥ ‚Ä¢ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å 4 ‡∏ß‡∏¥\n‡∏ó‡∏≥ 2‚Äì3 ‡∏£‡∏≠‡∏ö';
    $('tipFocus').textContent   = '‡∏ï‡∏±‡πâ‡∏á ‚Äú‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô\n‚Äú‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏•‡πá‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô!‚Äù';
    $('tipStretch').textContent = '‡∏ö‡∏¥‡∏î‡πÄ‡∏≠‡∏ß‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡∏ä‡πâ‡∏≤ ‡πÜ 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n‡∏¢‡∏∑‡∏î‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏ü‡πâ‡∏≤ 5 ‡∏ß‡∏¥';
    $('tipBoss').textContent    = '‡∏û‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°: ‡πÄ‡∏•‡πá‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡πá‡∏ß\n‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ß!';
    $('ringHint').textContent   = 'WARMUP: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏≠‡∏™ ‚ö°';
  }else{
    $('tipBreath').textContent  = '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤ 4 ‡∏ß‡∏¥ ‚Ä¢ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å 6 ‡∏ß‡∏¥\n‡∏ó‡∏≥ 3‚Äì4 ‡∏£‡∏≠‡∏ö';
    $('tipFocus').textContent   = '‡∏´‡∏•‡∏±‡∏ö‡∏ï‡∏≤ 2 ‡∏ß‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ\n‚Äú‡∏â‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß!‚Äù';
    $('tipStretch').textContent = '‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏±‡∏ß‡πÑ‡∏´‡∏•‡πà 6 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n‡∏¢‡∏∑‡∏î‡∏Ñ‡∏≠‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏∞ 3 ‡∏ß‡∏¥';
    $('tipBoss').textContent    = '‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥ 2‚Äì3 ‡∏≠‡∏∂‡∏Å\n‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
    $('ringHint').textContent   = 'COOLDOWN: ‡∏•‡∏î‡πÅ‡∏£‡∏á‡∏™‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏™ üåô';
  }

  // Buttons
  $('btnHub').addEventListener('click', ()=> location.href = hub);

  // Safe next
  function resolveNext(){
    if (!hasNext) return hub;
    try{
      // next is expected to be absolute URL already; but handle relative too
      return new URL(String(next0), location.href).toString();
    }catch{
      return hub;
    }
  }

  // Countdown
  let running = false;
  let tLeft = dur;
  let tickTimer = null;
  let raf = null;
  let tStartMs = 0;

  function setProgress(){
    const p = 1 - (tLeft / dur);
    document.documentElement.style.setProperty('--p', String(Math.max(0, Math.min(1, p))));
    $('sec').textContent = String(Math.max(0, Math.ceil(tLeft)));
    document.body.classList.toggle('urgent', tLeft > 0 && tLeft <= 3);
  }

  function stopAll(){
    running = false;
    if (tickTimer) clearInterval(tickTimer);
    tickTimer = null;
    if (raf) cancelAnimationFrame(raf);
    raf = null;
  }

  function goNext(){
    stopAll();
    const target = resolveNext();
    location.replace(target);
  }

  $('btnSkip').addEventListener('click', goNext);

  function start(){
    if (running) return;
    running = true;
    $('tapHint').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‚Ä¶';
    $('btnStart').disabled = true;

    tLeft = dur;
    setProgress();

    tStartMs = performance.now();

    // smooth progress via RAF
    const step = () => {
      if (!running) return;
      const elapsed = (performance.now() - tStartMs) / 1000;
      tLeft = Math.max(0, dur - elapsed);
      setProgress();
      if (tLeft <= 0){
        goNext();
        return;
      }
      raf = requestAnimationFrame(step);
    };
    raf = requestAnimationFrame(step);

    // integer tick for label stability (optional)
    tickTimer = setInterval(() => {
      if (!running) return;
      if (tLeft <= 0) return;
    }, 200);
  }

  $('btnStart').addEventListener('click', start);

  // Tap-anywhere start (‡∏ä‡πà‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
  const wrap = $('wrap');
  wrap.addEventListener('pointerdown', (e)=>{
    const id = e?.target?.id || '';
    // Don't hijack button clicks
    if (id === 'btnHub' || id === 'btnSkip' || id === 'btnStart') return;
    if (!running){
      start();
    }
  }, {passive:true});

  // Debug info
  if (document.body.classList.contains('debug')){
    $('dbg').textContent =
      'phase=' + phase + '\n' +
      'view=' + view + '\n' +
      'dur=' + dur + '\n' +
      'hub=' + hub + '\n' +
      'next=' + (next0 || '(none)') + '\n' +
      'autonext=' + autonext + '\n';
  }

  // Autostart
  // (‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ audio ‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î gesture policy)
  if (autonext === '1' || autonext === 'true'){
    start();
  }else{
    $('tapHint').textContent = '‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°';
  }

})();
</script>
</body>
</html>