<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>HeroHealth ‚Äî Warmup / Cooldown Gate</title>
<meta name="color-scheme" content="dark light"/>
<link rel="icon" href="./favicon.ico"/>

<style>
  :root{
    --bg:#020617; --panel:rgba(2,6,23,.78); --panel2:rgba(15,23,42,.70);
    --stroke:rgba(148,163,184,.18); --text:#e5e7eb; --muted:#94a3b8;
    --accent:#22c55e; --accent2:#38bdf8; --bad:#fb7185;
    --radius:22px; --shadow:0 18px 60px rgba(0,0,0,.45);
    --sat: env(safe-area-inset-top, 0px); --sar: env(safe-area-inset-right, 0px);
    --sab: env(safe-area-inset-bottom, 0px); --sal: env(safe-area-inset-left, 0px);
  }
  html,body{height:100%; margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif; overscroll-behavior:none;}
  .wrap{min-height:100%; display:flex; align-items:center; justify-content:center;
    padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));}
  .card{width:min(860px, 96vw); border:1px solid var(--stroke);
    background: radial-gradient(1100px 700px at 20% 10%, rgba(34,197,94,.14), transparent 55%),
                radial-gradient(900px 700px at 90% 20%, rgba(56,189,248,.10), transparent 60%),
                linear-gradient(180deg, rgba(2,6,23,.92), rgba(2,6,23,.62));
    border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;}
  .row{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
  .title{display:flex; gap:10px; align-items:center; flex-wrap:wrap; font-weight:1000;}
  .pill{display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px;
    border:1px solid var(--stroke); background:rgba(2,6,23,.45); font-weight:950;}
  .muted{color:var(--muted); font-weight:850; font-size:12px; line-height:1.35;}
  .bar{height:10px; border-radius:999px; background:rgba(148,163,184,.16); overflow:hidden;
    margin-top:14px; border:1px solid rgba(148,163,184,.14);}
  .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg, rgba(34,197,94,.95), rgba(56,189,248,.85)); border-radius:999px;}
  .grid{margin-top:14px; display:grid; grid-template-columns: 1.2fr .8fr; gap:12px;}
  @media (max-width:860px){ .grid{grid-template-columns:1fr; } }
  .box{border:1px solid rgba(148,163,184,.14); background:rgba(2,6,23,.35); border-radius:18px; padding:12px;}
  .box h3{margin:0 0 8px 0; font-size:13px;}
  .stage{position:relative; min-height: 320px; border-radius:16px; overflow:hidden;
    border:1px solid rgba(148,163,184,.16); background: rgba(2,6,23,.35);}
  .hud{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
  .kv{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .kv .k{font-size:11px; color:rgba(148,163,184,.9); font-weight:900;}
  .kv .v{font-size:12px; font-weight:1000;}
  .btns{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-top:10px;}
  button{font-weight:1000; padding:10px 14px; border-radius:14px; border:1px solid rgba(148,163,184,.18);
    background:rgba(2,6,23,.35); color:var(--text);}
  button.primary{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.18);}
  button.bad{border-color:rgba(251,113,133,.35); background:rgba(251,113,133,.14);}
  /* game elements */
  .centerPrompt{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:10px;
    padding:16px; text-align:center;
  }
  .big{font-size:34px; font-weight:1100;}
  .tapHint{font-size:12px; font-weight:900; color:rgba(229,231,235,.82);}
  .chip{position:absolute; left:12px; top:12px; z-index:5;}
  .chipR{position:absolute; right:12px; top:12px; z-index:5;}
  .target{
    position:absolute; width:72px; height:72px; border-radius:18px;
    display:flex; align-items:center; justify-content:center; font-size:34px; font-weight:1000;
    border:1px solid rgba(148,163,184,.22);
    background:rgba(2,6,23,.55);
    user-select:none; touch-action:none;
  }
  .target.good{box-shadow:0 0 0 1px rgba(34,197,94,.22) inset;}
  .target.bad{box-shadow:0 0 0 1px rgba(251,113,133,.22) inset;}
  .flash{
    position:absolute; inset:0; pointer-events:none; opacity:0; transition:opacity .18s ease;
    background: radial-gradient(900px 500px at 50% 40%, rgba(34,197,94,.18), transparent 60%);
  }
  .flash.bad{ background: radial-gradient(900px 500px at 50% 40%, rgba(251,113,133,.18), transparent 60%); }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div class="title">
        <span class="pill" id="pillPhase">PHASE: ‚Ä¶</span>
        <span class="pill" id="pillCat">CAT: ‚Ä¶</span>
        <span class="pill" id="pillPid">PID: ‚Ä¶</span>
      </div>
      <div class="pill" style="border-color:rgba(56,189,248,.35);">Gate Mini-game</div>
    </div>

    <div class="muted" id="desc">
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á‚Ä¶ (‡∏ß‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏Ñ‡∏ô‡∏ï‡∏≤‡∏° PID ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î)
    </div>

    <div class="bar" aria-hidden="true"><i id="pbar"></i></div>

    <div class="grid">
      <div class="box">
        <h3 id="gameTitle">Mini-game</h3>
        <div class="stage" id="stage" aria-label="mini game stage">
          <div class="flash" id="flash"></div>
          <div class="chip pill" id="chipLeft">score:0</div>
          <div class="chipR pill" id="chipRight">time:0</div>

          <div class="centerPrompt" id="prompt">
            <div class="big" id="promptBig">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>
            <div class="tapHint" id="promptSmall">Tap / Click anywhere</div>
          </div>
        </div>

        <div class="btns">
          <button class="bad" id="btnHub">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
          <button class="primary" id="btnSkip">‡∏Ç‡πâ‡∏≤‡∏° (‡πÑ‡∏õ‡∏ï‡πà‡∏≠)</button>
        </div>
      </div>

      <div class="box">
        <h3>‡∏™‡∏£‡∏∏‡∏õ/‡∏ö‡∏±‡∏ü‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏´‡∏•‡∏±‡∏Å</h3>
        <div class="muted" id="buffText">‚Äî</div>
        <hr style="border:0;border-top:1px solid rgba(148,163,184,.14); margin:12px 0;">
        <div class="muted">
          <b>Warmup</b>: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ ‚Äú‡∏ô‡∏¥‡πâ‡∏ß/‡∏™‡∏≤‡∏¢‡∏ï‡∏≤/‡∏™‡∏°‡∏≠‡∏á‚Äù ‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏±‡πâ‡∏ô<br/>
          <b>Cooldown</b>: ‡∏Ñ‡∏•‡∏≤‡∏¢ + ‡∏™‡∏£‡∏∏‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏•‡∏±‡∏ö HUB
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  'use strict';
  const DOC=document, WIN=window;

  // ---------- QS ----------
  function getQS(){ try{return new URL(location.href).searchParams;}catch{return new URLSearchParams();} }
  const QS=getQS();
  const q=(k,d='')=>(QS.get(k)??d);
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const num=(v,d)=>{ const n=Number(v); return Number.isFinite(n)?n:d; };

  // ---------- Context ----------
  const phase = String(q('phase','warmup')).toLowerCase() || 'warmup'; // warmup|cooldown
  const cat   = String(q('cat', q('category','nutrition'))).toLowerCase() || 'nutrition';
  const pid   = String(q('pid', 'anon')).trim() || 'anon';
  const hub   = String(q('hub','./hub.html')) || './hub.html';
  const next  = String(q('next', hub)) || hub;
  const dur   = clamp(num(q('dur', q('cdur','20')), 20), 8, 60);

  // daily keys
  function dayKey(){
    const d=new Date();
    const yyyy=d.getFullYear();
    const mm=String(d.getMonth()+1).padStart(2,'0');
    const dd=String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }
  function dkey(prefix){ return `${prefix}:${cat}:${pid}:${dayKey()}`; }
  function isDone(prefix){ try{return localStorage.getItem(dkey(prefix))==='1';}catch{return false;} }
  function mark(prefix){ try{localStorage.setItem(dkey(prefix),'1');}catch{} }

  // ---------- UI ----------
  const $=id=>DOC.getElementById(id);
  $('pillPhase').textContent = `PHASE: ${phase.toUpperCase()}`;
  $('pillCat').textContent   = `CAT: ${cat.toUpperCase()}`;
  $('pillPid').textContent   = `PID: ${pid}`;

  function go(url){
    try{ location.replace(url); }catch{ location.href=url; }
  }
  $('btnHub').addEventListener('click', ()=>go(hub));

  // skip -> still mark daily
  $('btnSkip').addEventListener('click', ()=>{
    if(phase==='warmup') mark('HHA_WARMUP_DONE');
    if(phase==='cooldown') mark('HHA_COOLDOWN_DONE');
    go(next);
  });

  // If warmup/cooldown already done today => auto go next
  if(phase==='warmup' && isDone('HHA_WARMUP_DONE')){ go(next); return; }
  if(phase==='cooldown' && isDone('HHA_COOLDOWN_DONE')){ go(next); return; }

  // ---------- Mini-games by category ----------
  // Result buff pack => sent to next url as query params
  const buff = { wType:'', wPct:0, rank:'C', calm:0 };

  function buildNextUrl(){
    const u=new URL(next, location.href);
    // preserve existing search params in next
    // add warmup buffs
    if(phase==='warmup'){
      u.searchParams.set('wType', buff.wType || cat);
      u.searchParams.set('wPct', String(Math.round(buff.wPct||0)));
      u.searchParams.set('rank', String(buff.rank||'C'));
      u.searchParams.set('calm', String(Math.round(buff.calm||0)));
    }
    // pass identity
    u.searchParams.set('pid', pid);
    u.searchParams.set('cat', cat);
    u.searchParams.set('hub', hub);
    return u.toString();
  }

  function setBuffText(){
    $('buffText').textContent =
      phase==='warmup'
      ? `wType=${buff.wType} ‚Ä¢ wPct=${Math.round(buff.wPct)} ‚Ä¢ rank=${buff.rank} ‚Ä¢ calm=${Math.round(buff.calm)}`
      : `cooldown (no buff) ‚Ä¢ ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ ${new URL(hub, location.href).pathname}`;
  }

  function finish(success=true){
    // mark daily
    if(phase==='warmup') mark('HHA_WARMUP_DONE');
    if(phase==='cooldown') mark('HHA_COOLDOWN_DONE');

    setBuffText();
    // small pause then go
    setTimeout(()=>go(buildNextUrl()), 520);
  }

  // ---------- Core timer/progress ----------
  const stage=$('stage');
  const prompt=$('prompt');
  const pBig=$('promptBig');
  const pSmall=$('promptSmall');
  const chipL=$('chipLeft');
  const chipR=$('chipRight');
  const flash=$('flash');
  const pbar=$('pbar');

  let started=false;
  let tLeft=dur;
  let score=0, miss=0, total=0;
  let raf=0, last=0;

  function flashGood(){
    flash.classList.remove('bad');
    flash.style.opacity='1';
    setTimeout(()=>flash.style.opacity='0', 140);
  }
  function flashBad(){
    flash.classList.add('bad');
    flash.style.opacity='1';
    setTimeout(()=>flash.style.opacity='0', 160);
  }

  function tick(ts){
    if(!started) return;
    if(!last) last=ts;
    const dt=Math.min(0.25,(ts-last)/1000);
    last=ts;
    tLeft=Math.max(0, tLeft-dt);

    chipR.textContent=`time:${Math.ceil(tLeft)}`;
    chipL.textContent=`score:${score}  miss:${miss}`;
    pbar.style.width = `${Math.round(((dur - tLeft)/dur)*100)}%`;

    if(tLeft<=0){
      // compute buff / rank
      const acc = total>0 ? (score/total) : 0;
      buff.wType = cat;
      buff.wPct  = acc*100;
      buff.rank  = (acc>=0.86) ? 'A' : (acc>=0.72) ? 'B' : (acc>=0.55) ? 'C' : 'D';
      // calm: only meaningful for cooldown
      buff.calm  = Math.max(0, 100 - miss*12);

      finish(true);
      return;
    }
    raf=requestAnimationFrame(tick);
  }

  function start(){
    if(started) return;
    started=true;
    prompt.style.display='none';
    last=0;
    chipR.textContent=`time:${Math.ceil(tLeft)}`;
    chipL.textContent=`score:${score}  miss:${miss}`;
    raf=requestAnimationFrame(tick);

    // spawn loop depends on category
    if(phase==='cooldown'){
      runCooldown();
      return;
    }
    if(cat==='nutrition') runNutrition();
    else if(cat==='hygiene') runHygiene();
    else runExercise();
  }

  stage.addEventListener('pointerdown', (e)=>{
    // prevent accidental double in some browsers
    if(!started) start();
  }, {passive:true});

  // ---------- Nutrition: Food Sort Sprint ----------
  function runNutrition(){
    $('gameTitle').textContent = 'Nutrition Warmup ‚Äî Food Sort Sprint';
    $('desc').textContent = '‡πÅ‡∏ï‡∏∞ ‚Äúü•ó ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äúüçü ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‚Äù ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πá‡∏ß';

    const good=['ü•¶','üçé','ü•õ','ü•ö','üêü','üçö','ü•¨','üçå','ü•ú'];
    const bad =['üçü','üçî','üç©','ü•§','üç∞','üç≠','üçø','üßÅ','üçï'];

    const btnGood=DOC.createElement('div');
    const btnBad=DOC.createElement('div');
    const card=DOC.createElement('div');

    Object.assign(card.style,{position:'absolute', left:'50%', top:'50%', transform:'translate(-50%,-55%)',
      width:'min(520px, 92%)', padding:'14px', borderRadius:'18px',
      border:'1px solid rgba(148,163,184,.18)', background:'rgba(2,6,23,.50)', textAlign:'center'});
    card.innerHTML = `<div style="font-weight:1100; font-size:18px;">üçΩÔ∏è <span id="foodEmoji">ü•¶</span></div>
      <div class="muted" style="margin-top:6px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å: ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ vs ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</div>`;
    stage.appendChild(card);

    function makeBtn(label, cls, x){
      const b=DOC.createElement('button');
      b.className = cls;
      b.textContent = label;
      b.style.position='absolute';
      b.style.bottom='14px';
      b.style.left = x;
      b.style.transform='translateX(-50%)';
      b.style.width='min(240px, 44%)';
      b.style.fontSize='14px';
      b.style.padding='12px 12px';
      b.style.borderRadius='16px';
      b.style.border='1px solid rgba(148,163,184,.18)';
      b.style.background='rgba(2,6,23,.35)';
      b.style.color='var(--text)';
      b.style.fontWeight='1000';
      return b;
    }
    const bG=makeBtn('ü•ó ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ', 'primary', '30%');
    bG.style.borderColor='rgba(34,197,94,.35)';
    bG.style.background='rgba(34,197,94,.14)';

    const bB=makeBtn('üçü ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢', 'bad', '70%');
    bB.style.borderColor='rgba(251,113,133,.35)';
    bB.style.background='rgba(251,113,133,.10)';

    stage.appendChild(bG); stage.appendChild(bB);

    let curIsGood=true;
    function nextFood(){
      total++;
      curIsGood = Math.random() < 0.62;
      const emo = curIsGood ? good[(Math.random()*good.length)|0] : bad[(Math.random()*bad.length)|0];
      const el=card.querySelector('#foodEmoji');
      if(el) el.textContent=emo;
    }

    function choose(isGood){
      if(!started) return;
      if(isGood===curIsGood){ score++; flashGood(); }
      else { miss++; flashBad(); }
      nextFood();
    }

    bG.addEventListener('click', ()=>choose(true));
    bB.addEventListener('click', ()=>choose(false));
    nextFood();
  }

  // ---------- Hygiene: Germ Tap Combo ----------
  function runHygiene(){
    $('gameTitle').textContent = 'Hygiene Warmup ‚Äî Germ Tap Combo';
    $('desc').textContent = '‡πÅ‡∏ï‡∏∞ ü¶† ‡πÉ‡∏´‡πâ‡πÑ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ï‡∏∞ ‚Äú‡∏ü‡∏≠‡∏á‡∏™‡∏ö‡∏π‡πà‚Äù ‡∏ú‡∏¥‡∏î)';

    const maxTargets=8;

    function spawnOne(){
      if(!started) return;
      total++;

      const isGerm = Math.random() < 0.75;
      const t=DOC.createElement('div');
      t.className = 'target ' + (isGerm ? 'good' : 'bad');
      t.textContent = isGerm ? 'ü¶†' : 'ü´ß';

      const r=stage.getBoundingClientRect();
      const pad=16;
      const x = pad + Math.random()*(r.width - pad*2 - 72);
      const y = 54 + Math.random()*(r.height - 54 - 16 - 72);
      t.style.left = Math.round(x)+'px';
      t.style.top  = Math.round(y)+'px';

      stage.appendChild(t);

      const ttl = isGerm ? 850 : 950;
      let alive=true;

      t.addEventListener('pointerdown', (e)=>{
        if(!alive) return;
        alive=false;
        t.remove();
        if(isGerm){ score++; flashGood(); }
        else { miss++; flashBad(); }
        spawnOne();
      }, {passive:true});

      setTimeout(()=>{
        if(!alive) return;
        alive=false;
        t.remove();
        if(isGerm){ miss++; flashBad(); } // germ escaped counts miss
        spawnOne();
      }, ttl);
    }

    for(let i=0;i<maxTargets;i++) spawnOne();
  }

  // ---------- Exercise: Move Reaction ----------
  function runExercise(){
    $('gameTitle').textContent = 'Exercise Warmup ‚Äî Move Reaction';
    $('desc').textContent = '‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏ß: LEFT/RIGHT/JUMP/DUCK';

    const cmds = [
      {k:'LEFT',  label:'‚¨ÖÔ∏è LEFT'},
      {k:'RIGHT', label:'‚û°Ô∏è RIGHT'},
      {k:'JUMP',  label:'‚¨ÜÔ∏è JUMP'},
      {k:'DUCK',  label:'‚¨áÔ∏è DUCK'}
    ];

    const card=DOC.createElement('div');
    Object.assign(card.style,{position:'absolute', left:'50%', top:'50%', transform:'translate(-50%,-55%)',
      width:'min(520px, 92%)', padding:'14px', borderRadius:'18px',
      border:'1px solid rgba(148,163,184,.18)', background:'rgba(2,6,23,.50)', textAlign:'center'});
    card.innerHTML = `<div style="font-weight:1100; font-size:20px;" id="cmdNow">‚¨ÖÔ∏è LEFT</div>
      <div class="muted" style="margin-top:6px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</div>`;
    stage.appendChild(card);

    const pad=DOC.createElement('div');
    pad.style.position='absolute';
    pad.style.left='12px';
    pad.style.right='12px';
    pad.style.bottom='12px';
    pad.style.display='grid';
    pad.style.gridTemplateColumns='repeat(2, minmax(0,1fr))';
    pad.style.gap='10px';
    stage.appendChild(pad);

    function mkBtn(txt){
      const b=DOC.createElement('button');
      b.textContent=txt;
      b.style.padding='14px 12px';
      b.style.borderRadius='16px';
      b.style.border='1px solid rgba(148,163,184,.18)';
      b.style.background='rgba(2,6,23,.35)';
      b.style.color='var(--text)';
      b.style.fontWeight='1100';
      return b;
    }
    const bL=mkBtn('‚¨ÖÔ∏è LEFT'), bR=mkBtn('‚û°Ô∏è RIGHT'), bJ=mkBtn('‚¨ÜÔ∏è JUMP'), bD=mkBtn('‚¨áÔ∏è DUCK');
    pad.appendChild(bL); pad.appendChild(bR); pad.appendChild(bJ); pad.appendChild(bD);

    let cur = cmds[(Math.random()*cmds.length)|0];
    function nextCmd(){
      total++;
      cur = cmds[(Math.random()*cmds.length)|0];
      const el=card.querySelector('#cmdNow');
      if(el) el.textContent=cur.label;
    }
    function choose(k){
      if(!started) return;
      if(k===cur.k){ score++; flashGood(); }
      else { miss++; flashBad(); }
      nextCmd();
    }
    bL.addEventListener('click', ()=>choose('LEFT'));
    bR.addEventListener('click', ()=>choose('RIGHT'));
    bJ.addEventListener('click', ()=>choose('JUMP'));
    bD.addEventListener('click', ()=>choose('DUCK'));

    // optional swipe support (mobile)
    let sx=0, sy=0;
    stage.addEventListener('pointerdown',(e)=>{ sx=e.clientX; sy=e.clientY; },{passive:true});
    stage.addEventListener('pointerup',(e)=>{
      const dx=e.clientX-sx, dy=e.clientY-sy;
      if(Math.hypot(dx,dy) < 40) return;
      if(Math.abs(dx) > Math.abs(dy)) choose(dx<0?'LEFT':'RIGHT');
      else choose(dy<0?'JUMP':'DUCK');
    },{passive:true});

    nextCmd();
  }

  // ---------- Cooldown: breathing mini ----------
  function runCooldown(){
    $('gameTitle').textContent = 'Cooldown ‚Äî Breathe & Reset';
    $('desc').textContent = '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ä‡πâ‡∏≤ ‡πÜ 4-4-4 (‡πÄ‡∏Ç‡πâ‡∏≤-‡∏Ñ‡πâ‡∏≤‡∏á-‡∏≠‡∏≠‡∏Å) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ HUB';

    // simple guided timer, no scoring
    const card=DOC.createElement('div');
    Object.assign(card.style,{position:'absolute', left:'50%', top:'50%', transform:'translate(-50%,-55%)',
      width:'min(520px, 92%)', padding:'14px', borderRadius:'18px',
      border:'1px solid rgba(148,163,184,.18)', background:'rgba(2,6,23,.50)', textAlign:'center'});
    card.innerHTML = `<div style="font-weight:1100; font-size:18px;" id="breathTitle">INHALE</div>
      <div class="muted" style="margin-top:6px;" id="breathDesc">‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‚Ä¶</div>
      <div style="margin-top:12px; font-size:44px; font-weight:1200;" id="breathNum">4</div>`;
    stage.appendChild(card);

    let step=0, stepLeft=4;
    const steps=[
      {t:'INHALE', d:'‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‚Ä¶', c:'rgba(34,197,94,.18)'},
      {t:'HOLD',   d:'‡∏Å‡∏•‡∏±‡πâ‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à‚Ä¶', c:'rgba(56,189,248,.14)'},
      {t:'EXHALE', d:'‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å‚Ä¶', c:'rgba(251,113,133,.10)'}
    ];

    const tEl=card.querySelector('#breathTitle');
    const dEl=card.querySelector('#breathDesc');
    const nEl=card.querySelector('#breathNum');

    const it=setInterval(()=>{
      if(!started) return;
      stepLeft--;
      if(stepLeft<=0){
        step=(step+1)%steps.length;
        stepLeft=4;
      }
      const s=steps[step];
      if(tEl) tEl.textContent=s.t;
      if(dEl) dEl.textContent=s.d;
      if(nEl) nEl.textContent=String(stepLeft);
      card.style.background = `linear-gradient(180deg, rgba(2,6,23,.55), rgba(2,6,23,.35)), radial-gradient(800px 400px at 50% 30%, ${s.c}, transparent 60%)`;
    }, 1000);

    // ensure cleanup if navigate
    WIN.addEventListener('beforeunload', ()=>{ try{clearInterval(it);}catch{} });
  }

  // initial prompt
  pBig.textContent = (phase==='cooldown') ? '‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° Cooldown' : '‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° Warmup';
  pSmall.textContent = 'Tap / Click anywhere';
  setBuffText();
})();
</script>
</body>
</html>