<!-- === /herohealth/vr-plate/plate-vr.html ===
Balanced Plate VR RUN ‚Äî PRODUCTION
FULL v20260228-PLATE-RUN-SHIELD-AIHUD-CVRSTRICT

Requires:
- ./plate.safe.js (ES module)
- ./plate-vr.css
- ../vr/hha-shield.js (ES module)
- ../vr/vr-ui.js (ES module)
- ../vr/ai-hooks.js (ES module)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="color-scheme" content="dark light"/>
  <meta name="google" content="notranslate"/>
  <title>HeroHealth ‚Ä¢ Plate VR</title>

  <link rel="stylesheet" href="./plate-vr.css?v=20260228"/>

  <!-- ‚úÖ Shared modules (ESM) -->
  <script type="module" src="../vr/hha-shield.js?v=20260228"></script>
  <script type="module" src="../vr/vr-ui.js?v=20260228"></script>

  <style>
    html,body{height:100%;margin:0;}
    body{overflow:hidden;-webkit-tap-highlight-color:transparent;}

    .stage{ position:relative; width:100%; height:100%; }
    #layer{ position:absolute; inset:0; overflow:hidden; touch-action: manipulation; }

    .hud{
      position:fixed; left:0; right:0; top:0;
      z-index:120; pointer-events:none;
      padding-top: calc(env(safe-area-inset-top,0px) + 10px);
      padding-left: calc(env(safe-area-inset-left,0px) + 10px);
      padding-right: calc(env(safe-area-inset-right,0px) + 10px);
      display:flex; gap:10px; justify-content:space-between; align-items:flex-start;
    }
    .card{
      background: rgba(2,6,23,.68);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 14px;
      padding: 10px 12px;
      color: rgba(229,231,235,.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
    }
    .stat{ display:flex; gap:10px; flex-wrap:wrap; font-weight:900; letter-spacing:.2px; }
    .k{ opacity:.78; font-weight:800; }
    .v{ font-variant-numeric: tabular-nums; }

    .chips{ margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; font-size:13px; }
    .chip{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(2,6,23,.42);
      font-weight:1000;
      white-space:nowrap;
    }

    .food{
      position:absolute;
      transform: translate(-50%,-50%);
      user-select:none;
      pointer-events:auto;
      font-size: var(--tSize, 56px);
      line-height: 1;
      filter: drop-shadow(0 10px 26px rgba(0,0,0,.35));
      will-change: transform, opacity;
      transition: transform .08s ease, opacity .14s ease;
    }
    .food:active{ transform: translate(-50%,-50%) scale(.92); }

    #end{
      position:fixed; inset:0; z-index:300;
      display:flex; align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    #end[aria-hidden="true"]{ display:none; }
    .end-card{
      width:min(700px, 94vw);
      border-radius: 18px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.82);
      color: rgba(229,231,235,.95);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      padding: 16px;
    }
    .end-title{ font-weight:1000; font-size:20px; }
    .end-sub{ margin-top:6px; font-size:12px; opacity:.9; word-break: break-all; }
    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
    }
    .item{
      border:1px solid rgba(148,163,184,.14);
      background: rgba(2,6,23,.55);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight:900;
    }
    .item .kk{ font-size:12px; opacity:.82; font-weight:800; }
    .item .vv{ margin-top:4px; font-size:18px; font-variant-numeric: tabular-nums; }

    .actions{
      margin-top: 14px;
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      pointer-events:auto;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.55);
      color: rgba(229,231,235,.95);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 1000;
      cursor:pointer;
    }
    .btn.primary{
      border-color: rgba(99,102,241,.35);
      background: rgba(99,102,241,.22);
    }
    .btn.danger{
      border-color: rgba(244,63,94,.30);
      background: rgba(244,63,94,.16);
    }
    .is-hidden{ display:none !important; }

    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="hud">
    <div class="card" style="min-width:240px">
      <div class="stat">
        <span class="k">SCORE</span> <span id="score" class="v">0</span>
        <span class="k">TIME</span> <span id="time" class="v">0</span>
        <span class="k">MISS</span> <span id="miss" class="v">0</span>
        <span class="k">GRADE</span> <span id="grade" class="v">‚Äî</span>
      </div>

      <div class="chips">
        <span class="chip">üçΩÔ∏è TARGET <span id="target">‚Äî</span></span>
        <span class="chip">‚úÖ OK <span id="ok">0</span></span>
        <span class="chip">‚ùå WRONG <span id="wrong">0</span></span>
      </div>

      <!-- ‚úÖ AI HUD -->
      <div class="chips">
        <span class="chip">ü§ñ RISK <span id="aiRisk">‚Äî</span></span>
        <span class="chip"><span id="aiHint">‚Äî</span></span>
      </div>
    </div>

    <div class="card" style="min-width:140px; opacity:.92">
      <div style="font-weight:1000">PLATE</div>
      <div style="margin-top:6px; font-size:12px; opacity:.9">
        view=<span id="uiView">‚Äî</span><br/>
        run=<span id="uiRun">‚Äî</span><br/>
        diff=<span id="uiDiff">‚Äî</span>
      </div>
    </div>
  </div>

  <div class="stage">
    <div id="layer" aria-label="plate layer"></div>
  </div>

  <div id="end" aria-hidden="true">
    <div class="end-card">
      <div class="end-title" id="endTitle">Completed</div>
      <div class="end-sub" id="endSub">‚Äî</div>

      <div class="grid">
        <div class="item"><div class="kk">GRADE</div><div class="vv" id="endGrade">‚Äî</div></div>
        <div class="item"><div class="kk">SCORE</div><div class="vv" id="endScore">0</div></div>
        <div class="item"><div class="kk">OK</div><div class="vv" id="endOk">0</div></div>
        <div class="item"><div class="kk">WRONG</div><div class="vv" id="endWrong">0</div></div>
      </div>

      <div class="actions">
        <button class="btn" id="btnCopy">Copy Summary</button>
        <button class="btn danger" id="btnReplay">Replay</button>
        <button class="btn primary is-hidden" id="btnNextCooldown">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: Cooldown</button>
        <button class="btn primary" id="btnBackHub">Back HUB</button>
      </div>
    </div>
  </div>

  <script type="module">
    // ‚úÖ Shield install (quiet 403 + lock scroll + banner)
    try{
      window.HHA_Shield?.install({
        lockScroll: true,
        quietApollo403: true,
        quietNetworkNoise: true,
        showBanner: true
      });
    }catch(e){}

    import { createAIHooks } from '../vr/ai-hooks.js';
    import { boot as bootPlate } from './plate.safe.js';

    const U = new URL(location.href);
    const runMode = String(U.searchParams.get('run') || 'play').toLowerCase();
    const diff = String(U.searchParams.get('diff') || 'normal').toLowerCase();
    const view = String(U.searchParams.get('view') || 'mobile').toLowerCase();
    const seed = U.searchParams.get('seed') ?? String((Date.now() ^ (Math.random()*1e9))|0);

    // ‚úÖ cVR strict: ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ï‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏¥‡∏á crosshair (hha:shoot)
    if(view === 'cvr'){
      try{ document.getElementById('layer').style.pointerEvents = 'none'; }catch(e){}
    }

    // labels
    const s=(id,v)=>{ const el=document.getElementById(id); if(el) el.textContent=String(v); };
    s('uiView',view); s('uiRun',runMode); s('uiDiff',diff);

    const ai = createAIHooks({ seed:String(seed), runMode, game:'plate', diff, device:view });
    window.HHA_AI = ai;

    bootPlate({
      ai,
      view,
      run: runMode,
      diff,
      seed,
      pid: U.searchParams.get('pid') || 'anon',
      hub: U.searchParams.get('hub') || '../hub.html',
      time: Number(U.searchParams.get('time') || 80),
      cooldown: (U.searchParams.get('cooldown') === '1') || (U.searchParams.get('cd') === '1')
    });
  </script>
</body>
</html>