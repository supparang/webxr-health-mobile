/* === /herohealth/plate/plate-vr.css ===
Balanced Plate VR — PRODUCTION+ (HHA Standard UI)
✅ PC / Mobile / VR / cVR
✅ Safe-area + HUD-safe layering
✅ Target animations + hit feedback
✅ Storm/Boss FX classes (toggled by JS on #stormFx/#bossFx)
✅ cVR strict helper (targets still clickable on mobile; shooting via hha:shoot works)
*/

/* ------------------------------------------------------------
   Base
------------------------------------------------------------ */
:root{
  color-scheme: dark;
  --bg:#020617;
  --panel:rgba(2,6,23,.78);
  --panel2:rgba(15,23,42,.70);
  --stroke:rgba(148,163,184,.18);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;
  --radius:18px;
  --pill:999px;

  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  /* target */
  --t-shadow: 0 18px 44px rgba(0,0,0,.28);
  --t-bg: rgba(2,6,23,.55);
  --t-ring: rgba(148,163,184,.18);

  /* z-stack guard */
  --z-scene: 0;
  --z-bg: 1;
  --z-stage: 2;
  --z-layer: 10;
  --z-hitfx: 12;
  --z-hud: 30;
  --z-storm: 55;
  --z-overlay: 70;
}

*,
*::before,
*::after{ box-sizing:border-box; }

html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, -apple-system, "Noto Sans Thai", Segoe UI, Roboto, sans-serif;
}

/* ------------------------------------------------------------
   View flags (set by JS)
------------------------------------------------------------ */
body.view-pc{}
body.view-mobile{}
body.view-vr{}
body.view-cvr{}

/* ------------------------------------------------------------
   A-Frame scene should stay behind UI always
------------------------------------------------------------ */
a-scene{
  position:fixed;
  inset:0;
  z-index: var(--z-scene);
}

/* ------------------------------------------------------------
   Plate Layer (targets host)
------------------------------------------------------------ */
#plate-layer{
  position:fixed;
  inset:0;
  z-index: var(--z-layer);
  pointer-events:auto;
  touch-action:none;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color: transparent;
  transform: translateZ(0);
}

#hitFx{
  position:fixed;
  inset:0;
  z-index: var(--z-hitfx);
  pointer-events:none;
  opacity:0;
}

/* ------------------------------------------------------------
   Targets
------------------------------------------------------------ */
.plateTarget{
  appearance:none;
  border:none;
  padding:0;
  margin:0;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;

  /* JS sets size/pos/emoji */
  display:grid;
  place-items:center;

  background: var(--t-bg);
  border: 1px solid var(--t-ring);
  border-radius: 999px;
  box-shadow: var(--t-shadow);
  backdrop-filter: blur(8px);

  transform: translateZ(0);
  will-change: transform, opacity, filter;

  animation: tPop .14s ease-out both, tFloat 1.6s ease-in-out .12s infinite;
}

.plateTarget:active{
  transform: translateZ(0) scale(.985);
}

@keyframes tPop{
  from{ transform: scale(.74); opacity:.0; filter: blur(2px); }
  to  { transform: scale(1); opacity:1; filter: blur(0); }
}

@keyframes tFloat{
  0%{ transform: translateY(0) }
  50%{ transform: translateY(-2px) }
  100%{ transform: translateY(0) }
}

/* Type hints (optional) */
.plateTarget[data-kind="good"]{
  border-color: rgba(34,197,94,.28);
}
.plateTarget[data-kind="junk"]{
  border-color: rgba(239,68,68,.28);
  box-shadow: 0 18px 44px rgba(239,68,68,.06), var(--t-shadow);
}
.plateTarget[data-kind="shield"]{
  border-color: rgba(34,211,238,.28);
  box-shadow: 0 18px 44px rgba(34,211,238,.06), var(--t-shadow);
}

/* cVR strict: targets should NOT steal pointer events when using crosshair shooting */
body.view-cvr #plate-layer{
  pointer-events:none;
}
body.view-cvr .plateTarget{
  pointer-events:none;
}

/* In VR mode we also prefer shooting via crosshair, but allow if needed */
body.view-vr .plateTarget{
  /* keep clickable just in case; can be switched off later */
}

/* ------------------------------------------------------------
   HUD cards micro polish
------------------------------------------------------------ */
.hudTop,
#miniPanel,
#coachPanel,
#hudBtns,
#bossHud,
#stormHud{
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

.card,
.questCard,
.panelCard,
.bossCard,
.stormCard{
  backdrop-filter: blur(10px);
}

/* ------------------------------------------------------------
   Buttons (HUD)
------------------------------------------------------------ */
#hudBtns{
  pointer-events:none; /* container */
}
#hudBtns .btn{
  pointer-events:auto;
}

.btn{
  transition: transform .06s ease, filter .12s ease, opacity .12s ease;
}
.btn:hover{ filter: brightness(1.06); }
.btn:active{ transform: translateY(1px); }

/* Don't let HUD buttons block VR-UI (ENTER/EXIT/RECENTER) */
.hha-vrui,
.hha-vrui *{
  pointer-events:auto !important;
}

/* If vr-ui.js places buttons top-left, keep our HUD away slightly on small screens */
@media (max-width: 420px){
  .hudTop{ padding-top: 2px; }
}

/* ------------------------------------------------------------
   Overlays
------------------------------------------------------------ */
#startOverlay,
#hudPaused,
#resultBackdrop{
  z-index: var(--z-overlay);
}

#startOverlay .panelCard,
#hudPaused .panelCard,
#resultBackdrop .panelCard{
  animation: panelIn .18s ease-out both;
}

@keyframes panelIn{
  from{ transform: translateY(10px) scale(.985); opacity:.0; }
  to  { transform: translateY(0) scale(1); opacity:1; }
}

/* ------------------------------------------------------------
   Storm FX
------------------------------------------------------------ */
#stormFx{
  z-index: var(--z-storm);
  display:none;
}

#stormFx::before{
  content:"";
  position:absolute;
  inset:-40px;
  pointer-events:none;
  background:
    radial-gradient(circle at 20% 25%, rgba(34,211,238,.22), transparent 55%),
    radial-gradient(circle at 80% 35%, rgba(34,211,238,.16), transparent 58%),
    radial-gradient(circle at 55% 85%, rgba(34,211,238,.10), transparent 62%);
  opacity:.0;
  filter: blur(0px);
  transform: translateZ(0);
}

#stormFx{
  /* base subtle motion */
  animation: stormBreathe 2.8s ease-in-out infinite;
}

@keyframes stormBreathe{
  0%{ filter: saturate(1) brightness(1); }
  50%{ filter: saturate(1.06) brightness(1.02); }
  100%{ filter: saturate(1) brightness(1); }
}

/* JS toggles this class */
#stormFx.storm-panic::before{
  opacity:.65;
  animation: stormPulse .55s ease-in-out infinite;
}
@keyframes stormPulse{
  0%{ transform: scale(1); filter: blur(0px) brightness(1); }
  50%{ transform: scale(1.02); filter: blur(1px) brightness(1.05); }
  100%{ transform: scale(1); filter: blur(0px) brightness(1); }
}

/* Keep HUD readable during storm */
#stormFx.storm-panic{
  mix-blend-mode: screen;
}

/* ------------------------------------------------------------
   Boss FX
------------------------------------------------------------ */
#bossFx{
  z-index: var(--z-storm);
  display:none;
}

#bossFx::before{
  content:"";
  position:absolute;
  inset:-40px;
  pointer-events:none;
  background:
    radial-gradient(circle at 20% 30%, rgba(167,139,250,.18), transparent 58%),
    radial-gradient(circle at 80% 30%, rgba(167,139,250,.14), transparent 60%),
    radial-gradient(circle at 50% 90%, rgba(239,68,68,.10), transparent 62%);
  opacity:.0;
  transform: translateZ(0);
}

#bossFx.boss-on::before{
  opacity:.55;
  animation: bossGlow 1.4s ease-in-out infinite;
}
@keyframes bossGlow{
  0%{ filter: brightness(1) saturate(1); transform: scale(1); }
  50%{ filter: brightness(1.05) saturate(1.08); transform: scale(1.01); }
  100%{ filter: brightness(1) saturate(1); transform: scale(1); }
}

#bossFx.boss-panic::before{
  opacity:.75;
  animation: bossPanic .42s ease-in-out infinite;
}
@keyframes bossPanic{
  0%{ transform: translate(0,0) scale(1); }
  25%{ transform: translate(2px,-1px) scale(1.01); }
  50%{ transform: translate(-2px,1px) scale(1.02); }
  75%{ transform: translate(1px,1px) scale(1.01); }
  100%{ transform: translate(0,0) scale(1); }
}

/* ------------------------------------------------------------
   Accessibility / Motion
------------------------------------------------------------ */
@media (prefers-reduced-motion: reduce){
  .plateTarget{
    animation: none !important;
  }
  #stormFx,
  #bossFx{
    animation:none !important;
  }
  #stormFx::before,
  #bossFx::before{
    animation:none !important;
  }
}

/* ------------------------------------------------------------
   Small screen tweaks
------------------------------------------------------------ */
@media (max-width: 920px){
  /* keep more play area */
  #miniPanel{ top: calc(92px + var(--sat)); }
  #coachPanel{ bottom: calc(66px + var(--sab)); }
}

@media (max-width: 520px){
  /* compress cards slightly */
  .card{ min-width: 170px; }
}