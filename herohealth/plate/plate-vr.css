/* === /herohealth/plate/plate-vr.css ===
Balanced Plate VR — ALL-IN PRODUCTION CSS
✅ PC / Mobile / VR / cVR view modes
✅ Safe-area support
✅ No-overlap spawn zones friendly (HUD regions stable)
✅ cVR: disable pointer events on targets (shoot via hha:shoot)
✅ Polished HUD / Coach / Quest / Overlays / Result
*/

:root{
  color-scheme: dark;
  --bg:#020617;

  --panel:rgba(2,6,23,.74);
  --panel2:rgba(15,23,42,.70);
  --stroke:rgba(148,163,184,.20);

  --text:#e5e7eb;
  --muted:#94a3b8;

  --accent:#22c55e;
  --accentSoft:rgba(34,197,94,.18);

  --warn:#f59e0b;
  --warnSoft:rgba(245,158,11,.18);

  --bad:#ef4444;
  --badSoft:rgba(239,68,68,.18);

  --cyan:#22d3ee;
  --violet:#a78bfa;

  --radius-lg:18px;
  --radius-md:14px;
  --radius-pill:999px;

  --shadow: 0 22px 70px rgba(0,0,0,.42);
  --shadow2: 0 14px 40px rgba(0,0,0,.30);

  /* safe-area */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  /* HUD sizing */
  --hud-pad-x: 12px;
  --hud-pad-y: 10px;

  /* bottom stack */
  --btnbar-h: 56px;
  --mini-w: min(560px, calc(100vw - 24px));
}

*,
*::before,
*::after{ box-sizing:border-box; }

html, body{
  width:100%;
  height:100%;
  margin:0;
  padding:0;
  overflow:hidden;
  background:var(--bg);
  color:var(--text);
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans Thai",Roboto,sans-serif;
}

body{
  position:relative;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overscroll-behavior:none;
  touch-action: manipulation;
  user-select:none;

  background:
    radial-gradient(circle at 20% 10%, rgba(56,189,248,.14), transparent 55%),
    radial-gradient(circle at 80% 90%, rgba(34,197,94,.14), transparent 55%),
    radial-gradient(circle at 70% 15%, rgba(167,139,250,.12), transparent 50%),
    var(--bg);
}

a-scene{ z-index:1 !important; }

/* -------------------- Play Layer + HitFx -------------------- */
#plate-layer{
  position:fixed;
  inset:0;
  z-index:10;
  pointer-events:none; /* allow click only on targets */
  transform: translate(0,0);
  will-change: transform;
}

#hitFx{
  position:fixed;
  inset:0;
  z-index:18;
  pointer-events:none;
  opacity:0;
  transition: opacity .12s ease;
}

/* -------------------- Targets -------------------- */
.plateTarget{
  pointer-events:auto; /* clickable in PC/Mobile/VR */
  border-radius: var(--radius-pill);
  outline:none;
  cursor:pointer;

  /* visual polish (inline styles from JS remain, but these add effects) */
  text-shadow: 0 2px 0 rgba(0,0,0,.22);
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.32));
  transition: filter .12s ease, box-shadow .12s ease, border-color .12s ease;
  animation: plateTargetPulse 1.35s ease-in-out infinite;
}

.plateTarget:active{
  filter: drop-shadow(0 12px 24px rgba(0,0,0,.35)) brightness(1.08);
}

.plateTarget::before{
  content:"";
  position:absolute;
  inset:-4px;
  border-radius: var(--radius-pill);
  pointer-events:none;
  opacity:.0;
  transition: opacity .12s ease;
  box-shadow: 0 0 0 2px rgba(255,255,255,.08);
}

.plateTarget:hover::before{ opacity:.65; }

.plateTarget[data-kind="good"]{
  border-color: rgba(34,197,94,.40) !important;
  box-shadow: 0 18px 46px rgba(0,0,0,.30), 0 0 0 1px rgba(34,197,94,.10);
}
.plateTarget[data-kind="junk"]{
  border-color: rgba(239,68,68,.45) !important;
  box-shadow: 0 18px 46px rgba(0,0,0,.30), 0 0 0 1px rgba(239,68,68,.10);
  animation: plateTargetPulseBad 1.05s ease-in-out infinite;
}
.plateTarget[data-kind="shield"]{
  border-color: rgba(34,211,238,.50) !important;
  box-shadow: 0 18px 46px rgba(0,0,0,.30), 0 0 0 1px rgba(34,211,238,.12);
  animation: plateTargetPulseShield 1.25s ease-in-out infinite;
}

@keyframes plateTargetPulse{
  0%,100%{ filter: drop-shadow(0 10px 18px rgba(0,0,0,.30)) brightness(1.00); }
  50%{ filter: drop-shadow(0 14px 22px rgba(0,0,0,.36)) brightness(1.06); }
}
@keyframes plateTargetPulseBad{
  0%,100%{ filter: drop-shadow(0 10px 18px rgba(0,0,0,.30)) brightness(1.00); }
  50%{ filter: drop-shadow(0 14px 22px rgba(0,0,0,.36)) brightness(1.10) saturate(1.08); }
}
@keyframes plateTargetPulseShield{
  0%,100%{ filter: drop-shadow(0 10px 18px rgba(0,0,0,.30)) brightness(1.00); }
  50%{ filter: drop-shadow(0 14px 22px rgba(0,0,0,.36)) brightness(1.08) saturate(1.10); }
}

/* -------------------- HUD TOP -------------------- */
#hudTop{
  position:fixed;
  top:0;
  left:0;
  right:0;
  z-index:40;
  padding: calc(var(--sat) + 10px) calc(var(--hud-pad-x) + var(--sar)) 10px calc(var(--hud-pad-x) + var(--sal));
  pointer-events:none; /* HUD non-blocking to spawn & interactions */
}

#hudTop .hudRow{
  display:grid;
  grid-template-columns: repeat(6, minmax(0,1fr));
  gap:10px;
  align-items:stretch;
}

#hudTop .hudStat{
  background: linear-gradient(180deg, rgba(2,6,23,.80), rgba(2,6,23,.60));
  border:1px solid var(--stroke);
  border-radius: 14px;
  padding:10px 10px;
  box-shadow: 0 12px 30px rgba(0,0,0,.25);
  backdrop-filter: blur(10px);
  min-width:0;
}

#hudTop .hudStat .k{
  font-size:11px;
  letter-spacing:.10em;
  font-weight:1000;
  color: rgba(148,163,184,.95);
}
#hudTop .hudStat .v{
  font-size:18px;
  font-weight:1100;
  margin-top:4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#hudTop .muted{ color: rgba(148,163,184,.90); font-weight:900; }

#hudTop .plateChip .v{ color: rgba(34,197,94,.98); }
#hudTop .gradeChip .v{ color: rgba(167,139,250,.98); }
#hudTop .timeChip .v{ color: rgba(34,211,238,.98); }

#hudTop .hudRow2{
  margin-top:10px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  pointer-events:none;
}

.feverWrap{
  flex:1;
  min-width: 200px;
  background: linear-gradient(180deg, rgba(15,23,42,.70), rgba(2,6,23,.62));
  border:1px solid var(--stroke);
  border-radius: 14px;
  padding:10px 12px;
  box-shadow: 0 12px 30px rgba(0,0,0,.25);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:center;
  gap:10px;
}

.feverLabel{
  font-weight:1100;
  letter-spacing:.08em;
  font-size:11px;
  color: rgba(148,163,184,.95);
}

.feverBar{
  flex:1;
  height:12px;
  border-radius:999px;
  background: rgba(148,163,184,.16);
  overflow:hidden;
  border:1px solid rgba(148,163,184,.18);
}
.feverFill{
  width:0%;
  height:100%;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(245,158,11,.95), rgba(239,68,68,.95));
  box-shadow: 0 0 18px rgba(239,68,68,.18);
  transition: width .12s linear;
}

.shieldPill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(34,211,238,.25);
  background: rgba(34,211,238,.10);
  font-weight:1100;
  color: rgba(34,211,238,.98);
}

.plateCounts{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-end;
  flex-wrap:wrap;
}

.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.60);
  box-shadow: 0 10px 26px rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
  font-weight:1000;
  color: rgba(229,231,235,.98);
}

/* -------------------- Coach Panel -------------------- */
#coachPanel{
  position:fixed;
  left: calc(12px + var(--sal));
  bottom: calc(12px + var(--sab) + var(--btnbar-h) + 10px);
  z-index:42;
  width: min(360px, calc(100vw - 24px));
  display:flex;
  gap:12px;
  align-items:flex-end;
  padding:12px;
  border-radius: var(--radius-lg);
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(2,6,23,.74), rgba(2,6,23,.55));
  box-shadow: var(--shadow2);
  backdrop-filter: blur(10px);
  pointer-events:none;
}

#coachPanel img{
  width:72px;
  height:72px;
  object-fit:contain;
  filter: drop-shadow(0 16px 30px rgba(0,0,0,.30));
}

.coachText{ min-width:0; }
.coachName{
  font-weight:1200;
  font-size:13px;
  letter-spacing:.06em;
  color: rgba(148,163,184,.95);
}
.coachMsg{
  margin-top:6px;
  font-weight:1100;
  font-size:14px;
  line-height:1.3;
  color: rgba(229,231,235,.98);
  word-break:break-word;
}

/* -------------------- Quest Panel -------------------- */
#miniPanel{
  position:fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(12px + var(--sab) + var(--btnbar-h) + 10px);
  z-index:41;
  width: var(--mini-w);
  pointer-events:none;
}

.questBlock{
  background: linear-gradient(180deg, rgba(15,23,42,.74), rgba(2,6,23,.58));
  border:1px solid var(--stroke);
  border-radius: var(--radius-lg);
  padding: 12px;
  box-shadow: var(--shadow2);
  backdrop-filter: blur(10px);
}

.questBlock + .questBlock{ margin-top:10px; }

.questHdr{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}

.badge{
  font-weight:1200;
  font-size:11px;
  letter-spacing:.12em;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.55);
}
.badgeGoal{
  border-color: rgba(167,139,250,.28);
  background: rgba(167,139,250,.10);
  color: rgba(167,139,250,.98);
}
.badgeMini{
  border-color: rgba(245,158,11,.28);
  background: rgba(245,158,11,.10);
  color: rgba(245,158,11,.98);
}

.qTitle{
  flex:1;
  min-width:0;
  font-weight:1100;
  font-size:13px;
  color: rgba(229,231,235,.98);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.qCount{
  font-weight:1100;
  font-size:12px;
  color: rgba(148,163,184,.95);
  white-space:nowrap;
}

.bar{
  margin-top:10px;
  height:12px;
  border-radius:999px;
  overflow:hidden;
  background: rgba(148,163,184,.14);
  border:1px solid rgba(148,163,184,.18);
}
.barFill{
  width:0%;
  height:100%;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(167,139,250,.95), rgba(34,211,238,.92));
  transition: width .14s linear;
}
.barFill.mini{
  background: linear-gradient(90deg, rgba(245,158,11,.95), rgba(34,197,94,.92));
}

.hint{
  margin-top:8px;
  font-size:12px;
  line-height:1.35;
  color: rgba(148,163,184,.95);
  font-weight:900;
}

/* -------------------- Buttons (HUD) -------------------- */
#hudBtns{
  position:fixed;
  right: calc(12px + var(--sar));
  bottom: calc(12px + var(--sab));
  z-index:45;
  display:flex;
  gap:10px;
  pointer-events:auto;
}

.btn{
  height: var(--btnbar-h);
  padding: 0 14px;
  border-radius: 16px;
  border:1px solid rgba(34,197,94,.25);
  background: linear-gradient(180deg, rgba(34,197,94,.22), rgba(2,6,23,.70));
  color: rgba(229,231,235,.98);
  font-weight:1200;
  letter-spacing:.02em;
  box-shadow: 0 14px 40px rgba(0,0,0,.32);
  backdrop-filter: blur(10px);
  cursor:pointer;
  transition: transform .10s ease, filter .10s ease, border-color .10s ease;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

.btn:hover{ filter: brightness(1.08); }
.btn:active{ transform: translateY(1px) scale(.99); }

.btn.ghost{
  border-color: rgba(148,163,184,.22);
  background: linear-gradient(180deg, rgba(15,23,42,.70), rgba(2,6,23,.72));
}

.btn.big{
  height: 56px;
  padding: 0 18px;
  border-radius: 18px;
}

/* -------------------- Paused Overlay -------------------- */
#hudPaused{
  position:fixed;
  inset:0;
  z-index:90;
  display:none;
  place-items:center;
  background: rgba(0,0,0,.48);
  backdrop-filter: blur(6px);
}

.pausedCard{
  width: min(520px, calc(100vw - 28px));
  border-radius: var(--radius-lg);
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.78);
  box-shadow: var(--shadow);
  padding: 16px;
}

.pausedTitle{
  font-size: 18px;
  font-weight: 1200;
}
.pausedText{
  margin-top: 8px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  line-height:1.35;
}

/* -------------------- Start Overlay -------------------- */
#startOverlay{
  position:fixed;
  inset:0;
  z-index:100;
  display:none; /* JS sets grid */
  place-items:center;
  background: radial-gradient(circle at 35% 18%, rgba(34,197,94,.16), transparent 60%),
              radial-gradient(circle at 75% 80%, rgba(56,189,248,.16), transparent 60%),
              rgba(0,0,0,.54);
  backdrop-filter: blur(8px);
}

.startCard{
  width: min(640px, calc(100vw - 28px));
  border-radius: 22px;
  border:1px solid rgba(148,163,184,.18);
  background: linear-gradient(180deg, rgba(2,6,23,.88), rgba(2,6,23,.70));
  box-shadow: var(--shadow);
  padding: 16px;
}

.startTitle{
  font-size: 20px;
  font-weight: 1300;
  letter-spacing:.01em;
}
.startSub{
  margin-top: 10px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  line-height:1.4;
}
.startMeta{
  margin-top: 12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.metaPill{
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.62);
  border-radius: 999px;
  padding: 8px 10px;
  font-weight: 1000;
  color: rgba(229,231,235,.98);
}
.startBtns{
  margin-top: 14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.startFoot{
  margin-top: 10px;
  font-size:12px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
}

/* -------------------- Result Overlay -------------------- */
#resultBackdrop{
  position:fixed;
  inset:0;
  z-index:110;
  display:none; /* JS toggles */
  place-items:center;
  background: rgba(0,0,0,.60);
  backdrop-filter: blur(8px);
}

.resultCard{
  width: min(720px, calc(100vw - 28px));
  border-radius: 22px;
  border:1px solid rgba(148,163,184,.18);
  background: linear-gradient(180deg, rgba(2,6,23,.90), rgba(2,6,23,.70));
  box-shadow: var(--shadow);
  padding: 16px;
}

.resultTitle{
  font-size:18px;
  font-weight:1300;
}

.resultGrid{
  margin-top: 12px;
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap:10px;
}

.resultItem{
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.62);
  border-radius: 16px;
  padding: 10px;
}
.resultItem .k{
  font-size:11px;
  letter-spacing:.10em;
  font-weight:1100;
  color: rgba(148,163,184,.95);
}
.resultItem .v{
  margin-top:6px;
  font-size:16px;
  font-weight:1300;
  color: rgba(229,231,235,.98);
}

.resultPlate{
  margin-top: 12px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.58);
  border-radius: 18px;
  padding: 12px;
}
.plateRow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.totalRow{
  margin-top:10px;
  font-weight:1200;
  color: rgba(148,163,184,.95);
}

.resultBtns{
  margin-top: 12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

/* -------------------- View Modes -------------------- */
/* Default: PC */
body.view-pc #hudBtns{ right: calc(12px + var(--sar)); }
body.view-pc #coachPanel{ width: 360px; }

/* Mobile: tighten */
body.view-mobile #hudTop .hudRow{
  grid-template-columns: repeat(3, minmax(0,1fr));
}
body.view-mobile #hudTop .hudStat .v{ font-size:16px; }
body.view-mobile #coachPanel{
  left: calc(10px + var(--sal));
  bottom: calc(10px + var(--sab) + var(--btnbar-h) + 8px);
  width: min(360px, calc(100vw - 20px));
}
body.view-mobile #miniPanel{
  width: min(560px, calc(100vw - 20px));
  bottom: calc(10px + var(--sab) + var(--btnbar-h) + 8px);
}
body.view-mobile #hudBtns{
  left: calc(10px + var(--sal));
  right: calc(10px + var(--sar));
  justify-content:space-between;
}
body.view-mobile .btn{ flex:1; }

/* VR: slightly compact */
body.view-vr #hudTop{
  padding-top: calc(var(--sat) + 8px);
}
body.view-vr #hudTop .hudRow{
  grid-template-columns: repeat(6, minmax(0,1fr));
}
body.view-vr #coachPanel{
  opacity:.96;
}
body.view-vr #miniPanel{
  opacity:.98;
}

/* cVR: SHOOT MODE — disable clicking targets */
body.view-cvr #plate-layer{ pointer-events:none; }
body.view-cvr .plateTarget{ pointer-events:none !important; }
body.view-cvr #hudTop,
body.view-cvr #miniPanel,
body.view-cvr #coachPanel{ opacity:.96; }

/* -------------------- Tiny screens (short height) -------------------- */
@media (max-height: 720px){
  #hudTop .hudRow{ gap:8px; }
  #hudTop .hudStat{ padding:9px; }
  #hudTop .hudStat .v{ font-size:16px; }

  #coachPanel{
    padding:10px;
  }
  #coachPanel img{ width:64px; height:64px; }

  #miniPanel .questBlock{ padding:10px; }
}

@media (max-height: 620px){
  :root{ --btnbar-h: 52px; }
  #hudTop{ padding-bottom: 8px; }
  #miniPanel{ bottom: calc(10px + var(--sab) + var(--btnbar-h) + 6px); }
  #coachPanel{ bottom: calc(10px + var(--sab) + var(--btnbar-h) + 6px); }
  .hint{ display:none; } /* กันกินพื้นที่ */
}

/* -------------------- Landscape handling -------------------- */
@media (orientation: landscape){
  body.view-mobile #hudTop .hudRow{
    grid-template-columns: repeat(6, minmax(0,1fr));
  }
  body.view-mobile #hudBtns{
    left: auto;
    right: calc(12px + var(--sar));
    justify-content:flex-end;
  }
  body.view-mobile .btn{ flex:0 0 auto; }
  body.view-mobile #miniPanel{
    width: min(520px, calc(100vw - 24px));
  }
}

/* -------------------- Optional: allow Universal VR UI overlay above everything -------------------- */
/* (vr-ui.js uses its own classes; we just ensure it's not buried) */
.hha-vr-ui, .hha-vr-crosshair, .hha-vr-btnbar{
  z-index: 200 !important;
}