/* === /herohealth/plate/plate-vr.css ===
Balanced Plate VR — PRODUCTION+ (HHA Standard UI)
✅ PC/Mobile/VR/cVR layouts + safe-area
✅ HUD/Quest/Boss/Storm/Coach panels
✅ Prevent HUD blocking VR-UI buttons
✅ Targets readable + tap friendly
✅ FX layer + hit pop
*/

:root{
  color-scheme: dark;
  --bg:#020617;
  --panel:rgba(2,6,23,.82);
  --panel2:rgba(15,23,42,.72);
  --stroke:rgba(148,163,184,.22);
  --text:#e5e7eb;
  --muted:#94a3b8;

  --accent:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;

  --radius:22px;
  --pill:999px;

  /* safe-area */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  /* HUD spacing rules */
  --hudTopH: 132px;          /* top reserved area */
  --hudBottomH: 106px;       /* bottom reserved area */
  --sidePad: 12px;

  /* plate targets */
  --targetSize: 56px;
  --targetFont: 28px;
  --targetShadow: 0 10px 28px rgba(0,0,0,.38);
}

/* ---------- base ---------- */
*{ box-sizing:border-box; }
html,body{
  width:100%; height:100%;
  margin:0; padding:0;
  overflow:hidden;
  background: radial-gradient(circle at 15% 10%, rgba(34,211,238,.16), transparent 52%),
              radial-gradient(circle at 90% 80%, rgba(167,139,250,.16), transparent 56%),
              linear-gradient(180deg, #020617, #020617);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  -webkit-tap-highlight-color: transparent;
}

a{ color:inherit; }

/* ---------- background scene slot (if any) ---------- */
#sceneRoot{
  position:fixed; inset:0;
  z-index:0;
}

/* ---------- play layer ---------- */
#plate-layer{
  position:fixed;
  inset:0;
  z-index:2;
  /* reserved space so targets don't spawn under HUD */
  padding:
    calc(var(--sat) + var(--hudTopH)) 
    calc(var(--sar) + 10px)
    calc(var(--sab) + var(--hudBottomH))
    calc(var(--sal) + 10px);
  touch-action: manipulation;
}

/* if you want targets allowed behind HUD in PC (optional):
body.view-pc #plate-layer{ padding-top: calc(var(--sat) + 118px); } */

/* ---------- targets ---------- */
.plateTarget{
  border:1px solid rgba(148,163,184,.28);
  background: linear-gradient(180deg, rgba(2,6,23,.78), rgba(15,23,42,.72));
  color:#fff;
  box-shadow: var(--targetShadow);
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
  touch-action: manipulation;
  transform: translateZ(0);
  transition: transform .08s ease, filter .08s ease, opacity .12s ease;
}
.plateTarget:active{
  transform: scale(.96);
  filter: brightness(1.1);
}
.plateTarget.fx-good{
  border-color: rgba(34,197,94,.45);
  box-shadow: 0 14px 38px rgba(34,197,94,.12), var(--targetShadow);
}
.plateTarget.fx-bad{
  border-color: rgba(239,68,68,.45);
  box-shadow: 0 14px 38px rgba(239,68,68,.12), var(--targetShadow);
}

/* ---------- HUD wrappers ---------- */
#hudTop,
#hudBtns,
#bossHud,
#stormHud,
#miniPanel,
#coachPanel{
  position:fixed;
  z-index:40; /* keep above targets */
  pointer-events:none; /* IMPORTANT: don't block targets */
}
#hudTop * ,
#hudBtns * ,
#bossHud * ,
#stormHud * ,
#miniPanel * ,
#coachPanel * { pointer-events:auto; }

/* Keep VR-UI buttons always clickable (vr-ui.js usually uses z-index 120) */
.hha-vrui,
.hha-vrui *{
  pointer-events:auto !important;
}

/* ---------- Top HUD ---------- */
#hudTop{
  left: calc(var(--sal) + var(--sidePad));
  right: calc(var(--sar) + var(--sidePad));
  top: calc(var(--sat) + 10px);
  display:flex;
  gap:10px;
  align-items:stretch;
  justify-content:space-between;
}

.hudCard{
  background: var(--panel);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: 0 20px 50px rgba(0,0,0,.25);
  padding:10px 12px;
  backdrop-filter: blur(10px);
}

#hudMain{
  flex:1;
  min-width: 0;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

.hudStat{
  display:flex;
  gap:8px;
  align-items:baseline;
  min-width: 0;
}
.hudLabel{
  font-size:12px;
  color:var(--muted);
  letter-spacing:.3px;
}
.hudValue{
  font-size:18px;
  font-weight:900;
}
.hudTiny{
  font-size:12px;
  color:var(--muted);
}

/* fever */
#uiFeverWrap{
  width: 120px;
  height: 12px;
  border-radius: 999px;
  border:1px solid rgba(148,163,184,.22);
  background: rgba(15,23,42,.55);
  overflow:hidden;
}
#uiFeverFill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(245,158,11,.95), rgba(239,68,68,.95));
}

/* grade chip */
#uiGradeChip{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:30px;
  padding:0 12px;
  border-radius: var(--pill);
  border:1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.65);
  font-weight:900;
}

/* ---------- Mini panel (goal/mini) ---------- */
#miniPanel{
  left: calc(var(--sal) + var(--sidePad));
  right: calc(var(--sar) + var(--sidePad));
  top: calc(var(--sat) + 86px);
  display:flex;
  gap:10px;
  align-items:stretch;
  justify-content:space-between;
}

#miniPanel .miniCard{
  flex:1;
  min-width:0;
  background: var(--panel2);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  padding:10px 12px;
  backdrop-filter: blur(10px);
}

.miniTitle{
  font-size:12px;
  color:var(--muted);
}
.miniText{
  margin-top:4px;
  font-size:14px;
  font-weight:800;
  line-height:1.25;
  word-break:break-word;
}
.miniProg{
  margin-top:8px;
  height:10px;
  border-radius:999px;
  background: rgba(15,23,42,.55);
  border:1px solid rgba(148,163,184,.18);
  overflow:hidden;
}
.miniProg > i{
  display:block;
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(34,211,238,.9), rgba(167,139,250,.9));
}

/* ---------- Coach panel ---------- */
#coachPanel{
  left: calc(var(--sal) + var(--sidePad));
  bottom: calc(var(--sab) + 12px);
  width:min(520px, calc(100vw - (var(--sal) + var(--sar) + 2*var(--sidePad))));
}
#coachPanel .coachCard{
  display:flex;
  gap:10px;
  align-items:flex-start;
  background: rgba(2,6,23,.72);
  border:1px solid rgba(148,163,184,.18);
  border-radius: var(--radius);
  padding:10px 12px;
  backdrop-filter: blur(10px);
}
#coachAvatar{
  width:42px; height:42px;
  border-radius: 14px;
  display:grid;
  place-items:center;
  background: rgba(15,23,42,.7);
  border:1px solid rgba(148,163,184,.18);
  font-size:22px;
}
#coachMsg{
  font-size:14px;
  line-height:1.25;
  font-weight:800;
}
#coachHint{
  margin-top:3px;
  font-size:12px;
  color:var(--muted);
}

/* ---------- HUD Buttons bottom-right ---------- */
#hudBtns{
  right: calc(var(--sar) + var(--sidePad));
  bottom: calc(var(--sab) + 12px);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:flex-end;
}
.hudBtn{
  pointer-events:auto;
  appearance:none;
  border:1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.72);
  color:var(--text);
  padding:10px 12px;
  border-radius: var(--pill);
  font-weight:900;
  letter-spacing:.2px;
  cursor:pointer;
  box-shadow: 0 14px 34px rgba(0,0,0,.22);
  transition: transform .08s ease, filter .08s ease;
}
.hudBtn:active{ transform: scale(.98); }
.hudBtn.primary{
  border-color: rgba(34,197,94,.35);
  background: rgba(34,197,94,.18);
}
.hudBtn.warn{
  border-color: rgba(245,158,11,.35);
  background: rgba(245,158,11,.16);
}
.hudBtn.bad{
  border-color: rgba(239,68,68,.35);
  background: rgba(239,68,68,.16);
}

/* ---------- Boss / Storm HUD (top center) ---------- */
#bossHud, #stormHud{
  left: 50%;
  transform: translateX(-50%);
  top: calc(var(--sat) + 10px);
  width: min(520px, calc(100vw - (var(--sal) + var(--sar) + 40px)));
}
#stormHud{ top: calc(var(--sat) + 54px); }

.phaseCard{
  background: rgba(2,6,23,.64);
  border:1px solid rgba(148,163,184,.18);
  border-radius: var(--radius);
  padding:10px 12px;
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 48px rgba(0,0,0,.22);
}
.phaseTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.phaseTitle{
  font-weight:1000;
  letter-spacing:.2px;
}
.phaseHint{
  font-size:12px;
  color:var(--muted);
  text-align:right;
}
.phaseProg{
  margin-top:8px;
  height:10px;
  border-radius:999px;
  background: rgba(15,23,42,.55);
  border:1px solid rgba(148,163,184,.18);
  overflow:hidden;
}
.phaseProg > i{
  display:block;
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(245,158,11,.95), rgba(239,68,68,.95));
}

/* ---------- Start overlay / Pause overlay / Result ---------- */
#startOverlay,
#hudPaused,
#resultBackdrop{
  position:fixed;
  inset:0;
  z-index:80;
  display:grid;
  place-items:center;
  padding: calc(var(--sat) + 16px) calc(var(--sar) + 16px)
           calc(var(--sab) + 16px) calc(var(--sal) + 16px);
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
}

#hudPaused{ display:none; }
#resultBackdrop{ display:none; }

.modal{
  width:min(720px, 100%);
  background: rgba(2,6,23,.90);
  border:1px solid rgba(148,163,184,.22);
  border-radius: 26px;
  padding: 18px 18px;
  box-shadow: 0 30px 90px rgba(0,0,0,.35);
}
.modal h1{
  margin:0;
  font-size:20px;
  letter-spacing:.2px;
}
.modal p{
  margin:10px 0 0 0;
  color:var(--muted);
  line-height:1.35;
}
.modal .row{
  margin-top:14px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  justify-content:flex-end;
}
.modal .bigBtn{
  appearance:none;
  border:none;
  padding:12px 14px;
  border-radius: var(--pill);
  font-weight:1000;
  cursor:pointer;
  background: rgba(34,197,94,.18);
  border:1px solid rgba(34,197,94,.35);
  color:var(--text);
}
.modal .bigBtn.secondary{
  background: rgba(15,23,42,.65);
  border:1px solid rgba(148,163,184,.22);
}

/* ---------- FX Layer / Hit pop ---------- */
#hitFx{
  position:fixed;
  inset:0;
  z-index:70;
  pointer-events:none;
  overflow:hidden;
}
.fxPop{
  position:absolute;
  transform: translate(-50%,-50%);
  font: 1000 18px/1 system-ui;
  color:#fff;
  text-shadow: 0 6px 18px rgba(0,0,0,.35);
  animation: popUp .55s ease both;
}
@keyframes popUp{
  0%{ opacity:0; transform:translate(-50%,-50%) scale(.7); }
  20%{ opacity:1; transform:translate(-50%,-62%) scale(1.05); }
  100%{ opacity:0; transform:translate(-50%,-92%) scale(.92); }
}

/* ---------- Responsive tuning ---------- */
@media (max-width: 520px){
  :root{
    --hudTopH: 142px;
    --hudBottomH: 116px;
    --targetSize: 58px;
  }
  #hudTop{ gap:8px; }
  .hudCard{ padding:10px 10px; border-radius: 18px; }
  #uiFeverWrap{ width: 92px; }
  #coachPanel{ width: min(100%, calc(100vw - (var(--sal)+var(--sar) + 24px))); }
  .hudBtn{ padding:10px 11px; }
}

@media (min-width: 980px){
  :root{
    --hudTopH: 122px;
    --hudBottomH: 96px;
    --targetSize: 54px;
  }
}

/* ---------- View mode tweaks ---------- */
body.view-vr #coachPanel,
body.view-cvr #coachPanel{
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(var(--sab) + 12px);
  width: min(640px, calc(100vw - (var(--sal)+var(--sar) + 40px)));
}
body.view-cvr #plate-layer{
  /* cVR: keep bigger safe margins to reduce nausea + avoid HUD */
  padding:
    calc(var(--sat) + var(--hudTopH) + 6px)
    calc(var(--sar) + 14px)
    calc(var(--sab) + var(--hudBottomH) + 10px)
    calc(var(--sal) + 14px);
}

/* ---------- Accessibility ---------- */
button:focus-visible{
  outline: 2px solid rgba(34,211,238,.85);
  outline-offset: 2px;
}

/* ---------- Optional hide panels in VR to increase play area ---------- */
body.view-vr .hudLabel,
body.view-vr .hudTiny{ display:none; }