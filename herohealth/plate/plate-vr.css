/* === /herohealth/plate/plate-vr.css ===
Balanced Plate VR — PRODUCTION CSS (ROOT PATH FIXED)
✅ plate-layer fixed inset:0 (กันเป้าหลุด/ไปล่างขวา)
✅ z-index layering ชัดเจน (scene < targets < HUD < overlays)
✅ ลดอาการเป้าแว๊บ ๆ (gpu + backface-visibility + will-change)
✅ Responsive PC/Mobile/VR Cardboard
✅ Safe-area + HUD ไม่ทับพื้นที่เล่น
*/

:root{
  color-scheme: dark;

  --bg:#020617;
  --panel: rgba(2,6,23,.78);
  --panel2: rgba(15,23,42,.68);
  --stroke: rgba(148,163,184,.18);
  --text: #e5e7eb;
  --muted:#94a3b8;

  --good:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;

  --radius:18px;
  --radius2:22px;
  --pill:999px;

  --hudZ: 50;
  --overlayZ: 80;
  --targetZ: 30;
  --sceneZ: 1;

  /* safe-area */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;
}

*{ box-sizing:border-box; }

html, body{
  width:100%;
  height:100%;
  margin:0;
  padding:0;
  overflow:hidden;
  background: var(--bg);
  color: var(--text);
}

body{
  /* กัน bounce / highlight */
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

/* ===== A-Frame scene sits behind ===== */
a-scene#scene{
  position: fixed !important;
  inset: 0 !important;
  z-index: var(--sceneZ) !important;
}

/* ===== Play layer (targets) =====
   สำคัญมาก: fixed + inset 0 กันตำแหน่งเพี้ยน/หลุด/ไปล่างขวา */
#plate-layer{
  position: fixed;
  inset: 0;
  z-index: var(--targetZ);
  pointer-events: none; /* เป้าเป็น button เองค่อย pointer-events:auto */
  overflow: hidden;

  /* ลดอาการ “แว๊บ” */
  transform: translate3d(0,0,0);
  will-change: transform;
  backface-visibility: hidden;
}

/* Hit FX overlay */
#hitFx{
  position: fixed;
  inset: 0;
  z-index: calc(var(--targetZ) + 1);
  pointer-events: none;
  opacity: 0;
  transition: opacity .12s ease;
}

/* ===== TOP HUD ===== */
#hudTop{
  position: fixed;
  left: calc(10px + var(--sal));
  right: calc(10px + var(--sar));
  top: calc(10px + var(--sat));
  z-index: var(--hudZ);

  background: linear-gradient(180deg, rgba(15,23,42,.62), rgba(2,6,23,.62));
  border: 1px solid var(--stroke);
  border-radius: var(--radius2);
  padding: 10px 10px;
  box-shadow: 0 22px 70px rgba(0,0,0,.40);
  backdrop-filter: blur(10px);
}

.hudRow{
  display: grid;
  grid-template-columns: repeat(6, minmax(0,1fr));
  gap: 8px;
}

.hudStat{
  background: rgba(2,6,23,.52);
  border: 1px solid rgba(148,163,184,.14);
  border-radius: 14px;
  padding: 8px 8px;
  min-height: 44px;
}

.hudStat .k{
  font-size: 11px;
  font-weight: 1000;
  color: rgba(148,163,184,.95);
  letter-spacing: .2px;
}

.hudStat .v{
  margin-top: 3px;
  font-size: 16px;
  font-weight: 1100;
  line-height: 1.1;
}

.muted{ color: rgba(148,163,184,.95); font-weight: 900; }

.plateChip{
  border-color: rgba(34,197,94,.22);
  background: rgba(34,197,94,.10);
}
.gradeChip{
  border-color: rgba(250,204,21,.20);
  background: rgba(250,204,21,.08);
}
.timeChip{
  border-color: rgba(34,211,238,.18);
  background: rgba(34,211,238,.06);
}

.hudRow2{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  margin-top: 8px;
  flex-wrap: wrap;
}

.feverWrap{
  display:flex;
  gap:10px;
  align-items:center;
}

.feverLabel{
  font-size: 11px;
  font-weight: 1100;
  color: rgba(148,163,184,.95);
}

.feverBar{
  width: 160px;
  height: 10px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.50);
  overflow:hidden;
}

.feverFill{
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(250,204,21,.95), rgba(239,68,68,.95));
  transition: width .14s ease;
}

.shieldPill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(15,23,42,.52);
  border: 1px solid rgba(148,163,184,.16);
  font-weight: 1100;
}

.plateCounts{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap: wrap;
}

.pill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(2,6,23,.52);
  border: 1px solid rgba(148,163,184,.14);
  font-weight: 1100;
}

/* ===== COACH ===== */
#coachPanel{
  position: fixed;
  left: calc(10px + var(--sal));
  bottom: calc(92px + var(--sab));
  z-index: var(--hudZ);

  display:flex;
  gap:10px;
  align-items:center;

  background: rgba(2,6,23,.62);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 22px;
  padding: 10px 12px;
  box-shadow: 0 22px 70px rgba(0,0,0,.40);
  backdrop-filter: blur(10px);
  max-width: min(420px, calc(100vw - 20px - var(--sal) - var(--sar)));
}

#coachImg{
  width: 54px;
  height: 54px;
  border-radius: 18px;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.55);
  box-shadow: 0 16px 40px rgba(0,0,0,.32);
}

.coachName{ font-weight:1100; font-size: 13px; }
.coachMsg{ color: rgba(229,231,235,.95); font-weight: 900; font-size: 12px; line-height: 1.25; margin-top: 2px; }

/* ===== QUEST PANEL (Goal/Mini) ===== */
#miniPanel{
  position: fixed;
  right: calc(10px + var(--sar));
  bottom: calc(92px + var(--sab));
  z-index: var(--hudZ);

  width: min(420px, calc(100vw - 20px - var(--sal) - var(--sar)));
  display: grid;
  gap: 10px;
}

.questBlock{
  background: rgba(2,6,23,.62);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 22px;
  padding: 10px 12px;
  box-shadow: 0 22px 70px rgba(0,0,0,.36);
  backdrop-filter: blur(10px);
}

.questHdr{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  flex-wrap: wrap;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 1100;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.50);
}

.badgeGoal{
  border-color: rgba(34,197,94,.24);
  background: rgba(34,197,94,.10);
}
.badgeMini{
  border-color: rgba(250,204,21,.24);
  background: rgba(250,204,21,.10);
}

.qTitle{ font-weight:1100; font-size: 12px; color: rgba(229,231,235,.95); }
.qCount{ font-weight:1000; font-size: 12px; color: rgba(148,163,184,.95); }

.bar{
  margin-top: 8px;
  height: 10px;
  border-radius: 999px;
  overflow:hidden;
  border: 1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.50);
}
.barFill{
  height: 100%;
  width: 0%;
  background: rgba(34,197,94,.95);
  transition: width .14s ease;
}
.barFill.mini{
  background: rgba(250,204,21,.95);
}

.hint{
  margin-top: 8px;
  font-size: 11px;
  font-weight: 900;
  color: rgba(148,163,184,.95);
  line-height: 1.3;
}

/* ===== Bottom buttons ===== */
#hudBtns{
  position: fixed;
  left: calc(10px + var(--sal));
  right: calc(10px + var(--sar));
  bottom: calc(10px + var(--sab));
  z-index: var(--hudZ);

  display:flex;
  gap:10px;
  justify-content:center;
  align-items:center;

  background: rgba(2,6,23,.58);
  border: 1px solid rgba(148,163,184,.16);
  border-radius: 999px;
  padding: 10px;
  box-shadow: 0 22px 70px rgba(0,0,0,.40);
  backdrop-filter: blur(10px);
}

.btn{
  appearance:none;
  border: 1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.58);
  color: rgba(229,231,235,.95);
  border-radius: 14px;
  padding: 10px 12px;
  font-weight: 1100;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform: translateY(1px); }

.btn.ghost{
  background: rgba(2,6,23,.48);
}

/* ===== Paused overlay ===== */
#hudPaused{
  position: fixed;
  inset: 0;
  z-index: var(--overlayZ);
  display:none;
  place-items:center;
  background: rgba(2,6,23,.55);
  backdrop-filter: blur(8px);
}

.pausedCard{
  width: min(460px, calc(100vw - 28px));
  border-radius: 22px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.82);
  box-shadow: 0 22px 70px rgba(0,0,0,.45);
  padding: 16px;
}
.pausedTitle{ font-size: 16px; font-weight: 1100; }
.pausedText{ margin-top: 8px; color: rgba(148,163,184,.95); font-weight: 900; }

/* ===== Start overlay ===== */
#startOverlay{
  position: fixed;
  inset: 0;
  z-index: var(--overlayZ);
  display:none;
  place-items:center;
  background: radial-gradient(circle at top left, rgba(34,211,238,.10), transparent 55%),
              radial-gradient(circle at bottom right, rgba(34,197,94,.10), transparent 60%),
              rgba(2,6,23,.72);
  backdrop-filter: blur(12px);
}

.startCard{
  width: min(520px, calc(100vw - 28px));
  border-radius: 24px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.86);
  box-shadow: 0 22px 70px rgba(0,0,0,.52);
  padding: 16px;
}

.startTitle{ font-size: 18px; font-weight: 1200; }
.startSub{
  margin-top: 8px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  line-height: 1.35;
}
.startMeta{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  margin-top: 10px;
}
.metaPill{
  display:inline-flex; gap:8px; align-items:center;
  padding: 8px 12px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.58);
  font-weight: 1100;
}
.startBtns{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  margin-top: 12px;
  flex-wrap:wrap;
}
.btn.big{
  padding: 12px 16px;
  border-radius: 16px;
}
.startFoot{
  margin-top: 10px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  font-size: 12px;
}

/* ===== Result overlay ===== */
#resultBackdrop{
  position: fixed;
  inset: 0;
  z-index: var(--overlayZ);
  display:none;
  place-items:center;
  background: rgba(2,6,23,.68);
  backdrop-filter: blur(10px);
}

.resultCard{
  width: min(720px, calc(100vw - 28px));
  border-radius: 24px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.86);
  box-shadow: 0 22px 70px rgba(0,0,0,.55);
  padding: 16px;
}

.resultTitle{ font-size: 18px; font-weight: 1200; }
.resultGrid{
  margin-top: 10px;
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap:10px;
}
.resultItem{
  background: rgba(15,23,42,.55);
  border: 1px solid rgba(148,163,184,.14);
  border-radius: 16px;
  padding: 10px 12px;
}
.resultItem .k{ font-size: 11px; color: rgba(148,163,184,.95); font-weight: 1000; }
.resultItem .v{ margin-top: 4px; font-size: 16px; font-weight: 1100; }

.resultPlate{
  margin-top: 10px;
  background: rgba(15,23,42,.45);
  border: 1px solid rgba(148,163,184,.14);
  border-radius: 18px;
  padding: 10px 12px;
}
.plateRow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.totalRow{
  margin-top: 8px;
  font-weight: 1100;
  color: rgba(229,231,235,.95);
}
.resultBtns{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-top: 12px;
  flex-wrap:wrap;
}

/* ===== TARGET STYLE (important) ===== */
.plateTarget{
  pointer-events: auto;
  /* กัน flash/flicker */
  backface-visibility: hidden;
  transform: translate3d(0,0,0);
  will-change: transform, opacity;
  outline: none;

  /* pop-in animation */
  animation: platePop .10s ease-out;
}

@keyframes platePop{
  0%{ transform: translate3d(0,0,0) scale(.90); opacity:.0; }
  100%{ transform: translate3d(0,0,0) scale(1); opacity:1; }
}

/* hover/active feel */
.plateTarget:active{
  transform: translate3d(0,0,0) scale(.98);
}

/* ===== Responsive ===== */
@media (max-width: 980px){
  .hudRow{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  .feverBar{ width: 140px; }
  #miniPanel{ width: min(420px, calc(100vw - 20px - var(--sal) - var(--sar))); }
}

@media (max-width: 720px){
  #coachPanel{
    left: calc(10px + var(--sal));
    right: calc(10px + var(--sar));
    bottom: calc(96px + var(--sab));
    max-width: none;
  }
  #miniPanel{
    left: calc(10px + var(--sal));
    right: calc(10px + var(--sar));
    bottom: calc(170px + var(--sab));
    width: auto;
  }
  .resultGrid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}

/* ===== VR view helpers ===== */
body.view-vr #hudTop,
body.view-vr #miniPanel,
body.view-vr #coachPanel,
body.view-vr #hudBtns{
  /* VR/Cardboard: ลดความสูงเพื่อไม่บังกลางจอ */
  opacity: .96;
}

body.view-cvr #plate-layer{
  /* โหมด crosshair strict: layer ยังอยู่ แต่เป้าต้องกดได้ */
  pointer-events: none; /* ถ้าจะใช้ยิงกลางจอ ให้ปิดกด */
}

/* ถ้ามีปุ่ม enterVR ซ้อนกับ HUD ให้ยก z-index overlay/start สูงกว่า HUD อยู่แล้ว */