/* === /herohealth/plate/plate-vr.css ===
Balanced Plate VR â€” PRODUCTION CSS (HHA Standard + Safe-area + HUD + FX + H++)
âœ… HUD Top / Quest / Coach / Buttons / Overlays
âœ… Targets: .plateTarget (emoji)
âœ… FX: hitFx pulse + shake/blink/tick (fallback) + PERFECT spark ring (H++)
âœ… Slowmo vibe class: body.hha-slowmo
âœ… Grade crown/shimmer: SSS ðŸ‘‘
*/

:root{
  color-scheme: dark;
  --bg:#020617;
  --panel:rgba(2,6,23,.78);
  --panel2:rgba(15,23,42,.68);
  --stroke:rgba(148,163,184,.18);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;
  --gold:#facc15;

  --radius-lg:18px;
  --radius-pill:999px;

  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  --shadow: 0 22px 70px rgba(0,0,0,.40);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
}

*{ box-sizing:border-box; }
html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  overflow:hidden;
  background: radial-gradient(circle at top left, rgba(56,189,248,.18), transparent 60%),
              radial-gradient(circle at bottom right, rgba(34,197,94,.18), transparent 60%),
              var(--bg);
  color:var(--text);
}

/* --- A-Frame embedded stays behind --- */
a-scene{ position:fixed !important; inset:0; z-index:1; }

/* --- Play layer --- */
#plate-layer{
  position:fixed;
  inset:0;
  z-index:10;
  pointer-events:auto;
  transform: translate(0px,0px) translateZ(0);
}

/* --- Hit FX overlay --- */
#hitFx{
  position:fixed; inset:0;
  z-index:60;
  pointer-events:none;
  opacity:0;
  transition: opacity .12s ease;
}

/* --- HUD Top --- */
#hudTop{
  position:fixed;
  left:calc(10px + var(--sal));
  right:calc(10px + var(--sar));
  top:calc(10px + var(--sat));
  z-index:50;
  background:linear-gradient(180deg, rgba(2,6,23,.80), rgba(2,6,23,.55));
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  padding:10px 10px 8px 10px;
}

.hudRow{
  display:flex;
  gap:10px;
  align-items:stretch;
  justify-content:space-between;
  flex-wrap:wrap;
}

.hudStat{
  min-width: 92px;
  flex: 1 1 auto;
  background: rgba(15,23,42,.45);
  border:1px solid rgba(148,163,184,.14);
  border-radius:16px;
  padding:8px 10px;
  box-shadow: 0 14px 40px rgba(0,0,0,.25);
}
.hudStat .k{
  color:rgba(148,163,184,.95);
  font-weight:1000;
  font-size:11px;
  letter-spacing:.2px;
}
.hudStat .v{
  font-weight:1200;
  font-size:16px;
  margin-top:2px;
  white-space:nowrap;
}
.muted{ color:rgba(148,163,184,.95); font-weight:900; }

.hudStat.plateChip{
  border-color: rgba(34,197,94,.22);
  background: rgba(34,197,94,.10);
}
.hudStat.timeChip{
  border-color: rgba(34,211,238,.22);
  background: rgba(34,211,238,.08);
}
.hudStat.gradeChip{
  border-color: rgba(250,204,21,.22);
  background: rgba(250,204,21,.08);
  position:relative;
  overflow:hidden;
}

/* Grade crown/shimmer â€” driven by data-grade on the gradeChip */
.hudStat.gradeChip[data-grade="SSS"] .v::after{ content:" ðŸ‘‘"; }
.hudStat.gradeChip[data-grade="SS"]  .v::after{ content:" âœ¨"; }

.hudStat.gradeChip[data-grade="SSS"]::before{
  content:"";
  position:absolute; inset:-40%;
  background: conic-gradient(from 0deg,
    rgba(250,204,21,0) 0%,
    rgba(250,204,21,.18) 12%,
    rgba(255,255,255,.10) 18%,
    rgba(250,204,21,0) 30%,
    rgba(250,204,21,0) 100%);
  animation: hhaSSSShine 1.8s linear infinite;
  pointer-events:none;
  opacity:.35;
}
@keyframes hhaSSSShine{
  0%{ transform: rotate(0deg); }
  100%{ transform: rotate(360deg); }
}

.hudRow2{
  margin-top:8px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}

/* Fever */
.feverWrap{
  display:flex;
  gap:10px;
  align-items:center;
  flex: 1 1 320px;
}
.feverLabel{
  font-weight:1100;
  font-size:12px;
  color:rgba(148,163,184,.95);
}
.feverBar{
  height:12px;
  flex:1;
  background: rgba(15,23,42,.55);
  border:1px solid rgba(148,163,184,.14);
  border-radius:999px;
  overflow:hidden;
}
.feverFill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(250,204,21,.95), rgba(239,68,68,.95));
  border-radius:999px;
  transition: width .14s ease;
}
.shieldPill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.55);
  font-weight:1100;
  white-space:nowrap;
}

/* Plate counts */
.plateCounts{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-end;
  flex: 0 0 auto;
}
.plateCounts .pill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.45);
  font-weight:1100;
}

/* --- Coach panel --- */
#coachPanel{
  position:fixed;
  left:calc(10px + var(--sal));
  top:calc(132px + var(--sat));
  z-index:48;
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 12px;
  border-radius:18px;
  border:1px solid var(--stroke);
  background: rgba(2,6,23,.70);
  backdrop-filter: blur(12px);
  box-shadow: 0 20px 60px rgba(0,0,0,.35);
  max-width:min(360px, calc(100vw - 24px - var(--sal) - var(--sar)));
}

#coachPanel img{
  width:56px;
  height:56px;
  border-radius:16px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.45);
  box-shadow: 0 18px 44px rgba(0,0,0,.28);
}

.coachName{
  font-weight:1200;
  font-size:12px;
  color:rgba(148,163,184,.95);
}
.coachMsg{
  font-weight:1100;
  font-size:13px;
  line-height:1.2;
  margin-top:2px;
}

/* --- Quest panel --- */
#miniPanel{
  position:fixed;
  right:calc(10px + var(--sar));
  top:calc(132px + var(--sat));
  z-index:48;
  width:min(420px, calc(100vw - 24px - var(--sal) - var(--sar)));
  display:flex;
  flex-direction:column;
  gap:10px;
}
.questBlock{
  border-radius:18px;
  border:1px solid var(--stroke);
  background: rgba(2,6,23,.70);
  backdrop-filter: blur(12px);
  box-shadow: 0 20px 60px rgba(0,0,0,.35);
  padding:10px 12px;
}
.questHdr{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}
.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.50);
  font-weight:1200;
  font-size:11px;
  white-space:nowrap;
}
.badgeGoal{ border-color: rgba(34,197,94,.22); background: rgba(34,197,94,.10); }
.badgeMini{ border-color: rgba(250,204,21,.22); background: rgba(250,204,21,.10); }

.qTitle{
  flex:1;
  font-weight:1100;
  font-size:12px;
  color:rgba(229,231,235,.95);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.qCount{
  font-weight:1100;
  font-size:12px;
  color:rgba(148,163,184,.95);
  white-space:nowrap;
}
.bar{
  margin-top:8px;
  height:10px;
  background: rgba(15,23,42,.55);
  border:1px solid rgba(148,163,184,.14);
  border-radius:999px;
  overflow:hidden;
}
.barFill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(34,211,238,.95));
  border-radius:999px;
  transition: width .14s ease;
}
.barFill.mini{
  background: linear-gradient(90deg, rgba(250,204,21,.95), rgba(239,68,68,.95));
}
.hint{
  margin-top:8px;
  color:rgba(148,163,184,.95);
  font-weight:900;
  font-size:12px;
  line-height:1.25;
}

/* --- Buttons --- */
#hudBtns{
  position:fixed;
  left:calc(10px + var(--sal));
  right:calc(10px + var(--sar));
  bottom:calc(10px + var(--sab));
  z-index:50;
  display:flex;
  gap:10px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
}

.btn{
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.62);
  color: rgba(229,231,235,.95);
  border-radius:16px;
  padding:10px 12px;
  font-weight:1200;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
  box-shadow: 0 18px 44px rgba(0,0,0,.28);
  backdrop-filter: blur(12px);
}
.btn:active{ transform: translateY(1px); }
.btn.ghost{
  background: rgba(15,23,42,.42);
}
.btn.big{
  padding:12px 14px;
  border-radius:18px;
  font-size:15px;
}

/* --- Pause overlay --- */
#hudPaused{
  position:fixed; inset:0;
  z-index:90;
  display:none;
  place-items:center;
  background: rgba(2,6,23,.45);
  backdrop-filter: blur(10px);
}
.pausedCard{
  width:min(520px, calc(100vw - 28px));
  border-radius:22px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.78);
  box-shadow: var(--shadow);
  padding:16px;
  text-align:center;
}
.pausedTitle{ font-weight:1300; font-size:18px; }
.pausedText{ margin-top:6px; color:rgba(148,163,184,.95); font-weight:1000; }

/* --- Start overlay --- */
#startOverlay{
  position:fixed; inset:0;
  z-index:95;
  display:none;
  place-items:center;
  background: radial-gradient(circle at top, rgba(34,211,238,.18), transparent 55%),
              radial-gradient(circle at bottom, rgba(34,197,94,.18), transparent 55%),
              rgba(2,6,23,.55);
  backdrop-filter: blur(12px);
}
.startCard{
  width:min(640px, calc(100vw - 28px));
  border-radius:26px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.78);
  box-shadow: var(--shadow);
  padding:16px;
}
.startTitle{ font-weight:1300; font-size:18px; }
.startSub{ margin-top:6px; color:rgba(148,163,184,.95); font-weight:1000; line-height:1.35; }
.startMeta{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.metaPill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.45);
  font-weight:1100;
}
.startBtns{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.startFoot{
  margin-top:10px;
  color:rgba(148,163,184,.90);
  font-weight:900;
  font-size:12px;
}

/* --- Result overlay --- */
#resultBackdrop{
  position:fixed; inset:0;
  z-index:96;
  display:none;
  place-items:center;
  background: rgba(2,6,23,.55);
  backdrop-filter: blur(12px);
}
.resultCard{
  width:min(760px, calc(100vw - 28px));
  border-radius:26px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.80);
  box-shadow: var(--shadow);
  padding:16px;
}
.resultTitle{ font-weight:1300; font-size:18px; }
.resultGrid{
  margin-top:10px;
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap:10px;
}
@media (max-width:720px){
  .resultGrid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}
.resultItem{
  border-radius:16px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.45);
  padding:10px 12px;
}
.resultItem .k{ color:rgba(148,163,184,.95); font-weight:1000; font-size:11px; }
.resultItem .v{ margin-top:2px; font-weight:1300; font-size:16px; }

.resultPlate{
  margin-top:10px;
  border-radius:18px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.40);
  padding:12px;
}
.plateRow{ display:flex; flex-wrap:wrap; gap:8px; }
.totalRow{ margin-top:8px; color:rgba(148,163,184,.95); font-weight:1000; }

.resultBtns{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

/* --- Targets --- */
.plateTarget{
  position:fixed;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.55);
  backdrop-filter: blur(8px);
  box-shadow: 0 18px 44px rgba(0,0,0,.28);
  display:grid;
  place-items:center;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
  transform: translateZ(0);
  animation: plateFloat 1.25s ease-in-out infinite;
}
@keyframes plateFloat{
  0%{ transform: translateZ(0) translateY(0px) scale(1); }
  50%{ transform: translateZ(0) translateY(-2px) scale(1.02); }
  100%{ transform: translateZ(0) translateY(0px) scale(1); }
}

/* --- Judge / Perfect overlays created by plate-hud.js --- */
.hha-judge{
  position:fixed;
  left:50%;
  top:calc(50% - 12px);
  transform: translate(-50%,-50%) translateZ(0);
  z-index:88;
  pointer-events:none;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(2,6,23,.72);
  color:rgba(229,231,235,.95);
  font-weight:1200;
  box-shadow: 0 18px 70px rgba(0,0,0,.35);
  opacity:0;
  transition: opacity .14s ease, transform .14s ease;
  white-space:nowrap;
}
.hha-judge.show{
  opacity:1;
  transform: translate(-50%,-50%) translateY(-4px) translateZ(0);
}
.hha-judge.good{ border-color: rgba(34,197,94,.22); background: rgba(34,197,94,.10); }
.hha-judge.warn{ border-color: rgba(250,204,21,.24); background: rgba(250,204,21,.10); }
.hha-judge.bad { border-color: rgba(239,68,68,.22); background: rgba(239,68,68,.10); }
.hha-judge.perfect{ border-color: rgba(250,204,21,.24); background: rgba(250,204,21,.10); }

.hha-perfect{
  position:fixed;
  z-index:89;
  pointer-events:none;
  transform: translate(-50%,-50%) translateZ(0);
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(250,204,21,.24);
  background: rgba(250,204,21,.10);
  color:rgba(229,231,235,.95);
  font-weight:1300;
  box-shadow: 0 18px 70px rgba(0,0,0,.35);
  animation: hhaPerfectPop .65s ease-out forwards;
  white-space:nowrap;
}
@keyframes hhaPerfectPop{
  0%{ opacity:0; transform: translate(-50%,-50%) scale(.9); }
  20%{ opacity:1; transform: translate(-50%,-56%) scale(1.0); }
  100%{ opacity:0; transform: translate(-50%,-70%) scale(1.05); }
}

/* --- Slowmo vibe (H++) --- */
body.hha-slowmo{
  filter: saturate(1.06) contrast(1.05);
}
body.hha-slowmo #hudTop{
  box-shadow: var(--shadow), 0 0 0 1px rgba(34,211,238,.14), 0 16px 80px rgba(34,211,238,.14);
}
body.hha-slowmo .plateTarget{
  animation-duration: 2.05s !important;
}

/* --- PERFECT spark ring (H++) --- */
.hha-spark{
  position:fixed;
  z-index:89;
  pointer-events:none;
  left:0; top:0;
  width: 22px;
  height: 22px;
  transform: translate(-50%,-50%) translateZ(0);
}
.hha-spark::before{
  content:"";
  position:absolute; inset:-28px;
  border-radius:999px;
  border:2px solid rgba(250,204,21,.45);
  box-shadow:
    0 0 0 1px rgba(250,204,21,.14),
    0 18px 70px rgba(0,0,0,.35);
  background: radial-gradient(circle at center,
    rgba(250,204,21,.22) 0%,
    rgba(250,204,21,.12) 22%,
    rgba(0,0,0,0) 62%);
  animation: hhaSparkRing .42s ease-out forwards;
}
.hha-spark::after{
  content:"";
  position:absolute; inset:-36px;
  border-radius:999px;
  background: conic-gradient(from 0deg,
    rgba(250,204,21,0) 0%,
    rgba(250,204,21,.35) 8%,
    rgba(255,255,255,.18) 12%,
    rgba(250,204,21,0) 18%,
    rgba(250,204,21,0) 100%);
  filter: blur(.15px);
  animation: hhaSparkSpin .42s ease-out forwards;
}
@keyframes hhaSparkRing{
  0%{ opacity:0; transform: scale(.55); }
  25%{ opacity:1; transform: scale(1.0); }
  100%{ opacity:0; transform: scale(1.35); }
}
@keyframes hhaSparkSpin{
  0%{ opacity:0; transform: rotate(0deg) scale(.70); }
  25%{ opacity:1; transform: rotate(120deg) scale(1.0); }
  100%{ opacity:0; transform: rotate(320deg) scale(1.25); }
}

/* --- Responsive tweaks --- */
@media (max-width:860px){
  #coachPanel{
    top:calc(154px + var(--sat));
    max-width: calc(100vw - 24px - var(--sal) - var(--sar));
  }
  #miniPanel{
    top:calc(154px + var(--sat));
    width: calc(100vw - 24px - var(--sal) - var(--sar));
  }
}
@media (max-width:720px){
  .hudStat{ min-width: 86px; }
  .hudStat .v{ font-size:15px; }
}

/* --- Fallback minimal FX classes used by plate.safe.js --- */
.pfx-shake { animation:pfxShake .18s ease-in-out 0s 2; }
@keyframes pfxShake { 0%{transform:translate(0,0)} 25%{transform:translate(2px,0)} 50%{transform:translate(-2px,1px)} 75%{transform:translate(1px,-1px)} 100%{transform:translate(0,0)} }
.pfx-blink { animation:pfxBlink .26s ease-in-out 0s 6; }
@keyframes pfxBlink { 0%,100%{filter:none} 50%{filter:brightness(1.35)} }
.pfx-tick { animation:pfxTick .12s linear 0s 1; }
@keyframes pfxTick { 0%{transform:scale(1)} 50%{transform:scale(1.03)} 100%{transform:scale(1)} }
#hitFx.pfx-hit-good{opacity:1; background:radial-gradient(circle at center, rgba(34,197,94,.18), transparent 55%);}
#hitFx.pfx-hit-bad {opacity:1; background:radial-gradient(circle at center, rgba(239,68,68,.18), transparent 55%);}