:root{
  color-scheme: dark;
  --bg-main:#020617;
  --panel:#020617;
  --panel-soft:#020617;
  --panel-soft2:#0b1120;
  --accent:#22c55e;
  --accent-soft:rgba(34,197,94,0.18);
  --accent-alt:#38bdf8;
  --text-main:#e5e7eb;
  --text-soft:#9ca3af;
  --danger:#fb7185;
  --radius-lg:18px;
  --radius-pill:999px;
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  min-height:100vh;
  margin:0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Thonburi",sans-serif;
  background:#020617;
  color:var(--text-main);
  overflow:hidden;
}

.app{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
  background:
    radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
}

/* ======= A-Frame Scene ======= */
#scene-wrap{
  position:absolute;
  inset:0;
  z-index:1;
}
a-scene{
  width:100%;
  height:100%;
}

/* ======= HUD ======= */
#hud{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:400;
  padding:10px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.hud-top{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}

.hud-left{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.hud-title{
  font-size:14px;
  font-weight:600;
  display:flex;
  align-items:center;
  gap:6px;
}
.hud-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:11px;
  padding:2px 10px;
  border-radius:var(--radius-pill);
  background:rgba(15,23,42,0.95);
  border:1px solid rgba(148,163,184,0.5);
}
.hud-pill span.label{
  color:var(--text-soft);
}

.hud-info-row{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.hud-badge{
  font-size:11px;
  padding:3px 10px;
  border-radius:var(--radius-pill);
  background:rgba(15,23,42,0.9);
  border:1px solid rgba(148,163,184,0.35);
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.hud-badge strong{
  font-weight:600;
  color:var(--accent);
}
.hud-badge span.value{
  font-variant-numeric:tabular-nums;
}

.hud-right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}

.hud-timer{
  font-size:13px;
  padding:4px 12px;
  border-radius:var(--radius-pill);
  background:rgba(15,23,42,0.92);
  border:1px solid rgba(148,163,184,0.6);
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.hud-timer span.icon{font-size:14px;}
.hud-timer span.value{
  font-variant-numeric:tabular-nums;
  font-weight:600;
  color:#fee2e2;
}

.hud-groups{
  font-size:11px;
  padding:4px 10px;
  border-radius:var(--radius-pill);
  background:rgba(15,23,42,0.9);
  border:1px solid rgba(148,163,184,0.35);
  color:var(--text-soft);
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.hud-groups span strong{
  font-weight:600;
  color:var(--accent-alt);
  font-variant-numeric:tabular-nums;
}

/* ===== แผนที่หมู่อาหาร ===== */
.hud-groups-legend{
  margin-top:4px;
  font-size:10px;
  color:var(--text-soft);
  display:flex;
  flex-wrap:wrap;
  gap:6px 10px;
}
.hud-groups-legend span{
  white-space:nowrap;
}

/* ===== เกรดบน HUD ให้สีต่างกัน ===== */
.hud-badge-grade .value{
  font-weight:700;
}

.hud-badge-grade-SSS .value{
  color:#22c55e;
}
.hud-badge-grade-SS .value{
  color:#4ade80;
}
.hud-badge-grade-S .value{
  color:#38bdf8;
}
.hud-badge-grade-A .value{
  color:#60a5fa;
}
.hud-badge-grade-B .value{
  color:#eab308;
}
.hud-badge-grade-C .value{
  color:#9ca3af;
}

/* ======= Quest Panel ======= */
#quest-panel{
  position:absolute;
  right:10px;
  top:72px;
  width:260px;
  max-width:60vw;
  z-index:410;
  pointer-events:none;
}
.quest-card{
  background:rgba(15,23,42,0.96);
  border-radius:var(--radius-lg);
  border:1px solid rgba(148,163,184,0.6);
  box-shadow:0 18px 40px rgba(0,0,0,0.8);
  padding:10px 12px;
  font-size:11px;
}
.quest-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}
.quest-header span.title{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.06em;
  color:var(--text-soft);
}
.quest-header span.icon{
  font-size:14px;
}
.quest-section{
  margin-bottom:6px;
}
.quest-label{
  font-size:11px;
  color:var(--text-soft);
  margin-bottom:2px;
}
.quest-text{
  font-size:11px;
  line-height:1.4;
}
.quest-hint{
  font-size:10px;
  color:var(--accent-alt);
  margin-top:4px;
}

/* progress list (Goal / Mini / จานนี้) */
.quest-progress-list{
  margin-top:4px;
  border-top:1px dashed rgba(148,163,184,0.5);
  padding-top:4px;
  font-size:10px;
}
.quest-progress-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:2px;
}
.quest-progress-label{
  color:var(--text-soft);
}
.quest-progress-value{
  font-variant-numeric:tabular-nums;
}
.quest-progress-value.success{
  color:#4ade80;
}
.quest-progress-value.warn{
  color:#fde047;
}
.quest-progress-value.danger{
  color:#fb7185;
}

/* แสดงหมู่ที่ยังขาดเป็น emoji แยกบรรทัด */
.quest-groups-line{
  margin-top:2px;
  font-size:10px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}
.quest-group-pill{
  padding:1px 6px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.4);
  background:rgba(15,23,42,0.9);
  display:inline-flex;
  align-items:center;
  gap:4px;
}
.quest-group-pill.missing{
  border-color:rgba(251,113,133,0.8);
  background:rgba(127,29,29,0.9);
  color:#fee2e2;
}

/* ======= Coach Bubble (ย้ายขึ้นเหนือ Fever) ======= */
#coach-wrap{
  position:absolute;
  left:0;
  right:0;
  bottom:72px;              /* เหนือ Fever */
  z-index:950;              /* สูงกว่า Fever (900) */
  pointer-events:none;
  display:flex;
  justify-content:center;
}
.coach-bubble{
  max-width:420px;
  padding:8px 11px;
  border-radius:16px;
  background:rgba(15,23,42,0.96);
  border:1px solid rgba(148,163,184,0.6);
  box-shadow:0 18px 40px rgba(0,0,0,0.85);
  font-size:12px;
  display:flex;
  align-items:flex-start;
  gap:8px;
  opacity:0;
  transform:translateY(8px);
  transition:opacity .25s ease, transform .25s ease;
}
.coach-bubble.show{
  opacity:1;
  transform:translateY(0);
}
.coach-avatar{
  font-size:20px;
}
.coach-text{
  line-height:1.4;
}

/* ======= Summary Overlay ======= */
#summary{
  position:absolute;
  inset:0;
  z-index:1000;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  opacity:0;
  transition:opacity .25s ease;
}
#summary.visible{
  opacity:1;
  pointer-events:auto;
}
.summary-card{
  width: min(420px, 90vw);
  background:radial-gradient(circle at top, rgba(34,197,94,0.1) 0, #020617 45%, #000 100%);
  border-radius:22px;
  border:1px solid rgba(148,163,184,0.75);
  box-shadow:0 28px 60px rgba(0,0,0,0.9);
  padding:14px 16px 12px;
  font-size:12px;
}
.summary-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:8px;
  gap:8px;
}
.summary-header h2{
  font-size:15px;
}
.summary-header p{
  font-size:11px;
  color:var(--text-soft);
}
.summary-badge{
  font-size:11px;
  padding:3px 10px;
  border-radius:var(--radius-pill);
  background:rgba(15,23,42,0.9);
  border:1px solid rgba(148,163,184,0.5);
}
.summary-grid{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr));
  gap:6px 10px;
  margin-bottom:8px;
}
.summary-item span{
  display:block;
  font-size:11px;
  color:var(--text-soft);
  margin-bottom:1px;
}
.summary-item strong{
  font-size:13px;
  font-variant-numeric:tabular-nums;
}
.summary-groups{
  font-size:11px;
  padding:6px 8px;
  border-radius:var(--radius-lg);
  background:rgba(15,23,42,0.9);
  border:1px solid rgba(148,163,184,0.45);
  margin-bottom:8px;
  color:var(--text-soft);
}
.summary-actions{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-top:4px;
}
.btn{
  border:none;
  border-radius:var(--radius-pill);
  font-size:12px;
  padding:5px 12px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.btn-primary{
  background:var(--accent);
  color:#022c22;
}
.btn-ghost{
  background:transparent;
  color:var(--text-soft);
  border:1px solid rgba(148,163,184,0.5);
}

/* ===== Toast ฉลองจบแต่ละภารกิจ ===== */
#quest-toast{
  position:absolute;
  left:50%;
  top:18%;
  transform:translateX(-50%);
  z-index:960;
  pointer-events:none;
  opacity:0;
  transition:opacity .25s ease, transform .25s ease;
}
#quest-toast.show{
  opacity:1;
  transform:translate(-50%, 0);
}
.quest-toast-inner{
  background:radial-gradient(circle at top, rgba(34,197,94,0.18) 0, #020617 55%);
  border-radius:18px;
  border:1px solid rgba(74,222,128,0.8);
  box-shadow:0 24px 50px rgba(0,0,0,0.85);
  padding:8px 12px;
  font-size:11px;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.quest-toast-title{
  font-size:12px;
  font-weight:600;
}
.quest-toast-body{
  font-size:11px;
}
.quest-toast-tags{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-top:2px;
}
.quest-toast-tag{
  padding:1px 8px;
  border-radius:999px;
  background:rgba(15,23,42,0.9);
  border:1px solid rgba(74,222,128,0.8);
  font-size:10px;
}

/* ===== Mega celebration (ครบทุกภารกิจ) ===== */
#mega-celebration{
  position:absolute;
  inset:0;
  z-index:980;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  opacity:0;
  transition:opacity .3s ease;
}
#mega-celebration.show{
  opacity:1;
  pointer-events:auto;
}
.mega-inner{
  width:min(460px, 92vw);
  border-radius:24px;
  border:1px solid rgba(251,191,36,0.9);
  background:
    radial-gradient(circle at top, rgba(250,204,21,0.25) 0, rgba(15,23,42,0.98) 55%);
  box-shadow:0 32px 70px rgba(0,0,0,0.95);
  padding:18px 18px 14px;
  text-align:center;
}
.mega-title{
  font-size:20px;
  font-weight:700;
  margin-bottom:4px;
}
.mega-sub{
  font-size:12px;
  color:var(--text-soft);
  margin-bottom:10px;
}
.mega-badges{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:10px;
}
.mega-badge{
  padding:3px 10px;
  border-radius:999px;
  font-size:11px;
  background:rgba(15,23,42,0.95);
  border:1px solid rgba(251,191,36,0.8);
}
.mega-close{
  margin-top:4px;
  font-size:11px;
  color:var(--text-soft);
}

/* เล็กลงบนจอมือถือแนวตั้ง */
@media (max-width:768px){
  .hud-groups{
    display:none;
  }
  #quest-panel{
    top:auto;
    bottom:72px;
    right:6px;
  }
  .summary-card{
    border-radius:18px;
    padding:12px 12px 10px;
  }
  .hud-groups-legend{
    font-size:9px;
  }
  #quest-toast{
    top:16%;
  }
}

/* ====== TARGETS (เป้า emoji) ====== */

.hha-target{
  position:fixed;
  transform:translate(-50%, -50%);
  width:68px;
  height:68px;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:auto;
  cursor:pointer;
  z-index:360;
}

/* แสดง emoji จาก data-char */
.hha-target::before{
  content: attr(data-char);
  display:block;
  font-size:42px;
  line-height:1;
  text-shadow:
    0 0 8px rgba(0,0,0,0.65),
    0 0 16px rgba(0,0,0,0.7);
}

/* glow เพิ่มสำหรับของดี/ของไม่ดี */
.hha-target-good::before{
  text-shadow:
    0 0 10px rgba(34,197,94,0.9),
    0 0 20px rgba(34,197,94,0.7),
    0 0 28px rgba(34,197,94,0.55);
}

.hha-target-bad::before{
  text-shadow:
    0 0 10px rgba(248,113,113,0.9),
    0 0 20px rgba(248,113,113,0.7),
    0 0 28px rgba(248,113,113,0.55);
}

/* ===== Gaze Reticle ===== */

#gaze-reticle{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  width:26px;
  height:26px;
  pointer-events:none;
  z-index:430;
  opacity:0.8;              /* เห็นทุกโหมด */
}

.gaze-dot{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  width:4px;
  height:4px;
  border-radius:999px;
  background:rgba(248,250,252,0.96);
  box-shadow:0 0 4px rgba(248,250,252,0.9);
}

.gaze-ring{
  position:absolute;
  inset:0;
  border-radius:999px;
  border:2px solid rgba(248,250,252,0.85);
  box-shadow:0 0 10px rgba(248,250,252,0.7);
  opacity:0.8;
}

/* ตอนอยู่ใน VR ให้เป้าเด่นขึ้นนิดหนึ่ง */
body.hha-vr-mode #gaze-reticle{
  opacity:1;
}

/* animation ตอนกำลัง fuse */
#gaze-reticle.fuse-active .gaze-ring{
  animation:hhaFuse 1s linear forwards;
}

@keyframes hhaFuse{
  0%{
    transform:scale(1);
    opacity:0.85;
  }
  100%{
    transform:scale(0.25);
    opacity:0;
  }
}