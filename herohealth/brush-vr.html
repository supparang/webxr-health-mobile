<!-- === /herohealth/brush-vr.html ===
HeroHealth ‚Äî Brush (ROOT Launcher)
‚úÖ Choose view: pc / mobile / vr / cvr
‚úÖ Pass-through: hub/run/diff/time/seed/studyId/phase/conditionGroup/log/view/pid/ai
‚úÖ Remembers last view
‚úÖ Launches (default): ./hygiene-vr/hygiene-vr.html?mode=brush
   - Change RUN_PATH if you have a dedicated brush run page.
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Brush (Launcher)</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />

  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel: rgba(2,6,23,.72);
      --panel2: rgba(15,23,42,.55);
      --stroke: rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;
      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --cyan:#22d3ee; --violet:#a78bfa; --amber:#f59e0b;
      --radius:22px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial;
      background:
        radial-gradient(1200px 700px at 18% 18%, rgba(245,158,11,.10), transparent 55%),
        radial-gradient(900px 560px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 520px at 45% 92%, rgba(167,139,250,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      overflow:auto;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
    header{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      flex-wrap:wrap;padding:6px 6px 0 6px
    }
    .title{margin:0;font-size:clamp(22px,2.2vw,30px);font-weight:1000}
    .subtitle{margin:0;color:var(--muted);font-size:13px;line-height:1.4;font-weight:800;max-width:78ch}
    .pillrow{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:flex-end}
    .pill{
      background:rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      padding:8px 10px;border-radius:999px;
      font-size:12px;color:var(--muted);
      backdrop-filter: blur(8px);
      white-space:nowrap;user-select:none;font-weight:900
    }
    .pill b{color:var(--text);font-weight:1000}

    .panel{
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:0 18px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:12px 14px;border-bottom:1px solid var(--stroke);
      background:rgba(2,6,23,.35);
      flex-wrap:wrap
    }
    .big{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      font-size:13px;font-weight:1000;white-space:nowrap
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background:var(--amber);
      box-shadow:0 0 18px rgba(245,158,11,.28)
    }
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center}
    .btn{
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.42);
      padding:10px 12px;border-radius:14px;
      cursor:pointer;user-select:none;
      display:flex;align-items:center;gap:8px;
      white-space:nowrap;font-weight:1000;font-size:13px;
      transition:transform .12s ease,opacity .12s ease
    }
    .btn:active{transform:translateY(1px)}
    .btn.good{border-color:rgba(34,197,94,.25);background:rgba(34,197,94,.10)}
    .btn.ghost{color:var(--muted)}

    .body{padding:12px;display:grid;grid-template-columns:1.1fr .9fr;gap:12px}
    @media (max-width: 900px){.body{grid-template-columns:1fr}.pillrow{justify-content:flex-start}.actions{justify-content:flex-start}}
    .card{
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.40);
      border-radius:18px;
      padding:14px;
      box-shadow:0 12px 40px rgba(0,0,0,.25)
    }
    .card h3{margin:0 0 6px 0;font-size:16px;font-weight:1000}
    .card p{margin:0;color:var(--muted);font-size:13px;line-height:1.45;font-weight:800}
    .grid{margin-top:10px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width: 560px){.grid{grid-template-columns:1fr}}
    .opt{
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.28);
      border-radius:16px;
      padding:12px;
      cursor:pointer;
      user-select:none;
      transition:transform .12s ease,border-color .12s ease,background .12s ease
    }
    .opt:hover{border-color:rgba(255,255,255,.22);background:rgba(255,255,255,.06)}
    .opt:active{transform:translateY(1px)}
    .opt.on{border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.10)}
    .opt .t{font-weight:1000}
    .opt .d{margin-top:6px;color:rgba(229,231,235,.74);font-weight:800;font-size:12px;line-height:1.35}
    .row2{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    code{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:rgba(229,231,235,.92);background:rgba(0,0,0,.25);border:1px solid rgba(148,163,184,.18);padding:2px 6px;border-radius:10px;word-break:break-all}
    .toast{
      position:fixed;left:50%;
      bottom:calc(18px + var(--sab));
      transform:translateX(-50%);
      background:rgba(2,6,23,.85);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      z-index:9999;max-width:92vw;
      font-size:13px;opacity:0;
      transition:opacity .18s ease;
      pointer-events:none;font-weight:900
    }
    .toast.show{opacity:1}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1 class="title">ü™• Brush ‚Äî Launcher</h1>
        <p class="subtitle">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô ‚Ä¢ ‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Ä¢ ‡∏Å‡∏•‡∏±‡∏ö HUB ‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
        </p>
      </div>
      <div class="pillrow" id="pillrow"></div>
    </header>

    <section class="panel">
      <div class="head">
        <div class="big"><span class="dot"></span><span>Brush (Run)</span></div>
        <div class="actions">
          <div class="btn ghost" id="btnHow">‚ùì ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</div>
          <div class="btn" id="btnToHub">üè∞ ‡∏Å‡∏•‡∏±‡∏ö HUB</div>
          <div class="btn good" id="btnStart">‚ñ∂ Start</div>
        </div>
      </div>

      <div class="body">
        <div class="card">
          <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å View</h3>
          <p>‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ = <b>mobile</b> ‚Ä¢ Cardboard = <b>cvr</b> ‚Ä¢ Headset = <b>vr</b></p>

          <div class="grid" id="viewGrid">
            <div class="opt" data-view="pc"><div class="t">üñ•Ô∏è PC</div><div class="d">‡∏ó‡∏î‡∏™‡∏≠‡∏ö/‡∏î‡∏µ‡∏ö‡∏±‡∏Å</div></div>
            <div class="opt" data-view="mobile"><div class="t">üì± Mobile</div><div class="d">‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤ ‚Ä¢ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div></div>
            <div class="opt" data-view="vr"><div class="t">üï∂Ô∏è VR</div><div class="d">WebXR ‚Ä¢ ENTER VR</div></div>
            <div class="opt" data-view="cvr"><div class="t">üì¶ cVR</div><div class="d">‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair</div></div>
          </div>

          <div class="row2">
            <span class="pill"><b>view</b>: <span id="tView">‚Äî</span></span>
            <span class="pill"><b>diff</b>: <span id="tDiff">‚Äî</span></span>
            <span class="pill"><b>time</b>: <span id="tTime">‚Äî</span>s</span>
            <span class="pill"><b>pid</b>: <span id="tPid">‚Äî</span></span>
          </div>

          <div class="row2" style="margin-top:10px;">
            <span class="pill"><b>tip</b>: ‡πÄ‡∏õ‡∏¥‡∏î AI (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ play) ‡∏î‡πâ‡∏ß‡∏¢ <code>?ai=1</code></span>
          </div>
        </div>

        <div class="card">
          <h3>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏° (Run)</h3>
          <p>‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤ run ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Hygiene ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏±‡πà‡∏á‡πÇ‡∏´‡∏°‡∏î brush ‡∏î‡πâ‡∏ß‡∏¢ <code>mode=brush</code></p>
          <div class="row2" style="margin-top:10px;">
            <span class="pill"><b>run</b>: <code id="runPath">‚Äî</code></span>
          </div>
          <div class="row2" style="margin-top:10px;">
            <span class="pill"><b>goal</b>: ‡πÅ‡∏õ‡∏£‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏à‡∏∏‡∏î + ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ + ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏û‡∏•‡∏≤‡∏î (combo)</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  // ‚úÖ DEFAULT: reuse hygiene run page with mode=brush
  // üîß If you have a dedicated brush page, change RUN_PATH only.
  const RUN_PATH = './hygiene-vr/hygiene-vr.html?mode=brush';

  const PASS_KEYS = ['pid','run','diff','time','seed','studyId','phase','conditionGroup','log','view','ai'];
  const LS_VIEW = 'HHA_LAUNCHER_VIEW::brush';

  function pageUrl(){ return location.href.split('#')[0]; }
  function qs(){ try{ return new URL(pageUrl()).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = qs();

  function nowSeed(){ return String(Date.now()); }
  function detectMobile(){ return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent||''); }
  function pickDefaultView(){
    const qv = (QS.get('view')||'').trim();
    if(qv) return qv;
    try{ const last = localStorage.getItem(LS_VIEW); if(last) return last; }catch(_){}
    return detectMobile() ? 'mobile' : 'pc';
  }

  // defaults for pills
  const ctx = {
    pid: (QS.get('pid')||'').trim() || 'anon',
    run: (QS.get('run')||'play').trim() || 'play',
    diff: (QS.get('diff')||'normal').trim() || 'normal',
    time: (QS.get('time')||'80').trim() || '80',
    seed: (QS.get('seed')||'').trim() || nowSeed()
  };

  // render pills
  function esc(s){ return String(s).replace(/</g,'&lt;'); }
  function renderPills(){
    const pills = [
      ['pid', QS.get('pid') ?? ctx.pid],
      ['run', QS.get('run') ?? ctx.run],
      ['diff', QS.get('diff') ?? ctx.diff],
      ['time', QS.get('time') ?? ctx.time],
      ['seed', QS.get('seed') ?? ctx.seed],
      ['ai', QS.get('ai')],
      ['studyId', QS.get('studyId')],
      ['phase', QS.get('phase')],
      ['conditionGroup', QS.get('conditionGroup')],
      ['log', QS.get('log')]
    ].filter(x => x[1] != null && String(x[1]).trim() !== '');

    document.getElementById('pillrow').innerHTML = (pills.length ? pills : [['ctx','none']])
      .slice(0, 12)
      .map(([k,v]) => `<span class="pill"><b>${k}</b>: ${esc(v)}</span>`)
      .join('');
  }

  // toast
  const toastEl = document.getElementById('toast');
  let toastTimer=null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    toastTimer = setTimeout(()=> toastEl.classList.remove('show'), 1300);
  }

  // attach pass-through
  function applyPassThrough(href, view){
    const u = new URL(href, location.href);

    // copy incoming params first
    for (const k of PASS_KEYS){
      if (!u.searchParams.has(k) && QS.has(k)){
        const v = QS.get(k);
        if (v != null && String(v).trim() !== '') u.searchParams.set(k, v);
      }
    }

    // ensure defaults
    if(!u.searchParams.has('pid'))  u.searchParams.set('pid', ctx.pid);
    if(!u.searchParams.has('run'))  u.searchParams.set('run', ctx.run);
    if(!u.searchParams.has('diff')) u.searchParams.set('diff', ctx.diff);
    if(!u.searchParams.has('time')) u.searchParams.set('time', String(ctx.time));
    if(!u.searchParams.has('seed')) u.searchParams.set('seed', ctx.seed);
    if(view) u.searchParams.set('view', view);

    // ensure hub
    if(!u.searchParams.has('hub') || !String(u.searchParams.get('hub')||'').trim()){
      u.searchParams.set('hub', new URL('./hub.html', location.href).toString());
    }
    return u.toString();
  }

  // view selection
  const viewGrid = document.getElementById('viewGrid');
  const tView = document.getElementById('tView');
  const tDiff = document.getElementById('tDiff');
  const tTime = document.getElementById('tTime');
  const tPid  = document.getElementById('tPid');

  let selectedView = pickDefaultView();

  function setView(v){
    selectedView = v;
    try{ localStorage.setItem(LS_VIEW, v); }catch(_){}
    viewGrid.querySelectorAll('.opt[data-view]').forEach(o=>{
      o.classList.toggle('on', o.getAttribute('data-view') === v);
    });
    tView.textContent = v;
    tDiff.textContent = ctx.diff;
    tTime.textContent = ctx.time;
    tPid.textContent  = ctx.pid;
  }

  viewGrid.addEventListener('click', (ev)=>{
    const el = ev.target.closest('.opt[data-view]');
    if(!el) return;
    setView(el.getAttribute('data-view'));
    toast(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å view = ${selectedView}`);
  });

  // buttons
  document.getElementById('btnStart').addEventListener('click', ()=>{
    location.href = applyPassThrough(RUN_PATH, selectedView);
  });

  document.getElementById('btnHow').addEventListener('click', ()=>{
    toast('‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô: ‡πÅ‡∏õ‡∏£‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î (‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á/‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô) + ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ ‚Ä¢ ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏≠‡∏™‡∏Ñ‡∏£‡∏≤‡∏ö!');
  });

  document.getElementById('btnToHub').addEventListener('click', ()=>{
    const h = (QS.get('hub')||'').trim();
    location.href = h || new URL('./hub.html', location.href).toString();
  });

  // init
  document.getElementById('runPath').textContent = RUN_PATH;
  renderPills();
  setView(selectedView);
})();
</script>
</body>
</html>