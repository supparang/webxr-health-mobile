<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth · Fitness Planner (Create)</title>
  <link rel="stylesheet" href="./planner.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">HH</div>
      <div>
        <div class="ttl">Fitness Planner — Create</div>
        <div class="sub">7-day Plan Builder (Bloom: Create) · เหมาะสำหรับ ป.5</div>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn ghost" id="btnSetUrls">ตั้งค่า URL เกม</button>
      <button class="btn ghost" id="btnLoad">โหลดแผนล่าสุด</button>
      <button class="btn ghost" id="btnReset">เริ่มแผนใหม่</button>
      <button class="btn" id="btnExportMD">Export แผน (MD)</button>
      <button class="btn" id="btnExportJSON">Export JSON</button>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="panel-h">
        <h2>ตั้งค่าแผนสัปดาห์</h2>
        <div class="chips">
          <span class="chip" id="chipPid">pid: anon</span>
          <span class="chip" id="chipRun">run: play</span>
          <span class="chip" id="chipWeek">week: —</span>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="card-h">เป้าหมายสัปดาห์ (เลือก 1–2)</div>
          <div class="goal-pills" id="goalPills"></div>
          <div class="hint">แนะนำ: เลือก 1 เป้าหมายหลัก + 1 เป้าหมายรอง</div>
        </div>

        <div class="card">
          <div class="card-h">ข้อจำกัด (สมจริงสำหรับวันเรียน)</div>
          <div class="form">
            <label>วันธรรมดา จำกัดเวลา/วัน
              <select id="limitWeekday">
                <option value="8">8 นาที</option>
                <option value="10" selected>10 นาที</option>
                <option value="12">12 นาที</option>
              </select>
            </label>

            <label>เสาร์-อาทิตย์ จำกัดเวลา/วัน
              <select id="limitWeekend">
                <option value="10">10 นาที</option>
                <option value="12" selected>12 นาที</option>
                <option value="15">15 นาที</option>
              </select>
            </label>

            <label>เล่นขั้นต่ำ/สัปดาห์ (days)
              <select id="minDays">
                <option value="3">3 วัน</option>
                <option value="4" selected>4 วัน</option>
                <option value="5">5 วัน</option>
                <option value="6">6 วัน</option>
              </select>
            </label>

            <label>วันพักที่แนะนำ
              <select id="restDays">
                <option value="0">0 วัน</option>
                <option value="1" selected>1 วัน</option>
                <option value="2">2 วัน</option>
              </select>
            </label>
          </div>
          <div class="hint">ระบบจะ “เตือน” ถ้าแผนหนักเกิน/เล่นติดกันแบบเสี่ยง</div>
        </div>
      </div>

      <div class="badgesRow">
        <div class="card">
          <div class="card-h">Badges สายวางแผน</div>
          <div class="badgeGrid" id="badgeGrid"></div>
          <div class="hint">Badge ไม่ใช่คะแนนวิจัย แต่ช่วยทำให้ “Create” สนุกและมีเป้าหมาย</div>
        </div>

        <div class="card">
          <div class="card-h">Try Today</div>
          <div class="tryRow">
            <div class="mut" id="todayLabel">วันนี้: —</div>
            <button class="btn" id="btnTryToday">▶️ เล่นตามแผนวันนี้</button>
          </div>
          <div class="hint">จะพาไป “เกมแรกของวันนี้” ในแท็บเดิม (กัน popup block)</div>
          <div class="tryList" id="tryList"></div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="panel-h">
        <h2>ตาราง 7 วัน</h2>
        <div class="right">
          <button class="btn small ghost" id="btnAutoFill">Auto-Fill (แนะนำ)</button>
          <button class="btn small ghost" id="btnClearWeek">ล้างทั้งสัปดาห์</button>
        </div>
      </div>

      <div class="week-grid" id="weekGrid"></div>
      <div class="footnote">
        Tip: 1 วันเลือกได้ 0–2 เกม · รวมเวลาต่อวันควรอยู่ในข้อจำกัด · Energy/day ช่วยกันโอเวอร์โหลด
      </div>
    </section>

    <section class="panel">
      <div class="panel-h">
        <h2>คะแนนแผน + โค้ชอธิบาย (Explainable)</h2>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="scoreRow">
            <div>
              <div class="big" id="scoreTotal">0</div>
              <div class="mut">คะแนนรวม (0–100)</div>
            </div>
            <div class="meter">
              <div class="bar" id="scoreBar" style="width:0%"></div>
            </div>
          </div>

          <div class="breakdown" id="breakdown"></div>

          <div class="mini">
            <div class="miniRow">
              <div>รวมเวลาเล่นทั้งสัปดาห์</div>
              <div class="val" id="sumMinutes">0 นาที</div>
            </div>
            <div class="miniRow">
              <div>วันเล่นจริง</div>
              <div class="val" id="sumDays">0 วัน</div>
            </div>
            <div class="miniRow">
              <div>ความหนักเฉลี่ย/วันเล่น (load)</div>
              <div class="val" id="avgLoad">0</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-h">Coach (เหตุผลที่ระบบแนะนำ)</div>
          <ul class="coach" id="coachList"></ul>
          <div class="hint">Planner เป็น “Create task” (Bloom) ผู้เรียนออกแบบแผนเอง + ระบบอธิบายเหตุผล (โปร่งใส)</div>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="panel-h">
        <h2>ส่งออก (สำหรับรายงาน/ครู)</h2>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="card-h">Export แผน</div>
          <div class="exportBtns">
            <button class="btn" id="btnExportMD2">Download Plan.md</button>
            <button class="btn ghost" id="btnCopyMD">Copy MD</button>
            <button class="btn" id="btnExportJSON2">Download Plan.json</button>
          </div>
          <div class="hint">MD เหมาะกับแปะรายงานบท 4 · JSON ใช้โหลดกลับมาแก้/ทำต่อ Evaluate</div>
        </div>

        <div class="card">
          <div class="card-h">Preview (Markdown)</div>
          <textarea id="mdPreview" spellcheck="false"></textarea>
        </div>
      </div>
    </section>

    <footer class="footer">
      <a class="link" id="backHub" href="../hub.html">กลับ HUB</a>
      <span class="mut">·</span>
      <span class="mut">HeroHealth Fitness Planner (Create) · local-only</span>
    </footer>
  </main>

  <!-- URL Settings Modal -->
  <div class="modal" id="urlModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="urlModalTitle">
      <div class="modal-h">
        <div>
          <div class="modal-title" id="urlModalTitle">ตั้งค่า URL เกม (ครั้งแรกครั้งเดียว)</div>
          <div class="modal-sub">เก็บในเครื่อง (localStorage) · ถ้าไฟล์/โฟลเดอร์เปลี่ยน แก้ที่นี่ได้เลย</div>
        </div>
        <button class="btn ghost small" id="btnCloseModal">ปิด</button>
      </div>

      <div class="modal-grid">
        <label>Shadow Breaker URL
          <input id="urlShadow" placeholder="../fitness/shadow-breaker.html"/>
        </label>
        <label>Rhythm Boxer URL
          <input id="urlRhythm" placeholder="../fitness/rhythm-boxer.html"/>
        </label>
        <label>Jump-Duck URL
          <input id="urlJump" placeholder="../fitness/jump-duck.html"/>
        </label>
        <label>Balance Hold URL
          <input id="urlBalance" placeholder="../fitness/balance-hold.html"/>
        </label>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="btnRestoreDefault">คืนค่าเริ่มต้น</button>
        <button class="btn" id="btnSaveUrls">บันทึก</button>
      </div>
      <div class="hint">ถ้าโฟลเดอร์จริงของคุณคือ /herohealth/fitness/... ตามภาพ “fitness” ให้ปล่อยค่าเริ่มต้นได้เลย</div>
    </div>
  </div>

  <script src="./planner.boot.js" defer></script>
</body>
</html>