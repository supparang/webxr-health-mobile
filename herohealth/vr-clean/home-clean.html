<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Ä¢ Clean Objects (Home)</title>
  <style>
    :root{
      --bg:#0b1220; --fg:#e8eefc; --mut:#9fb0d0; --card:#121b2f; --bd:#243455;
      --safeT: env(safe-area-inset-top, 0px);
      --safeB: env(safe-area-inset-bottom, 0px);
      --ok:#1f8b4c; --warn:#c7a100; --bad:#c54848;
    }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #app{ position:fixed; inset:0; padding-top:var(--safeT); padding-bottom:var(--safeB); overflow:hidden; }

    /* shared HUD */
    .hud{ position:fixed; left:12px; right:12px; top:calc(12px + var(--safeT)); display:flex; gap:10px; z-index:30; }
    .hud .box{ flex:1; background:rgba(18,27,47,.86); border:1px solid var(--bd); border-radius:14px; padding:10px 12px; min-width:0; }
    .hud .t{ font-size:12px; color:var(--mut); }
    .hud .v{ font-size:16px; font-weight:900; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* A renderer container */
    #mapRoot{ position:absolute; inset:0; display:none; }
    .toolbar{
      position:fixed; left:12px; right:12px;
      top:calc(64px + var(--safeT));
      display:flex; gap:8px; z-index:25; flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--bd);
      background:#1a2a4a; color:var(--fg);
      padding:10px 12px; border-radius:12px;
      font-weight:900; cursor:pointer;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.ghost{ background:transparent; }

    /* grid map layout */
    .mapStage{
      position:absolute; left:12px; right:12px;
      top:calc(114px + var(--safeT));
      bottom:calc(12px + var(--safeB));
      display:grid; gap:10px;
      grid-template-columns: 1.1fr 0.9fr;
      grid-template-rows: 1fr 1fr 1fr;
    }
    .zone{
      background:rgba(18,27,47,.55);
      border:1px solid var(--bd);
      border-radius:18px;
      padding:12px;
      display:flex; flex-direction:column; gap:10px;
      overflow:hidden;
    }
    .zone h3{ margin:0; font-size:14px; letter-spacing:.2px; }
    .zone .sub{ margin:0; color:var(--mut); font-size:12px; }
    .chips{ display:flex; gap:6px; flex-wrap:wrap; }
    .chip{
      font-size:11px; color:var(--mut);
      border:1px dashed var(--bd);
      padding:5px 8px; border-radius:999px;
      user-select:none;
    }
    .hotlist{
      display:flex; flex-direction:column; gap:8px;
      overflow:auto; padding-right:4px;
    }
    .hot{
      background:rgba(11,18,32,.55);
      border:1px solid var(--bd);
      border-radius:14px;
      padding:10px;
      display:flex; gap:10px; align-items:flex-start;
      cursor:pointer;
    }
    .hot:active{ transform: translateY(1px); }
    .hot.sel{ outline:2px solid rgba(160,200,255,.45); }
    .hot .name{ font-weight:900; font-size:13px; }
    .meta{ color:var(--mut); font-size:11px; margin-top:3px; line-height:1.25; }
    .right{ margin-left:auto; text-align:right; }
    .value{ font-weight:900; font-size:13px; }
    .stars{ font-size:11px; color:var(--mut); margin-top:3px; }

    /* zone placement */
    #zoneEntry{ grid-column:1; grid-row:1; }
    #zoneLiving{ grid-column:1; grid-row:2; }
    #zoneKitchen{ grid-column:1; grid-row:3; }
    #zoneBath{ grid-column:2; grid-row:1 / span 2; }
    #zoneBed{ grid-column:2; grid-row:3; }

    /* bottom action drawer */
    .drawer{
      position:fixed; left:12px; right:12px;
      bottom:calc(12px + var(--safeB));
      z-index:40;
      background:rgba(18,27,47,.92);
      border:1px solid var(--bd);
      border-radius:18px;
      padding:12px;
      display:none;
    }
    .drawer.on{ display:block; }
    .dTitle{ font-weight:1000; font-size:14px; margin:0 0 4px; }
    .dSub{ margin:0 0 10px; color:var(--mut); font-size:12px; line-height:1.35; }
    .row{ display:flex; gap:8px; flex-wrap:wrap; }
    .badge{
      font-size:11px; border:1px solid var(--bd);
      padding:5px 8px; border-radius:999px; color:var(--mut);
    }
    .btnWide{ flex:1; min-width:150px; }
    .mini{ font-size:11px; color:var(--mut); margin-top:10px; line-height:1.35; }

    /* B renderer container */
    #vrRoot{ position:absolute; inset:0; display:none; }
    .overlayNote{
      position:fixed; left:12px; right:12px;
      bottom:calc(12px + var(--safeB));
      z-index:30;
      background:rgba(11,18,32,.75);
      border:1px solid var(--bd);
      border-radius:14px;
      padding:10px 12px;
      color:var(--mut);
      font-size:12px;
      line-height:1.35;
    }
  </style>
</head>
<body>
<div id="app">
  <!-- Shared HUD -->
  <div class="hud" id="hud">
    <div class="box"><div class="t">TIME</div><div class="v" id="hudTime">--</div></div>
    <div class="box"><div class="t">SPRAY</div><div class="v" id="hudSpray">--</div></div>
    <div class="box"><div class="t">CLOTH</div><div class="v" id="hudCloth">--</div></div>
  </div>

  <!-- A) Map renderer -->
  <div id="mapRoot">
    <div class="toolbar">
      <button class="btn" id="btnSort">Sort by Value</button>
      <button class="btn" id="btnPlan">Plan Builder</button>
      <button class="btn ghost" id="btnBack">Back HUB</button>
    </div>

    <div class="mapStage" id="mapStage">
      <section class="zone" id="zoneEntry">
        <div>
          <h3>Entry</h3>
          <p class="sub">‡∏à‡∏∏‡∏î‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</p>
          <div class="chips"><span class="chip">Bottleneck</span><span class="chip">Touch ‡∏™‡∏π‡∏á</span></div>
        </div>
        <div class="hotlist" data-zone="entry"></div>
      </section>

      <section class="zone" id="zoneLiving">
        <div>
          <h3>Living Room</h3>
          <p class="sub">‡∏£‡∏µ‡πÇ‡∏°‡∏ó/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡∏•‡∏≤‡∏á</p>
          <div class="chips"><span class="chip">Shared</span><span class="chip">‡πÄ‡∏£‡πá‡∏ß</span></div>
        </div>
        <div class="hotlist" data-zone="living"></div>
      </section>

      <section class="zone" id="zoneKitchen">
        <div>
          <h3>Kitchen</h3>
          <p class="sub">‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏ß = ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô</p>
          <div class="chips"><span class="chip">Food</span><span class="chip">Cost ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô</span></div>
        </div>
        <div class="hotlist" data-zone="kitchen"></div>
      </section>

      <section class="zone" id="zoneBath">
        <div>
          <h3>Bathroom</h3>
          <p class="sub">Spread ‡∏™‡∏π‡∏á (‡∏Ñ‡∏±‡∏ô‡∏ä‡∏±‡∏Å/‡∏Å‡πä‡∏≠‡∏Å/‡∏ó‡∏µ‡πà‡∏Å‡∏î)</p>
          <div class="chips"><span class="chip">Spread ‡∏™‡∏π‡∏á</span><span class="chip">Priority</span></div>
        </div>
        <div class="hotlist" data-zone="bath"></div>
      </section>

      <section class="zone" id="zoneBed">
        <div>
          <h3>Bedroom</h3>
          <p class="sub">‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô/‡∏´‡∏•‡∏±‡∏á‡∏õ‡πà‡∏ß‡∏¢</p>
          <div class="chips"><span class="chip">Routine</span><span class="chip">Light</span></div>
        </div>
        <div class="hotlist" data-zone="bed"></div>
      </section>
    </div>

    <!-- Action drawer (selected hotspot) -->
    <div class="drawer" id="drawer">
      <div class="dTitle" id="dTitle">--</div>
      <div class="dSub" id="dSub">--</div>
      <div class="row" style="margin-bottom:10px;">
        <span class="badge" id="bTouch">Touch: -</span>
        <span class="badge" id="bSpread">Spread: -</span>
        <span class="badge" id="bCost">Cost: -</span>
        <span class="badge" id="bValue">Value: -</span>
      </div>
      <div class="row">
        <button class="btn btnWide" id="btnClean">CLEAN</button>
        <button class="btn btnWide ghost" id="btnClose">Close</button>
      </div>
      <div class="mini">
        Skeleton ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: CLEAN ‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡πä‡∏Å ‚Äúcleaned‚Äù ‡πÉ‡∏´‡πâ‡∏Å‡πà‡∏≠‡∏ô<br/>
        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏™‡πà mini-action ‡πÄ‡∏ä‡πá‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (coverage) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
      </div>
    </div>
  </div>

  <!-- B) WebXR renderer -->
  <div id="vrRoot">
    <div class="overlayNote">
      B Mode (Cardboard): ‡πÉ‡∏ä‡πâ crosshair + tap-to-shoot ‡∏ú‡πà‡∏≤‡∏ô <b>/herohealth/vr/vr-ui.js</b> (event: <code>hha:shoot</code>)<br/>
      ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô skeleton ‚Äî ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏™‡πà hotspot glow + clean progress ‡πÉ‡∏ô 3D
    </div>
    <div id="vrStage" style="position:absolute; inset:0;"></div>
  </div>
</div>

<script type="module">
'use strict';

const qs = (k, d='') => { try{ const u=new URL(location.href); return u.searchParams.get(k) ?? d; }catch(e){ return d; } };
const clamp = (v,a,b)=>Math.max(a, Math.min(b, v));
const isCVR = String(qs('view','')).toLowerCase() === 'cvr';

const P = {
  view: String(qs('view','')).toLowerCase(),
  run:  String(qs('run','play')).toLowerCase(),
  diff: String(qs('diff','normal')).toLowerCase(),
  time: clamp(Number(qs('time','90')), 20, 300),
  seed: String(qs('seed', String(Date.now()))),
  pid:  String(qs('pid','anon')),
  hub:  String(qs('hub','/herohealth/hub.html')),
  ai:   Number(qs('ai','0'))||0,
  debug:Number(qs('debug','0'))||0,
  api:  String(qs('api',''))
};

// Simple game state (skeleton)
const S = {
  timeLeft: P.time,
  spray: 100,
  cloth: 3,
  selectedId: null,
  cleaned: new Set(),
};

// Hotspots dataset (starter; we‚Äôll tune later)
const HOT = [
  { id:'door_knob', zone:'entry',  name:'‡∏•‡∏π‡∏Å‡∏ö‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡πâ‡∏≤',  touch:9, spread:8, cost:3, note:'‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏î ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏±‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô' },
  { id:'light_switch', zone:'entry',name:'‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÑ‡∏ü',         touch:8, spread:5, cost:1, note:'‡∏Ñ‡∏∏‡πâ‡∏°‡∏°‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ cost ‡∏ï‡πà‡∏≥' },

  { id:'tv_remote', zone:'living',  name:'‡∏£‡∏µ‡πÇ‡∏°‡∏ó‡∏ó‡∏µ‡∏ß‡∏µ',         touch:7, spread:6, cost:2, note:'‡πÅ‡∏ä‡∏£‡πå‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ö‡πâ‡∏≤‡∏ô' },
  { id:'phone', zone:'living',      name:'‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï',    touch:8, spread:7, cost:2, note:'‡∏à‡∏±‡∏ö‡∏ö‡πà‡∏≠‡∏¢ + ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏ô‡πâ‡∏≤' },
  { id:'drawer_handle', zone:'living', name:'‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡∏•‡∏¥‡πâ‡∏ô‡∏ä‡∏±‡∏Å/‡∏ï‡∏π‡πâ', touch:6, spread:6, cost:2, note:'‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡∏•‡∏∑‡∏°' },

  { id:'fridge_handle', zone:'kitchen', name:'‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô', touch:7, spread:7, cost:3, note:'‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£ = ‡∏à‡∏±‡∏ö‡∏ö‡πà‡∏≠‡∏¢' },
  { id:'kitchen_faucet', zone:'kitchen',name:'‡∏Å‡πä‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏Ñ‡∏£‡∏±‡∏ß',   touch:6, spread:6, cost:2, note:'‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å/‡∏•‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏≤‡∏∞‡πÑ‡∏î‡πâ' },
  { id:'counter_board', zone:'kitchen', name:'‡πÄ‡∏Ñ‡∏≤‡∏ô‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏á', touch:6, spread:8, cost:4, note:'‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£' },

  { id:'bath_door', zone:'bath',    name:'‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥', touch:6, spread:7, cost:2, note:'‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç' },
  { id:'soap_pump', zone:'bath',    name:'‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏™‡∏ö‡∏π‡πà/‡∏Å‡πä‡∏≠‡∏Å‡∏ô‡πâ‡∏≥',  touch:6, spread:7, cost:2, note:'‡πÅ‡∏ï‡∏∞‡∏ã‡πâ‡∏≥ ‡πÜ' },
  { id:'flush', zone:'bath',        name:'‡∏Ñ‡∏±‡∏ô‡∏ä‡∏±‡∏Å/‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏±‡∏Å‡πÇ‡∏Ñ‡∏£‡∏Å', touch:5, spread:9, cost:3, note:'Spread ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å' },

  { id:'bed_door', zone:'bed',      name:'‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô', touch:5, spread:5, cost:2, note:'‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô' },
];

function valueOf(h){ return (h.touch * h.spread) / Math.max(1, h.cost); }
function fmt(n){ return (Math.round(n*10)/10).toFixed(1); }

// HUD
const $ = (id)=>document.getElementById(id);
function renderHUD(){
  $('hudTime').textContent  = S.timeLeft + 's';
  $('hudSpray').textContent = String(S.spray);
  $('hudCloth').textContent = String(S.cloth);
}
renderHUD();

// mount correct renderer
const mapRoot = $('mapRoot');
const vrRoot  = $('vrRoot');

if (isCVR){
  vrRoot.style.display = 'block';
  mapRoot.style.display = 'none';
  await bootVR();
} else {
  mapRoot.style.display = 'block';
  vrRoot.style.display = 'none';
  bootMap();
}

function bootMap(){
  // toolbar
  $('btnSort').onclick = ()=> {
    // sort within each zone by Value desc
    HOT.sort((a,b)=> valueOf(b)-valueOf(a));
    renderZones();
    toast('Sorted by Value ‚úÖ');
  };
  $('btnPlan').onclick = ()=> toast('TODO: Plan Builder (Checklist/Routine/Route)');
  $('btnBack').onclick = ()=> goHub();

  $('btnClose').onclick = closeDrawer;
  $('btnClean').onclick = doCleanSelected;

  renderZones();
}

function renderZones(){
  const lists = document.querySelectorAll('.hotlist');
  lists.forEach(el=> el.innerHTML = '');

  const byZone = new Map();
  for(const h of HOT){
    if(!byZone.has(h.zone)) byZone.set(h.zone, []);
    byZone.get(h.zone).push(h);
  }

  for(const el of lists){
    const zone = el.getAttribute('data-zone');
    const arr = byZone.get(zone) || [];
    for(const h of arr){
      const card = document.createElement('div');
      card.className = 'hot' + (S.selectedId===h.id ? ' sel':'');

      const cleaned = S.cleaned.has(h.id);
      const val = valueOf(h);

      card.innerHTML = `
        <div>
          <div class="name">${cleaned ? '‚úÖ ' : ''}${h.name}</div>
          <div class="meta">${h.note}</div>
        </div>
        <div class="right">
          <div class="value">${fmt(val)}</div>
          <div class="stars">T${h.touch} ‚Ä¢ S${h.spread} ‚Ä¢ C${h.cost}</div>
        </div>
      `;
      card.onclick = ()=> openDrawer(h.id);
      el.appendChild(card);
    }
  }
}

function openDrawer(id){
  S.selectedId = id;
  const h = HOT.find(x=>x.id===id);
  if(!h) return;

  $('drawer').classList.add('on');
  $('dTitle').textContent = (S.cleaned.has(id) ? '‚úÖ ' : '') + h.name;

  const cleaned = S.cleaned.has(id);
  const msg = cleaned
    ? '‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß (‡∏¢‡∏±‡∏á‡πÅ‡∏ï‡∏∞ CLEAN ‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£)'
    : '‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡πâ‡∏°: ‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö Cost';
  $('dSub').textContent = msg;

  $('bTouch').textContent = 'Touch: ' + h.touch;
  $('bSpread').textContent = 'Spread: ' + h.spread;
  $('bCost').textContent = 'Cost: ' + h.cost;
  $('bValue').textContent = 'Value: ' + fmt(valueOf(h));

  renderZones();
}

function closeDrawer(){
  $('drawer').classList.remove('on');
}

function doCleanSelected(){
  const id = S.selectedId;
  const h = HOT.find(x=>x.id===id);
  if(!h) return;

  // skeleton resource spend (later: add mini-action coverage)
  const sprayNeed = 10 * h.cost;      // simple rule
  const timeNeed  = 4  * h.cost;      // seconds
  const clothNeed = (h.spread >= 8) ? 1 : 0; // high spread uses cloth

  if(S.timeLeft < timeNeed){ toast('‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠ ‚è≥'); return; }
  if(S.spray < sprayNeed){ toast('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠ üß¥'); return; }
  if(S.cloth < clothNeed){ toast('‡∏ú‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠ üßª'); return; }

  S.timeLeft -= timeNeed;
  S.spray -= sprayNeed;
  S.cloth -= clothNeed;

  S.cleaned.add(id);
  renderHUD();
  renderZones();
  openDrawer(id);

  toast('Cleaned ‚úÖ (-time/-spray)');
}

async function bootVR(){
  try{
    await import('../vr/vr-ui.js'); // /herohealth/vr/vr-ui.js
  }catch(e){
    console.warn('vr-ui.js missing or failed to load:', e);
    toast('vr-ui.js ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  }

  window.addEventListener('hha:shoot', (ev)=>{
    const d = (ev && ev.detail) ? ev.detail : {};
    if(P.debug) console.log('hha:shoot', d);
    // TODO next: raycast/select hotspot in 3D and clean
  });
}

function goHub(){
  const u = new URL(P.hub, location.href);
  u.searchParams.set('from', 'clean-home');
  u.searchParams.set('pid', P.pid);
  u.searchParams.set('seed', P.seed);
  location.href = u.toString();
}

function toast(msg){
  const d = document.createElement('div');
  d.textContent = msg;
  d.style.position='fixed';
  d.style.left='12px'; d.style.right='12px';
  d.style.bottom='12px';
  d.style.zIndex='9999';
  d.style.padding='10px 12px';
  d.style.border='1px solid var(--bd)';
  d.style.borderRadius='14px';
  d.style.background='rgba(18,27,47,.9)';
  d.style.color='var(--fg)';
  document.body.appendChild(d);
  setTimeout(()=>{ d.remove(); }, 1400);
}
</script>
</body>
</html>