<!-- === /herohealth/goodjunk-vr-launcher.html ===
GoodJunkVR LAUNCHER — PRODUCTION (AUTO-DETECT + NO MENU)
✅ Root = launcher, Folder = run (/vr-goodjunk/goodjunk-vr.html)
✅ Auto-detect view if NOT provided (?view=...)
✅ If ?view= present -> respect (NO override)
✅ Pass-through: hub/run/diff/time/seed/studyId/phase/conditionGroup (+ aliases)
✅ Adds ts=Date.now() to avoid caching issues
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GoodJunkVR (Auto Launcher)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel: rgba(2,6,23,.72);
      --stroke: rgba(148,163,184,.22);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    html,body{
      height:100%; margin:0; background: radial-gradient(circle at top left, rgba(34,211,238,.10), transparent 60%),
                                  radial-gradient(circle at bottom right, rgba(167,139,250,.10), transparent 60%),
                                  var(--bg);
      color:var(--text);
      font-family: system-ui,-apple-system,"Segoe UI","Noto Sans Thai",sans-serif;
    }
    .wrap{
      min-height:100%;
      padding: calc(18px + var(--sat)) calc(14px + var(--sar)) calc(18px + var(--sab)) calc(14px + var(--sal));
      display:flex; align-items:center; justify-content:center;
    }
    .card{
      width:min(820px, 94vw);
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      padding: 18px;
    }
    .title{ font-size:18px; font-weight:1200; letter-spacing:.2px; }
    .sub{ margin-top:6px; color:var(--muted); font-weight:900; font-size:12px; line-height:1.5; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .bar{
      margin-top:12px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.55);
      border-radius: 18px;
      padding: 12px;
      font-size: 12px;
      line-height: 1.55;
      color:#cbd5e1;
      word-break: break-all;
    }
    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      font-weight:900;
    }
    .dot{
      display:inline-block; width:10px; height:10px; border-radius:999px;
      background: rgba(34,197,94,.85);
      box-shadow: 0 0 0 6px rgba(34,197,94,.10);
      margin-right:8px;
      vertical-align: middle;
      animation: pulse 1.1s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform:scale(1); opacity:.9; }
      50%{ transform:scale(1.25); opacity:1; }
    }
    .btn{
      margin-top:12px;
      height:52px;
      width:100%;
      border-radius: 16px;
      border:1px solid rgba(34,197,94,.35);
      background: rgba(34,197,94,.16);
      color:#eafff3;
      font-weight:1200;
      font-size: 15px;
      cursor:pointer;
    }
    .btn.alt{
      border-color: rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color: var(--text);
      margin-top:10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title"><span class="dot"></span>กำลังพาเข้าเกม GoodJunkVR อัตโนมัติ…</div>
      <div class="sub">
        - ถ้ามี <span class="mono">?view=...</span> มาแล้ว จะเคารพตามนั้น (ไม่ override)<br/>
        - ถ้าไม่มี จะเดาอุปกรณ์เอง (pc / mobile / cvr) แล้วพาไปไฟล์ run ในโฟลเดอร์ <span class="mono">/vr-goodjunk/</span>
      </div>

      <div class="bar">
        <div><b>Preview URL</b></div>
        <div id="preview" class="mono">—</div>
      </div>

      <div class="hint">ถ้าค้าง ให้กดปุ่มด้านล่างเพื่อเข้าแบบ manual (ยังคงส่งพารามิเตอร์เดิม)</div>
      <button class="btn" id="btnGo">เข้าเกมเลย</button>
      <button class="btn alt" id="btnGoMobile">เข้าแบบ Mobile (force)</button>
    </div>
  </div>

  <script>
    (function(){
      const qs = (k, def=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? def; }catch(_){ return def; } };

      // ✅ Respect explicit ?view= (NO override)
      function detectView(){
        const explicit = String(qs('view','')).toLowerCase();
        if (explicit) return explicit;

        const isTouch = ('ontouchstart' in window) || ((navigator.maxTouchPoints|0) > 0);
        const w = Math.max(1, window.innerWidth||1);
        const h = Math.max(1, window.innerHeight||1);
        const landscape = w >= h;

        // heuristic:
        // touch + landscape + wide => likely cardboard split usage => cvr
        if (isTouch){
          if (landscape && w >= 740) return 'cvr';
          return 'mobile';
        }
        return 'pc';
      }

      function pickParam(name, fallbackNames=[], def=null){
        // accept alias keys (e.g. studyId/study)
        let v = qs(name, null);
        if (v != null && v !== '') return v;
        for (const a of fallbackNames){
          v = qs(a, null);
          if (v != null && v !== '') return v;
        }
        return def;
      }

      function clampNum(v, min, max, def){
        const n = Number(v);
        if (!Number.isFinite(n)) return def;
        return Math.max(min, Math.min(max, n));
      }

      function build(view){
        const base = './vr-goodjunk/goodjunk-vr.html';
        const p = new URLSearchParams();

        // view
        p.set('view', view);

        // run/diff/time
        p.set('run', pickParam('run', [], 'play'));
        p.set('diff', pickParam('diff', [], 'normal'));

        const time = clampNum(pickParam('time', [], 80), 20, 300, 80);
        p.set('time', String(time));

        // hub
        const hub = pickParam('hub', [], '');
        if (hub) p.set('hub', hub);

        // seed (recommend for research)
        const seed = pickParam('seed', [], '');
        if (seed) p.set('seed', seed);

        // study pass-through (support aliases)
        const studyId = pickParam('studyId', ['study'], '');
        if (studyId) p.set('studyId', studyId);

        const phase = pickParam('phase', [], '');
        if (phase) p.set('phase', phase);

        const conditionGroup = pickParam('conditionGroup', ['cond'], '');
        if (conditionGroup) p.set('conditionGroup', conditionGroup);

        // cache buster
        p.set('ts', String(Date.now()));
        return base + '?' + p.toString();
      }

      const autoView = detectView();
      const url = build(autoView);

      const preview = document.getElementById('preview');
      if (preview) preview.textContent = url;

      function go(u){ location.href = u; }

      // auto redirect quickly (still shows preview)
      setTimeout(()=> go(url), 420);

      document.getElementById('btnGo')?.addEventListener('click', ()=> go(url));
      document.getElementById('btnGoMobile')?.addEventListener('click', ()=> go(build('mobile')));
    })();
  </script>
</body>
</html>