<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GoodJunkVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg:#020617; --panel:rgba(2,6,23,.78); --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e; --radius:22px;
      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:radial-gradient(circle at 20% 15%, rgba(34,211,238,.14), transparent 55%),
                                radial-gradient(circle at 80% 85%, rgba(167,139,250,.12), transparent 60%),
                                linear-gradient(180deg,#020617 0%,#020617 100%);
              color:var(--text); font-family:system-ui,-apple-system,"Segoe UI","Noto Sans Thai",sans-serif;}
    .wrap{min-height:100%; display:flex; align-items:center; justify-content:center;
          padding: calc(18px + var(--sat)) calc(14px + var(--sar)) calc(18px + var(--sab)) calc(14px + var(--sal));}
    .card{width:min(760px, 94vw); background:rgba(2,6,23,.72); border:1px solid var(--stroke);
          border-radius:var(--radius); box-shadow:0 22px 70px rgba(0,0,0,.45); padding:18px;}
    .title{font-weight:1200; font-size:22px}
    .sub{margin-top:6px; color:var(--muted); font-weight:900; font-size:12px; line-height:1.4}
    .grid{margin-top:14px; display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px}
    .box{background:rgba(15,23,42,.62); border:1px solid rgba(148,163,184,.16); border-radius:18px; padding:12px}
    .k{color:var(--muted); font-weight:900; font-size:11px; letter-spacing:.2px}
    .v{margin-top:6px; font-weight:1100; font-size:14px}
    .actions{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap}
    .btn{flex:1; min-width:220px; height:54px; border-radius:16px; border:1px solid rgba(148,163,184,.20);
         background:rgba(15,23,42,.58); color:var(--text); font-weight:1100; font-size:16px; cursor:pointer}
    .btn.primary{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.14)}
    .hint{margin-top:10px; color:var(--muted); font-weight:900; font-size:12px}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title">GoodJunkVR</div>
      <div class="sub">Launcher (อยู่ root) → จะส่งเข้า Run ที่ <code>/herohealth/vr-goodjunk/goodjunk-vr.html</code> แบบ “ไม่ override ?view= ถ้ามีอยู่แล้ว”</div>

      <div class="grid">
        <div class="box">
          <div class="k">HUB</div>
          <div class="v" id="hubTxt">—</div>
        </div>
        <div class="box">
          <div class="k">AUTO VIEW</div>
          <div class="v" id="viewTxt">—</div>
        </div>
        <div class="box">
          <div class="k">MODE</div>
          <div class="v" id="modeTxt">—</div>
        </div>
        <div class="box">
          <div class="k">DIFF / TIME</div>
          <div class="v" id="dtTxt">—</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnGo">▶ เริ่มเล่น (Auto)</button>
        <button class="btn" id="btnHub">↩ กลับ HUB</button>
      </div>

      <div class="hint">
        ถ้าต้องการบังคับโหมดเอง ใส่พารามิเตอร์ได้ เช่น
        <code>?view=cvr&run=play&diff=easy&time=80</code>
      </div>
    </div>
  </div>

<script>
(function(){
  const qs=(k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };

  function detectViewNoOverride(){
    const explicit = String(qs('view','')).toLowerCase();
    if (explicit) return explicit;

    const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints|0) > 0;
    const w = Math.max(1, window.innerWidth||1);
    const h = Math.max(1, window.innerHeight||1);
    const landscape = w >= h;

    if (isTouch){
      if (landscape && w >= 740) return 'cvr';
      return 'mobile';
    }
    return 'pc';
  }

  const hub = qs('hub', null);
  const view = detectViewNoOverride();
  const run  = qs('run','play');
  const diff = qs('diff','normal');
  const time = qs('time','80');

  const hubTxt = document.getElementById('hubTxt');
  const viewTxt = document.getElementById('viewTxt');
  const modeTxt = document.getElementById('modeTxt');
  const dtTxt = document.getElementById('dtTxt');

  if(hubTxt) hubTxt.textContent = hub || '(no hub param)';
  if(viewTxt) viewTxt.textContent = view;
  if(modeTxt) modeTxt.textContent = run;
  if(dtTxt) dtTxt.textContent = `${diff} / ${time}s`;

  function buildRunUrl(){
    const u = new URL('./vr-goodjunk/goodjunk-vr.html', location.href);
    // passthrough all known params
    const keys = ['hub','view','run','diff','time','seed','studyId','study','phase','conditionGroup','cond','siteCode','schoolCode','studentKey'];
    keys.forEach(k=>{
      const v = qs(k, null);
      if(v!==null && v!=='') u.searchParams.set(k, v);
    });
    // if no explicit view, inject detected
    if(!qs('view','')) u.searchParams.set('view', view);
    return u.toString();
  }

  document.getElementById('btnGo')?.addEventListener('click', ()=>{
    location.href = buildRunUrl();
  });

  document.getElementById('btnHub')?.addEventListener('click', ()=>{
    if(hub) location.href = hub;
    else alert('ยังไม่ได้ใส่ hub url');
  });

  // auto-start optional (คอมเมนต์ไว้ ถ้ายังไม่อยาก auto)
  // setTimeout(()=>location.href = buildRunUrl(), 250);
})();
</script>
</body>
</html>