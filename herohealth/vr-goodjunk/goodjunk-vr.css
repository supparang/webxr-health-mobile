/* === /herohealth/vr-goodjunk/goodjunk-vr.css ===
   GoodJunkVR UI — PRODUCTION
   ✅ compact + overlay lock + z-index FX
   ✅ HUD-safe spawn vars: --gj-top-safe / --gj-bottom-safe (safe.js reads)
   ✅ Field never crushed on short screens (grid + min-heights)
   ✅ Quest panel is modal (doesn't squeeze layout)
   v20260217c
*/

/* ---------- Root / Safe-area ---------- */
:root{
  --bg0:#050814;
  --bg1:#070b1a;
  --panel: rgba(9, 14, 32, .68);
  --panel2: rgba(9, 14, 32, .82);
  --stroke: rgba(255,255,255,.10);
  --stroke2: rgba(255,255,255,.14);
  --text:#eaf0ff;
  --muted: rgba(234,240,255,.72);

  --r: 18px;
  --r2: 22px;

  /* safe-area insets */
  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  /* IMPORTANT: px vars for HUD-safe spawn (safe.js reads numeric px) */
  --gj-top-safe: 176px;      /* fallback: topbar + hud-top */
  --gj-bottom-safe: 230px;   /* fallback: hud-bot */
}

/* When HUD hidden -> open more spawn area */
body.hud-hidden{
  --gj-top-safe: 118px;
  --gj-bottom-safe: 126px;
}

/* ---------- Base reset ---------- */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body.gj{
  margin:0;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(70,120,255,.12), transparent 55%),
    radial-gradient(900px 600px at 80% 30%, rgba(0,255,210,.10), transparent 55%),
    radial-gradient(700px 600px at 55% 95%, rgba(255,120,50,.08), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Thai", sans-serif;
  overflow:hidden;
  -webkit-tap-highlight-color: transparent;

  /* 4-row grid: topbar / hud-top / field / hud-bot */
  min-height: 100svh;
  display:grid;
  grid-template-rows: auto auto 1fr auto;
  grid-template-columns: 1fr;
}

/* Prevent scroll bounce */
body.gj, .gj-field{ overscroll-behavior: none; }

/* ---------- Buttons / Chips ---------- */
.gj-btn, .btn{
  border:1px solid var(--stroke2);
  background: rgba(255,255,255,.06);
  color: var(--text);
  border-radius: 14px;
  padding: 10px 14px;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: .2px;
  cursor:pointer;
  backdrop-filter: blur(10px);
}
.gj-btn:active, .btn:active{ transform: translateY(1px); }
.gj-btn.primary{
  background: rgba(32, 205, 120, .22);
  border-color: rgba(32,205,120,.35);
}
.btn.alt{
  background: rgba(255,255,255,.05);
}

.gj-chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding: 9px 12px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.05);
  backdrop-filter: blur(10px);
  font-weight: 800;
  font-size: 14px;
  color: var(--text);
  white-space: nowrap;
}
.gj-chip-brand{
  background: rgba(32,205,120,.18);
  border-color: rgba(32,205,120,.25);
}
.gj-chip-mini{
  opacity:.9;
  font-weight: 800;
}

/* ---------- TOPBAR (row1) ---------- */
.gj-topbar{
  grid-row:1;
  padding: calc(12px + var(--sat)) calc(12px + var(--sar)) 10px calc(12px + var(--sal));
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  z-index: 90;
}
.gj-topbar .left, .gj-topbar .right{
  display:flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items:center;
}
.gj-topbar .right{ justify-content:flex-end; }

/* ---------- HUD TOP (row2) ---------- */
.gj-hud-top{
  grid-row:2;
  padding: 0 calc(12px + var(--sar)) 10px calc(12px + var(--sal));
  z-index: 80;
}

.hud-row{
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 10px;
  align-items:stretch;
}
@media (max-width: 520px){
  .hud-row{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}

.hud-pill{
  background: var(--panel);
  border:1px solid var(--stroke);
  border-radius: var(--r2);
  padding: 10px 12px;
  backdrop-filter: blur(12px);
  box-shadow: 0 10px 24px rgba(0,0,0,.22);
  min-height: 62px;
}
.hud-pill.warn{ border-color: rgba(255,190,120,.26); }
.hud-pill.grade{ border-color: rgba(180,200,255,.22); }

.hud-label{
  font-size: 12px;
  font-weight: 900;
  color: rgba(234,240,255,.75);
  letter-spacing: .8px;
}
.hud-value{
  font-size: 22px;
  font-weight: 1000;
  margin-top: 2px;
}

/* VR hint chip inside hud-row */
#vrMiniHud{
  grid-column: 1 / -1;
  justify-content:center;
}

/* progress */
.gj-progress{ margin-top: 10px; }
.gj-progress-track{
  height: 12px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  overflow:hidden;
}
.gj-progress-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(50,220,160,.75), rgba(120,160,255,.65), rgba(255,120,80,.60));
}

/* boss bar */
.gj-bossbar{
  margin-top: 10px;
  padding: 12px;
  border-radius: var(--r2);
  border:1px solid rgba(255,120,120,.24);
  background: rgba(40, 10, 18, .35);
  backdrop-filter: blur(12px);
}
.gj-bossbar[aria-hidden="true"]{ display:none; }
.gj-bossbar-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.gj-bossbar-title{ font-weight: 1000; }
.gj-bossbar-hint{
  font-weight: 900;
  color: rgba(255,220,220,.82);
  font-size: 13px;
}
.gj-bossbar-track{
  margin-top: 10px;
  height: 12px;
  border-radius: 999px;
  border:1px solid rgba(255,120,120,.24);
  background: rgba(255,255,255,.04);
  overflow:hidden;
}
.gj-bossbar-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,120,120,.70), rgba(255,80,120,.55));
}

/* ---------- FIELD (row3) ---------- */
.gj-field{
  grid-row:3;
  position:relative;
  margin: 0 calc(12px + var(--sar)) 10px calc(12px + var(--sal));
  border-radius: 26px;
  border:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(1200px 600px at 50% 20%, rgba(255,255,255,.06), transparent 60%),
    rgba(255,255,255,.02);
  box-shadow: 0 18px 40px rgba(0,0,0,.35);
  overflow:hidden;

  /* key: prevent field from collapsing on small screens */
  min-height: 220px;
}

.gj-layer{
  position:absolute;
  inset:0;
  pointer-events:auto;
  z-index: 20;
}
.gj-layer-r{
  pointer-events:none;
  opacity: .98;
  filter: saturate(1.08);
}

/* Crosshair (vr-ui.js) above targets, below modals */
#hha-crosshair, .hha-crosshair, .vrui-crosshair{
  z-index: 70 !important;
}

/* ---------- Targets ---------- */
.gj-target{
  position:absolute;
  transform: translate(-50%, -50%) scale(1);
  user-select:none;
  -webkit-user-select:none;
  touch-action:none;
  cursor:pointer;
  filter: drop-shadow(0 10px 14px rgba(0,0,0,.35));
  will-change: transform, opacity;
}
.gj-target.spawn{ animation: gjPop .18s ease-out both; }
.gj-target.gone{
  animation: gjGone .14s ease-in both;
  pointer-events:none;
}
@keyframes gjPop{
  from{ transform: translate(-50%,-50%) scale(.75); opacity:.0; }
  to{ transform: translate(-50%,-50%) scale(1); opacity:1; }
}
@keyframes gjGone{
  from{ transform: translate(-50%,-50%) scale(1); opacity:1; }
  to{ transform: translate(-50%,-50%) scale(.75); opacity:0; }
}

/* ---------- HUD BOTTOM (row4) ---------- */
.gj-hud-bot{
  grid-row:4;
  padding: 0 calc(12px + var(--sar)) calc(12px + var(--sab)) calc(12px + var(--sal));
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap: 10px;
  z-index: 80;
}
@media (max-width: 760px){
  .gj-hud-bot{ grid-template-columns: 1fr; }
}

.meter{
  border-radius: var(--r2);
  border:1px solid var(--stroke);
  background: var(--panel2);
  backdrop-filter: blur(12px);
  padding: 12px 14px;
  box-shadow: 0 10px 24px rgba(0,0,0,.22);
}
.meter-title{
  font-weight: 1000;
  letter-spacing: .5px;
  margin-bottom: 10px;
}
.meter-bar{
  height: 14px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  overflow:hidden;
}
.meter-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(50,220,160,.75), rgba(255,180,70,.65), rgba(255,90,90,.60));
}
.meter-num, .meter-shield, .meter-tip{
  margin-top: 8px;
  font-weight: 850;
  color: rgba(234,240,255,.86);
}
.meter-tip{
  color: rgba(234,240,255,.72);
  line-height: 1.35;
}

/* HUD hidden -> collapse bottom meters */
body.hud-hidden .gj-hud-bot{ display:none; }
body.hud-hidden .gj-hud-top .gj-progress{ display:none; }
body.hud-hidden #vrMiniHud{ display:none; }

/* ---------- Quest modal (overlay lock) ---------- */
.gj-quest-panel{
  position:fixed;
  inset:0;
  padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 140;
}
.gj-quest-panel[aria-hidden="true"]{ display:none; }

.gj-quest-card{
  width: min(720px, 94vw);
  max-height: min(78svh, 760px);
  overflow:auto;
  border-radius: 26px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(10, 14, 30, .82);
  box-shadow: 0 30px 80px rgba(0,0,0,.55);
  padding: 14px;
}

.gj-quest-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 8px 8px 12px;
  position: sticky;
  top: 0;
  background: rgba(10,14,30,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,.10);
  border-radius: 18px;
}

.gj-quest-title{
  font-size: 18px;
  font-weight: 1100;
}

.gj-quest-section{
  margin-top: 12px;
  padding: 12px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
}

.q-title{
  font-weight: 1000;
  margin-bottom: 6px;
}
.q-desc{
  color: rgba(234,240,255,.76);
  line-height: 1.35;
}
.q-bar{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.q-num{ font-weight: 1100; }
.q-hint{
  color: rgba(234,240,255,.62);
  font-weight: 900;
  font-size: 13px;
}

.gj-ul{
  margin: 8px 0 0 18px;
  color: rgba(234,240,255,.76);
  line-height: 1.4;
}

code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: .92em;
  padding: 2px 6px;
  border-radius: 10px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}

/* Lock background interaction when quest open */
body.quest-open{ overflow:hidden; }
body.quest-open .gj-field{ filter: blur(0.2px) saturate(1.02); }

/* ---------- Low-time overlay ---------- */
.gj-lowtime-overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  z-index: 130;
}
.gj-lowtime-overlay[aria-hidden="true"]{ display:none; }

.gj-lowtime-ring{
  width: 180px;
  height: 180px;
  border-radius: 999px;
  border: 2px solid rgba(255,120,80,.35);
  box-shadow: 0 0 0 18px rgba(255,120,80,.10);
}
.gj-lowtime-num{
  position:absolute;
  font-size: 64px;
  font-weight: 1100;
  text-shadow: 0 18px 40px rgba(0,0,0,.55);
}
body.gj-tick .gj-lowtime-ring{
  box-shadow: 0 0 0 26px rgba(255,120,80,.14);
}

/* ---------- End overlay ---------- */
.gj-end{
  position:fixed;
  inset:0;
  padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 150;
}
.gj-end[aria-hidden="true"]{ display:none; }

.gj-end .card{
  width: min(560px, 92vw);
  border-radius: 26px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(10, 14, 30, .86);
  box-shadow: 0 30px 90px rgba(0,0,0,.60);
  padding: 16px;
}
.gj-end .title{
  font-size: 20px;
  font-weight: 1100;
}
.gj-end .sub{
  margin-top: 4px;
  color: rgba(234,240,255,.70);
  font-weight: 850;
}
.gj-end .grid{
  margin-top: 14px;
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 10px;
}
.gj-end .stat{
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  padding: 10px 12px;
}
.gj-end .stat span{
  display:block;
  color: rgba(234,240,255,.70);
  font-weight: 900;
  font-size: 12px;
  letter-spacing: .6px;
}
.gj-end .stat b{
  display:block;
  margin-top: 2px;
  font-size: 22px;
  font-weight: 1100;
}
.gj-end .actions{
  margin-top: 14px;
  display:flex;
  gap: 10px;
}
.gj-end .actions .btn{ flex:1; }

/* ---------- FX layering (Particles / FX Director) ----------
   FX above field, under HUD/modals
*/
#fx, #fx-layer, #hha-fx, .hha-fx, canvas.hha-fx, canvas#hhaFxCanvas{
  position: fixed !important;
  inset: 0 !important;
  pointer-events: none !important;
  z-index: 60 !important;
}
.fx-pop, .hha-pop, .particles-pop{
  position: fixed;
  pointer-events: none;
  z-index: 65;
}

/* ---------- Mode classes (storm/boss/rage feedback) ---------- */
body.storm .gj-field{
  border-color: rgba(255,200,90,.18);
  box-shadow: 0 18px 44px rgba(255,200,90,.06), 0 18px 40px rgba(0,0,0,.35);
}
body.boss .gj-field{
  border-color: rgba(255,120,120,.20);
  box-shadow: 0 18px 44px rgba(255,120,120,.07), 0 18px 40px rgba(0,0,0,.35);
}
body.rage .gj-field{
  border-color: rgba(255,90,160,.22);
  box-shadow: 0 18px 52px rgba(255,90,160,.08), 0 18px 40px rgba(0,0,0,.35);
}

/* Pulses from safe.js */
body.gj-junk-hit .gj-field{ filter: saturate(1.12) brightness(1.03); }
body.gj-bomb .gj-field{ filter: saturate(1.20) brightness(1.06); }
body.gj-storm .gj-field{ filter: saturate(1.10); }
body.gj-rage .gj-field{ filter: saturate(1.15); }
body.gj-boss-down .gj-field{ filter: saturate(1.05) brightness(1.02); }

/* ---------- Small height devices (layout not tight) ---------- */
@media (max-height: 740px){
  .hud-pill{ padding: 8px 10px; min-height: 56px; }
  .hud-value{ font-size: 20px; }
  .meter{ padding: 10px 12px; }
  .gj-field{ min-height: 200px; }
}
@media (max-height: 640px){
  /* auto-hide bottom meters on very short screens */
  body.gj:not(.quest-open) .gj-hud-bot{ display:none; }
  body.gj:not(.quest-open){ --gj-bottom-safe: 120px; }
}

/* ---------- Accessibility ---------- */
[aria-hidden="true"]{ pointer-events:none; }