/* === /herohealth/vr-goodjunk/goodjunk-vr.css ===
   GoodJunkVR UI — PRODUCTION (compact + overlay lock + FX z-index + no HUD block)
   v20260217d

   Goals:
   - Layout ไม่แน่นบนมือถือ/จอเตี้ย
   - เป้าไม่ถูก HUD/การ์ดบัง + แตะ/ยิงได้แน่
   - Quest/End/LowTime overlay ซ่อนแล้วไม่บังสนาม
   - รองรับ safe-area + safe spawn vars: --gj-top-safe / --gj-bottom-safe
*/

:root{
  /* safe areas */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);

  /* spacing */
  --gap: 10px;
  --radius: 18px;
  --radius2: 22px;

  /* colors */
  --bg0: #050712;
  --bg1: #070a18;
  --panel: rgba(10,16,32,.58);
  --panel2: rgba(10,16,32,.72);
  --stroke: rgba(255,255,255,.10);
  --stroke2: rgba(255,255,255,.14);

  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --muted2: rgba(255,255,255,.52);

  --good: rgba(65,210,125,.95);
  --warn: rgba(255,180,60,.92);
  --bad:  rgba(255,80,90,.92);

  /* UI safe rect for spawn (JS reads these px vars) */
  --gj-top-safe: calc(var(--sat) + 170px);
  --gj-bottom-safe: calc(var(--sab) + 150px);

  /* field padding (visual) */
  --field-pad-x: 10px;
  --field-pad-y: 8px;

  /* typography */
  --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial, sans-serif;

  /* shadows */
  --shadow: 0 16px 40px rgba(0,0,0,.45);
  --shadow2: 0 10px 24px rgba(0,0,0,.38);

  /* z-index plan */
  --z-topbar: 9000;
  --z-quest:  9500;
  --z-end:    9600;
  --z-low:    9700;

  --z-hud:    7000;
  --z-field:  8200;
  --z-target: 9999;

  /* FX layer above field but below overlays */
  --z-fx:     8800;
}

/* ---------------------------------------------------------
   Base
--------------------------------------------------------- */
*{ box-sizing:border-box; }
html, body{
  height:100%;
  margin:0;
  padding:0;
  background: radial-gradient(1200px 700px at 50% 30%, rgba(55,160,255,.12), transparent 60%),
              radial-gradient(900px 600px at 20% 80%, rgba(120,80,255,.10), transparent 60%),
              linear-gradient(180deg, var(--bg0), var(--bg1));
  color: var(--text);
  font-family: var(--font);
  overflow:hidden;
}

body.gj{
  position:relative;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  user-select:none;
  -webkit-user-select:none;
  -webkit-touch-callout:none;
}

/* nice blur cards (fallback safe) */
.gj-chip, .gj-btn, .hud-pill, .meter, .gj-bossbar, .gj-quest-card, .gj-end .card{
  background: var(--panel);
  border: 1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow2);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: .92em;
  color: rgba(255,255,255,.86);
}

/* ---------------------------------------------------------
   Topbar
--------------------------------------------------------- */
.gj-topbar{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  padding: calc(var(--sat) + 10px) 12px 10px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  z-index: var(--z-topbar);
  pointer-events:auto;
}

.gj-topbar .left, .gj-topbar .right{
  display:flex;
  flex-wrap: wrap;
  align-items:center;
  gap: 8px;
}

.gj-chip{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 999px;
  line-height:1;
  font-weight: 700;
  color: rgba(255,255,255,.90);
  font-size: 14px;
}

.gj-chip-brand{
  background: linear-gradient(180deg, rgba(50,190,120,.22), rgba(10,16,32,.65));
  border-color: rgba(65,210,125,.22);
}

.gj-chip-mini{
  background: rgba(10,16,32,.38);
  border-color: rgba(255,255,255,.10);
  font-weight: 700;
  font-size: 13px;
}

.gj-btn{
  appearance:none;
  border: 1px solid var(--stroke2);
  color: rgba(255,255,255,.92);
  padding: 10px 14px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 14px;
  cursor:pointer;
  touch-action: manipulation;
}
.gj-btn:active{ transform: translateY(1px); }
.gj-btn.primary{
  background: linear-gradient(180deg, rgba(60,220,140,.22), rgba(10,16,32,.70));
  border-color: rgba(65,210,125,.30);
}

/* ---------------------------------------------------------
   HUD TOP (score/time/miss/grade + progress + boss)
   IMPORTANT: pointer-events NONE to avoid blocking the field.
--------------------------------------------------------- */
.gj-hud-top{
  position: fixed;
  left: 0;
  right: 0;
  top: calc(var(--sat) + 74px); /* under topbar */
  padding: 0 12px;
  z-index: var(--z-hud);
  pointer-events: none; /* critical */
}

.hud-row{
  display:flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}

.hud-pill{
  min-width: 118px;
  padding: 12px 14px;
  border-radius: var(--radius);
}

.hud-pill.grade{
  min-width: 140px;
}

.hud-pill.warn{
  border-color: rgba(255,180,60,.18);
  background: linear-gradient(180deg, rgba(255,180,60,.10), rgba(10,16,32,.62));
}

.hud-label{
  font-size: 12px;
  font-weight: 900;
  letter-spacing: .06em;
  color: var(--muted2);
  margin-bottom: 6px;
}

.hud-value{
  font-size: 28px;
  font-weight: 950;
  letter-spacing: .02em;
  color: rgba(255,255,255,.94);
}

/* VR mini hint chip inside hud row */
#vrMiniHud{
  pointer-events:none !important;
}

/* progress */
.gj-progress{
  margin-top: 10px;
  pointer-events:none !important;
}
.gj-progress-track{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.gj-progress-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(65,210,125,.90), rgba(255,180,60,.92), rgba(255,80,90,.92));
}

/* bossbar */
.gj-bossbar{
  margin-top: 10px;
  padding: 12px 14px;
  border-radius: var(--radius2);
  border-color: rgba(255,80,90,.18);
  background: linear-gradient(180deg, rgba(255,80,90,.10), rgba(10,16,32,.72));
  pointer-events:none !important; /* critical */
}
.gj-bossbar-head{
  display:flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 10px;
  margin-bottom: 10px;
}
.gj-bossbar-title{
  font-weight: 950;
  font-size: 16px;
  letter-spacing: .02em;
}
.gj-bossbar-hint{
  font-weight: 850;
  font-size: 13px;
  color: rgba(255,255,255,.76);
}
.gj-bossbar-track{
  height: 12px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.12);
  overflow:hidden;
}
.gj-bossbar-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,80,90,.80), rgba(255,120,80,.85));
}

/* ---------------------------------------------------------
   FIELD (targets mount here) — MUST be tappable & above cards
--------------------------------------------------------- */
.gj-field{
  position: fixed;
  left: 0;
  right: 0;
  top: var(--gj-top-safe);
  bottom: var(--gj-bottom-safe);
  padding: var(--field-pad-y) var(--field-pad-x);
  z-index: var(--z-field);
  pointer-events: auto;        /* critical */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

.gj-layer{
  position:absolute;
  inset: 0;
  pointer-events: auto;
}

.gj-layer-r{
  opacity: 1;
}

/* Targets */
.gj-target{
  position:absolute;
  z-index: var(--z-target);
  pointer-events: auto !important;
  user-select:none;
  -webkit-user-select:none;
  -webkit-touch-callout:none;
  cursor: pointer;
  transform: translate(-50%, -50%) scale(1);
  filter: drop-shadow(0 14px 18px rgba(0,0,0,.45));
  will-change: transform, opacity;
  transition: transform .10s ease, opacity .12s ease;
}
.gj-target.spawn{ animation: gjPop .16s ease-out both; }
.gj-target.gone{
  opacity: 0;
  transform: translate(-50%, -50%) scale(.88);
}

@keyframes gjPop{
  from{ transform: translate(-50%, -50%) scale(.82); opacity:.0; }
  to  { transform: translate(-50%, -50%) scale(1.0); opacity:1; }
}

/* ---------------------------------------------------------
   HUD BOTTOM (fever + howto)
   IMPORTANT: pointer-events NONE to avoid blocking the field.
--------------------------------------------------------- */
.gj-hud-bot{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 10px 12px calc(var(--sab) + 14px);
  z-index: var(--z-hud);
  pointer-events: none; /* critical */
}

.gj-hud-bot{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.meter{
  padding: 12px 14px;
  border-radius: var(--radius2);
  background: var(--panel2);
}

.meter-title{
  font-weight: 950;
  letter-spacing: .02em;
  margin-bottom: 10px;
  font-size: 15px;
}

.meter-bar{
  height: 12px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.12);
  overflow:hidden;
  margin-bottom: 10px;
}
.meter-fill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(65,210,125,.92), rgba(255,180,60,.92), rgba(255,80,90,.92));
}

.meter-num, .meter-shield{
  font-weight: 850;
  color: rgba(255,255,255,.82);
  margin-bottom: 6px;
}

.meter-tip{
  color: var(--muted);
  font-weight: 800;
  line-height: 1.45;
}

/* ---------------------------------------------------------
   HUD hidden mode (more play space)
--------------------------------------------------------- */
body.hud-hidden .gj-hud-top,
body.hud-hidden .gj-hud-bot{
  display: none !important;
}
body.hud-hidden .gj-field{
  top: calc(var(--sat) + 78px);
  bottom: calc(var(--sab) + 74px);
}

/* ---------------------------------------------------------
   Quest panel overlay lock
--------------------------------------------------------- */
.gj-quest-panel{
  position: fixed;
  inset: 0;
  z-index: var(--z-quest);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: calc(var(--sat) + 18px) 14px calc(var(--sab) + 18px);
  background: rgba(0,0,0,.45);
}
.gj-quest-panel[aria-hidden="true"]{
  display: none !important;           /* key: not blocking */
  pointer-events: none !important;
}
.gj-quest-panel[aria-hidden="false"]{
  display:flex;
  pointer-events: auto;
}

.gj-quest-card{
  width: min(560px, 100%);
  max-height: calc(100vh - (var(--sat) + var(--sab) + 46px));
  overflow:auto;
  padding: 14px;
  background: rgba(10,16,32,.86);
  border-color: rgba(255,255,255,.14);
  border-radius: 24px;
}

.gj-quest-head{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 12px;
}
.gj-quest-title{
  font-weight: 950;
  font-size: 18px;
}

.gj-quest-section{
  padding: 12px 12px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  margin-bottom: 10px;
}
.q-title{
  font-weight: 950;
  margin-bottom: 8px;
}
.q-desc{
  color: rgba(255,255,255,.78);
  font-weight: 800;
  line-height: 1.45;
  margin-bottom: 10px;
}
.q-bar{
  display:flex;
  justify-content: space-between;
  align-items:center;
  gap: 8px;
}
.q-num{
  font-weight: 950;
}
.q-hint{
  color: rgba(255,255,255,.62);
  font-weight: 850;
}

.gj-ul{
  margin: 0;
  padding-left: 18px;
  color: rgba(255,255,255,.78);
  font-weight: 850;
  line-height: 1.55;
}
.gj-ul li{ margin: 6px 0; }

/* When quest open, freeze background scroll anyway */
body.quest-open{
  overflow:hidden;
}

/* ---------------------------------------------------------
   Low time overlay (hidden = not blocking)
--------------------------------------------------------- */
.gj-lowtime-overlay{
  position: fixed;
  inset: 0;
  z-index: var(--z-low);
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}
.gj-lowtime-overlay[aria-hidden="true"]{
  display:none !important;
  pointer-events:none !important;
}
.gj-lowtime-ring{
  width: 160px;
  height: 160px;
  border-radius: 999px;
  border: 6px solid rgba(255,80,90,.22);
  box-shadow: 0 0 0 10px rgba(255,80,90,.08);
  animation: gjPulse .9s ease-in-out infinite;
}
.gj-lowtime-num{
  position: absolute;
  font-size: 56px;
  font-weight: 950;
  color: rgba(255,255,255,.94);
  text-shadow: 0 18px 40px rgba(0,0,0,.55);
}
@keyframes gjPulse{
  0%{ transform: scale(1); opacity: .65; }
  50%{ transform: scale(1.06); opacity: 1; }
  100%{ transform: scale(1); opacity: .65; }
}

/* Tick flash helper class (safe.js toggles body.gj-tick) */
body.gj-tick{
  animation: gjTick .12s ease-in-out both;
}
@keyframes gjTick{
  from{ filter: saturate(1.0); }
  to{ filter: saturate(1.25); }
}

/* ---------------------------------------------------------
   End overlay (hidden = not blocking)
--------------------------------------------------------- */
.gj-end{
  position: fixed;
  inset: 0;
  z-index: var(--z-end);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: calc(var(--sat) + 18px) 14px calc(var(--sab) + 18px);
  background: rgba(0,0,0,.55);
}
.gj-end[aria-hidden="true"]{
  display:none !important;
  pointer-events:none !important;
}
.gj-end .card{
  width: min(520px, 100%);
  padding: 16px;
  background: rgba(10,16,32,.90);
  border-radius: 24px;
  border-color: rgba(255,255,255,.14);
}
.gj-end .title{
  font-size: 20px;
  font-weight: 950;
  margin-bottom: 6px;
}
.gj-end .sub{
  color: rgba(255,255,255,.72);
  font-weight: 850;
  margin-bottom: 14px;
}
.gj-end .grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 14px;
}
.gj-end .stat{
  padding: 12px 12px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
}
.gj-end .stat span{
  display:block;
  font-size: 12px;
  font-weight: 950;
  letter-spacing: .06em;
  color: rgba(255,255,255,.55);
  margin-bottom: 6px;
}
.gj-end .stat b{
  font-size: 20px;
  font-weight: 950;
}
.gj-end .actions{
  display:flex;
  gap: 10px;
}
.gj-end .btn{
  flex:1;
  padding: 12px 14px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.92);
  font-weight: 950;
  cursor:pointer;
}
.gj-end .btn.alt{
  background: linear-gradient(180deg, rgba(60,220,140,.20), rgba(10,16,32,.70));
  border-color: rgba(65,210,125,.30);
}
.gj-end .btn:active{ transform: translateY(1px); }

/* ---------------------------------------------------------
   FX layer z-index (Particles / FX Director)
   - If particles uses fixed canvas/div, keep it above field but non-blocking.
--------------------------------------------------------- */
#particles,
.particles,
canvas.particles,
.hha-fx,
.hha-fx-layer{
  position: fixed !important;
  inset: 0 !important;
  z-index: var(--z-fx) !important;
  pointer-events: none !important;
}

/* ---------------------------------------------------------
   Mode visual accents
--------------------------------------------------------- */
body.storm .gj-bossbar,
body.storm .hud-pill.warn{
  border-color: rgba(255,180,60,.22);
}
body.boss .gj-bossbar{
  border-color: rgba(255,80,90,.26);
}
body.rage .gj-bossbar{
  box-shadow: 0 18px 46px rgba(255,80,90,.22);
}

/* hit pulses (safe.js toggles these classes) */
body.gj-junk-hit{ animation: gjRed .22s ease-out both; }
body.gj-skull-hit{ animation: gjRed .24s ease-out both; }
body.gj-bomb{ animation: gjRed .30s ease-out both; }
body.gj-good-expire{ animation: gjAmber .16s ease-out both; }
body.gj-storm{ animation: gjAmber .24s ease-out both; }
body.gj-boss{ animation: gjRed .28s ease-out both; }
body.gj-rage{ animation: gjRed .32s ease-out both; }
body.gj-stomp{ animation: gjRed .24s ease-out both; }
body.gj-boss-down{ animation: gjGreen .26s ease-out both; }
body.gj-miss-shot{ animation: gjAmber .12s ease-out both; }

@keyframes gjRed{
  from{ filter: hue-rotate(0deg) saturate(1.0); }
  to{ filter: hue-rotate(-10deg) saturate(1.25); }
}
@keyframes gjAmber{
  from{ filter: saturate(1.0); }
  to{ filter: saturate(1.18); }
}
@keyframes gjGreen{
  from{ filter: hue-rotate(0deg) saturate(1.0); }
  to{ filter: hue-rotate(10deg) saturate(1.25); }
}

/* ---------------------------------------------------------
   Responsive: mobile short screens (layout not tight)
--------------------------------------------------------- */
@media (max-height: 780px){
  :root{
    --gj-top-safe: calc(var(--sat) + 155px);
    --gj-bottom-safe: calc(var(--sab) + 132px);
  }
  .hud-value{ font-size: 26px; }
  .hud-pill{ min-width: 110px; padding: 10px 12px; }
  .meter{ padding: 10px 12px; }
  .meter-title{ font-size: 14px; }
}

@media (max-height: 720px){
  :root{
    --gj-top-safe: calc(var(--sat) + 145px);
    --gj-bottom-safe: calc(var(--sab) + 118px);
  }
  .gj-hud-bot{
    padding-bottom: calc(var(--sab) + 10px);
  }
  .gj-hud-bot{
    grid-template-columns: 1fr; /* stack meters */
  }
}

/* ---------------------------------------------------------
   THE FIX: ensure HUD never steals pointer events
   - only topbar buttons clickable
--------------------------------------------------------- */
.gj-hud-top *,
.gj-hud-bot *{
  pointer-events: none;
}

/* but allow topbar controls */
.gj-topbar button,
.gj-topbar .gj-btn,
.gj-topbar .gj-chip{
  pointer-events: auto;
}

/* quest/end buttons are clickable */
.gj-quest-card button,
.gj-end .btn{
  pointer-events: auto;
}

/* ---------------------------------------------------------
   PATCH v20260217d — extra hardening: FIELD always above "cards"
   (แก้อาการ “เป้าโดนบัง/ตีไม่ได้” ตามรูปที่ส่งมา)
--------------------------------------------------------- */
.gj-field{ z-index: var(--z-field); }
.gj-target{ z-index: var(--z-target); }
.gj-hud-top, .gj-hud-bot{ z-index: var(--z-hud); }