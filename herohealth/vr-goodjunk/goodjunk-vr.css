/* === /herohealth/vr-goodjunk/goodjunk-vr.css ===
GoodJunkVR — PRODUCTION CSS (ULTRA FX + SAFE SPAWN)
✅ supports view: pc / mobile / vr / cvr (body.view-*)
✅ supports HUD hide toggle (body.hud-hidden)
✅ SAFE SPAWN via vars: --gj-top-safe / --gj-bottom-safe (+ safe-area)
✅ stage: #gjField + #gj-layer L/R (cVR split)
✅ targets: .gj-target (size driven by JS font-size)
✅ effects: hit/miss/bad, storm/boss/rage, low-time ring, mission peek, end overlay
*/

:root{
  color-scheme: dark;

  --bg:#020617;
  --panel:rgba(2,6,23,.78);
  --panel2:rgba(15,23,42,.66);
  --stroke:rgba(148,163,184,.20);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;

  --radius:22px;
  --pill:999px;

  /* safe-area */
  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  /* HUD safe spawn (boot/inline measure sets these) */
  --gj-top-safe: 140px;
  --gj-bottom-safe: 130px;

  /* playfield */
  --play-pad-x: 12vw;    /* left/right margin for spawn */
  --play-min-h: 300px;

  /* target feel */
  --t-shadow: 0 18px 45px rgba(0,0,0,.42);
  --t-stroke: drop-shadow(0 2px 0 rgba(0,0,0,.25));
}

*{ box-sizing:border-box; }
html, body{ height:100%; width:100%; margin:0; padding:0; overflow:hidden; }
body{
  background:
    radial-gradient(circle at 20% 10%, rgba(34,211,238,.10), transparent 55%),
    radial-gradient(circle at 80% 90%, rgba(167,139,250,.10), transparent 60%),
    linear-gradient(180deg, #020617, #050b1a);
  color:var(--text);
  font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans Thai", sans-serif;
}

/* --- base view flags --- */
body.gj{ position:relative; }
body.view-pc{}
body.view-mobile{}
body.view-vr{}
body.view-cvr{}

/* --- topbar --- */
.gj-topbar{
  position: fixed;
  inset: calc(10px + var(--sat)) calc(10px + var(--sar)) auto calc(10px + var(--sal));
  z-index: 120;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  pointer-events: none; /* allow VR UI buttons still clickable around; enable on children */
}
.gj-topbar .left, .gj-topbar .right{
  display:flex;
  align-items:center;
  gap:10px;
  pointer-events:auto;
}
.gj-chip{
  padding: 10px 12px;
  border-radius: var(--pill);
  background: rgba(2,6,23,.64);
  border: 1px solid rgba(148,163,184,.18);
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
  font-weight: 900;
  font-size: 12px;
  color: rgba(229,231,235,.92);
  max-width: 62vw;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.gj-btn{
  height: 40px;
  padding: 0 12px;
  border-radius: 14px;
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.55);
  color: rgba(229,231,235,.96);
  font-weight: 900;
  font-size: 12px;
  cursor: pointer;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
}
.gj-btn:active{ transform: translateY(1px); }
.gj-btn.primary{
  border-color: rgba(34,197,94,.35);
  background: rgba(34,197,94,.14);
  color: #eafff3;
}

/* --- HUD TOP --- */
.gj-hud-top{
  position: fixed;
  inset: calc(62px + var(--sat)) calc(10px + var(--sar)) auto calc(10px + var(--sal));
  z-index: 110;
  display:flex;
  flex-direction: column;
  gap: 10px;
  pointer-events:none;
}
.hud-row{
  display:flex;
  gap:10px;
  flex-wrap: wrap;
  pointer-events:auto;
}
.hud-pill{
  background: var(--panel);
  border: 1px solid rgba(148,163,184,.20);
  border-radius: 18px;
  padding: 10px 12px;
  min-width: 94px;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
}
.hud-label{
  font-size: 11px;
  font-weight: 1000;
  letter-spacing: .4px;
  color: var(--muted);
}
.hud-value{
  margin-top: 2px;
  font-size: 20px;
  font-weight: 1200;
  line-height: 1.05;
}
.hud-pill.warn .hud-value{ color: #ffd7a5; }
.hud-pill.grade .hud-value{ color: #d7fbe6; }

.quest-row{
  display:grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 10px;
  pointer-events:auto;
}
.quest-card{
  background: rgba(15,23,42,.60);
  border: 1px solid rgba(148,163,184,.20);
  border-radius: 18px;
  padding: 10px 12px;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
}
.quest-card.mini{
  background: rgba(2,6,23,.60);
}
.q-title{
  font-size: 12px;
  font-weight: 1100;
  color: rgba(229,231,235,.95);
}
.q-desc{
  margin-top: 4px;
  font-size: 12px;
  font-weight: 900;
  color: rgba(229,231,235,.90);
}
.q-bar{
  margin-top: 8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  color: var(--muted);
  font-size: 11px;
  font-weight: 900;
}
.q-num{ color: rgba(229,231,235,.92); }
.q-hint{ opacity:.9; }

/* --- HUD BOTTOM --- */
.gj-hud-bot{
  position: fixed;
  inset: auto calc(10px + var(--sar)) calc(10px + var(--sab)) calc(10px + var(--sal));
  z-index: 110;
  display:flex;
  gap:10px;
  align-items: stretch;
  pointer-events:none;
}
.meter{
  flex:1;
  min-width: 160px;
  background: var(--panel);
  border: 1px solid rgba(148,163,184,.20);
  border-radius: 18px;
  padding: 10px 12px;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
  pointer-events:auto;
}
.meter-title{
  font-size: 11px;
  font-weight: 1000;
  color: var(--muted);
  letter-spacing:.35px;
}
.meter-bar{
  margin-top: 8px;
  height: 12px;
  border-radius: 999px;
  background: rgba(148,163,184,.16);
  overflow:hidden;
  border: 1px solid rgba(148,163,184,.12);
}
.meter-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(34,197,94,.92), rgba(34,211,238,.92));
  box-shadow: 0 10px 24px rgba(34,211,238,.12);
}
.meter-num{
  margin-top: 6px;
  font-weight: 1100;
  font-size: 12px;
  color: rgba(229,231,235,.92);
}
.meter.shield .meter-shield{
  margin-top: 8px;
  font-size: 16px;
  font-weight: 1100;
  letter-spacing:.5px;
}
.meter-tip{
  margin-top: 4px;
  font-size: 11px;
  font-weight: 900;
  color: rgba(148,163,184,.95);
}

/* --- HUD hidden mode (still keep safe area minimal) --- */
body.hud-hidden .gj-hud-top,
body.hud-hidden .gj-hud-bot{
  opacity: 0;
  pointer-events:none;
  transform: translateY(-8px);
  transition: opacity 140ms ease, transform 140ms ease;
}
body.hud-hidden .gj-topbar{
  opacity: .92;
}

/* --- PLAYFIELD --- */
.gj-field{
  position: fixed;
  inset: 0;
  z-index: 50;
  overflow:hidden;
  user-select:none;
  touch-action: manipulation;
}
.gj-layer{
  position:absolute;
  inset: 0;
}
.gj-layer-r{
  opacity: 0;
}

/* cVR split: two eyes side-by-side */
body.view-cvr .gj-layer{
  width: 50%;
}
body.view-cvr .gj-layer-r{
  left: 50%;
  width: 50%;
  opacity: 1;
}

/* STRICT cVR: prevent direct tapping on targets if you want crosshair-only
   (if you want click allowed, comment this block) */
body.view-cvr .gj-target{
  pointer-events: none;
}

/* --- TARGETS --- */
.gj-target{
  position:absolute;
  transform: translate(-50%,-50%) scale(1);
  will-change: transform, opacity;
  filter: var(--t-stroke) drop-shadow(var(--t-shadow));
  text-shadow:
    0 2px 0 rgba(0,0,0,.25),
    0 14px 32px rgba(0,0,0,.35);
  cursor: pointer;
  line-height: 1;
  opacity: 0.0;
  transition: transform 140ms ease, opacity 140ms ease;
}
.gj-target.spawn{
  opacity: 1;
  transform: translate(-50%,-50%) scale(1.02);
  animation: gjPopIn 160ms ease-out both;
}
@keyframes gjPopIn{
  0%{ opacity:0; transform: translate(-50%,-50%) scale(.86); }
  100%{ opacity:1; transform: translate(-50%,-50%) scale(1.02); }
}
.gj-target.gone{
  opacity: 0;
  transform: translate(-50%,-60%) scale(.88);
}

/* --- LOW TIME overlay (5..1) --- */
.gj-lowtime-overlay{
  position: fixed;
  inset: 0;
  z-index: 140;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
  opacity: 0;
  transition: opacity 160ms ease;
}
.gj-lowtime-overlay[aria-hidden="false"]{ opacity: 1; }

.gj-lowtime-ring{
  width: 240px;
  height: 240px;
  border-radius: 999px;
  border: 6px dashed rgba(255,255,255,.22);
  box-shadow: 0 22px 60px rgba(0,0,0,.45);
  animation: gjRing 980ms linear infinite;
}
@keyframes gjRing{ to{ transform: rotate(360deg); } }

.gj-lowtime-num{
  position:absolute;
  font-size: 84px;
  font-weight: 1300;
  letter-spacing: .5px;
  color: rgba(255,255,255,.92);
  text-shadow: 0 18px 55px rgba(0,0,0,.55);
  transform: translateY(-6px);
}

/* --- Missions peek overlay --- */
.gj-peek{
  position: fixed;
  inset: 0;
  z-index: 150;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  pointer-events:none;
  opacity: 0;
  transition: opacity 180ms ease;
  padding-top: calc(100px + var(--sat));
}
body.show-missions .gj-peek{
  opacity: 1;
}
.peek-card{
  width: min(720px, 92vw);
  background: rgba(2,6,23,.82);
  border: 1px solid rgba(148,163,184,.22);
  border-radius: 22px;
  padding: 14px 16px;
  box-shadow: 0 20px 70px rgba(0,0,0,.52);
}
.peek-title{
  font-weight: 1200;
  font-size: 16px;
}
.peek-sub{
  margin-top: 6px;
  color: rgba(229,231,235,.90);
  font-weight: 1000;
  font-size: 13px;
}
.peek-mini{
  margin-top: 6px;
  color: rgba(229,231,235,.88);
  font-weight: 1000;
  font-size: 13px;
}
.peek-tip{
  margin-top: 8px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  font-size: 12px;
}

/* --- End overlay (fallback) --- */
.gj-end{
  position: fixed;
  inset: 0;
  z-index: 220;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(2,6,23,.86);
  backdrop-filter: blur(10px);
  padding: calc(18px + var(--sat)) 16px calc(18px + var(--sab)) 16px;
}
.gj-end .card{
  width: min(760px, 94vw);
  background: rgba(2,6,23,.84);
  border: 1px solid rgba(148,163,184,.22);
  border-radius: 22px;
  padding: 18px;
  box-shadow: 0 18px 55px rgba(0,0,0,.45);
}
.gj-end .title{
  font-size: 22px;
  font-weight: 1200;
}
.gj-end .sub{
  margin-top: 6px;
  color: rgba(148,163,184,.95);
  font-weight: 900;
  font-size: 12px;
}
.gj-end .grid{
  margin-top: 14px;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}
.gj-end .stat{
  background: rgba(15,23,42,.58);
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 18px;
  padding: 10px 12px;
}
.gj-end .stat span{
  display:block;
  color: rgba(148,163,184,.95);
  font-weight: 1000;
  font-size: 11px;
}
.gj-end .stat b{
  display:block;
  margin-top: 3px;
  font-size: 20px;
  font-weight: 1200;
}
.gj-end .actions{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
}
.gj-end .btn{
  flex:1;
  min-width: 220px;
  height: 54px;
  border-radius: 16px;
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.55);
  color: rgba(229,231,235,.96);
  font-weight: 1200;
  font-size: 16px;
  cursor: pointer;
}
.gj-end .btn.alt{
  border-color: rgba(34,197,94,.35);
  background: rgba(34,197,94,.14);
  color:#eafff3;
}

/* ---------------- FX REACTIVE CLASSES (from hha-fx-director.js) ---------------- */

/* Storm: subtle pulse + slightly brighter */
body.fx-storm{
  animation: gjStormPulse 980ms ease-in-out infinite;
}
@keyframes gjStormPulse{
  0%{ filter: brightness(1) saturate(1); }
  50%{ filter: brightness(1.06) saturate(1.08); }
  100%{ filter: brightness(1) saturate(1); }
}

/* Boss: vignette + shake micro */
body.fx-boss{
  animation: gjBossShake 520ms ease-in-out infinite;
}
@keyframes gjBossShake{
  0%{ transform: translate3d(0,0,0); }
  35%{ transform: translate3d(.6px,-.4px,0); }
  70%{ transform: translate3d(-.5px,.5px,0); }
  100%{ transform: translate3d(0,0,0); }
}

/* Rage: stronger pulse, higher contrast (still readable for kids) */
body.fx-rage{
  animation: gjRagePulse 760ms ease-in-out infinite;
}
@keyframes gjRagePulse{
  0%{ filter: brightness(1.02) contrast(1.02) saturate(1.06); }
  50%{ filter: brightness(1.12) contrast(1.06) saturate(1.18); }
  100%{ filter: brightness(1.02) contrast(1.02) saturate(1.06); }
}

/* Hit/Miss class reactions (director toggles short-lived) */
body.fx-hit-good .gj-field{
  filter: drop-shadow(0 0 28px rgba(34,197,94,.10));
}
body.fx-hit-bad .gj-field{
  filter: drop-shadow(0 0 34px rgba(239,68,68,.12));
}
body.fx-miss .gj-field{
  filter: drop-shadow(0 0 34px rgba(249,115,115,.12));
}

/* --- responsive tweaks --- */
@media (max-width: 560px){
  .quest-row{ grid-template-columns: 1fr; }
  .gj-topbar .right .gj-btn{ height:38px; padding:0 10px; }
  .hud-value{ font-size: 18px; }
  .gj-lowtime-ring{ width: 210px; height:210px; }
  .gj-lowtime-num{ font-size: 76px; }
}

/* --- VR readability tweaks --- */
body.view-vr .gj-hud-top,
body.view-cvr .gj-hud-top{
  transform: translateZ(0);
}
body.view-vr .hud-pill,
body.view-cvr .hud-pill{
  background: rgba(2,6,23,.72);
}
body.view-vr .quest-card,
body.view-cvr .quest-card{
  background: rgba(2,6,23,.68);
}

/* --- keep topbar above VR UI controls if overlay exists --- */
.hha-controls{ z-index: 130 !important; }