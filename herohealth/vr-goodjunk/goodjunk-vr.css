/* === /herohealth/vr-goodjunk/goodjunk-vr.css ===
   GoodJunkVR — PRODUCTION (COMPACT + OVERLAY LOCK + FX Z-INDEX)
   v2026-02-18c

   Goals:
   ✅ จอเตี้ย/มือถือ: ไม่แน่น ไม่ทับกัน
   ✅ HUD ไม่บังเป้า (spawn safe vars + pointer-events hardening)
   ✅ FX layer เห็นแน่ (z-index + isolation)
   ✅ Quest panel โผล่สวย ไม่บีบ HUD
   ✅ low-time overlay ชัด (aria-hidden drives visibility)
*/

:root{
  /* safe-area insets */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  /* spawn safe vars (boot updates these) */
  --gj-top-safe: 140px;
  --gj-bottom-safe: 120px;

  /* layout */
  --gj-maxw: 980px;
  --gj-gap: 10px;
  --gj-radius: 16px;

  /* HUD sizing */
  --hud-pill-w: 92px;
  --hud-pill-h: 54px;

  /* z */
  --z-field: 20;
  --z-fx: 80;
  --z-hud: 120;
  --z-topbar: 160;
  --z-controls: 170;
  --z-overlay: 220;

  /* colors */
  --c-bg: #0b0f14;
  --c-panel: rgba(18,24,32,.88);
  --c-panel2: rgba(18,24,32,.72);
  --c-text: rgba(255,255,255,.92);
  --c-dim: rgba(255,255,255,.72);
  --c-line: rgba(255,255,255,.12);
  --c-warn: rgba(255, 185, 0, .18);
  --c-danger: rgba(255, 80, 80, .18);
  --c-ok: rgba(120, 255, 170, .16);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body.gj{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
  background: radial-gradient(1200px 600px at 50% 0%, rgba(60,120,255,.10), transparent 62%),
              radial-gradient(900px 500px at 10% 80%, rgba(255,120,120,.08), transparent 60%),
              var(--c-bg);
  color: var(--c-text);
  overflow:hidden;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;

  /* make z-index reliable */
  position:relative;
  isolation:isolate;
}

/* ---------------------------
   TOPBAR
---------------------------- */
.gj-topbar{
  position:fixed;
  top:0;
  left:0;
  right:0;
  padding: calc(10px + var(--sat)) calc(12px + var(--sar)) 10px calc(12px + var(--sal));
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  z-index: var(--z-topbar);
  pointer-events:auto;
  background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
}

.gj-topbar .left,
.gj-topbar .right{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}

.gj-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 7px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.09);
  border: 1px solid rgba(255,255,255,.10);
  color: var(--c-dim);
  font-size: 13px;
  line-height: 1;
  backdrop-filter: blur(8px);
}
.gj-chip-brand{
  background: rgba(120,255,170,.10);
  border-color: rgba(120,255,170,.22);
  color: rgba(225,255,238,.92);
}
.gj-chip-mini{
  padding: 6px 10px;
  font-size: 12px;
  opacity: .92;
}

.gj-btn{
  appearance:none;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08);
  color: rgba(255,255,255,.92);
  border-radius: 999px;
  padding: 8px 12px;
  font-size: 13px;
  line-height: 1;
  cursor:pointer;
  pointer-events:auto;
  backdrop-filter: blur(10px);
}
.gj-btn:hover{ background: rgba(255,255,255,.12); }
.gj-btn:active{ transform: translateY(1px); }
.gj-btn.primary{
  background: rgba(80,160,255,.22);
  border-color: rgba(80,160,255,.35);
}

/* ---------------------------
   HUD TOP (pointer-events none by default)
---------------------------- */
.gj-hud-top{
  position:fixed;
  left:0; right:0;
  top: calc(54px + var(--sat));
  padding: 0 calc(12px + var(--sar)) 0 calc(12px + var(--sal));
  z-index: var(--z-hud);
  pointer-events:none;
}
.gj-hud-top > *{
  max-width: var(--gj-maxw);
  margin: 0 auto;
}

.hud-row{
  display:flex;
  align-items:center;
  gap: var(--gj-gap);
  flex-wrap:wrap;
  justify-content:flex-start;
}

.hud-pill{
  width: var(--hud-pill-w);
  min-width: var(--hud-pill-w);
  height: var(--hud-pill-h);
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:4px;
  padding: 8px 10px;
  border-radius: 14px;
  background: var(--c-panel);
  border: 1px solid var(--c-line);
  box-shadow: 0 8px 30px rgba(0,0,0,.25);
}
.hud-pill .hud-label{
  font-size: 11px;
  letter-spacing:.06em;
  color: rgba(255,255,255,.70);
}
.hud-pill .hud-value{
  font-size: 18px;
  font-weight: 800;
  line-height:1;
}
.hud-pill.warn{
  background: linear-gradient(180deg, rgba(255,185,0,.18), rgba(18,24,32,.88));
  border-color: rgba(255,185,0,.25);
}
.hud-pill.grade{
  background: linear-gradient(180deg, rgba(120,255,170,.18), rgba(18,24,32,.88));
  border-color: rgba(120,255,170,.22);
}

/* progress */
.gj-progress{ margin-top: 8px; pointer-events:none; }
.gj-progress-track{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.gj-progress-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: rgba(80,160,255,.55);
}

/* boss bar */
.gj-bossbar{
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 16px;
  background: linear-gradient(180deg, rgba(255,80,80,.18), rgba(18,24,32,.88));
  border: 1px solid rgba(255,80,80,.20);
  pointer-events:none;
}
.gj-bossbar[aria-hidden="true"]{ display:none; }
.gj-bossbar-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}
.gj-bossbar-title{ font-weight:900; letter-spacing:.02em; }
.gj-bossbar-hint{ font-size:12px; color: rgba(255,255,255,.80); }
.gj-bossbar-track{
  height: 10px;
  border-radius:999px;
  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.gj-bossbar-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: rgba(255,80,80,.70);
}

/* ---------------------------
   PLAYFIELD
---------------------------- */
.gj-field{
  position:fixed;
  inset: 0;
  z-index: var(--z-field);
  pointer-events:auto;
}

/* visual safe padding (spawn safe handled in JS) */
#playfield, .gj-field{
  padding-top: calc(var(--gj-top-safe) + 6px);
  padding-bottom: calc(var(--gj-bottom-safe) + 6px);
}

.gj-layer{
  position:absolute;
  inset:0;
  pointer-events:auto;
}
.gj-layer-r{ display:none; }
body.view-cvr .gj-layer-r{ display:block; }

/* targets */
.gj-target{
  position:absolute;
  transform: translate(-50%, -50%) scale(1);
  user-select:none;
  cursor:pointer;
  will-change: transform, opacity, filter;
  filter: drop-shadow(0 6px 16px rgba(0,0,0,.40));
  z-index: 5;
}
.gj-target.spawn{ animation: gjPop .14s ease-out both; }
.gj-target.gone{ animation: gjGone .14s ease-in both; }

@keyframes gjPop{
  from{ transform: translate(-50%,-50%) scale(.75); opacity:.0; }
  to{ transform: translate(-50%,-50%) scale(1); opacity:1; }
}
@keyframes gjGone{
  from{ transform: translate(-50%,-50%) scale(1); opacity:1; }
  to{ transform: translate(-50%,-50%) scale(.75); opacity:0; }
}

/* ---------------------------
   HUD BOTTOM (pointer-events none)
---------------------------- */
.gj-hud-bot{
  position:fixed;
  left:0; right:0;
  bottom:0;
  padding: 10px calc(12px + var(--sar)) calc(10px + var(--sab)) calc(12px + var(--sal));
  z-index: var(--z-hud);
  pointer-events:none;
  display:flex;
  gap:10px;
  align-items:stretch;
  justify-content:space-between;
}
.gj-hud-bot > *{
  max-width: var(--gj-maxw);
  margin: 0 auto;
}

.meter{
  flex:1 1 0;
  min-width: 220px;
  padding: 10px 12px;
  border-radius: 16px;
  background: var(--c-panel);
  border: 1px solid var(--c-line);
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}
.meter-title{
  font-weight:900;
  letter-spacing:.03em;
  font-size: 12px;
  color: rgba(255,255,255,.86);
  margin-bottom:8px;
}
.meter-bar{
  height: 10px;
  border-radius:999px;
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.12);
  overflow:hidden;
  margin-bottom:6px;
}
.meter-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: rgba(120,255,170,.65);
}
.meter-num, .meter-tip, .meter-shield{
  font-size: 12px;
  color: rgba(255,255,255,.80);
}
.meter-tip{ opacity:.92; }

/* ---------------------------
   QUEST PANEL (overlay lock)
---------------------------- */
.gj-quest-panel{
  position:fixed;
  inset:0;
  z-index: var(--z-overlay);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: calc(12px + var(--sat)) calc(12px + var(--sar)) calc(12px + var(--sab)) calc(12px + var(--sal));
  background: rgba(0,0,0,.52);
  backdrop-filter: blur(8px);
  pointer-events:auto;
}
.gj-quest-panel[aria-hidden="true"]{ display:none; }

.gj-quest-card{
  width: min(640px, 96vw);
  max-height: min(76vh, 680px);
  overflow:auto;
  border-radius: 18px;
  background: rgba(16,20,28,.92);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 16px 60px rgba(0,0,0,.55);
  padding: 12px 12px 14px;
  pointer-events:auto;
}
.gj-quest-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding-bottom:8px;
  border-bottom: 1px solid rgba(255,255,255,.10);
  margin-bottom:10px;
}
.gj-quest-title{ font-weight: 950; font-size: 16px; }

.gj-quest-section{
  padding: 10px 10px;
  border-radius: 14px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.08);
  margin: 10px 0;
}
.q-title{ font-weight:900; margin-bottom:6px; }
.q-desc{ color: rgba(255,255,255,.82); margin-bottom:8px; }
.q-hint{ color: rgba(255,255,255,.70); font-size: 12px; }

.q-bar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.q-num{
  font-weight:900;
  color: rgba(255,255,255,.92);
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 12px;
}
.gj-ul{ margin: 8px 0 0 16px; padding: 0; }
.gj-ul li{ margin: 6px 0; color: rgba(255,255,255,.86); font-size: 13px; }

body.quest-open .gj-hud-top,
body.quest-open .gj-hud-bot{
  opacity: .18;
}

/* ---------------------------
   LOW TIME OVERLAY (aria-hidden driven)
---------------------------- */
.gj-lowtime-overlay{
  position:fixed;
  left:50%;
  top: calc(var(--gj-top-safe) + 16px);
  transform: translateX(-50%);
  z-index: var(--z-overlay);
  pointer-events:none;
  display:grid;
  place-items:center;
  width: 120px;
  height: 120px;
}
.gj-lowtime-ring{
  width: 120px;
  height: 120px;
  border-radius: 999px;
  border: 10px solid rgba(255,80,80,.35);
  box-shadow: 0 10px 40px rgba(255,80,80,.22);
  opacity:0;
  transform: scale(.92);
  transition: opacity .12s ease, transform .12s ease;
}
.gj-lowtime-num{
  position:absolute;
  font-weight: 950;
  font-size: 44px;
  color: rgba(255,255,255,.95);
  text-shadow: 0 10px 26px rgba(0,0,0,.55);
  opacity:0;
  transform: scale(.92);
  transition: opacity .12s ease, transform .12s ease;
}
#lowTimeOverlay[aria-hidden="false"] .gj-lowtime-ring,
#lowTimeOverlay[aria-hidden="false"] .gj-lowtime-num{
  opacity:1 !important;
  transform: scale(1) !important;
}
body.gj-tick .gj-lowtime-ring{
  transform: scale(1.04) !important;
}

/* ---------------------------
   END OVERLAY
---------------------------- */
.gj-end{
  position:fixed;
  inset:0;
  z-index: var(--z-overlay);
  display:none;
  align-items:center;
  justify-content:center;
  padding: calc(12px + var(--sat)) calc(12px + var(--sar)) calc(12px + var(--sab)) calc(12px + var(--sal));
  background: rgba(0,0,0,.58);
  backdrop-filter: blur(8px);
  pointer-events:auto;
}
.gj-end[aria-hidden="false"]{ display:flex; }

.gj-end .card{
  width: min(560px, 94vw);
  border-radius: 18px;
  background: rgba(16,20,28,.94);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 16px 60px rgba(0,0,0,.60);
  padding: 14px 14px 16px;
}
.gj-end .title{ font-weight: 950; font-size: 20px; margin-bottom:6px; }
.gj-end .sub{ color: rgba(255,255,255,.75); font-size: 12px; margin-bottom:12px; }
.gj-end .grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:10px;
  margin-bottom:12px;
}
.gj-end .stat{
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: 10px 10px;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
}
.gj-end .stat span{ color: rgba(255,255,255,.70); font-size: 12px; }
.gj-end .stat b{ font-size: 18px; }
.gj-end .actions{ display:flex; gap:10px; justify-content:flex-end; }
.gj-end .btn{
  appearance:none;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08);
  color: rgba(255,255,255,.92);
  border-radius: 14px;
  padding: 10px 12px;
  font-size: 13px;
  cursor:pointer;
}
.gj-end .btn.alt{
  background: rgba(80,160,255,.18);
  border-color: rgba(80,160,255,.26);
}

/* ---------------------------
   FX LAYER HARD LOCK
---------------------------- */
#fxLayer, .fx-layer, canvas.fx, canvas.particles{
  position:fixed !important;
  inset:0 !important;
  z-index: var(--z-fx) !important;
  pointer-events:none !important;
}

/* ---------------------------
   HUD HIDDEN MODE
---------------------------- */
body.hud-hidden .gj-hud-top,
body.hud-hidden .gj-hud-bot{
  opacity: 0.06;
}
body.hud-hidden .gj-hud-top,
body.hud-hidden .gj-hud-bot{
  pointer-events:none;
}

/* ---------------------------
   STATE FX CLASSES
---------------------------- */
body.boss .gj-topbar{
  background: linear-gradient(to bottom, rgba(255,80,80,.22), rgba(0,0,0,0));
}
body.storm .gj-topbar{
  background: linear-gradient(to bottom, rgba(80,160,255,.22), rgba(0,0,0,0));
}
body.rage .gj-topbar{
  background: linear-gradient(to bottom, rgba(255,120,0,.22), rgba(0,0,0,0));
}

/* ---------------------------
   RESPONSIVE COMPACT
---------------------------- */
@media (max-width: 520px){
  :root{
    --hud-pill-w: 84px;
    --hud-pill-h: 52px;
    --gj-gap: 8px;
  }
  .gj-btn{ padding: 8px 10px; font-size: 13px; }
  .gj-chip{ font-size: 12px; padding: 7px 9px; }
  .hud-pill .hud-value{ font-size: 17px; }
  .meter{ min-width: 0; }
  .gj-hud-bot{ flex-direction:column; }
}

@media (max-height: 700px){
  :root{
    --hud-pill-w: 86px;
    --hud-pill-h: 50px;
  }
  .gj-topbar{ padding-top: calc(8px + var(--sat)); padding-bottom: 8px; }
  .gj-hud-top{ top: calc(50px + var(--sat)); }
  .gj-progress-track{ height: 8px; }
  .meter{ padding: 9px 10px; }
  .gj-lowtime-overlay{ width: 108px; height: 108px; }
  .gj-lowtime-ring{ width:108px; height:108px; border-width: 9px; }
  .gj-lowtime-num{ font-size: 40px; }
}

@media (max-height: 600px){
  .gj-hud-bot .meter:nth-child(2){
    display:none;
  }
}

/* ---------------------------
   SAFETY: prevent selection artifacts
---------------------------- */
.gj *{
  -webkit-user-select: none;
  user-select: none;
}
code, pre{ -webkit-user-select:text; user-select:text; }