/* === /herohealth/vr-goodjunk/goodjunk-vr.css ===
GoodJunkVR UI+FX — PRODUCTION (HHA Standard + Ultra FX)
✅ view: pc / mobile / vr / cvr  (body.view-*)
✅ HUD-safe spawn vars: --gj-top-safe / --gj-bottom-safe (set by boot + fallback)
✅ FX supports:
   - HHA FX Director: body.fx-hit-good / fx-hit-bad / fx-miss / fx-kick / fx-endblink
   - GJ modes: body.gj-storm / gj-boss / gj-rage
✅ Prevent HUD blocking targets: pointer-events + safe-rect + z-index discipline
*/

/* -------------------- root tokens -------------------- */
:root{
  color-scheme: dark;
  --bg:#020617;
  --panel:rgba(2,6,23,.78);
  --panel2:rgba(15,23,42,.70);
  --stroke:rgba(148,163,184,.20);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;

  --radius:22px;
  --pill:999px;

  /* safe area */
  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  /* HUD-safe spawn (boot sets; fallback helper sets too) */
  --gj-top-safe: 150px;
  --gj-bottom-safe: 120px;

  /* playfield padding for targets */
  --gj-field-pad-x: clamp(10px, 3.8vw, 34px);
  --gj-field-pad-y: 10px;

  /* target */
  --gj-target-shadow: 0 16px 40px rgba(0,0,0,.40);
  --gj-target-stroke: rgba(148,163,184,.20);

  /* motion intensity */
  --gj-shake: 1; /* scaled for storm/boss/rage */
}

*{ box-sizing:border-box; }
html,body{
  width:100%;
  height:100%;
  margin:0;
  overflow:hidden;
  background:
    radial-gradient(circle at 18% 15%, rgba(34,211,238,.12), transparent 60%),
    radial-gradient(circle at 85% 82%, rgba(167,139,250,.11), transparent 65%),
    radial-gradient(circle at 50% 50%, rgba(34,197,94,.08), transparent 62%),
    var(--bg);
  color:var(--text);
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans Thai",sans-serif;
}

/* -------------------- global layers -------------------- */
.gj-topbar{ z-index:110; }
.gj-hud-top{ z-index:105; }
.gj-hud-bot{ z-index:105; }
.gj-field{ z-index:40; }
.hha-fx-layer{ z-index:90; }     /* particles */
.hha-vr-ui-layer{ z-index:130; } /* vr-ui.js layer (if it injects) */
.gj-peek{ z-index:160; }
.gj-lowtime-overlay{ z-index:170; }
.gj-end{ z-index:220; }

/* -------------------- topbar -------------------- */
.gj-topbar{
  position:fixed;
  left: calc(10px + var(--sal));
  right: calc(10px + var(--sar));
  top: calc(10px + var(--sat));
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  pointer-events:none; /* only buttons clickable */
}

.gj-topbar .left, .gj-topbar .right{
  display:flex;
  align-items:center;
  gap:10px;
}

.gj-chip{
  pointer-events:auto;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.62);
  color:var(--text);
  border-radius: var(--pill);
  padding:9px 12px;
  font: 900 12px/1 system-ui;
  backdrop-filter: blur(8px);
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}

.gj-btn{
  pointer-events:auto;
  height:36px;
  padding:0 12px;
  border-radius: var(--pill);
  border:1px solid rgba(148,163,184,.20);
  background: rgba(15,23,42,.55);
  color:var(--text);
  font: 1000 12px/1 system-ui;
  cursor:pointer;
  backdrop-filter: blur(8px);
  box-shadow: 0 10px 30px rgba(0,0,0,.20);
}
.gj-btn:active{ transform: translateY(1px); }
.gj-btn.primary{
  border-color: rgba(34,197,94,.30);
  background: rgba(34,197,94,.16);
  color:#eafff3;
}

/* -------------------- HUD layout -------------------- */
.gj-hud-top{
  position:fixed;
  left: calc(12px + var(--sal));
  right: calc(12px + var(--sar));
  top: calc(56px + var(--sat));
  pointer-events:none; /* important: HUD never blocks targets */
}
.gj-hud-bot{
  position:fixed;
  left: calc(12px + var(--sal));
  right: calc(12px + var(--sar));
  bottom: calc(12px + var(--sab));
  pointer-events:none; /* important */
}

/* HUD blocks */
.hud-row{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
@media (max-width:720px){
  .hud-row{ grid-template-columns: repeat(2, 1fr); }
}

.hud-pill{
  pointer-events:none;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.72);
  border-radius: 18px;
  padding:10px 12px;
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 42px rgba(0,0,0,.30);
}
.hud-pill .hud-label{
  color:var(--muted);
  font: 1000 11px/1 system-ui;
  letter-spacing:.3px;
}
.hud-pill .hud-value{
  margin-top:6px;
  font: 1200 20px/1 system-ui;
}
.hud-pill.warn{
  border-color: rgba(245,158,11,.30);
  background: rgba(245,158,11,.08);
}
.hud-pill.grade{
  border-color: rgba(34,211,238,.28);
  background: rgba(34,211,238,.08);
}

/* quests */
.quest-row{
  margin-top:10px;
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap:10px;
}
@media (max-width:920px){
  .quest-row{ grid-template-columns:1fr; }
}

.quest-card{
  pointer-events:none;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.55);
  border-radius: 18px;
  padding:10px 12px;
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 42px rgba(0,0,0,.28);
}
.quest-card.mini{
  border-color: rgba(167,139,250,.22);
  background: rgba(167,139,250,.08);
}
.q-title{
  font: 1100 12px/1 system-ui;
  color:var(--text);
}
.q-desc{
  margin-top:6px;
  color:var(--muted);
  font: 900 12px/1.3 system-ui;
}
.q-bar{
  margin-top:8px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.q-num{
  color:var(--text);
  font: 1100 12px/1 system-ui;
}
.q-hint{
  color:rgba(148,163,184,.85);
  font: 900 11px/1 system-ui;
}

/* bottom meters */
.meter{
  display:flex;
  align-items:center;
  gap:10px;
  border:1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.70);
  border-radius: 18px;
  padding:10px 12px;
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 42px rgba(0,0,0,.30);
}
.meter + .meter{ margin-top:10px; }
.meter-title{
  width:64px;
  color:var(--muted);
  font: 1000 11px/1 system-ui;
}
.meter-bar{
  flex:1;
  height:12px;
  border-radius:999px;
  overflow:hidden;
  background: rgba(148,163,184,.14);
  border:1px solid rgba(148,163,184,.14);
}
.meter-fill{
  width:0%;
  height:100%;
  background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(34,211,238,.85), rgba(167,139,250,.75));
  transition: width 140ms linear;
}
.meter-num{
  width:52px;
  text-align:right;
  font: 1100 12px/1 system-ui;
}
.meter.shield .meter-shield{
  flex:1;
  font: 1100 14px/1 system-ui;
}
.meter-tip{
  color:rgba(148,163,184,.85);
  font: 900 11px/1 system-ui;
}

/* HUD hidden */
body.hud-hidden .gj-hud-top,
body.hud-hidden .gj-hud-bot{
  opacity:.08;
  transform: translateZ(0);
  filter: blur(.2px);
}

/* -------------------- playfield + layers -------------------- */
.gj-field{
  position:fixed;
  inset:0;
  padding:
    calc(var(--gj-top-safe) + var(--gj-field-pad-y))
    calc(var(--gj-field-pad-x))
    calc(var(--gj-bottom-safe) + var(--gj-field-pad-y))
    calc(var(--gj-field-pad-x));
}

.gj-layer{
  position:absolute;
  inset:0;
  overflow:hidden;
}
.gj-layer-r{ display:none; } /* default */

/* cVR split */
body.view-cvr .gj-field{
  padding:
    calc(var(--gj-top-safe) + 6px)
    calc(var(--gj-field-pad-x))
    calc(var(--gj-bottom-safe) + 6px)
    calc(var(--gj-field-pad-x));
}
body.view-cvr .gj-layer{ width:50%; }
body.view-cvr .gj-layer-r{
  display:block;
  left:50%;
  width:50%;
  border-left:1px solid rgba(148,163,184,.12);
  background: linear-gradient(180deg, rgba(2,6,23,.00), rgba(2,6,23,.08));
}

/* -------------------- targets -------------------- */
.gj-target{
  position:absolute;
  transform: translate(-50%,-50%) scale(.92);
  opacity:0;
  border-radius: 999px;
  padding: 8px 10px;
  line-height:1;
  user-select:none;
  -webkit-user-select:none;
  touch-action: none;

  background: rgba(15,23,42,.35);
  border: 1px solid rgba(148,163,184,.18);
  box-shadow: var(--gj-target-shadow);
  text-shadow: 0 10px 26px rgba(0,0,0,.55);

  will-change: transform, opacity, filter;
  cursor:pointer;
  pointer-events:auto; /* targets clickable */
}
body.view-cvr .gj-target,
body.view-vr .gj-target{
  /* strict crosshair shooting: prevent accidental touch on targets */
  pointer-events:none;
}

/* spawn + gone */
.gj-target.spawn{
  animation: gjSpawn 180ms ease-out forwards;
}
.gj-target.gone{
  animation: gjGone 140ms ease-in forwards;
}
@keyframes gjSpawn{
  0%{ opacity:0; transform:translate(-50%,-50%) scale(.75); filter: blur(.6px); }
  100%{ opacity:1; transform:translate(-50%,-50%) scale(1); filter:none; }
}
@keyframes gjGone{
  0%{ opacity:1; transform:translate(-50%,-50%) scale(1); }
  100%{ opacity:0; transform:translate(-50%,-60%) scale(.82); filter: blur(.8px); }
}

/* tiny float to feel alive */
.gj-target{
  animation:
    gjFloat 900ms ease-in-out infinite alternate;
}
@keyframes gjFloat{
  0%{ transform:translate(-50%,-50%) scale(1) rotate(-1.2deg); }
  100%{ transform:translate(-50%,-53%) scale(1.02) rotate(1.2deg); }
}

/* hit feedback classes from GoodJunk JS (optional) */
body.gj-junk-hit .gj-field{ filter: saturate(1.04) contrast(1.03); }
body.gj-good-expire .gj-field{ filter: saturate(1.03) contrast(1.02); }
body.gj-miss-shot .gj-field{ filter: brightness(1.02); }

/* -------------------- Missions peek -------------------- */
.gj-peek{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(2,6,23,.62);
  backdrop-filter: blur(10px);
  opacity:0;
  pointer-events:none;
  transition: opacity 160ms ease;
}
body.show-missions .gj-peek{
  opacity:1;
  pointer-events:auto;
}
.peek-card{
  width:min(560px, 92vw);
  border:1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.86);
  border-radius: 22px;
  padding: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,.45);
}
.peek-title{
  font: 1200 18px/1.1 system-ui;
}
.peek-sub{
  margin-top:8px;
  color:var(--muted);
  font: 1000 13px/1.4 system-ui;
}
.peek-mini{
  margin-top:8px;
  font: 1100 14px/1.3 system-ui;
}
.peek-tip{
  margin-top:10px;
  color:rgba(148,163,184,.88);
  font: 900 12px/1.35 system-ui;
}

/* -------------------- low time overlay -------------------- */
.gj-lowtime-overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition: opacity 160ms ease;
}
body.gj-lowtime5 .gj-lowtime-overlay{
  opacity:1;
}
.gj-lowtime-ring{
  position:absolute;
  width:min(460px, 74vw);
  height:min(460px, 74vw);
  border-radius:999px;
  border: 3px solid rgba(245,158,11,.25);
  box-shadow: 0 0 0 10px rgba(245,158,11,.06), 0 30px 80px rgba(0,0,0,.55);
  filter: blur(.2px);
  animation: gjPulse 920ms ease-in-out infinite;
}
@keyframes gjPulse{
  0%{ transform: scale(.98); opacity:.65; }
  50%{ transform: scale(1.02); opacity:.95; }
  100%{ transform: scale(.98); opacity:.65; }
}
.gj-lowtime-num{
  font: 1400 92px/1 system-ui;
  color:#fff;
  text-shadow: 0 18px 60px rgba(0,0,0,.55);
}

/* -------------------- end overlay -------------------- */
.gj-end{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(2,6,23,.86);
  backdrop-filter: blur(12px);
  padding: calc(18px + var(--sat)) 16px calc(18px + var(--sab));
}
.gj-end .card{
  width:min(760px,92vw);
  border:1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.84);
  border-radius: 22px;
  padding: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,.45);
  color:var(--text);
}
.gj-end .title{font: 1200 22px/1.1 system-ui; }
.gj-end .sub{margin-top:6px;color:var(--muted);font: 900 12px/1.35 system-ui;}
.gj-end .grid{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
@media (max-width:720px){ .gj-end .grid{grid-template-columns:1fr;} }
.gj-end .stat{
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.45);
  border-radius: 16px;
  padding: 10px 12px;
  display:flex; align-items:baseline; justify-content:space-between; gap:10px;
  font: 900 12px/1 system-ui;
}
.gj-end .stat b{font-size:16px;}
.gj-end .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;}
.gj-end .btn{
  min-width: 210px;
  height: 52px;
  border-radius: 16px;
  border: 1px solid rgba(34,197,94,.35);
  background: rgba(34,197,94,.16);
  color:#eafff3;
  font: 1100 16px/1 system-ui;
  cursor:pointer;
}
.gj-end .btn.alt{
  border-color: rgba(148,163,184,.22);
  background: rgba(2,6,23,.55);
  color:var(--text);
}

/* =========================================================
   ULTRA GAME STATES: STORM / BOSS / RAGE  (โหด + แฟร์)
   ========================================================= */

/* ---------- STORM (timeLeft <= 30s) ---------- */
body.gj-storm{
  --gj-shake: 1.2;
}
body.gj-storm::before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  z-index:60;
  background:
    radial-gradient(circle at 50% 45%, rgba(34,211,238,.10), transparent 55%),
    repeating-linear-gradient(120deg, rgba(34,211,238,.05), rgba(34,211,238,.05) 6px, transparent 6px, transparent 14px);
  mix-blend-mode: screen;
  opacity:.55;
  filter: blur(.2px);
  animation: gjStormScan 1.05s linear infinite;
}
@keyframes gjStormScan{
  0%{ transform: translate3d(-6%, -2%, 0); }
  100%{ transform: translate3d(6%, 2%, 0); }
}
body.gj-storm .gj-target{
  box-shadow: 0 18px 50px rgba(0,0,0,.46);
  border-color: rgba(34,211,238,.22);
}
body.gj-storm .hud-pill.warn{
  border-color: rgba(34,211,238,.28);
  background: rgba(34,211,238,.08);
}

/* ---------- BOSS (miss >= 4) ---------- */
body.gj-boss{
  --gj-shake: 1.55;
}
body.gj-boss::after{
  content:"";
  position:fixed;
  inset:-30px;
  pointer-events:none;
  z-index:61;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 42%, rgba(0,0,0,.35) 74%, rgba(0,0,0,.62) 100%);
  opacity:.72;
  animation: gjBossBreath 1.2s ease-in-out infinite;
}
@keyframes gjBossBreath{
  0%{ opacity:.62; transform: scale(1); }
  50%{ opacity:.85; transform: scale(1.01); }
  100%{ opacity:.62; transform: scale(1); }
}
body.gj-boss .gj-target{
  animation-duration: 720ms; /* faster float */
}
body.gj-boss .gj-hud-top{
  filter: saturate(1.05);
}

/* ---------- RAGE (miss >= 5) ---------- */
body.gj-rage{
  --gj-shake: 2.0;
}
body.gj-rage{
  animation: gjRageShake 520ms ease-in-out infinite;
}
@keyframes gjRageShake{
  0%{ transform: translate3d(0,0,0); }
  20%{ transform: translate3d(calc(-.8px*var(--gj-shake)), calc(.7px*var(--gj-shake)), 0); }
  40%{ transform: translate3d(calc(.9px*var(--gj-shake)), calc(-.8px*var(--gj-shake)), 0); }
  60%{ transform: translate3d(calc(-.7px*var(--gj-shake)), calc(-.6px*var(--gj-shake)), 0); }
  80%{ transform: translate3d(calc(.8px*var(--gj-shake)), calc(.7px*var(--gj-shake)), 0); }
  100%{ transform: translate3d(0,0,0); }
}
body.gj-rage .gj-target{
  border-color: rgba(239,68,68,.22);
  background: rgba(239,68,68,.06);
  box-shadow: 0 20px 60px rgba(0,0,0,.52);
}
body.gj-rage .hud-pill.warn{
  border-color: rgba(239,68,68,.30);
  background: rgba(239,68,68,.10);
}

/* =========================================================
   SUPPORT HHA FX DIRECTOR classes (so effects visible)
   ========================================================= */
body.fx-hit-good .gj-field{ filter: brightness(1.03) saturate(1.06); }
body.fx-hit-bad  .gj-field{ filter: brightness(1.02) saturate(1.10); }
body.fx-miss     .gj-field{ filter: brightness(1.01) contrast(1.03); }

/* optional: extra glow on good/bad hits */
body.fx-hit-good .gj-target{ filter: drop-shadow(0 0 18px rgba(34,197,94,.16)); }
body.fx-hit-bad  .gj-target{ filter: drop-shadow(0 0 18px rgba(239,68,68,.18)); }

/* tick helper from safe.js (gj-tick) */
body.gj-tick .gj-lowtime-num{
  transform: scale(1.02);
  text-shadow: 0 22px 70px rgba(0,0,0,.58);
}

/* Reduce motion accessibility */
@media (prefers-reduced-motion: reduce){
  *{ animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration:0.001ms !important; }
  body.gj-rage{ animation:none !important; }
  body.gj-storm::before{ animation:none !important; }
  body.gj-boss::after{ animation:none !important; }
}