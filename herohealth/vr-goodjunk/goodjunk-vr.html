<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- A-Frame (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ Enter VR ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- FX + Logger (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
  <script src="../vr/particles.js" defer></script>
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <!-- CSS -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />
</head>

<body class="view-mobile">
  <!-- minimal aframe scene -->
  <a-scene embedded vr-mode-ui="enabled:false"
    style="position:fixed; inset:0; width:1px; height:1px; opacity:0; pointer-events:none;">
    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

  <!-- WARNING RING + COUNTDOWN (CSS already supports) -->
  <div class="gj-warning-ring"></div>
  <div class="gj-lowtime-overlay" aria-hidden="true">
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </div>

  <!-- START overlay (‡∏ï‡πâ‡∏≠‡∏á dispatch hha:start ‡πÉ‡∏´‡πâ boot ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) -->
  <div class="start-overlay" id="startOverlay">
    <div class="start-card">
      <div class="start-title">ü•¶üçé GoodJunkVR</div>
      <div class="start-desc">
        ‡∏¢‡∏¥‡∏á ‚Äú‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ‚Äú‡∏Ç‡∏¢‡∏∞‚Äù<br/>
        <span class="muted">VR/cVR: ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡∏¢‡∏¥‡∏á</span>
      </div>
      <div class="start-meta" id="startMeta"></div>
      <button class="btn-start" id="btnStart">Start</button>
      <button class="btn-start" id="btnStartVR" style="margin-top:10px;background:rgba(34,211,238,.14);border-color:rgba(34,211,238,.30);">
        Enter VR
      </button>
    </div>
  </div>

  <!-- HUD (PC/Mobile) -->
  <div class="hha-hud">
    <div class="hud-top">
      <div class="hud-badge">
        <div class="hud-title">GoodJunkVR</div>
        <div class="hud-sub" id="hud-mini">‚Äî</div>
        <div class="viewbar">
          <button class="pill ghost" id="btnPeek" type="button">Missions</button>
          <button class="pill ghost" id="btnHideHud" type="button">Hide HUD</button>
        </div>
      </div>

      <div class="hud-stats">
        <div class="hud-stat"><div class="k">SCORE</div><div class="v" id="hud-score">0</div></div>
        <div class="hud-stat"><div class="k">TIME</div><div class="v" id="hud-time">0</div></div>
        <div class="hud-stat"><div class="k">MISS</div><div class="v" id="hud-miss">0</div></div>
        <div class="hud-stat"><div class="k">GRADE</div><div class="v" id="hud-grade">‚Äî</div></div>
      </div>
    </div>

    <div class="hud-mid" style="display:none;">
      <div class="hud-quest">
        <div class="q-row">
          <div class="q-title">GOAL</div>
          <div class="q-count"><span id="hud-goal-cur">0</span>/<span id="hud-goal-target">0</span></div>
          <div class="q-timer"></div>
        </div>
        <div class="q-progress" id="hud-goal">‚Äî</div>
      </div>

      <div class="hud-coach" style="display:none;">
        <img class="coach-img" src="../img/coach-neutral.png" alt="coach">
        <div>
          <div class="coach-line">Coach</div>
          <div class="coach-sub">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

  <!-- VR MINI HUD -->
  <div class="vr-mini-hud">
    <div class="mini-row">
      <div class="mini-pill"><span>S</span><b id="hud-score-mini">0</b></div>
      <div class="mini-pill"><span>T</span><b id="hud-time-mini">0</b></div>
      <div class="mini-pill"><span>G</span><b id="hud-grade-mini">‚Äî</b></div>
      <button class="mini-btn" id="btnPeekMini" type="button">Missions</button>
    </div>
  </div>

  <!-- MISSIONS PEEK -->
  <div class="gj-peek" id="gjPeek" aria-hidden="true">
    <div class="peek-card">
      <div class="peek-title">Missions</div>
      <div class="peek-sub"><b>Goal:</b> <span id="peekGoal">‚Äî</span></div>
      <div class="peek-mini"><b>Mini:</b> <span id="peekMini">‚Äî</span></div>
      <div class="peek-tip">Tip: VR/cVR ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡∏¢‡∏¥‡∏á</div>
    </div>
  </div>

  <!-- FEVER (‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏°‡πâ safe.js ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï fill ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á) -->
  <div class="hha-fever">
    <div class="fever-row">
      <div class="fever-label">FEVER</div>
      <div class="fever-bar"><div class="fever-fill" id="feverFill"></div></div>
      <div class="fever-text" id="feverText">0%</div>
    </div>
    <div class="shield-row">
      <div class="shield-label">SHIELD</div>
      <div class="shield-pills" id="shieldPills"></div>
    </div>
  </div>

  <!-- STAGE -->
  <div id="gj-stage">
    <div class="gj-eye eye-l">
      <div class="gj-layer" id="gj-layer"></div>
      <div class="gj-crosshair"></div>
    </div>
    <div class="gj-eye eye-r">
      <div class="gj-layer"></div>
      <div class="gj-crosshair"></div>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="hha-controls">
    <button class="btn-shoot" id="btnShoot" type="button">‡∏¢‡∏¥‡∏á / TAP</button>
  </div>

  <!-- Boot -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>

  <script>
    // Start gate: dispatch hha:start (‡πÉ‡∏´‡πâ boot ‡πÄ‡∏£‡∏¥‡πà‡∏° engine ‡∏´‡∏•‡∏±‡∏á overlay)
    (function(){
      const qs = (k,d=null)=>{ try{return new URL(location.href).searchParams.get(k) ?? d;}catch{return d;} };
      const btnStart = document.getElementById('btnStart');
      const btnStartVR= document.getElementById('btnStartVR');
      const overlay  = document.getElementById('startOverlay');
      const meta     = document.getElementById('startMeta');
      const view = qs('view','mobile');
      const diff = qs('diff','normal');
      const run  = qs('run','play');
      meta.textContent = `view=${view} | run=${run} | diff=${diff}`;

      function start(){
        overlay.style.display = 'none';
        window.dispatchEvent(new CustomEvent('hha:start', { detail:{ view } }));
      }

      btnStart.addEventListener('click', start);

      // Enter VR -> ‡πÉ‡∏´‡πâ vr-ui.js ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏£‡∏≤‡πÅ‡∏Ñ‡πà‡∏¢‡∏¥‡∏á event)
      btnStartVR.addEventListener('click', ()=>{
        // preload or signal (boot listens)
        window.dispatchEvent(new CustomEvent('hha:enter-cvr'));
        start();
        // ‡πÉ‡∏´‡πâ VR UI ‡∏Å‡∏î Enter VR ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î script ‡πÅ‡∏•‡πâ‡∏ß
      });

      // TAP ‡∏¢‡∏¥‡∏á (‡∏ó‡∏∏‡∏Å‡πÇ‡∏´‡∏°‡∏î)
      document.getElementById('btnShoot').addEventListener('click', ()=>{
        window.dispatchEvent(new CustomEvent('hha:shoot'));
      });

      // missions peek
      const peek = document.getElementById('gjPeek');
      function openPeek(){
        peek.setAttribute('aria-hidden','false');
        setTimeout(()=>peek.setAttribute('aria-hidden','true'), 1300);
      }
      document.getElementById('btnPeek')?.addEventListener('click', openPeek);
      document.getElementById('btnPeekMini')?.addEventListener('click', openPeek);

      // hide HUD toggle
      document.getElementById('btnHideHud')?.addEventListener('click', ()=>{
        document.body.classList.toggle('hud-hidden');
      });

      // keep peek texts synced from HUD fields (cheap mirror)
      const pg = document.getElementById('peekGoal');
      const pm = document.getElementById('peekMini');
      setInterval(()=>{
        const g = document.getElementById('hud-goal')?.textContent || '‚Äî';
        const m = document.getElementById('hud-mini')?.textContent || '‚Äî';
        pg.textContent = g;
        pm.textContent = m;
        // mirror mini HUD
        document.getElementById('hud-score-mini').textContent = document.getElementById('hud-score')?.textContent || '0';
        document.getElementById('hud-time-mini').textContent  = document.getElementById('hud-time')?.textContent || '0';
        document.getElementById('hud-grade-mini').textContent = document.getElementById('hud-grade')?.textContent || '‚Äî';
      }, 250);
    })();
  </script>
</body>
</html>