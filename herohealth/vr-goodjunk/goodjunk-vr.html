<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- UI/CSS -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />

  <!-- Global FX + (optional) logger -->
  <script src="../vr/particles.js" defer></script>
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <!-- Boot (wait hha:start) -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</head>

<body class="view-mobile">
  <!-- WARNING RING + COUNTDOWN (VR-safe, no shake) -->
  <div class="gj-warning-ring" aria-hidden="true"></div>
  <div class="gj-lowtime-overlay" aria-hidden="true">
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </div>

  <!-- VR MINI HUD (shown only in VR/cVR) -->
  <div class="vr-mini-hud" id="vr-mini-hud">
    <div class="mini-row">
      <div class="mini-pill"><span>Score</span><b id="hud2-score">0</b></div>
      <div class="mini-pill"><span>Time</span><b id="hud2-time">0</b></div>
      <div class="mini-pill"><span>Grade</span><b id="hud2-grade">‚Äî</b></div>
      <button class="mini-btn" id="btn-peek">Missions</button>
    </div>
  </div>

  <!-- MAIN HUD (hidden in VR/cVR by CSS) -->
  <div class="hha-hud">
    <div class="hud-top">
      <div class="hud-badge">
        <div class="hud-title">ü•¶üçü GoodJunkVR</div>
        <div class="hud-sub">‡∏¢‡∏¥‡∏á ‚Äú‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ‚Äú‡∏Ç‡∏¢‡∏∞‚Äù</div>

        <div class="viewbar">
          <button class="pill ghost" id="btn-hide-hud" type="button">‡∏ã‡πà‡∏≠‡∏ô HUD</button>
          <button class="pill ghost" id="btn-show-hud" type="button" style="display:none;">‡πÅ‡∏™‡∏î‡∏á HUD</button>
        </div>
      </div>

      <div class="hud-stats">
        <div class="hud-stat"><div class="k">Score</div><div class="v" id="hud-score">0</div></div>
        <div class="hud-stat"><div class="k">Time</div><div class="v" id="hud-time">0</div></div>
        <div class="hud-stat"><div class="k">Combo</div><div class="v" id="hud-combo">0</div></div>
        <div class="hud-stat"><div class="k">Miss</div><div class="v" id="hud-miss">0</div></div>
      </div>
    </div>

    <div class="hud-mid">
      <div class="hud-quest">
        <div class="q-row">
          <div class="q-title">üéØ Goal: <span id="hud-goal">‚Äî</span></div>
          <div class="q-count"><span id="hud-goal-cur">0</span>/<span id="hud-goal-target">0</span></div>
        </div>
        <div class="q-progress">üß© Mini: <span id="hud-mini">‚Äî</span></div>
      </div>

      <div class="hud-coach">
        <img class="coach-img" src="../img/coach-neutral.png" alt="coach" />
        <div>
          <div class="coach-line">Coach</div>
          <div class="coach-sub" id="coach-line">‡∏¢‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡πÇ‡∏î‡∏ô‡∏Ç‡∏¢‡∏∞!</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MISSIONS PEEK -->
  <div class="gj-peek" id="gj-peek" aria-hidden="true">
    <div class="peek-card">
      <div class="peek-title">üìå Missions</div>
      <div class="peek-sub" id="peek-goal">Goal: ‚Äî</div>
      <div class="peek-mini" id="peek-mini">Mini: ‚Äî</div>
      <div class="peek-tip">‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠/‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</div>
    </div>
  </div>

  <!-- FEVER UI host (your ui-fever module can also attach here if you use it) -->
  <div class="hha-fever">
    <div class="fever-row">
      <div class="fever-label">FEVER</div>
      <div class="fever-bar"><div class="fever-fill" id="fever-fill"></div></div>
      <div class="fever-text" id="fever-text">0%</div>
    </div>
    <div class="shield-row">
      <div class="shield-label">SHIELD</div>
      <div class="shield-pills" id="shield-pills"></div>
    </div>
  </div>

  <!-- PLAYFIELD -->
  <div id="gj-stage">
    <div class="gj-eye eye-l">
      <div class="gj-layer" id="gj-layer"></div>
      <div class="gj-crosshair"></div>
    </div>
    <div class="gj-eye eye-r">
      <div class="gj-layer" aria-hidden="true"></div>
      <div class="gj-crosshair"></div>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="hha-controls">
    <button class="btn-shoot" id="btn-shoot" type="button">TAP / SHOOT</button>
  </div>

  <!-- START OVERLAY (fires hha:start) -->
  <div class="start-overlay" id="start-overlay">
    <div class="start-card">
      <div class="start-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô GoodJunkVR</div>
      <div class="start-desc">
        üéØ ‡∏¢‡∏¥‡∏á ‚Äú‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ü•¶üçé ‚Ä¢ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ‚Äú‡∏Ç‡∏¢‡∏∞‚Äù üçüüçî <br/>
        <span class="muted">Play: ‡∏°‡∏µ Practice 15s ‚Ä¢ Research: ‡πÑ‡∏°‡πà‡∏°‡∏µ Practice</span>
      </div>
      <div class="start-meta" id="start-meta">‚Äî</div>
      <button class="btn-start" id="btn-start" type="button">START</button>
    </div>
  </div>

  <script>
  (function(){
    const qs = (k, def=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? def; }catch(e){ return def; } };
    const view = (String(qs('view','mobile')).toLowerCase()==='pc')?'pc':
                 (String(qs('view','mobile')).toLowerCase()==='vr')?'vr':
                 (String(qs('view','mobile')).toLowerCase()==='cvr')?'cvr':'mobile';

    const metaEl = document.getElementById('start-meta');
    metaEl.textContent =
      `view=${view} ‚Ä¢ diff=${qs('diff','normal')} ‚Ä¢ run=${qs('run','play')} ‚Ä¢ time=${qs('time','80')}s ‚Ä¢ seed=${qs('seed','auto')}`;

    // Missions peek
    const peek = document.getElementById('gj-peek');
    const peekGoal = document.getElementById('peek-goal');
    const peekMini = document.getElementById('peek-mini');
    function refreshPeek(){
      const g = document.getElementById('hud-goal')?.textContent || '‚Äî';
      const cur = document.getElementById('hud-goal-cur')?.textContent || '0';
      const tar = document.getElementById('hud-goal-target')?.textContent || '0';
      const m = document.getElementById('hud-mini')?.textContent || '‚Äî';
      peekGoal.textContent = `Goal: ${g} (${cur}/${tar})`;
      peekMini.textContent = `Mini: ${m}`;
    }
    document.getElementById('btn-peek')?.addEventListener('click', ()=>{
      refreshPeek();
      peek.setAttribute('aria-hidden','false');
      peek.style.pointerEvents = 'auto';
    });
    peek.addEventListener('click', ()=>{
      peek.setAttribute('aria-hidden','true');
      peek.style.pointerEvents = 'none';
    });

    // HUD hide/show
    const hideBtn = document.getElementById('btn-hide-hud');
    const showBtn = document.getElementById('btn-show-hud');
    hideBtn?.addEventListener('click', ()=>{
      document.body.classList.add('hud-hidden');
      hideBtn.style.display = 'none';
      showBtn.style.display = 'inline-block';
    });
    showBtn?.addEventListener('click', ()=>{
      document.body.classList.remove('hud-hidden');
      showBtn.style.display = 'none';
      hideBtn.style.display = 'inline-block';
    });

    // Start -> dispatch hha:start (boot.js listens)
    const overlay = document.getElementById('start-overlay');
    document.getElementById('btn-start')?.addEventListener('click', ()=>{
      overlay.style.display = 'none';
      window.dispatchEvent(new CustomEvent('hha:start', { detail:{ view } }));
    });

    // Shoot button -> emit hha:shoot for vr-ui.js tap-to-shoot, but also click layer fallback
    document.getElementById('btn-shoot')?.addEventListener('click', ()=>{
      window.dispatchEvent(new CustomEvent('hha:shoot', { detail:{ source:'btn' } }));
    });

    // allow Enter key
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && overlay.style.display !== 'none'){
        e.preventDefault();
        document.getElementById('btn-start').click();
      }
    });

    // set body class for view early (for layout)
    document.body.classList.remove('view-pc','view-mobile','view-vr','view-cvr');
    document.body.classList.add('view-'+view);
  })();
  </script>
</body>
</html>