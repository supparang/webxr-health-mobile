<!-- === /herohealth/vr-goodjunk/goodjunk.html ===
GoodJunkVR RUN — PRODUCTION (works with goodjunk.safe.js ESM)
FULL v20260228-RUN-AIHUD -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth • GoodJunk VR</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="stylesheet" href="./goodjunk.css" />
</head>
<body>
  <div id="app">

    <!-- Debug pills (optional) -->
    <div id="debugPills" aria-hidden="true">
      <span class="pill">view=<b id="uiView">—</b></span>
      <span class="pill">run=<b id="uiRun">—</b></span>
      <span class="pill">diff=<b id="uiDiff">—</b></span>
    </div>

    <!-- Top HUD -->
    <header id="hud">
      <div class="hud-row">
        <div class="pill">SCORE <b id="hud-score">0</b></div>
        <div class="pill">TIME <b id="hud-time">0</b></div>
        <div class="pill">MISS <b id="hud-miss">0</b></div>
        <div class="pill">GRADE <b id="hud-grade">C</b></div>
      </div>

      <div class="hud-row">
        <div class="pill pill-soft">
          GOAL <b id="hud-goal">Daily</b>:
          <span><b id="hud-goal-cur">0</b>/<b id="hud-goal-target">20</b></span>
          <span id="goalDesc" class="mut">Hit GOOD 20</span>
        </div>
        <div class="pill pill-soft">
          MINI <b id="hud-mini">—</b>
          <span class="mut">⏱ <b id="miniTimer">—</b></span>
        </div>
      </div>

      <!-- AI HUD -->
      <div class="hud-row">
        <div class="pill pill-ai">
          AI Risk <b id="aiRisk">—</b>
          <span class="mut">next: <b id="aiHint">—</b></span>
        </div>
      </div>

      <!-- Fever + Shield + Boss -->
      <div class="hud-row hud-bars">
        <div class="barCard">
          <div class="barTop">
            <span class="mut">FEVER</span>
            <b id="feverText">0%</b>
          </div>
          <div class="bar">
            <div class="barFill" id="feverFill" style="width:0%"></div>
          </div>
        </div>

        <div class="barCard">
          <div class="barTop">
            <span class="mut">SHIELD</span>
            <b id="shieldPills">—</b>
          </div>
        </div>

        <div class="barCard boss" id="bossBar" aria-hidden="true">
          <div class="barTop">
            <span class="mut">BOSS</span>
            <b id="bossHint">—</b>
          </div>
          <div class="bar">
            <div class="barFill bossFill" id="bossFill" style="width:0%"></div>
          </div>
        </div>
      </div>

      <div class="gj-progress" aria-hidden="false">
        <div class="gj-progress-track">
          <div class="gj-progress-fill" id="gjProgressFill" style="width:0%"></div>
        </div>
      </div>
    </header>

    <!-- Playfield -->
    <main id="stage" aria-label="GoodJunk Stage">
      <div id="gj-layer" aria-label="targets"></div>
    </main>

    <!-- Low time overlay -->
    <div id="lowTimeOverlay" aria-hidden="true">
      <div class="lowTimeCard">
        <div class="mut">TIME</div>
        <div class="lowTimeNum" id="gj-lowtime-num">5</div>
      </div>
    </div>

    <!-- End overlay -->
    <div id="endOverlay" aria-hidden="true">
      <div class="panel">
        <div class="endTitle" id="endTitle">Game Over</div>
        <div class="endSub" id="endSub">—</div>

        <div class="endGrid">
          <div class="endStat"><span>GRADE</span><b id="endGrade">—</b></div>
          <div class="endStat"><span>SCORE</span><b id="endScore">0</b></div>
          <div class="endStat"><span>MISS</span><b id="endMiss">0</b></div>
          <div class="endStat"><span>TIME</span><b id="endTime">0</b></div>
        </div>

        <div class="endActions">
          <button class="btn" id="btnRetry" type="button">เล่นอีกครั้ง</button>
          <button class="btn primary" id="btnHub" type="button">กลับ HUB</button>
        </div>

        <!-- Cooldown button will be injected here by JS -->
      </div>
    </div>

  </div>

  <script type="module">
    import { boot } from './goodjunk.safe.js';
    import { createGoodJunkAI } from '../vr/ai-goodjunk.js';

    const qs = (k, d='')=>{ try{ return (new URL(location.href)).searchParams.get(k) ?? d; }catch(e){ return d; } };

    // Build cfg from URL params (pass-through)
    const cfg = {
      view: qs('view','mobile'),
      run: qs('run','play'),
      diff: qs('diff','normal'),
      time: Number(qs('time','80')) || 80,
      seed: qs('seed', String(Date.now())),
      pid: qs('pid','anon'),
      hub: qs('hub','../hub.html'),
      ai: null
    };

    // AI enabled only when ?ai=1 AND not research/practice
    const aiOn = (qs('ai','0') === '1') && (String(cfg.run).toLowerCase() === 'play');
    if(aiOn){
      cfg.ai = createGoodJunkAI({
        seed: cfg.seed,
        pid: cfg.pid,
        diff: cfg.diff,
        view: cfg.view
      });
    }

    // Buttons
    const btnRetry = document.getElementById('btnRetry');
    const btnHub = document.getElementById('btnHub');
    btnRetry?.addEventListener('click', ()=>{
      const u = new URL(location.href);
      u.searchParams.set('seed', String(Date.now())); // new seed for replay (unless you want deterministic keep)
      location.href = u.toString();
    });
    btnHub?.addEventListener('click', ()=>{
      const hub = cfg.hub || '../hub.html';
      location.href = hub;
    });

    // Boot
    boot(cfg);
  </script>
</body>
</html>