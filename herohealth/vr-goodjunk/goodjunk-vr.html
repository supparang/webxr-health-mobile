<!-- === /herohealth/vr-goodjunk/goodjunk-vr.html ===
GoodJunkVR RUN — PRODUCTION (HHA Standard)
✅ Views: pc/mobile/vr/cvr (auto detect in boot; DO NOT override)
✅ Uses: ../vr/vr-ui.js (ENTER VR/EXIT/RECENTER + crosshair + hha:shoot)
✅ Engine: goodjunk.safe.js (ESM)
✅ Boot: goodjunk-vr.boot.js (mount + start overlay hardened)
✅ Layers: #gj-layer (+ #gj-layer-r for cVR)
✅ HUD safe areas via CSS vars: --gj-top-safe / --gj-bottom-safe
✅ GATE FLOW:
   - if ?gate=1 => on hha:end => redirect to ../warmup-gate.html?phase=cooldown&cdur=20&autonext=1&next=<hub>
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth — GoodJunkVR</title>
  <meta name="color-scheme" content="dark light"/>
  <link rel="icon" href="../favicon.ico"/>

  <!-- CSS -->
  <link rel="stylesheet" href="./goodjunk-vr.css"/>

  <!-- (optional) preload fonts -->
  <style>
    :root{
      --bg:#020617;
      --panel: rgba(2,6,23,.72);
      --stroke: rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --good:#22c55e;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --amber:#f59e0b;

      /* SAFE for target spawns inside layer */
      --gj-top-safe: 92;    /* px */
      --gj-bottom-safe: 96; /* px */

      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
    }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% 0%, rgba(59,130,246,.12), transparent 60%),
                  radial-gradient(900px 520px at 90% 30%, rgba(34,211,238,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Thai", sans-serif;
    }
  </style>
</head>

<body class="view-mobile">
  <!-- ===== PLAYFIELD ===== -->
  <div id="gj-playfield" class="gj-playfield">
    <!-- layers for spawning targets -->
    <div id="gj-layer" class="gj-layer" aria-hidden="false"></div>
    <div id="gj-layer-r" class="gj-layer gj-layer-r" aria-hidden="false"></div>

    <!-- ===== HUD ===== -->
    <header id="gj-hud" class="gj-hud" aria-label="HUD">
      <div class="gj-hud-left">
        <span class="gj-pill">HeroHealth · Nutrition</span>
        <span class="gj-pill gj-pill-view" id="gj-pill-view">—</span>
      </div>

      <div class="gj-hud-mid">
        <div class="gj-stat">
          <div class="gj-stat-k">SCORE</div>
          <div class="gj-stat-v" id="hud-score">0</div>
        </div>
        <div class="gj-stat">
          <div class="gj-stat-k">TIME</div>
          <div class="gj-stat-v" id="hud-time">0</div>
        </div>
        <div class="gj-stat">
          <div class="gj-stat-k">MISS</div>
          <div class="gj-stat-v" id="hud-miss">0</div>
        </div>
        <div class="gj-stat">
          <div class="gj-stat-k">GRADE</div>
          <div class="gj-stat-v" id="hud-grade">—</div>
        </div>
      </div>

      <div class="gj-hud-right">
        <div class="gj-mini">
          <div class="gj-mini-k">FEVER</div>
          <div class="gj-fever">
            <div id="feverFill" class="gj-fever-fill"></div>
          </div>
          <div id="feverText" class="gj-mini-v">0%</div>
        </div>
        <div class="gj-mini">
          <div class="gj-mini-k">SHIELD</div>
          <div id="shieldPills" class="gj-mini-v">—</div>
        </div>
      </div>
    </header>

    <!-- ===== QUEST PANEL ===== -->
    <aside id="gj-quest" class="gj-quest" aria-label="Quest">
      <div class="gj-quest-title" id="hud-goal">—</div>
      <div class="gj-quest-desc" id="goalDesc">—</div>

      <div class="gj-quest-row">
        <span class="gj-quest-k">Goal</span>
        <span class="gj-quest-v"><b id="hud-goal-cur">0</b>/<b id="hud-goal-target">0</b></span>
      </div>

      <div class="gj-quest-row">
        <span class="gj-quest-k">Mini</span>
        <span class="gj-quest-v"><span id="hud-mini">—</span> · <b id="miniTimer">—</b></span>
      </div>
    </aside>

    <!-- ===== PROGRESS BAR ===== -->
    <div class="gj-progress" aria-hidden="false">
      <div id="gjProgressFill" class="gj-progress-fill"></div>
    </div>

    <!-- ===== BOSS BAR (optional) ===== -->
    <div id="bossBar" class="gj-boss" aria-hidden="true">
      <div class="gj-boss-top">
        <span class="gj-boss-title">BOSS</span>
        <span id="bossHint" class="gj-boss-hint">—</span>
      </div>
      <div class="gj-boss-bar">
        <div id="bossFill" class="gj-boss-fill"></div>
      </div>
    </div>

    <!-- ===== LOW TIME OVERLAY ===== -->
    <div id="lowTimeOverlay" class="gj-lowtime" aria-hidden="true">
      <div class="gj-lowtime-inner">
        <div class="gj-lowtime-k">เหลือเวลา</div>
        <div id="gj-lowtime-num" class="gj-lowtime-num">5</div>
      </div>
    </div>

    <!-- ===== START OVERLAY ===== -->
    <div id="startOverlay" class="gj-start" aria-hidden="false">
      <div class="gj-start-card">
        <div class="gj-start-pill">GoodJunkVR</div>
        <h1 class="gj-start-title">แยก “ของดี” vs “ของเสีย”</h1>
        <p class="gj-start-sub">
          แตะเพื่อยิง • คุม MISS • เก็บคอมโบ • ช่วงท้ายมีบอส
        </p>
        <div class="gj-start-actions">
          <button id="btnStart" class="gj-btn gj-btn-primary">เริ่มเล่น</button>
          <button class="gj-btn btnBackHub">กลับ HUB</button>
        </div>
        <p class="gj-start-foot">
          Tip: โหมด cVR จะมี 2 เลเยอร์ (ซ้าย/ขวา) แต่ “นับเป้า” แค่ครั้งเดียวต่อ UID
        </p>
      </div>
    </div>
  </div>

  <!-- VR UI (Universal): ENTER VR/EXIT/RECENTER + Crosshair + tap-to-shoot -->
  <script src="../vr/vr-ui.js"></script>

  <!-- Optional: tweak lockPx for GoodJunk -->
  <script>
    window.HHA_VRUI_CONFIG = Object.assign(
      { lockPx: 28, cooldownMs: 85 },
      window.HHA_VRUI_CONFIG || {}
    );
  </script>

  <!-- ✅ GATE FLOW: on end => cooldown gate => hub -->
  <script>
  (() => {
    'use strict';
    const QS = new URL(location.href).searchParams;
    const q = (k, d='') => (QS.get(k) ?? d);

    const gateOn = String(q('gate','0')) === '1';
    const hub = q('hub','') || '../hub.html';
    const cdur = Math.max(5, Math.min(60, Number(q('cdur','20') || 20)));

    function buildCooldownGateUrl(){
      // from /herohealth/vr-goodjunk/goodjunk-vr.html => /herohealth/warmup-gate.html
      const gate = new URL('../warmup-gate.html', location.href);
      gate.searchParams.set('phase', 'cooldown');
      gate.searchParams.set('cdur', String(cdur));
      gate.searchParams.set('hub', hub);
      gate.searchParams.set('next', hub);       // ✅ cooldown ends -> HUB
      gate.searchParams.set('autonext', '1');   // ✅ auto go

      // passthrough (keep research ids, diff, run, seed, etc.)
      const deny = new Set(['next','hub','phase','dur','cdur','games','autonext']);
      QS.forEach((v,k)=>{ if(!deny.has(k)) gate.searchParams.set(k, v); });

      return gate.toString();
    }

    window.addEventListener('hha:end', () => {
      if(!gateOn) return;
      if(window.__HHA_GJ_TO_COOLDOWN__) return;
      window.__HHA_GJ_TO_COOLDOWN__ = true;

      try{
        location.href = buildCooldownGateUrl();
      }catch(_){}
    }, { passive:true });
  })();
  </script>

  <!-- Boot (ESM) -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</body>
</html>