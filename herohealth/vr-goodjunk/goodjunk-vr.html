<!-- === /herohealth/vr-goodjunk/goodjunk-vr.html ===
GoodJunkVR RUN ‚Äî PRODUCTION (HUD + AI chip + AI coach bubble)
FULL v20260223-html-aihud-coach
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Ä¢ GoodJunk VR</title>
  <link rel="stylesheet" href="./goodjunk-vr.css"/>
</head>
<body>

  <!-- LAYER (Left eye / main) -->
  <div id="gj-layer" aria-label="GoodJunk layer"></div>

  <!-- LAYER (Right eye for cVR only) -->
  <div id="gj-layer-r" aria-hidden="true" style="display:none"></div>

  <!-- HUD -->
  <div id="hud" aria-label="HUD">
    <div class="hud-top">
      <div class="hud-pill">
        <div class="hud-k">SCORE</div>
        <div class="hud-v" id="hud-score">0</div>
      </div>

      <div class="hud-pill">
        <div class="hud-k">TIME</div>
        <div class="hud-v" id="hud-time">‚Äî</div>
      </div>

      <div class="hud-pill">
        <div class="hud-k">MISS</div>
        <div class="hud-v" id="hud-miss">0</div>
      </div>

      <div class="hud-pill">
        <div class="hud-k">GRADE</div>
        <div class="hud-v" id="hud-grade">‚Äî</div>
      </div>
    </div>

    <div class="hud-mid">
      <div class="hud-panel">
        <div class="hud-row">
          <div class="hud-k">GOAL</div>
          <div class="hud-v" id="hud-goal">‚Äî</div>
        </div>
        <div class="hud-row">
          <div class="hud-k">PROGRESS</div>
          <div class="hud-v">
            <span id="hud-goal-cur">0</span>/<span id="hud-goal-target">0</span>
          </div>
        </div>
        <div class="hud-desc" id="goalDesc">‚Äî</div>
      </div>

      <div class="hud-panel">
        <div class="hud-row">
          <div class="hud-k">MINI</div>
          <div class="hud-v" id="hud-mini">‚Äî</div>
        </div>
        <div class="hud-row">
          <div class="hud-k">TIMER</div>
          <div class="hud-v" id="miniTimer">‚Äî</div>
        </div>
      </div>
    </div>

    <div class="hud-bot">
      <div class="hud-meter">
        <div class="hud-k">FEVER</div>
        <div class="bar">
          <div class="bar-fill" id="feverFill" style="width:0%"></div>
        </div>
        <div class="hud-v" id="feverText">0%</div>
      </div>

      <div class="hud-meter">
        <div class="hud-k">SHIELD</div>
        <div class="hud-v hud-shield" id="shieldPills">‚Äî</div>
      </div>

      <div class="hud-progress">
        <div class="hud-progress-track">
          <div class="hud-progress-fill" id="gjProgressFill" style="width:0%"></div>
        </div>
      </div>
    </div>

    <!-- Boss bar -->
    <div id="bossBar" aria-hidden="true">
      <div class="boss-track"><div class="boss-fill" id="bossFill" style="width:0%"></div></div>
      <div class="boss-hint" id="bossHint"></div>
    </div>
  </div>

  <!-- LOW TIME overlay -->
  <div id="lowTimeOverlay" aria-hidden="true">
    <div class="lowtime-inner">
      <div class="lowtime-k">LAST</div>
      <div class="lowtime-v" id="gj-lowtime-num">5</div>
      <div class="lowtime-k">SECONDS</div>
    </div>
  </div>

  <!-- =========================
       AI HUD CHIP + AI COACH
       ========================= -->
  <div id="aiHud" aria-hidden="false">
    <div id="aiRiskChip" class="ai-chip risk-low" role="status" aria-live="polite">
      <span class="ai-badge">AI</span>
      <span class="ai-label">Risk</span>
      <span class="ai-value" id="aiRiskVal">0.00</span>
      <span class="ai-sep">‚Ä¢</span>
      <span class="ai-next" id="aiNextRow">Next: ‚Äî</span>
    </div>

    <div id="aiCoachWrap" aria-hidden="true">
      <div id="aiCoachBubble">
        <div class="coach-title">AI Coach</div>
        <div class="coach-msg" id="aiCoachMsg">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- END overlay -->
  <div id="endOverlay" aria-hidden="true">
    <div class="end-card">
      <div class="end-title" id="endTitle">Completed</div>
      <div class="end-sub" id="endSub">‚Äî</div>

      <div class="end-grid">
        <div class="end-item"><div class="k">GRADE</div><div class="v" id="endGrade">‚Äî</div></div>
        <div class="end-item"><div class="k">SCORE</div><div class="v" id="endScore">0</div></div>

        <div class="end-item"><div class="k">MISS</div><div class="v" id="endMiss">0</div></div>
        <div class="end-item"><div class="k">GOOD MISS</div><div class="v" id="endMissGood">0</div></div>
        <div class="end-item"><div class="k">JUNK MISS</div><div class="v" id="endMissJunk">0</div></div>

        <div class="end-item"><div class="k">TIME</div><div class="v" id="endTime">0</div></div>
      </div>

      <div class="end-note">‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° Back ‡∏ó‡∏µ‡πà Hub ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ HUB</div>
    </div>
  </div>

  <script type="module">
    import { boot } from './goodjunk.safe.js';

    // boot game
    boot({});

    // =========================
    // AI HUD + Coach wiring
    // listens to `hha:ai-prediction` emitted by goodjunk.safe.js
    // =========================
    const $ = (s)=>document.querySelector(s);

    const chip = $('#aiRiskChip');
    const riskVal = $('#aiRiskVal');
    const nextRow = $('#aiNextRow');

    const coachWrap = $('#aiCoachWrap');
    const coachMsg  = $('#aiCoachMsg');

    let lastUIAt = 0;
    let lastCoachAt = 0;
    let lastShownTip = '';
    let lastRisk = 0;
    let lastMiss = 0;

    const clamp = (v,a,b)=>Math.max(a, Math.min(b, v));
    const now = ()=> performance.now();

    function getState(){
      return window.__GJ_STATE__ || null;
    }

    function riskClass(r){
      if(r >= 0.66) return 'risk-high';
      if(r >= 0.38) return 'risk-med';
      return 'risk-low';
    }

    function fmtRisk(r){
      const rr = clamp(Number(r)||0, 0, 1);
      return rr.toFixed(2);
    }

    function pickTip(pred){
      const st = getState();
      const risk = clamp(pred?.hazardRisk ?? 0, 0, 1);

      const missGood = st?.missGoodExpired|0;
      const missJunk = st?.missJunkHit|0;
      const miss = (missGood + missJunk)|0;
      const shield = st?.shield|0;
      const fever = Math.round(st?.fever||0);

      // Detect "trend"
      const missUp = (miss > lastMiss);

      if(risk >= 0.75){
        if(shield <= 0) return '‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏°‡∏≤‡∏Å! üõ°Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πà‚Äî‡∏£‡∏µ‡∏ö‡πÄ‡∏Å‡πá‡∏ö Shield ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏•‡∏∏‡∏¢';
        if(missUp) return 'MISS ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡πá‡∏ß! ‚≠ê ‡∏´‡∏≤ Star ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î MISS ‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏´‡∏•';
        return '‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢! ‡πÄ‡∏•‡πá‡∏á‡∏¢‡∏¥‡∏á Good ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô + ‡∏£‡∏∞‡∏ß‡∏±‡∏á üí£/üíÄ';
      }

      if(risk >= 0.55){
        if(shield <= 1) return '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ‡πÄ‡∏Å‡πá‡∏ö üõ°Ô∏è ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏° Junk ‡πÉ‡∏´‡πâ‡∏î‡∏µ (‡∏≠‡∏¢‡πà‡∏≤‡∏û‡∏•‡∏≤‡∏î‡∏ö‡∏•‡πá‡∏≠‡∏Å)';
        if(fever >= 70) return 'FEVER ‡∏™‡∏π‡∏á‚Äî‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô ‡πÜ ‡∏•‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏ô‡πâ‡∏ô Good ‡∏ä‡∏±‡∏ß‡∏£‡πå ‡πÜ)';
        return '‡∏Å‡∏•‡∏≤‡∏á ‡πÜ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏Å: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô ‚≠ê ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î MISS';
      }

      if(risk >= 0.35){
        if(missUp) return '‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ‚Äî‡∏ä‡∏∞‡∏•‡∏≠ 0.5 ‡∏ß‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö Good ‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô';
        return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ! ‡∏£‡∏±‡∏Å‡∏©‡∏≤ Combo ‡πÅ‡∏•‡∏∞‡∏´‡∏≤ üíé ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ö‡∏ô‡∏±‡∏™';
      }

      return '‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡πÄ‡∏ô‡πâ‡∏ô Combo ‡∏¢‡∏¥‡∏á Good ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏∏‡∏ô üõ°Ô∏è ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡∏ä‡∏ô';
    }

    function showCoach(text){
      if(!coachWrap || !coachMsg) return;
      coachMsg.textContent = String(text || '‚Äî');
      coachWrap.setAttribute('aria-hidden', 'false');
      coachWrap.classList.add('show');

      // auto-hide
      setTimeout(()=>{
        coachWrap.classList.remove('show');
        coachWrap.setAttribute('aria-hidden', 'true');
      }, 2200);
    }

    function updateAIUI(pred){
      const t = now();
      // throttle UI updates (avoid spam)
      if(t - lastUIAt < 180) return;
      lastUIAt = t;

      const risk = clamp(Number(pred?.hazardRisk)||0, 0, 1);
      lastRisk = risk;

      // chip value
      if(riskVal) riskVal.textContent = fmtRisk(risk);

      // class
      if(chip){
        chip.classList.remove('risk-low','risk-med','risk-high');
        chip.classList.add(riskClass(risk));
      }

      // next list (show 3 items)
      const arr = Array.isArray(pred?.next5) ? pred.next5 : [];
      const top3 = arr.slice(0,3).map(s=>{
        // keep icon prefix if any
        const m = String(s||'').trim();
        // if "Next: üí£ ..." already present, just show it
        return m;
      });

      if(nextRow){
        nextRow.textContent = top3.length ? `Next: ${top3.join(' ‚Ä¢ ')}` : 'Next: ‚Äî';
      }

      // Coach rate-limit
      const st = getState();
      const missGood = st?.missGoodExpired|0;
      const missJunk = st?.missJunkHit|0;
      const miss = (missGood + missJunk)|0;

      // only coach if meaningful, and not too often
      const coachCooldown = (risk >= 0.66) ? 1200 : 2000;
      const shouldCoach = (risk >= 0.42) || (miss > lastMiss);

      if(shouldCoach && (t - lastCoachAt >= coachCooldown)){
        const tip = pickTip(pred);
        // avoid repeating exact same line too often
        if(tip && tip !== lastShownTip){
          lastCoachAt = t;
          lastShownTip = tip;
          showCoach(tip);
        }
      }

      lastMiss = miss;
    }

    window.addEventListener('hha:ai-prediction', (ev)=>{
      try{
        updateAIUI(ev.detail || {});
      }catch(_){}
    }, { passive:true });

    // optional: fade AI chip slightly while end overlay shown
    window.addEventListener('hha:game-ended', ()=>{
      try{ document.body.classList.add('is-ended'); }catch(_){}
    }, { passive:true });
  </script>

</body>
</html>