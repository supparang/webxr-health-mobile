<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GoodJunk VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- UI -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />

  <!-- Global FX + Cloud Logger (ต้องอยู่ก่อน boot เพื่อให้พร้อม) -->
  <script src="../vr/particles.js" defer></script>
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <!-- Boot (module) -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</head>

<body class="view-mobile">

  <!-- LOW TIME WARNING RING -->
  <div class="gj-warning-ring" aria-hidden="true"></div>

  <!-- VR MINI HUD (show only in VR/cVR) -->
  <div class="vr-mini-hud" id="vrMiniHud">
    <div class="mini-row">
      <div class="mini-pill"><span>SCORE</span><b id="miniScore">0</b></div>
      <div class="mini-pill"><span>TIME</span><b id="miniTime">0</b></div>
      <div class="mini-pill"><span>GRADE</span><b id="miniGrade">—</b></div>
      <button class="mini-btn" id="btnPeek">Missions</button>
    </div>
  </div>

  <!-- HUD -->
  <div class="hha-hud" id="hud">
    <div class="hud-top">
      <div class="hud-badge">
        <div class="hud-title">GoodJunkVR</div>
        <div class="hud-sub" id="hudSub">ยิงดีเลี่ยง “ขยะ”</div>

        <div class="viewbar">
          <button class="pill ghost" id="btnMissions">Missions</button>
          <button class="pill ghost" id="btnHideHud">Hide HUD</button>
        </div>
      </div>

      <div class="hud-stats">
        <div class="hud-stat"><div class="k">SCORE</div><div class="v" id="hudScore">0</div></div>
        <div class="hud-stat"><div class="k">TIME</div><div class="v" id="hudTime">0</div></div>
        <div class="hud-stat"><div class="k">MISS</div><div class="v" id="hudMiss">0</div></div>
        <div class="hud-stat"><div class="k">GRADE</div><div class="v" id="hudGrade">—</div></div>
      </div>
    </div>

    <div class="hud-mid">
      <div class="hud-quest">
        <div class="q-row">
          <div class="q-title" id="goalTitle">—</div>
          <div class="q-count" id="goalCount">0/0</div>
        </div>
        <div class="q-progress" id="goalDesc">—</div>

        <div style="height:10px"></div>

        <div class="q-row">
          <div class="q-title mini" id="miniTitle">—</div>
          <div class="q-timer" id="miniTimer">—</div>
        </div>
        <div class="q-progress" id="miniDesc">—</div>
      </div>
    </div>
  </div>

  <!-- MISSIONS PEEK -->
  <div class="gj-peek" id="peek" aria-hidden="true">
    <div class="peek-card">
      <div class="peek-title">Missions</div>
      <div class="peek-sub" id="peekGoal">—</div>
      <div class="peek-mini" id="peekMini">—</div>
      <div class="peek-tip" id="peekTip">แตะ/ยิงเพื่อปิด</div>
    </div>
  </div>

  <!-- FEVER -->
  <div class="hha-fever" id="feverBox">
    <div class="fever-row">
      <div class="fever-label">FEVER</div>
      <div class="fever-bar"><div class="fever-fill" id="feverFill"></div></div>
      <div class="fever-text" id="feverPct">0%</div>
    </div>

    <div class="shield-row">
      <div class="shield-label">SHIELD</div>
      <div class="shield-pills" id="shieldPills">—</div>
    </div>
  </div>

  <!-- STAGE -->
  <div id="gj-stage">
    <div class="gj-eye eye-l">
      <div class="gj-layer" id="layerL"></div>
      <div class="gj-crosshair" id="crosshairL"></div>
    </div>
    <div class="gj-eye eye-r">
      <div class="gj-layer" id="layerR"></div>
      <div class="gj-crosshair" id="crosshairR"></div>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="hha-controls">
    <button class="btn-shoot" id="btnShoot">ยิง / TAP</button>
  </div>

  <!-- LOWTIME BIG COUNTDOWN -->
  <div class="gj-lowtime-overlay" id="lowTimeOverlay" aria-hidden="true">
    <div class="gj-lowtime-num" id="lowTimeNum">5</div>
  </div>

  <!-- START OVERLAY -->
  <div id="startOverlay" style="
    position:fixed; inset:0; z-index:200;
    display:flex; align-items:center; justify-content:center;
    background: rgba(2,6,23,.86); backdrop-filter: blur(10px);
  ">
    <div style="
      width:min(720px,92vw);
      background: rgba(2,6,23,.82);
      border:1px solid rgba(148,163,184,.20);
      border-radius: 22px;
      padding:18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
    ">
      <div style="font-size:26px;font-weight:1200;">GoodJunkVR</div>
      <div id="startMeta" style="margin-top:8px;color:#94a3b8;font-weight:900;font-size:12px;">—</div>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
        <button id="btnStart" style="
          border:1px solid rgba(34,197,94,.30);
          background: rgba(34,197,94,.16);
          color:#eafff3;
          border-radius: 14px;
          padding:12px 16px;
          font-weight:1200;
          font-size:16px;
        ">Start</button>

        <button id="btnStartVR" style="
          border:1px solid rgba(34,211,238,.30);
          background: rgba(34,211,238,.14);
          color:#e9fbff;
          border-radius: 14px;
          padding:12px 16px;
          font-weight:1200;
          font-size:16px;
        ">Enter VR</button>
      </div>

      <div style="margin-top:12px;color:#94a3b8;font-weight:900;font-size:12px;">
        Mobile: แตะเป้าได้ / VR(cVR): เล็งกลางจอแล้วแตะ “ยิง”
      </div>
    </div>
  </div>

  <!-- INLINE UI WIRING -->
  <script>
  (function(){
    const qs = (k,d=null)=>{ try{return new URL(location.href).searchParams.get(k) ?? d;}catch{return d;} };

    const overlay  = document.getElementById('startOverlay');
    const meta     = document.getElementById('startMeta');
    const btnStart = document.getElementById('btnStart');
    const btnStartVR= document.getElementById('btnStartVR');

    const view = qs('view','mobile');
    const diff = qs('diff','normal');
    const run  = qs('run','play');
    meta.textContent = `view=${view} | run=${run} | diff=${diff}`;

    function start(){
      overlay.style.display = 'none';

      // ✅ สำคัญ: กัน start เกิดก่อน boot.js โหลด
      window.__HHA_PENDING_START__ = { view };

      window.dispatchEvent(new CustomEvent('hha:start', { detail:{ view } }));
    }

    btnStart.addEventListener('click', start);

    btnStartVR.addEventListener('click', ()=>{
      window.dispatchEvent(new CustomEvent('hha:enter-cvr'));
      start();
    });

    // shoot button => engine listens via event
    document.getElementById('btnShoot').addEventListener('click', ()=>{
      window.dispatchEvent(new CustomEvent('hha:shoot'));
    });

    // mission peek close by any tap
    const peek = document.getElementById('peek');
    peek.addEventListener('click', ()=>{
      peek.setAttribute('aria-hidden','true');
    });

    document.getElementById('btnMissions').addEventListener('click', ()=>{
      peek.setAttribute('aria-hidden','false');
    });
    document.getElementById('btnPeek').addEventListener('click', ()=>{
      peek.setAttribute('aria-hidden','false');
    });

    document.getElementById('btnHideHud').addEventListener('click', ()=>{
      document.body.classList.toggle('hud-hidden');
    });
  })();
  </script>

</body>
</html>