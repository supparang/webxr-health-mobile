<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- CSS (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô /herohealth/vr-goodjunk/) -->
  <link rel="stylesheet" href="./goodjunk-vr.css?v=20260206a" />
</head>

<body class="gj">
  <!-- =========================
       TOP BAR
  ========================== -->
  <header class="gj-topbar" role="banner">
    <div class="left">
      <div class="gj-chip" aria-label="Game title">üçÄ GoodJunkVR</div>
    </div>

    <div class="right">
      <button class="gj-btn" id="btnMissions" type="button">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
      <button class="gj-btn" id="btnHideHud" type="button">‡∏ã‡πà‡∏≠‡∏ô HUD</button>
      <button class="gj-btn primary" id="btnBackHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
    </div>
  </header>

  <!-- =========================
       PROGRESS BAR
  ========================== -->
  <div class="gj-progress" aria-hidden="true">
    <div class="gj-progress-fill" id="gjProgressFill"></div>
  </div>

  <!-- =========================
       HUD TOP
  ========================== -->
  <section class="gj-hud-top" id="hud" aria-label="HUD">
    <div class="hud-row">
      <div class="hud-pill grade">
        <div class="hud-label">GRADE</div>
        <div class="hud-value" id="hud-grade">‚Äî</div>
      </div>
      <div class="hud-pill">
        <div class="hud-label">SCORE</div>
        <div class="hud-value" id="hud-score">0</div>
      </div>
      <div class="hud-pill warn">
        <div class="hud-label">TIME</div>
        <div class="hud-value" id="hud-time">0</div>
      </div>
      <div class="hud-pill">
        <div class="hud-label">MISS</div>
        <div class="hud-value" id="hud-miss">0</div>
      </div>
    </div>

    <!-- Boss UI (safe.js toggles aria-hidden; boot re-measures on gj:measureSafe) -->
    <div class="gj-boss" id="bossBar" aria-hidden="true">
      <div class="gj-boss-title">üëë BOSS!</div>
      <div class="gj-boss-meter">
        <div class="gj-boss-fill" id="bossFill"></div>
      </div>
      <div class="gj-boss-hint" id="bossHint">‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≠‡∏™‚Ä¶</div>
    </div>

    <!-- Quests -->
    <div class="quest-row">
      <div class="quest-card goal">
        <div class="q-title">
          GOAL: <span id="hud-goal">‚Äî</span>
        </div>
        <div class="q-desc" id="goalDesc">‚Äî</div>
        <div class="q-bar">
          <div class="q-num"><span id="hud-goal-cur">0</span> / <span id="hud-goal-target">0</span></div>
          <div class="q-hint">‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏∞</div>
        </div>
      </div>

      <div class="quest-card mini">
        <div class="q-title">MINI: <span id="hud-mini">‚Äî</span></div>
        <div class="q-desc">‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏™‡∏•‡∏±‡∏ö MINI ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
        <div class="q-bar">
          <div class="q-num">‚è± <span id="miniTimer">‚Äî</span></div>
          <div class="q-hint">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ‚≠ê/üõ°Ô∏è</div>
        </div>
      </div>
    </div>
  </section>

  <!-- =========================
       PLAYFIELD + LAYERS
       IMPORTANT: safe.js v4.2 spawns relative to layer rect
       so the layer must be a fixed play-area (CSS handles)
  ========================== -->
  <div class="gj-field" id="playfield" aria-hidden="true"></div>

  <!-- left/main layer -->
  <div class="gj-layer" id="gj-layer" aria-label="Play layer"></div>

  <!-- right-eye layer for cVR split -->
  <div class="gj-layer gj-layer-r" id="gj-layer-r" aria-label="Play layer right" aria-hidden="true"></div>

  <!-- =========================
       BOTTOM HUD
  ========================== -->
  <footer class="gj-hud-bot" id="gjHudBot" aria-label="Bottom HUD">
    <div class="meter" id="feverBox">
      <div class="meter-title">FEVER / SHIELD</div>
      <div class="meter-bar" aria-hidden="true">
        <div class="meter-fill" id="feverFill"></div>
      </div>
      <div class="meter-num">
        Fever: <span id="feverText">0%</span><br/>
        Shield: <span id="shieldPills">‚Äî</span>
      </div>
      <div class="meter-tip">‚≠ê ‡∏•‡∏î MISS / üõ°Ô∏è ‡∏Å‡∏±‡∏ô‡∏Ç‡∏¢‡∏∞ (‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô MISS)</div>
    </div>

    <div class="meter" id="howtoBox">
      <div class="meter-title">HOW TO</div>
      <div class="meter-tip">
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞ üçÄ/‡∏ú‡∏•‡πÑ‡∏°‡πâ = ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br/>
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞ üçü/‡∏Ç‡∏¢‡∏∞ = MISS + ‡∏ï‡∏±‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ üõ°Ô∏è ‡∏à‡∏∞ BLOCK)<br/>
        ‚Ä¢ VR/cVR: ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ ‡∏ú‡πà‡∏≤‡∏ô <b>hha:shoot</b>
      </div>
    </div>
  </footer>

  <!-- floating quick controls (optional) -->
  <div class="hha-controls" aria-label="Quick controls">
    <button class="gj-btn" id="btnHideHud2" type="button">‡∏ã‡πà‡∏≠‡∏ô HUD</button>
    <button class="gj-btn" id="btnMissions2" type="button">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
  </div>

  <!-- =========================
       Missions Peek Overlay
  ========================== -->
  <div class="gj-peek" id="missionsPeek" aria-hidden="true">
    <div class="peek-card">
      <div class="peek-title">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</div>
      <div class="peek-sub" id="peekGoal">GOAL: ‚Äî</div>
      <div class="peek-mini" id="peekMini">MINI: ‚Äî</div>
      <div class="peek-tip">‡πÅ‡∏ï‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</div>
    </div>
  </div>

  <!-- =========================
       Low time overlay
  ========================== -->
  <div class="gj-lowtime-overlay" id="lowTimeOverlay" aria-hidden="true">
    <div class="gj-lowtime-ring"></div>
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </div>

  <!-- =========================
       Optional FX + Logger (classic scripts)
       - logger listens hha:start/hha:end automatically
  ========================== -->
  <script defer src="../vr/particles.js"></script>
  <script defer src="../vr/hha-fx-director.js"></script>
  <script defer src="../vr/hha-cloud-logger.js"></script>

  <!-- =========================
       Boot (module)
       - will boot goodjunk.safe.js v4.2
       - strict auto view (ignores ?view=)
       - measures safe vars --gj-top-safe/--gj-bottom-safe
       - listens gj:measureSafe to re-measure when boss shows/hides
  ========================== -->
  <script type="module" src="./goodjunk-vr.boot.js?v=20260206a"></script>

  <!-- =========================
       UI bindings (small)
  ========================== -->
  <script>
    (function(){
      'use strict';
      const DOC = document;

      const qs = (k, d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch{ return d; } };

      function toggleHud(){
        DOC.body.classList.toggle('hud-hidden');
        try{ window.dispatchEvent(new CustomEvent('gj:measureSafe', { detail:{ source:'toggleHud' } })); }catch(_){}
      }

      function showMissions(){
        DOC.body.classList.add('show-missions');

        const gName = (DOC.getElementById('hud-goal')?.textContent||'‚Äî').trim();
        const gDesc = (DOC.getElementById('goalDesc')?.textContent||'‚Äî').trim();
        const gCur  = (DOC.getElementById('hud-goal-cur')?.textContent||'0').trim();
        const gTar  = (DOC.getElementById('hud-goal-target')?.textContent||'0').trim();

        const mTxt  = (DOC.getElementById('hud-mini')?.textContent||'‚Äî').trim();
        const mTim  = (DOC.getElementById('miniTimer')?.textContent||'‚Äî').trim();

        const peekGoal = DOC.getElementById('peekGoal');
        const peekMini = DOC.getElementById('peekMini');
        if(peekGoal) peekGoal.textContent = `GOAL: ${gName} ‚Ä¢ ${gCur}/${gTar} ‚Äî ${gDesc}`;
        if(peekMini) peekMini.textContent = `MINI: ${mTxt} ‚Ä¢ ${mTim}`;
      }

      function hideMissions(){
        DOC.body.classList.remove('show-missions');
      }

      function backHub(){
        const hub = qs('hub', null);
        if(hub){
          location.href = hub;
          return;
        }
        location.href = '../hub.html';
      }

      function bind(id, fn){
        const el = DOC.getElementById(id);
        if(el) el.addEventListener('click', fn, { passive:true });
      }

      bind('btnHideHud', toggleHud);
      bind('btnHideHud2', toggleHud);

      bind('btnMissions', showMissions);
      bind('btnMissions2', showMissions);

      bind('btnBackHub', backHub);

      const peek = DOC.getElementById('missionsPeek');
      if(peek){
        peek.addEventListener('click', (e)=>{
          if(e.target === peek) hideMissions();
        }, { passive:true });
      }

      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') hideMissions();
      }, { passive:true });
    })();
  </script>
</body>
</html>