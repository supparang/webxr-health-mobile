<!-- === /herohealth/vr-goodjunk/goodjunk-vr.html ===
GoodJunkVR RUN ‚Äî PRODUCTION (pairs with v4.2 safe + playable CSS)
‚úÖ Uses: ./goodjunk-vr.css
‚úÖ Boots: ./goodjunk-vr.boot.js  (module; imports ./goodjunk.safe.js v4.2)
‚úÖ Optional FX: ../vr/particles.js + ../vr/hha-fx-director.js
‚úÖ Optional Logger: ../vr/hha-cloud-logger.js (auto-init by ?log=)
‚úÖ DOM IDs match safe.js v4.2:
   hud-score hud-time hud-miss hud-grade
   hud-goal goalDesc hud-goal-cur hud-goal-target
   hud-mini miniTimer
   feverFill feverText shieldPills feverBox
   gjProgressFill
   bossBar bossFill bossHint
   lowTimeOverlay + gj-lowtime-num
   gj-layer + gj-layer-r
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- ‚úÖ RUN CSS (‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô) -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />
</head>

<body class="gj" data-view="">

  <!-- =========================
       TOPBAR
  ========================== -->
  <header class="gj-topbar" role="banner">
    <div class="left">
      <span class="gj-chip" id="gjTitle">üçÄ GoodJunkVR</span>
      <span class="gj-chip" id="gjModeChip">AUTO</span>
    </div>

    <div class="right">
      <button class="gj-btn" id="btnMissions" type="button">Missions</button>
      <button class="gj-btn" id="btnHideHud" type="button">‡∏ã‡πà‡∏≠‡∏ô HUD</button>
      <button class="gj-btn primary" id="btnBackHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
    </div>
  </header>

  <!-- =========================
       PROGRESS BAR (top)
  ========================== -->
  <div class="gj-progress" aria-hidden="true">
    <div class="gj-progress-fill" id="gjProgressFill" style="width:0%"></div>
  </div>

  <!-- =========================
       HUD TOP
  ========================== -->
  <section class="gj-hud-top" id="hud" aria-label="HUD">
    <div class="hud-row" aria-hidden="false">
      <div class="hud-pill">
        <div class="hud-label">SCORE</div>
        <div class="hud-value" id="hud-score">0</div>
      </div>

      <div class="hud-pill warn">
        <div class="hud-label">TIME</div>
        <div class="hud-value" id="hud-time">‚Äî</div>
      </div>

      <div class="hud-pill">
        <div class="hud-label">MISS</div>
        <div class="hud-value" id="hud-miss">0</div>
      </div>

      <div class="hud-pill grade">
        <div class="hud-label">GRADE</div>
        <div class="hud-value" id="hud-grade">‚Äî</div>
      </div>
    </div>

    <!-- Boss bar (safe.js v4.2 toggles aria-hidden) -->
    <div class="gj-boss" id="bossBar" aria-hidden="true">
      <div class="gj-boss-title">‚ö° BOSS</div>
      <div class="gj-boss-meter">
        <div class="gj-boss-fill" id="bossFill" style="width:100%"></div>
      </div>
      <div class="gj-boss-hint" id="bossHint">‚Äî</div>
    </div>

    <!-- Quests -->
    <div class="quest-row" aria-label="Quests">
      <div class="quest-card goal">
        <div class="q-title">GOAL: <span id="hud-goal">‚Äî</span></div>
        <div class="q-desc" id="goalDesc">‚Äî</div>
        <div class="q-bar">
          <div class="q-num"><span id="hud-goal-cur">0</span>/<span id="hud-goal-target">0</span></div>
          <div class="q-hint">‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ GOAL ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
        </div>
      </div>

      <div class="quest-card mini">
        <div class="q-title">MINI</div>
        <div class="q-desc" id="hud-mini">‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô 12 ‡∏ß‡∏¥</div>
        <div class="q-bar">
          <div class="q-num" id="miniTimer">‚Äî</div>
          <div class="q-hint">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ‚≠ê/üõ°Ô∏è/MISS-1</div>
        </div>
      </div>
    </div>
  </section>

  <!-- =========================
       PLAYFIELD + LAYERS
       (targets will be appended here)
  ========================== -->
  <main class="gj-field" id="playfield" aria-label="Playfield">
    <div class="gj-layer" id="gj-layer" aria-hidden="false"></div>
    <div class="gj-layer gj-layer-r" id="gj-layer-r" aria-hidden="true"></div>
  </main>

  <!-- =========================
       BOTTOM HUD (Fever/Shield + Howto)
  ========================== -->
  <footer class="gj-hud-bot" id="gjHudBot" aria-label="Status">
    <div class="meter" id="feverBox">
      <div class="meter-title">üî• FEVER / SHIELD</div>
      <div class="meter-bar" aria-hidden="true">
        <div class="meter-fill" id="feverFill" style="width:0%"></div>
      </div>
      <div class="meter-num">FEVER: <span id="feverText">‚Äî</span></div>
      <div class="meter-tip">SHIELD: <b id="shieldPills">‚Äî</b></div>
    </div>

    <div class="meter" id="howtoBox">
      <div class="meter-title">üéÆ HOW TO</div>
      <div class="meter-tip">
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞ ‚Äú‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ó‡∏≥‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°)<br/>
        ‚Ä¢ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ‚Äú‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‚Äù (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πà‡∏à‡∏∞‡∏ô‡∏±‡∏ö MISS)<br/>
        ‚Ä¢ ‡∏ó‡∏≥ MINI ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™<br/>
        ‚Ä¢ Enter VR: ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô cVR / ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏õ‡πá‡∏ô VR (boot auto)
      </div>
    </div>
  </footer>

  <!-- quick controls (boot measure uses .hha-controls) -->
  <div class="hha-controls" aria-label="Quick Controls">
    <button class="gj-btn" id="btnHideHud2" type="button">HUD</button>
    <button class="gj-btn" id="btnRestart" type="button">Restart</button>
  </div>

  <!-- =========================
       Missions Peek Overlay
  ========================== -->
  <section class="gj-peek" id="missionsPeek" aria-hidden="true">
    <div class="peek-card">
      <div class="peek-title">üß≠ Missions</div>
      <div class="peek-sub" id="peekGoal">GOAL: ‡∏î‡∏π‡∏ö‡∏ô HUD</div>
      <div class="peek-mini" id="peekMini">MINI: ‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô 12 ‡∏ß‡∏¥</div>
      <div class="peek-tip">‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏° Missions ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</div>
      <div style="margin-top:12px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
        <button class="gj-btn" id="btnClosePeek" type="button">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </section>

  <!-- =========================
       Low time overlay (safe.js toggles aria-hidden)
  ========================== -->
  <section class="gj-lowtime-overlay" id="lowTimeOverlay" aria-hidden="true">
    <div class="gj-lowtime-ring" aria-hidden="true"></div>
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </section>

  <!-- =========================
       End overlay (optional UI; safe.js emits hha:end)
  ========================== -->
  <section class="gj-end" id="endOverlay" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" aria-label="Summary">
      <div class="title">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</div>
      <div class="sub" id="endSub">‚Äî</div>

      <div class="grid" id="endGrid">
        <div class="stat"><span>Score</span><b id="endScore">0</b></div>
        <div class="stat"><span>Miss</span><b id="endMiss">0</b></div>
        <div class="stat"><span>ComboMax</span><b id="endCombo">0</b></div>
        <div class="stat"><span>Grade</span><b id="endGrade">‚Äî</b></div>
      </div>

      <div class="actions">
        <button class="btn" id="btnEndRestart" type="button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn alt" id="btnEndHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>
    </div>
  </section>

  <!-- =========================
       OPTIONAL FX + LOGGER (classic scripts)
       (defer OK ‚Äî boot waits briefly for FX core)
  ========================== -->
  <script defer src="../vr/particles.js"></script>
  <script defer src="../vr/hha-fx-director.js"></script>
  <script defer src="../vr/hha-cloud-logger.js"></script>

  <!-- =========================
       UI wiring (classic)
  ========================== -->
  <script>
    (function(){
      'use strict';
      const $ = (s)=>document.querySelector(s);

      function qs(k, def=null){
        try{ return new URL(location.href).searchParams.get(k) ?? def; }
        catch{ return def; }
      }

      function setModeChip(){
        const run  = (qs('run','play')||'play').toLowerCase();
        const diff = (qs('diff','normal')||'normal').toLowerCase();
        const time = (qs('time','80')||'80');
        const txt = `${run.toUpperCase()} ‚Ä¢ ${diff.toUpperCase()} ‚Ä¢ ${time}s`;
        const el = $('#gjModeChip');
        if(el) el.textContent = txt;
      }

      function toggleHud(){
        document.body.classList.toggle('hud-hidden');
      }

      function toggleMissions(on){
        const show = (typeof on === 'boolean') ? on : !document.body.classList.contains('show-missions');
        document.body.classList.toggle('show-missions', show);
        const peek = $('#missionsPeek');
        if(peek) peek.setAttribute('aria-hidden', show ? 'false' : 'true');
      }

      function backHub(){
        const hub = qs('hub', null);
        if(hub) { location.href = hub; return; }
        location.href = '../hub.html';
      }

      function restart(){
        location.reload();
      }

      // Buttons
      const btnM = $('#btnMissions');
      const btnHide1 = $('#btnHideHud');
      const btnHide2 = $('#btnHideHud2');
      const btnHub = $('#btnBackHub');
      const btnClosePeek = $('#btnClosePeek');
      const btnRestart = $('#btnRestart');

      if(btnM) btnM.addEventListener('click', ()=>toggleMissions(), { passive:true });
      if(btnClosePeek) btnClosePeek.addEventListener('click', ()=>toggleMissions(false), { passive:true });
      if(btnHide1) btnHide1.addEventListener('click', toggleHud, { passive:true });
      if(btnHide2) btnHide2.addEventListener('click', toggleHud, { passive:true });
      if(btnHub) btnHub.addEventListener('click', backHub, { passive:true });
      if(btnRestart) btnRestart.addEventListener('click', restart, { passive:true });

      // End overlay buttons
      const btnEndRestart = $('#btnEndRestart');
      const btnEndHub = $('#btnEndHub');
      if(btnEndRestart) btnEndRestart.addEventListener('click', restart, { passive:true });
      if(btnEndHub) btnEndHub.addEventListener('click', backHub, { passive:true });

      // Show end overlay when safe.js emits hha:end
      window.addEventListener('hha:end', (e)=>{
        const d = (e && e.detail) ? e.detail : {};
        const end = $('#endOverlay');
        if(!end) return;

        $('#endSub').textContent =
          `‡πÇ‡∏´‡∏°‡∏î: ${(d.runMode||'').toUpperCase()} ‚Ä¢ ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${(d.diff||'').toUpperCase()} ‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤: ${d.durationPlayedSec||0}s`;

        $('#endScore').textContent = String(d.scoreFinal ?? 0);
        $('#endMiss').textContent  = String(d.miss ?? 0);
        $('#endCombo').textContent = String(d.comboMax ?? 0);
        $('#endGrade').textContent = String(d.grade ?? '‚Äî');

        end.setAttribute('aria-hidden','false');
      }, { passive:true });

      // update mission peek live (optional) from quest:update
      window.addEventListener('quest:update', (e)=>{
        const q = e && e.detail ? e.detail : null;
        if(!q) return;
        const g = q.goal || {};
        const m = q.mini || {};
        const pg = $('#peekGoal');
        const pm = $('#peekMini');
        if(pg) pg.textContent = `GOAL: ${(g.title||g.name||'‚Äî')} (${g.cur||0}/${g.target||0})`;
        if(pm) pm.textContent = `MINI: ${(m.title||m.name||'‚Äî')} (${m.cur||0}/${m.target||0})`;
      }, { passive:true });

      setModeChip();
    })();
  </script>

  <!-- =========================
       BOOT (module)
  ========================== -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</body>
</html>