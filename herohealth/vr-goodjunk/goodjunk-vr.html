<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" />

  <!-- CSS -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />

  <!-- Cloud Logger (optional; enabled only when ?log=... exists) -->
  <script defer src="../vr/hha-cloud-logger.js"></script>

  <!-- Boot (module) -> auto view (pc/mobile), auto VR switch, safe-measure, then starts engine -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</head>

<body class="gj view-mobile">
  <!-- =========================
       TOP BAR
       ========================= -->
  <header class="gj-topbar" role="banner" aria-label="GoodJunkVR topbar">
    <div class="left">
      <div class="gj-chip" aria-label="Game Title">GOODJUNK</div>
      <div class="gj-chip" aria-label="Mode / Difficulty" id="chipMode">PLAY</div>
    </div>

    <div class="right">
      <button class="gj-btn" id="btnMissions" type="button" aria-label="Show missions">
        MISSIONS
      </button>
      <button class="gj-btn" id="btnHideHud" type="button" aria-label="Toggle HUD">
        HIDE HUD
      </button>
      <button class="gj-btn primary" id="btnBackHub" type="button" aria-label="Back to HUB">
        HUB
      </button>
    </div>
  </header>

  <!-- Progress bar -->
  <div class="gj-progress" aria-label="progress">
    <div class="gj-progress-fill" id="gjProgressFill"></div>
  </div>

  <!-- =========================
       HUD TOP (pointer-events none)
       ========================= -->
  <section class="gj-hud-top" id="hud" aria-label="HUD Top">
    <div class="hud-row" aria-label="HUD row">
      <div class="hud-pill">
        <div class="hud-label">SCORE</div>
        <div class="hud-value" id="hud-score">0</div>
      </div>
      <div class="hud-pill">
        <div class="hud-label">TIME</div>
        <div class="hud-value" id="hud-time">0</div>
      </div>
      <div class="hud-pill warn">
        <div class="hud-label">MISS</div>
        <div class="hud-value" id="hud-miss">0</div>
      </div>
      <div class="hud-pill grade">
        <div class="hud-label">GRADE</div>
        <div class="hud-value" id="hud-grade">‚Äî</div>
      </div>

      <div class="hud-pill" aria-label="Shield">
        <div class="hud-label">SHIELD</div>
        <div class="hud-value" id="shieldPills">‚Äî</div>
      </div>
    </div>

    <!-- Boss bar (safe.js will toggle aria-hidden) -->
    <div class="gj-boss" id="bossBar" aria-hidden="true" aria-label="Boss bar">
      <div class="gj-boss-title">BOSS PHASE</div>
      <div class="gj-boss-meter" aria-label="Boss HP">
        <div class="gj-boss-fill" id="bossFill"></div>
      </div>
      <div class="gj-boss-hint" id="bossHint">‚Äî</div>
    </div>

    <!-- Goal + Mini quest -->
    <div class="quest-row" aria-label="Quests">
      <div class="quest-card" aria-label="Goal quest">
        <div class="q-title">
          GOAL: <span id="hud-goal">‚Äî</span>
        </div>
        <div class="q-desc" id="goalDesc">‚Äî</div>
        <div class="q-bar">
          <div class="q-num">
            <span id="hud-goal-cur">0</span>/<span id="hud-goal-target">1</span>
          </div>
          <div class="q-hint">‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
        </div>
      </div>

      <div class="quest-card mini" aria-label="Mini quest">
        <div class="q-title">MINI</div>
        <div class="q-desc" id="hud-mini">‚Äî</div>
        <div class="q-bar">
          <div class="q-num" id="miniTimer">‚Äî</div>
          <div class="q-hint">‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ß!</div>
        </div>
      </div>
    </div>
  </section>

  <!-- =========================
       PLAYFIELD + LAYERS
       ========================= -->
  <main class="gj-field" id="playfield" aria-label="playfield">
    <!-- left eye layer -->
    <div class="gj-layer" id="gj-layer" aria-label="gj-layer"></div>
    <!-- right eye layer (for cVR split) -->
    <div class="gj-layer gj-layer-r" id="gj-layer-r" aria-label="gj-layer-r" aria-hidden="true"></div>
  </main>

  <!-- =========================
       HUD BOTTOM
       ========================= -->
  <footer class="gj-hud-bot" id="gjHudBot" aria-label="HUD Bottom">
    <div class="meter" id="feverBox" aria-label="Fever meter">
      <div class="meter-title">FEVER</div>
      <div class="meter-bar" aria-label="Fever bar">
        <div class="meter-fill" id="feverFill"></div>
      </div>
      <div class="meter-num" id="feverText">0%</div>
      <div class="meter-tip">‡∏¢‡∏¥‡πà‡∏á FEVER ‡∏™‡∏π‡∏á ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏à‡∏∞‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô!</div>
    </div>

    <div class="meter" id="howtoBox" aria-label="How to play">
      <div class="meter-title">HOW TO</div>
      <div class="meter-tip">
        ‚úÖ ‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πâ‡∏≤ ‚Äú‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô<br/>
        ‚ùå ‡∏≠‡∏¢‡πà‡∏≤‡πÇ‡∏î‡∏ô ‚Äú‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‚Äù<br/>
        üéÅ ‡πÄ‡∏Å‡πá‡∏ö ‚≠ê ‡∏•‡∏î MISS / üõ°Ô∏è ‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢<br/>
        VR/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÉ‡∏ä‡πâ crosshair ‡∏¢‡∏¥‡∏á (tap-to-shoot)
      </div>
    </div>
  </footer>

  <!-- Controls cluster (optional quick actions; pointer-events:auto in CSS) -->
  <div class="hha-controls" aria-label="Quick controls">
    <button class="gj-btn" id="btnHideHud2" type="button" aria-label="Toggle HUD bottom button">
      HUD
    </button>
    <button class="gj-btn" id="btnRecenterHint" type="button" aria-label="Recenter hint">
      RECENTER
    </button>
  </div>

  <!-- =========================
       Missions Peek Overlay (toggle via body.show-missions)
       ========================= -->
  <section class="gj-peek" id="missionsPeek" aria-label="Missions overlay">
    <div class="peek-card" role="dialog" aria-modal="true" aria-label="Missions">
      <div class="peek-title">MISSIONS</div>
      <div class="peek-sub" id="peekGoal">GOAL: ‡∏î‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
      <div class="peek-mini" id="peekMini">MINI: ‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
      <div class="peek-tip">
        ‡∏ó‡∏¥‡∏õ: ‡∏ñ‡πâ‡∏≤ HUD ‡∏ö‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏î HIDE HUD ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏∞‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚úÖ
      </div>
      <div style="margin-top:12px; display:flex; gap:10px; justify-content:flex-end;">
        <button class="gj-btn primary" id="btnCloseMissions" type="button">CLOSE</button>
      </div>
    </div>
  </section>

  <!-- =========================
       Low Time Overlay
       ========================= -->
  <div class="gj-lowtime-overlay" id="lowTimeOverlay" aria-hidden="true" aria-label="Low time overlay">
    <div class="gj-lowtime-ring" aria-hidden="true"></div>
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </div>

  <!-- =========================
       Small helpers (no dependency)
       ========================= -->
  <script>
  (function(){
    'use strict';
    const DOC = document;
    const WIN = window;

    function qs(k, d=null){ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch{ return d; } }

    // Top chip reflect query (nice-to-have)
    const chip = DOC.getElementById('chipMode');
    if(chip){
      const run = String(qs('run','play')).toUpperCase();
      const diff = String(qs('diff','normal')).toUpperCase();
      chip.textContent = run + ' ‚Ä¢ ' + diff;
    }

    // Missions overlay toggle
    const btnM = DOC.getElementById('btnMissions');
    const btnC = DOC.getElementById('btnCloseMissions');
    function showM(){ DOC.body.classList.add('show-missions'); }
    function hideM(){ DOC.body.classList.remove('show-missions'); }
    if(btnM) btnM.addEventListener('click', showM, { passive:true });
    if(btnC) btnC.addEventListener('click', hideM, { passive:true });
    const overlay = DOC.getElementById('missionsPeek');
    if(overlay) overlay.addEventListener('click', (e)=>{
      if(e.target === overlay) hideM();
    }, { passive:true });

    // HUD toggle -> body.hud-hidden (boot will remeasure via click listener)
    function toggleHUD(){
      DOC.body.classList.toggle('hud-hidden');
      const b1 = DOC.getElementById('btnHideHud');
      const b2 = DOC.getElementById('btnHideHud2');
      const on = DOC.body.classList.contains('hud-hidden');
      if(b1) b1.textContent = on ? 'SHOW HUD' : 'HIDE HUD';
      if(b2) b2.textContent = on ? 'HUD+' : 'HUD';
    }
    const btnH1 = DOC.getElementById('btnHideHud');
    const btnH2 = DOC.getElementById('btnHideHud2');
    if(btnH1) btnH1.addEventListener('click', toggleHUD, { passive:true });
    if(btnH2) btnH2.addEventListener('click', toggleHUD, { passive:true });

    // Back to HUB (pass-through ?hub=... ; also flush logger)
    const btnHub = DOC.getElementById('btnBackHub');
    if(btnHub){
      btnHub.addEventListener('click', ()=>{
        try{ WIN.HHA_LOGGER && WIN.HHA_LOGGER.flush && WIN.HHA_LOGGER.flush('backHub'); }catch(_){}
        const hub = qs('hub', null);
        if(hub){
          location.href = hub;
        }else{
          // fallback
          location.href = '../hub.html';
        }
      });
    }

    // Recenter hint button (real recenter is in vr-ui.js; this is just UX)
    const btnR = DOC.getElementById('btnRecenterHint');
    if(btnR){
      btnR.addEventListener('click', ()=>{
        try{
          WIN.dispatchEvent(new CustomEvent('hha:recenter', { detail:{ source:'hintBtn' } }));
        }catch(_){}
      }, { passive:true });
    }
  })();
  </script>
</body>
</html>