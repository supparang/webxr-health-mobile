<!-- === /herohealth/vr-goodjunk/goodjunk-vr.html ===
GoodJunkVR RUN (FOLDER) ‚Äî PRODUCTION FULL (clean)
v20260220b
‚úÖ IDs ‡∏Ñ‡∏£‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö goodjunk.safe.js
‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ inline bind ‡∏õ‡∏∏‡πà‡∏° HUB/Restart (‡πÉ‡∏´‡πâ boot.js ‡∏Ñ‡∏∏‡∏°)
‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏´‡∏•‡∏î ../vr/vr-ui.js ‡∏ã‡πâ‡∏≥ (boot ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á HUD / overlays ‡∏Ñ‡∏£‡∏ö
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>GoodJunkVR</title>
  <meta name="color-scheme" content="dark light"/>
  <link rel="icon" href="../favicon.ico"/>
  <link rel="stylesheet" href="./goodjunk-vr.css?v=20260220b"/>
</head>
<body class="gj view-pc">

  <!-- =========================================================
       TOPBAR
       ========================================================= -->
  <div class="gj-topbar" role="region" aria-label="Top Bar">
    <div class="left">
      <span class="gj-chip gj-chip-brand">üçÄ GoodJunkVR</span>
      <span id="chipMode" class="gj-chip gj-chip-mini">mode: ‚Äî</span>
      <span id="chipDiff" class="gj-chip gj-chip-mini">diff: ‚Äî</span>
      <span id="vrMiniHud" class="gj-chip gj-chip-mini">üéØ VR: ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠</span>
    </div>

    <div class="right hha-controls">
      <button id="btnMissions" class="gj-btn" type="button">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
      <button id="btnHideHud" class="gj-btn" type="button">‡∏ã‡πà‡∏≠‡∏ô HUD</button>

      <!-- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö id ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + id ‡πÄ‡∏î‡∏¥‡∏° (boot.js bind ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà) -->
      <button id="btnRestart" class="gj-btn" type="button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      <button id="btnHub" class="gj-btn primary" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
    </div>
  </div>

  <!-- =========================================================
       PLAYFIELD
       ========================================================= -->
  <div class="gj-field" id="playfield" aria-label="GoodJunk Playfield">
    <div id="gj-layer" class="gj-layer" aria-label="GoodJunk Layer"></div>
    <div id="gj-layer-r" class="gj-layer gj-layer-r" aria-hidden="true" aria-label="GoodJunk Layer Right"></div>
    <!-- safe.js ‡∏≠‡∏≤‡∏à‡∏™‡∏£‡πâ‡∏≤‡∏á #gj-fx ‡πÄ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö hardened -->
  </div>

  <!-- =========================================================
       HUD TOP
       ========================================================= -->
  <div class="gj-hud-top" id="hud" role="region" aria-label="HUD" style="pointer-events:none;">
    <div class="hud-row">
      <div class="hud-pill">
        <div class="hud-label">SCORE</div>
        <div id="hud-score" class="hud-value">0</div>
      </div>

      <div class="hud-pill warn">
        <div class="hud-label">TIME</div>
        <div id="hud-time" class="hud-value">0</div>
      </div>

      <div class="hud-pill">
        <div class="hud-label">MISS</div>
        <div id="hud-miss" class="hud-value">0</div>
      </div>

      <div class="hud-pill grade">
        <div class="hud-label">GRADE</div>
        <div id="hud-grade" class="hud-value">‚Äî</div>
      </div>
    </div>

    <!-- progress -->
    <div class="gj-progress" aria-label="progress" style="pointer-events:none;">
      <div class="gj-progress-track">
        <div id="gjProgressFill" class="gj-progress-fill"></div>
      </div>
    </div>

    <!-- boss bar -->
    <div id="bossBar" class="gj-bossbar" aria-hidden="true">
      <div class="gj-bossbar-head">
        <div class="gj-bossbar-title">BOSS</div>
        <div id="bossHint" class="gj-bossbar-hint"></div>
      </div>
      <div class="gj-bossbar-track">
        <div id="bossFill" class="gj-bossbar-fill"></div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       HUD BOTTOM
       ========================================================= -->
  <div class="gj-hud-bot" aria-label="HUD Bottom">
    <div class="meter" aria-label="Goal">
      <div class="meter-title" id="hud-goal">‚Äî</div>
      <div class="meter-tip" id="goalDesc">‚Äî</div>
      <div class="meter-num" style="margin-top:6px;">
        <b id="hud-goal-cur">0</b> / <b id="hud-goal-target">0</b>
      </div>
    </div>

    <div class="meter" aria-label="Mini Quest">
      <div class="meter-title">Mini Quest</div>
      <div class="meter-tip" id="hud-mini">‚Äî</div>
      <div class="meter-num" style="margin-top:6px;">‚è± <span id="miniTimer">‚Äî</span></div>
    </div>

    <div class="meter" aria-label="Fever + Shield">
      <div class="meter-title">FEVER</div>
      <div class="meter-bar"><div id="feverFill" class="meter-fill"></div></div>
      <div class="meter-num"><span id="feverText">0%</span></div>
      <div class="meter-shield" style="margin-top:6px;">üõ°Ô∏è <span id="shieldPills">‚Äî</span></div>
    </div>
  </div>

  <!-- =========================================================
       Missions Peek (modal)
       ========================================================= -->
  <div id="missionsPeek" class="gj-quest-panel" aria-hidden="true">
    <div class="gj-quest-card" role="dialog" aria-modal="true" aria-label="‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ">
      <div class="gj-quest-head">
        <div class="gj-quest-title">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
        <button id="btnClosePeek" class="gj-btn" type="button">‡∏õ‡∏¥‡∏î</button>
      </div>

      <div class="gj-quest-section">
        <div class="q-title">GOAL</div>
        <div id="peekGoal" class="q-desc">GOAL: ‚Äî</div>
      </div>

      <div class="gj-quest-section">
        <div class="q-title">MINI</div>
        <div id="peekMini" class="q-desc">MINI: ‚Äî</div>
        <div class="q-hint">‡πÅ‡∏ï‡∏∞ ‚Äú‡∏õ‡∏¥‡∏î‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       Low time overlay
       ========================================================= -->
  <div id="lowTimeOverlay" class="gj-lowtime-overlay" aria-hidden="true">
    <div class="gj-lowtime-ring"></div>
    <div id="gj-lowtime-num" class="gj-lowtime-num">5</div>
  </div>

  <!-- =========================================================
       End overlay
       ========================================================= -->
  <div id="endOverlay" class="gj-end" aria-hidden="true">
    <div class="card">
      <div id="endTitle" class="title">Completed</div>
      <div id="endSub" class="sub">‚Äî</div>

      <div class="grid">
        <div class="stat"><span>GRADE</span><b id="endGrade">‚Äî</b></div>
        <div class="stat"><span>SCORE</span><b id="endScore">0</b></div>
        <div class="stat"><span>MISS</span><b id="endMiss">0</b></div>
        <div class="stat"><span>TIME</span><b id="endTime">0</b></div>
      </div>

      <div class="actions">
        <!-- id ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + id ‡πÄ‡∏î‡∏¥‡∏° ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô boot -->
        <button id="btnRestartEnd" class="btn" type="button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button id="btnBackHub" class="btn alt" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>
    </div>
  </div>

  <!-- =========================================================
       Boot (single source of truth)
       ========================================================= -->
  <script type="module" src="./goodjunk-vr.boot.js?v=20260220b"></script>

  <!-- =========================================================
       Lightweight UI-only wiring (‡πÑ‡∏°‡πà bind restart/hub ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Å‡∏±‡∏ö boot)
       - chips mode/diff
       - missions modal open/close
       - hide HUD toggle
       - quest:update -> update peek text
       ========================================================= -->
  <script>
    (function(){
      const DOC = document;
      const WIN = window;

      function qs(k, defVal=null){
        try { return new URL(location.href).searchParams.get(k) ?? defVal; }
        catch(_) { return defVal; }
      }

      // --- chips ---
      const chipMode = DOC.getElementById('chipMode');
      const chipDiff = DOC.getElementById('chipDiff');
      if (chipMode) chipMode.textContent = `mode: ${qs('run','play')}`;
      if (chipDiff) chipDiff.textContent = `diff: ${qs('diff','normal')}`;

      // --- HUD show/hide (UI-only) ---
      const btnHideHud = DOC.getElementById('btnHideHud');
      function syncHudBtn(){
        if (!btnHideHud) return;
        const hidden = DOC.body.classList.contains('hud-hidden');
        btnHideHud.textContent = hidden ? '‡πÅ‡∏™‡∏î‡∏á HUD' : '‡∏ã‡πà‡∏≠‡∏ô HUD';
      }
      function toggleHud(){
        DOC.body.classList.toggle('hud-hidden');
        syncHudBtn();
      }
      btnHideHud && btnHideHud.addEventListener('click', toggleHud);
      syncHudBtn();

      // --- Missions modal ---
      const btnMissions  = DOC.getElementById('btnMissions');
      const missionsPeek = DOC.getElementById('missionsPeek');
      const btnClosePeek = DOC.getElementById('btnClosePeek');

      function showPeek(on){
        if (!missionsPeek) return;
        if (on){
          missionsPeek.setAttribute('aria-hidden', 'false');
          DOC.body.classList.add('quest-open');
        } else {
          missionsPeek.setAttribute('aria-hidden', 'true');
          DOC.body.classList.remove('quest-open');
        }
      }

      btnMissions && btnMissions.addEventListener('click', ()=>showPeek(true));
      btnClosePeek && btnClosePeek.addEventListener('click', ()=>showPeek(false));
      missionsPeek && missionsPeek.addEventListener('click', (e)=>{
        if (e.target === missionsPeek) showPeek(false);
      });

      // --- quest:update -> missions peek text ---
      const peekGoal = DOC.getElementById('peekGoal');
      const peekMini = DOC.getElementById('peekMini');

      function safeText(x){ return (x == null) ? '‚Äî' : String(x); }

      function onQuestUpdate(ev){
        try{
          const goal = ev && ev.detail ? (ev.detail.goal || null) : null;
          const mini = ev && ev.detail ? (ev.detail.mini || null) : null;

          if (peekGoal){
            if (goal){
              peekGoal.textContent =
                `GOAL: ${safeText(goal.title)} (${safeText(goal.cur)}/${safeText(goal.target)})`;
            } else {
              peekGoal.textContent = 'GOAL: ‚Äî';
            }
          }

          if (peekMini){
            if (mini){
              if (mini.type === 'fast_hits'){
                peekMini.textContent =
                  `MINI: ${safeText(mini.title)} (${safeText(mini.cur)}/${safeText(mini.target)}) < ${safeText(mini.thrMs)}ms`;
              } else if (typeof mini.timeLeftSec === 'number'){
                peekMini.textContent =
                  `MINI: ${safeText(mini.title)} (${safeText(mini.cur)}/${safeText(mini.target)}) ‚Ä¢ ${Math.ceil(mini.timeLeftSec)}s`;
              } else {
                peekMini.textContent =
                  `MINI: ${safeText(mini.title)} (${safeText(mini.cur)}/${safeText(mini.target)})`;
              }
            } else {
              peekMini.textContent = 'MINI: ‚Äî';
            }
          }
        }catch(_){}
      }

      WIN.addEventListener('quest:update', onQuestUpdate, { passive:true });
      DOC.addEventListener('quest:update', onQuestUpdate, { passive:true });
    })();
  </script>
</body>
</html>