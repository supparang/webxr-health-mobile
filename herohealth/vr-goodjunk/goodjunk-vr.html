<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GoodJunkVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" />

  <!-- ✅ CSS (อยู่ใน /vr-goodjunk/) -->
  <link rel="stylesheet" href="./goodjunk-vr.css" />

  <!-- ✅ FX optional (ถ้ามี) -->
  <script defer src="../vr/particles.js"></script>
  <script defer src="../vr/hha-fx-director.js"></script>

  <!-- ✅ (Optional) logger -->
  <!-- <script defer src="../vr/hha-cloud-logger.js"></script> -->
</head>

<body class="gj view-mobile">
  <!-- ============ TOPBAR ============ -->
  <header class="gj-topbar" aria-label="topbar">
    <div class="left">
      <span class="gj-chip">GoodJunkVR</span>
      <button class="gj-btn" id="btnHideHud" type="button">ซ่อน HUD</button>
      <button class="gj-btn" id="btnMissions" type="button">ภารกิจ</button>
    </div>
    <div class="right">
      <button class="gj-btn primary" id="btnBackHubTop" type="button">กลับ HUB</button>
    </div>
  </header>

  <!-- ============ PROGRESS ============ -->
  <div class="gj-progress" aria-label="progress">
    <div class="gj-progress-fill" id="gjProgressFill"></div>
  </div>

  <!-- ============ HUD TOP ============ -->
  <section class="gj-hud-top" id="hud" aria-label="hud-top">
    <div class="hud-row">
      <div class="hud-pill">
        <div class="hud-label">SCORE</div>
        <div class="hud-value" id="hud-score">0</div>
      </div>
      <div class="hud-pill warn">
        <div class="hud-label">TIME</div>
        <div class="hud-value" id="hud-time">—</div>
      </div>
      <div class="hud-pill">
        <div class="hud-label">MISS</div>
        <div class="hud-value" id="hud-miss">0</div>
      </div>
      <div class="hud-pill grade">
        <div class="hud-label">GRADE</div>
        <div class="hud-value" id="hud-grade">—</div>
      </div>
    </div>

    <!-- boss bar -->
    <div class="gj-boss" id="bossBar" aria-hidden="true">
      <div class="gj-boss-title">BOSS</div>
      <div class="gj-boss-meter"><div class="gj-boss-fill" id="bossFill"></div></div>
      <div class="gj-boss-hint" id="bossHint">—</div>
    </div>

    <!-- quests -->
    <div class="quest-row">
      <div class="quest-card">
        <div class="q-title" id="hud-goal">—</div>
        <div class="q-desc" id="goalDesc">—</div>
        <div class="q-bar">
          <div class="q-num"><span id="hud-goal-cur">0</span> / <span id="hud-goal-target">0</span></div>
          <div class="q-hint">GOAL</div>
        </div>
      </div>

      <div class="quest-card mini">
        <div class="q-title">Mini Quest</div>
        <div class="q-desc" id="hud-mini">—</div>
        <div class="q-bar">
          <div class="q-num" id="miniTimer">—</div>
          <div class="q-hint">BONUS</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ============ PLAYFIELD (fixed) ============ -->
  <div class="gj-field" id="playfield" aria-label="playfield">
    <!-- layer L -->
    <div class="gj-layer" id="gj-layer" aria-label="layer-left"></div>
    <!-- layer R (only cVR) -->
    <div class="gj-layer gj-layer-r" id="gj-layer-r" aria-label="layer-right" aria-hidden="true"></div>
  </div>

  <!-- ============ BOTTOM HUD ============ -->
  <footer class="gj-hud-bot" aria-label="hud-bottom">
    <div class="meter" id="feverBox">
      <div class="meter-title">FEVER / SHIELD</div>
      <div class="meter-bar"><div class="meter-fill" id="feverFill"></div></div>
      <div class="meter-num">FEVER: <span id="feverText">—</span> • SHIELD: <span id="shieldPills">—</span></div>
      <div class="meter-tip">แตะ/ยิง: ของดี ✅ • ห้ามโดนของเสีย ❌</div>
    </div>

    <div class="meter" id="howtoBox">
      <div class="meter-title">HOW TO</div>
      <div class="meter-tip">
        PC: คลิกเป้า หรือกด Space/Enter ยิง<br/>
        Mobile/cVR: เล็งกลางจอแล้วแตะยิง (vr-ui.js จะส่ง hha:shoot)
      </div>
    </div>
  </footer>

  <!-- quick controls (optional) -->
  <div class="hha-controls" aria-label="controls">
    <button class="gj-btn" id="btnHideHud2" type="button">ซ่อน HUD</button>
  </div>

  <!-- ============ MISSIONS PEEK ============ -->
  <section class="gj-peek" id="missionsPeek" aria-label="missions">
    <div class="peek-card">
      <div class="peek-title">ภารกิจ</div>
      <div class="peek-sub">GOAL: <span id="peekGoal">ดูที่ HUD</span></div>
      <div class="peek-mini">MINI: <span id="peekMini">ครบ 3 หมู่ในเวลาที่กำหนด</span></div>
      <div class="peek-tip">แตะพื้นที่ว่างเพื่อปิด</div>
    </div>
  </section>

  <!-- ============ LOW TIME OVERLAY ============ -->
  <div class="gj-lowtime-overlay" id="lowTimeOverlay" aria-hidden="true">
    <div class="gj-lowtime-ring"></div>
    <div class="gj-lowtime-num" id="gj-lowtime-num">5</div>
  </div>

  <!-- ============ END OVERLAY (HHA Standard) ============ -->
  <section class="gj-end" id="endOverlay" aria-hidden="true" aria-label="end">
    <div class="card">
      <div class="title">สรุปผลการเล่น</div>
      <div class="sub">บันทึกผลล่าสุดแล้ว (HHA_LAST_SUMMARY)</div>

      <div class="grid">
        <div class="stat"><span>SCORE</span><b id="endScore">0</b></div>
        <div class="stat"><span>GRADE</span><b id="endGrade">—</b></div>
        <div class="stat"><span>MISS</span><b id="endMiss">0</b></div>
        <div class="stat"><span>COMBO MAX</span><b id="endCombo">0</b></div>
      </div>

      <div class="actions">
        <button class="btn" id="btnCloseEnd" type="button">ปิด</button>
        <button class="btn" id="btnReplay" type="button">เล่นใหม่</button>
        <button class="btn alt" id="btnBackHubEnd" type="button">กลับ HUB</button>
      </div>
    </div>
  </section>

  <!-- ============ UI glue ============ -->
  <script>
  (function(){
    'use strict';
    const DOC = document;

    const qs = (k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch{ return d; } };

    function goHub(){
      const hub = qs('hub', null);
      if(hub) location.href = hub;
      else location.href = '../hub.html';
    }

    function toggleHud(){
      DOC.body.classList.toggle('hud-hidden');
      // ให้ boot วัด safe ใหม่
      try{ window.dispatchEvent(new CustomEvent('gj:measureSafe', { detail:{} })); }catch(_){}
    }

    // hide HUD
    const b1 = DOC.getElementById('btnHideHud');
    const b2 = DOC.getElementById('btnHideHud2');
    if(b1) b1.addEventListener('click', toggleHud, { passive:true });
    if(b2) b2.addEventListener('click', toggleHud, { passive:true });

    // back hub
    const bh = DOC.getElementById('btnBackHubTop');
    if(bh) bh.addEventListener('click', goHub, { passive:true });

    // missions peek
    const bm = DOC.getElementById('btnMissions');
    const peek = DOC.getElementById('missionsPeek');
    if(bm && peek){
      bm.addEventListener('click', ()=>{
        DOC.body.classList.toggle('show-missions');
      }, { passive:true });

      peek.addEventListener('click', ()=>{
        DOC.body.classList.remove('show-missions');
      }, { passive:true });
    }
  })();
  </script>

  <!-- ============ BOOT (module) ============ -->
  <script type="module" src="./goodjunk-vr.boot.js"></script>
</body>
</html>