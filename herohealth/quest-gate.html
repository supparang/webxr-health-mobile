<!-- === /herohealth/quest-gate.html ===
HeroHealth ‚Äî Quest Gate (Daily Gate) ‚Äî PRODUCTION (Kid Friendly)
‚úÖ Very short (20‚Äì45s) gate for Grade 5
‚úÖ Big progress Q1‚ÄìQ3
‚úÖ Pass-through ctx: pid, diff, time, seed, studyId, phase, conditionGroup, log, view, hub, run
‚úÖ Daily key: HHA_ZONE_DONE::<zone>::YYYY-MM-DD (same as hub)
‚úÖ After complete => redirect to go=
‚úÖ Buttons: Back to Hub, Reset today (all zones)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî Quest Gate</title>
  <meta name="color-scheme" content="dark light"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.72);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;
      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --cyan:#22d3ee; --violet:#a78bfa;
      --radius:22px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(1000px 600px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 520px at 55% 90%, rgba(167,139,250,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:auto;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width: 980px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }
    .card{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .head{
      padding: 14px 14px 12px;
      border-bottom:1px solid var(--stroke);
      background: rgba(2,6,23,.38);
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
    }
    .title{
      margin:0;
      font-size: clamp(18px, 2.4vw, 26px);
      font-weight: 900;
      letter-spacing: .2px;
    }
    .sub{
      margin:6px 0 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.45;
      max-width: 72ch;
    }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .pill{
      background: rgba(2,6,23,.50);
      border:1px solid var(--stroke);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      user-select:none;
      white-space:nowrap;
    }
    .pill b{ color:var(--text); font-weight:900; }
    .body{ padding: 12px 12px 14px; }

    .bigProgress{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 720px){ .bigProgress{ grid-template-columns: 1fr; } }

    .step{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.40);
      border-radius: 18px;
      padding: 14px;
      position:relative;
      overflow:hidden;
      min-height: 120px;
      box-shadow: 0 12px 40px rgba(0,0,0,.20);
    }
    .step .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size:12px;
      font-weight:900;
      color: var(--text);
    }
    .step .badge .dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 16px rgba(245,158,11,.30);
    }
    .step.ok .badge .dot{ background: var(--good); box-shadow: 0 0 16px rgba(34,197,94,.30); }
    .stepTitle{ margin:10px 0 6px; font-weight: 950; font-size: 16px; }
    .stepDesc{ margin:0; color:var(--muted); font-size: 13px; line-height:1.45; }
    .btnRow{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
      align-items:center;
      justify-content:space-between;
    }
    .btns{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.44);
      padding: 10px 12px;
      border-radius: 14px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
      font-weight: 950;
      font-size: 13px;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .12s ease, opacity .12s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.good{ border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .btn.warn{ border-color: rgba(245,158,11,.25); background: rgba(245,158,11,.09); }
    .btn.ghost{ color: var(--muted); }
    .btn.disabled{ opacity:.55; cursor:not-allowed; }

    .quiz{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    @media (max-width: 720px){ .quiz{ grid-template-columns: 1fr; } }
    .qcard{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.36);
      border-radius: 18px;
      padding: 12px;
    }
    .qtitle{ margin:0 0 10px; font-weight: 950; }
    .choices{ display:grid; gap:8px; }
    .choice{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      user-select:none;
      font-weight: 900;
      color: var(--text);
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .choice:active{ transform: translateY(1px); }
    .choice.ok{ border-color: rgba(34,197,94,.40); background: rgba(34,197,94,.16); }
    .choice.no{ border-color: rgba(239,68,68,.40); background: rgba(239,68,68,.12); }

    .meter{
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      overflow:hidden;
    }
    .fill{ height:100%; width: 0%; background: rgba(34,197,94,.85); transition: width .18s ease; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + var(--sab));
      transform: translateX(-50%);
      background: rgba(2,6,23,.88);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      z-index: 9999;
      max-width: 92vw;
      font-size: 13px;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .toast.show{ opacity: 1; }

    .bigCTA{
      margin-top: 12px;
      width: 100%;
      border: 1px solid rgba(34,197,94,.28);
      background: linear-gradient(90deg, rgba(34,197,94,.16), rgba(34,211,238,.12));
      padding: 14px 14px;
      border-radius: 18px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .bigCTA .left{ display:flex; flex-direction:column; gap:4px; }
    .bigCTA .left .h{ font-weight: 950; }
    .bigCTA .left .p{ color: var(--muted); font-size: 13px; }
  </style>
</head>
<body>
  <div class="wrap">

    <section class="card">
      <div class="head">
        <div>
          <h1 class="title">üß© ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (Quest Gate)</h1>
          <p class="sub">
            ‡∏ó‡∏≥ <b>3 ‡∏Ç‡πâ‡∏≠</b> ‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ô‡∏≤‡∏ô) ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏î‡πâ ‚≠ê ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‚Äù
          </p>
        </div>
        <div class="row">
          <span class="pill"><b>zone</b>: <span id="zoneText">‚Äî</span></span>
          <span class="pill"><b>today</b>: <span id="todayText">‚Äî</span></span>
        </div>
      </div>

      <div class="body">
        <div class="bigProgress">
          <div class="step" id="s1">
            <div class="badge"><span class="dot"></span> Q1</div>
            <div class="stepTitle">üëÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
            <p class="stepDesc">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞ ‚Äú‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‚Äù ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏î‡∏£‡∏±‡∏ß‡∏°‡∏±‡πà‡∏ß ‡πÜ</p>
            <div style="margin-top:10px;">
              <button class="btn good" id="btnS1">‚úÖ ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡πâ‡∏ß</button>
            </div>
          </div>

          <div class="step" id="s2">
            <div class="badge"><span class="dot"></span> Q2</div>
            <div class="stepTitle">üß† ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ‡πÜ 1 ‡∏Ç‡πâ‡∏≠</div>
            <p class="stepDesc">‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö ‚≠ê (‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å)</p>
            <div class="quiz" id="quizWrap"></div>
          </div>

          <div class="step" id="s3">
            <div class="badge"><span class="dot"></span> Q3</div>
            <div class="stepTitle">üí™ ‡∏™‡∏±‡∏ç‡∏ç‡∏≤ 5 ‡∏ß‡∏¥</div>
            <p class="stepDesc">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏° ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏∏‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</p>
            <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" id="btnS3a">‚≠ê ‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÄ‡∏•‡πà‡∏ô</button>
              <button class="btn" id="btnS3b">‚è±Ô∏è ‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö‡∏Å‡∏î‡∏°‡∏±‡πà‡∏ß</button>
            </div>
          </div>
        </div>

        <div class="meter" aria-label="progress">
          <div class="fill" id="fill"></div>
        </div>

        <div class="bigCTA">
          <div class="left">
            <div class="h" id="ctaTitle">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô Gate</div>
            <div class="p" id="ctaSub">‡∏ó‡∏≥ Q1‚ÄìQ3 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‚Äù ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î</div>
          </div>
          <div class="btns">
            <button class="btn ghost" id="btnBackHub">‚Ü©Ô∏è ‡∏Å‡∏•‡∏±‡∏ö Hub</button>
            <button class="btn warn" id="btnResetToday">‚ôªÔ∏è Reset today</button>
            <button class="btn good disabled" id="btnStart">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
          </div>
        </div>

      </div>
    </section>

  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  // ---------- helpers ----------
  function pageUrl(){ return location.href.split('#')[0]; }
  function parseQS(){ try{ return new URL(pageUrl()).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = parseQS();

  function ymdLocal(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  function toast(msg){
    const el = document.getElementById('toast');
    if(!el) return;
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> el.classList.remove('show'), 1400);
  }

  const PASS_KEYS = ['pid','diff','time','seed','studyId','phase','conditionGroup','log','view','run','hub'];
  function applyPassThrough(urlStr){
    const u = new URL(urlStr, location.href);
    for(const k of PASS_KEYS){
      if(!u.searchParams.has(k) && QS.has(k)){
        const v = QS.get(k);
        if(v != null && String(v).trim() !== '') u.searchParams.set(k, v);
      }
    }
    // ensure hub exists
    if(!u.searchParams.has('hub') || String(u.searchParams.get('hub')||'').trim()===''){
      u.searchParams.set('hub', QS.get('hub') || location.origin + location.pathname.replace(/\/[^\/]*$/, '/hub.html'));
    }
    return u.toString();
  }

  function zoneFromQS(){
    const z = (QS.get('zone') || 'nutrition').toLowerCase().trim();
    if(z === 'hygiene' || z === 'fitness' || z === 'nutrition') return z;
    return 'nutrition';
  }
  const ZONE = zoneFromQS();

  function zoneDoneKey(zone){
    return `HHA_ZONE_DONE::${zone}::${ymdLocal()}`;
  }
  function isZoneDoneToday(zone){
    try{ return localStorage.getItem(zoneDoneKey(zone)) === '1'; }catch(_){ return false; }
  }
  function setZoneDoneToday(zone){
    try{ localStorage.setItem(zoneDoneKey(zone), '1'); }catch(_){}
  }
  function clearZoneToday(zone){
    try{ localStorage.removeItem(zoneDoneKey(zone)); }catch(_){}
  }

  // ---------- destination ----------
  // go can be absolute or relative. recommended: encoded run url from launcher.
  function getGo(){
    const raw = QS.get('go') || QS.get('to') || '';
    if(raw){
      try{
        // if already encoded, decode once safely
        const dec = decodeURIComponent(raw);
        return dec;
      }catch(_){
        return raw;
      }
    }
    // fallback: if run is provided, go to it
    const run = QS.get('run') || '';
    if(run) return run;
    // ultimate fallback: hub
    return QS.get('hub') || './hub.html';
  }
  const GO = getGo();

  // ---------- UI refs ----------
  const zoneText = document.getElementById('zoneText');
  const todayText = document.getElementById('todayText');
  const s1 = document.getElementById('s1');
  const s2 = document.getElementById('s2');
  const s3 = document.getElementById('s3');
  const fill = document.getElementById('fill');

  const btnS1 = document.getElementById('btnS1');
  const btnS3a = document.getElementById('btnS3a');
  const btnS3b = document.getElementById('btnS3b');
  const btnStart = document.getElementById('btnStart');
  const btnResetToday = document.getElementById('btnResetToday');
  const btnBackHub = document.getElementById('btnBackHub');

  const ctaTitle = document.getElementById('ctaTitle');
  const ctaSub = document.getElementById('ctaSub');
  const quizWrap = document.getElementById('quizWrap');

  // ---------- state ----------
  let done1 = false;
  let done2 = false;
  let done3 = false;

  // ---------- quiz bank (simple & kid friendly) ----------
  // You can expand later by zone/game; for now keep 1 question only (fast).
  const QUIZ = {
    nutrition: {
      q: 'ü•ó ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‚Äú‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤‚Äù ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏´‡∏ô?',
      choices: [
        { t:'üíß ‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°', ok:true },
        { t:'üç≠ ‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô', ok:false },
        { t:'üßã ‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô', ok:false },
      ]
    },
    hygiene: {
      q: 'üßº ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ?',
      choices: [
        { t:'‚è±Ô∏è 20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ', ok:true },
        { t:'‚è±Ô∏è 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ', ok:false },
        { t:'‚è±Ô∏è 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ', ok:false },
      ]
    },
    fitness: {
      q: 'üèÉ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?',
      choices: [
        { t:'ü§∏ ‡∏ß‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ', ok:true },
        { t:'üò¥ ‡∏ô‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ', ok:false },
        { t:'üçü ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏≠‡∏î', ok:false },
      ]
    }
  };

  function renderQuiz(){
    const q = QUIZ[ZONE] || QUIZ.nutrition;
    quizWrap.innerHTML = `
      <div class="qcard" style="grid-column: 1 / -1;">
        <p class="qtitle">${escapeHtml(q.q)}</p>
        <div class="choices" id="choices"></div>
      </div>
    `;
    const choicesEl = document.getElementById('choices');
    q.choices.forEach((c)=>{
      const btn = document.createElement('div');
      btn.className = 'choice';
      btn.textContent = c.t;
      btn.addEventListener('click', ()=>{
        if(done2) return;
        if(c.ok){
          btn.classList.add('ok');
          done2 = true;
          s2.classList.add('ok');
          toast('‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏î‡πâ ‚≠ê');
          sync();
        }else{
          btn.classList.add('no');
          toast('‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üôÇ');
          // remove wrong mark after a moment
          setTimeout(()=> btn.classList.remove('no'), 450);
        }
      }, {passive:true});
      choicesEl.appendChild(btn);
    });
  }

  function escapeHtml(s){
    return String(s||'').replace(/[&<>"']/g, (m)=>({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function setStepOK(stepEl, ok){
    stepEl.classList.toggle('ok', !!ok);
  }

  function sync(){
    const total = (done1?1:0) + (done2?1:0) + (done3?1:0);
    const pct = Math.round((total/3)*100);
    fill.style.width = pct + '%';

    setStepOK(s1, done1);
    setStepOK(s2, done2);
    setStepOK(s3, done3);

    const all = (done1 && done2 && done3);

    if(all){
      ctaTitle.textContent = '‡∏ú‡πà‡∏≤‡∏ô Gate ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ';
      ctaSub.textContent = '‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‚Äù ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!';
      btnStart.classList.remove('disabled');
    }else{
      ctaTitle.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô Gate';
      ctaSub.textContent = '‡∏ó‡∏≥ Q1‚ÄìQ3 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‚Äù ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î';
      btnStart.classList.add('disabled');
    }
  }

  function zoneLabel(z){
    if(z==='nutrition') return 'ü•ó nutrition';
    if(z==='hygiene') return 'üßº hygiene';
    if(z==='fitness') return 'üèÉ fitness';
    return z;
  }

  // ---------- init header ----------
  zoneText.textContent = zoneLabel(ZONE);
  todayText.textContent = ymdLocal();
  renderQuiz();

  // if already done today: allow start immediately (but still show the steps as done)
  if(isZoneDoneToday(ZONE)){
    done1 = done2 = done3 = true;
    toast('‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ ‚Äú‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‚Äù ‚úÖ');
  }
  sync();

  // ---------- bind actions ----------
  btnS1.addEventListener('click', ()=>{
    if(done1) return;
    done1 = true;
    toast('Q1 ‡∏ú‡πà‡∏≤‡∏ô ‚úÖ');
    sync();
  });

  function tryDone3(){
    // require both promises for Q3 (simple but intentional)
    const a = btnS3a.dataset.ok === '1';
    const b = btnS3b.dataset.ok === '1';
    done3 = !!(a && b);
    if(done3){
      toast('Q3 ‡∏ú‡πà‡∏≤‡∏ô ‚úÖ');
    }else{
      toast('‡∏Å‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 2 ‡∏≠‡∏±‡∏ô‡∏ô‡∏∞ üôÇ');
    }
    sync();
  }

  btnS3a.addEventListener('click', ()=>{
    btnS3a.dataset.ok = '1';
    btnS3a.classList.add('good');
    tryDone3();
  });
  btnS3b.addEventListener('click', ()=>{
    btnS3b.dataset.ok = '1';
    btnS3b.classList.add('good');
    tryDone3();
  });

  btnStart.addEventListener('click', ()=>{
    if(btnStart.classList.contains('disabled')) return;
    // mark zone done today and go
    setZoneDoneToday(ZONE);
    toast('‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° üöÄ');

    const url = applyPassThrough(GO);
    setTimeout(()=>{ location.href = url; }, 250);
  });

  btnBackHub.addEventListener('click', ()=>{
    const hub = QS.get('hub') || './hub.html';
    location.href = applyPassThrough(hub);
  });

  btnResetToday.addEventListener('click', ()=>{
    clearZoneToday('nutrition');
    clearZoneToday('hygiene');
    clearZoneToday('fitness');
    toast('Reset today ‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô)');
    // reset local steps too
    done1 = done2 = done3 = false;
    btnS3a.dataset.ok = ''; btnS3b.dataset.ok = '';
    btnS3a.classList.remove('good'); btnS3b.classList.remove('good');
    renderQuiz();
    sync();
  });

})();
</script>
</body>
</html>
