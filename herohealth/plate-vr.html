<!-- === /herohealth/plate-vr.html ===
Balanced Plate VR ‚Äî PRODUCTION HTML (ROOT)
‚úÖ Correct paths for repo structure in your screenshot:
  - CSS:  ./plate/plate-vr.css
  - Game: ./plate/plate.safe.js
  - FX:   ./vr/particles.js
  - Log:  ./vr/hha-cloud-logger.js
  - Coach image: ./img/coach-neutral.png
‚úÖ Single tap = Copy, Double tap = Play (on start card)
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />

  <!-- A-Frame (Cardboard/VR button uses scene.enterVR()) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ‚úÖ Styles (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô /plate/) -->
  <link rel="stylesheet" href="./plate/plate-vr.css?v=20251229" />

  <!-- Global FX + Logger -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ HUD binder ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Plate ‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ)
  <script src="./plate/plate-hud.js?v=20251229" defer></script>
  -->

  <!-- Game -->
  <script src="./plate/plate.safe.js?v=20251229" defer></script>

  <style>
    /* Toast ‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Copy */
    .hha-toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(2,6,23,.86);
      border:1px solid rgba(148,163,184,.22);
      color:#e5e7eb;
      padding:10px 12px;
      border-radius:999px;
      font:700 13px/1 system-ui;
      z-index:9999;
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
    }
    .hha-toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
  </style>
</head>

<body>
  <!-- Background VR scene (minimal) -->
  <a-scene
    id="scene"
    embedded
    renderer="antialias: true; colorManagement: true"
    vr-mode-ui="enabled: true"
    style="position:fixed; inset:0; z-index:1;"
  >
    <a-sky color="#020617"></a-sky>
    <a-entity light="type: ambient; intensity: 0.85"></a-entity>
    <a-entity light="type: directional; intensity: 0.55" position="1 2 1"></a-entity>

    <a-entity id="rig" position="0 1.6 0">
      <a-camera wasd-controls="enabled:false" look-controls="pointerLockEnabled:false"></a-camera>
    </a-entity>
  </a-scene>

  <!-- DOM Play layer for targets (required) -->
  <div id="plate-layer" aria-label="plate-layer"></div>

  <!-- Hit FX overlay (required) -->
  <div id="hitFx" aria-hidden="true"></div>

  <!-- TOP HUD (required: hudTop) -->
  <header id="hudTop">
    <div class="hudRow">
      <div class="hudStat">
        <div class="k">SCORE</div>
        <div class="v" id="uiScore">0</div>
      </div>

      <div class="hudStat">
        <div class="k">COMBO</div>
        <div class="v"><span id="uiCombo">0</span> <span class="muted">/</span> <span id="uiComboMax">0</span></div>
      </div>

      <div class="hudStat">
        <div class="k">MISS</div>
        <div class="v" id="uiMiss">0</div>
      </div>

      <div class="hudStat plateChip">
        <div class="k">PLATE</div>
        <div class="v"><span id="uiPlateHave">0</span><span class="muted">/5</span></div>
      </div>

      <div class="hudStat gradeChip">
        <div class="k">GRADE</div>
        <div class="v"><span id="uiGrade">C</span> <span class="muted" id="uiAcc">0%</span></div>
      </div>

      <div class="hudStat timeChip">
        <div class="k">TIME</div>
        <div class="v"><span id="uiTime">90</span><span class="muted">s</span></div>
      </div>
    </div>

    <div class="hudRow2">
      <div class="feverWrap">
        <div class="feverLabel">FEVER</div>
        <div class="feverBar">
          <div class="feverFill" id="uiFeverFill"></div>
        </div>
        <div class="shieldPill" id="uiShield" title="Shield">
          üõ°Ô∏è <span id="uiShieldN">0</span>
        </div>
      </div>

      <div class="plateCounts">
        <span class="pill">ü•¶ <b id="uiG1">0</b></span>
        <span class="pill">üçé <b id="uiG2">0</b></span>
        <span class="pill">üêü <b id="uiG3">0</b></span>
        <span class="pill">üçö <b id="uiG4">0</b></span>
        <span class="pill">ü•ë <b id="uiG5">0</b></span>
      </div>
    </div>
  </header>

  <!-- COACH PANEL (required: coachPanel) -->
  <aside id="coachPanel">
    <img
      id="coachImg"
      src="./img/coach-neutral.png"
      alt="Coach"
      draggable="false"
    />
    <div class="coachText">
      <div class="coachName">Hero Coach</div>
      <div class="coachMsg" id="coachMsg">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà üí™</div>
    </div>
  </aside>

  <!-- QUEST PANEL (required: miniPanel) -->
  <section id="miniPanel">
    <div class="questBlock">
      <div class="questHdr">
        <span class="badge badgeGoal">GOAL</span>
        <span class="qTitle" id="uiGoalTitle">‚Äî</span>
        <span class="qCount" id="uiGoalCount">0/0</span>
      </div>
      <div class="bar">
        <div class="barFill" id="uiGoalFill"></div>
      </div>
    </div>

    <div class="questBlock">
      <div class="questHdr">
        <span class="badge badgeMini">MINI</span>
        <span class="qTitle" id="uiMiniTitle">‚Äî</span>
        <span class="qCount"><span id="uiMiniCount">0/0</span> ¬∑ <span id="uiMiniTime">--</span></span>
      </div>
      <div class="bar">
        <div class="barFill mini" id="uiMiniFill"></div>
      </div>
      <div class="hint" id="uiHint">‡∏ó‡∏£‡∏¥‡∏Ñ: ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà‡πÑ‡∏ß ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥!</div>
    </div>
  </section>

  <!-- BUTTONS (required: hudBtns) -->
  <nav id="hudBtns">
    <button class="btn ghost" id="btnPause" type="button">‚è∏ Pause</button>
    <button class="btn ghost" id="btnRestart" type="button">üîÅ Restart</button>
    <button class="btn" id="btnEnterVR" type="button">üï∂ Enter VR</button>
  </nav>

  <!-- PAUSED overlay (required: hudPaused) -->
  <div id="hudPaused">
    <div class="pausedCard">
      <div class="pausedTitle">Paused</div>
      <div class="pausedText">‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏° Pause ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠</div>
    </div>
  </div>

  <!-- START overlay (required: startOverlay + btnStart) -->
  <div id="startOverlay">
    <div class="startCard" id="startCardTap">
      <div class="startTitle">ü•ó Balanced Plate VR</div>
      <div class="startSub">
        ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ô‡∏∏‡∏Å + ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÇ‡∏´‡∏î!<br/>
        <span class="muted">Plate Rush: ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô 8 ‡∏ß‡∏¥ + ‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏î‡∏ô‡∏Ç‡∏¢‡∏∞</span>
      </div>

      <div class="startMeta">
        <div class="metaPill">diff: <b id="uiDiffPreview">normal</b></div>
        <div class="metaPill">time: <b id="uiTimePreview">90</b>s</div>
        <div class="metaPill">run: <b id="uiRunPreview">play</b></div>
      </div>

      <div class="startBtns">
        <button class="btn big" id="btnStart" type="button">‚ñ∂ Start</button>
        <button class="btn ghost big" id="btnEnterVR2" type="button">üï∂ Enter VR</button>
      </div>

      <div class="startFoot">
        Tip: ‡πÅ‡∏ï‡∏∞ ‚Äú‡∏Å‡∏≤‡∏£‡πå‡∏î‚Äù ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß = Copy link, ‡πÅ‡∏ï‡∏∞‡∏™‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á = Play
      </div>
    </div>
  </div>

  <!-- RESULT overlay (required: resultBackdrop + rScore/rG1..rG5 etc.) -->
  <div id="resultBackdrop" style="display:none;">
    <div class="resultCard">
      <div class="resultTitle">üèÅ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>

      <div class="resultGrid">
        <div class="resultItem"><div class="k">MODE</div><div class="v" id="rMode">play</div></div>
        <div class="resultItem"><div class="k">GRADE</div><div class="v" id="rGrade">C</div></div>
        <div class="resultItem"><div class="k">SCORE</div><div class="v" id="rScore">0</div></div>
        <div class="resultItem"><div class="k">MAX COMBO</div><div class="v" id="rMaxCombo">0</div></div>
        <div class="resultItem"><div class="k">MISS</div><div class="v" id="rMiss">0</div></div>
        <div class="resultItem"><div class="k">FAST HIT</div><div class="v" id="rPerfect">0</div></div>
        <div class="resultItem"><div class="k">GOALS</div><div class="v" id="rGoals">0/0</div></div>
        <div class="resultItem"><div class="k">MINIS</div><div class="v" id="rMinis">0/0</div></div>
      </div>

      <div class="resultPlate">
        <div class="plateRow">
          <span class="pill">ü•¶ ‡∏´‡∏°‡∏π‡πà1 <b id="rG1">0</b></span>
          <span class="pill">üçé ‡∏´‡∏°‡∏π‡πà2 <b id="rG2">0</b></span>
          <span class="pill">üêü ‡∏´‡∏°‡∏π‡πà3 <b id="rG3">0</b></span>
          <span class="pill">üçö ‡∏´‡∏°‡∏π‡πà4 <b id="rG4">0</b></span>
          <span class="pill">ü•ë ‡∏´‡∏°‡∏π‡πà5 <b id="rG5">0</b></span>
        </div>
        <div class="totalRow">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="rGTotal">0</b></div>
      </div>

      <div class="resultBtns">
        <button class="btn ghost" id="btnBackHub" type="button">‚Ü© ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
        <button class="btn" id="btnPlayAgain" type="button">üîÅ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
      </div>
    </div>
  </div>

  <div class="hha-toast" id="toastCopy">üìã Copied link!</div>

  <script>
    (function(){
      // --- Enter VR (start overlay) ---
      var b = document.getElementById('btnEnterVR2');
      if (b){
        b.addEventListener('click', function(){
          try{
            var scene = document.querySelector('a-scene');
            if (scene && scene.enterVR) scene.enterVR();
          }catch(e){}
        }, { passive:true });
      }

      // --- Preview query params ---
      try{
        var u = new URL(location.href);
        var diff = u.searchParams.get('diff') || 'normal';
        var time = u.searchParams.get('time') || '90';
        var run  = u.searchParams.get('run') || u.searchParams.get('runMode') || 'play';
        document.getElementById('uiDiffPreview').textContent = String(diff);
        document.getElementById('uiTimePreview').textContent = String(time);
        document.getElementById('uiRunPreview').textContent  = String(run);
      }catch(e){}

      // --- Single tap Copy, Double tap Play (on start card) ---
      var card = document.getElementById('startCardTap');
      var btnStart = document.getElementById('btnStart');
      var toast = document.getElementById('toastCopy');

      function showToast(msg){
        if (!toast) return;
        toast.textContent = msg || 'üìã Copied link!';
        toast.classList.add('show');
        clearTimeout(showToast._t);
        showToast._t = setTimeout(function(){ toast.classList.remove('show'); }, 900);
      }

      async function copyLink(){
        var url = String(location.href);
        try{
          if (navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(url);
          }else{
            var ta = document.createElement('textarea');
            ta.value = url;
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            ta.remove();
          }
          showToast('üìã Copied link!');
        }catch(e){
          showToast('‚ùó Copy ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
      }

      // ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô card ‡πÑ‡∏°‡πà‡πÑ‡∏õ trigger tap logic ‡∏ã‡πâ‡∏≠‡∏ô
      function isInsideButton(ev){
        var t = ev.target;
        return !!(t && (t.closest && t.closest('button')));
      }

      if (card && btnStart){
        var lastTapAt = 0;
        var tapTimer = 0;
        var dblGap = 320;

        card.addEventListener('click', function(ev){
          if (isInsideButton(ev)) return;

          var now = Date.now();
          if (now - lastTapAt <= dblGap){
            // Double tap -> Play
            lastTapAt = 0;
            clearTimeout(tapTimer);
            btnStart.click();
            return;
          }

          // Single tap -> wait briefly to confirm not double, then copy
          lastTapAt = now;
          clearTimeout(tapTimer);
          tapTimer = setTimeout(function(){
            copyLink();
          }, dblGap + 10);
        }, { passive:true });
      }
    })();
  </script>
</body>
</html>