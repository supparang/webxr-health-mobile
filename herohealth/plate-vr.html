<!-- === /herohealth/plate-vr.html ===
Balanced Plate VR ‚Äî PRODUCTION HTML (ROOT PATH FIXED + UNIVERSAL VR UI)
‚úÖ plate-vr.html ‡∏≠‡∏¢‡∏π‡πà /herohealth/ (root)
‚úÖ CSS/JS ‡∏≠‡∏¢‡∏π‡πà /herohealth/plate/*
‚úÖ vr libs ‡∏≠‡∏¢‡∏π‡πà /herohealth/vr/*
‚úÖ img coach ‡∏≠‡∏¢‡∏π‡πà /herohealth/img/*
‚úÖ Provides ALL required DOM ids for plate.safe.js
‚úÖ Adds Universal VR UI (/vr/vr-ui.js) + view modes + orientation lock attempt on VR
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />

  <!-- A-Frame (Cardboard/VR) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="./plate/plate-vr.css?v=20251231" />

  <!-- Global FX + Logger -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- ‚úÖ Universal VR UI (ENTER/EXIT/RECENTER + crosshair + tap-to-shoot emits hha:shoot) -->
  <script src="./vr/vr-ui.js" defer></script>

  <!-- HUD binder (Plate-specific UI helpers) -->
  <script src="./plate/plate-hud.js?v=20251231" defer></script>

  <!-- Game -->
  <script src="./plate/plate.safe.js?v=20251231" defer></script>

  <style>
    /* ensure overlays stack above A-Frame */
    body{ margin:0; }
    .viewHint{
      position:fixed; right:10px; top:10px;
      z-index:120; font: 900 11px/1.2 system-ui;
      color:rgba(148,163,184,.9);
      background:rgba(2,6,23,.55);
      border:1px solid rgba(148,163,184,.14);
      padding:6px 10px; border-radius:999px;
      backdrop-filter: blur(8px);
      pointer-events:none;
      display:none;
    }
    body.debug-view .viewHint{ display:block; }
  </style>
</head>

<body class="view-pc">
  <div class="viewHint" id="viewHint">view: ‚Äî</div>

  <!-- Background VR scene (minimal) -->
  <a-scene
    id="scene"
    embedded
    renderer="antialias: true; colorManagement: true"
    vr-mode-ui="enabled: true"
    style="position:fixed; inset:0; z-index:1;"
  >
    <a-sky color="#020617"></a-sky>
    <a-entity light="type: ambient; intensity: 0.85"></a-entity>
    <a-entity light="type: directional; intensity: 0.55" position="1 2 1"></a-entity>

    <a-entity id="rig" position="0 1.6 0">
      <a-camera wasd-controls="enabled:false" look-controls="pointerLockEnabled:false"></a-camera>
    </a-entity>
  </a-scene>

  <!-- DOM Play layer for targets (required) -->
  <div id="plate-layer" aria-label="plate-layer"></div>

  <!-- Hit FX overlay (required) -->
  <div id="hitFx" aria-hidden="true"></div>

  <!-- TOP HUD (required: hudTop) -->
  <header id="hudTop">
    <div class="hudRow">
      <div class="hudStat">
        <div class="k">SCORE</div>
        <div class="v" id="uiScore">0</div>
      </div>

      <div class="hudStat">
        <div class="k">COMBO</div>
        <div class="v"><span id="uiCombo">0</span> <span class="muted">/</span> <span id="uiComboMax">0</span></div>
      </div>

      <div class="hudStat">
        <div class="k">MISS</div>
        <div class="v" id="uiMiss">0</div>
      </div>

      <div class="hudStat plateChip">
        <div class="k">PLATE</div>
        <div class="v"><span id="uiPlateHave">0</span><span class="muted">/5</span></div>
      </div>

      <div class="hudStat gradeChip">
        <div class="k">GRADE</div>
        <div class="v"><span id="uiGrade">C</span> <span class="muted" id="uiAcc">0%</span></div>
      </div>

      <div class="hudStat timeChip">
        <div class="k">TIME</div>
        <div class="v"><span id="uiTime">90</span><span class="muted">s</span></div>
      </div>
    </div>

    <div class="hudRow2">
      <div class="feverWrap">
        <div class="feverLabel">FEVER</div>
        <div class="feverBar">
          <div class="feverFill" id="uiFeverFill"></div>
        </div>
        <div class="shieldPill" id="uiShield" title="Shield">
          üõ°Ô∏è <span id="uiShieldN">0</span>
        </div>
      </div>

      <div class="plateCounts">
        <span class="pill">ü•¶ <b id="uiG1">0</b></span>
        <span class="pill">üçé <b id="uiG2">0</b></span>
        <span class="pill">üêü <b id="uiG3">0</b></span>
        <span class="pill">üçö <b id="uiG4">0</b></span>
        <span class="pill">ü•ë <b id="uiG5">0</b></span>
      </div>
    </div>
  </header>

  <!-- COACH PANEL (required: coachPanel) -->
  <aside id="coachPanel">
    <img
      id="coachImg"
      src="./img/coach-neutral.png"
      alt="Coach"
      draggable="false"
    />
    <div class="coachText">
      <div class="coachName">Hero Coach</div>
      <div class="coachMsg" id="coachMsg">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà üí™</div>
    </div>
  </aside>

  <!-- QUEST PANEL (required: miniPanel) -->
  <section id="miniPanel">
    <div class="questBlock">
      <div class="questHdr">
        <span class="badge badgeGoal">GOAL</span>
        <span class="qTitle" id="uiGoalTitle">‚Äî</span>
        <span class="qCount" id="uiGoalCount">0/0</span>
      </div>
      <div class="bar">
        <div class="barFill" id="uiGoalFill"></div>
      </div>
    </div>

    <div class="questBlock">
      <div class="questHdr">
        <span class="badge badgeMini">MINI</span>
        <span class="qTitle" id="uiMiniTitle">‚Äî</span>
        <span class="qCount"><span id="uiMiniCount">0/0</span> ¬∑ <span id="uiMiniTime">--</span></span>
      </div>
      <div class="bar">
        <div class="barFill mini" id="uiMiniFill"></div>
      </div>
      <div class="hint" id="uiHint">‡∏ó‡∏£‡∏¥‡∏Ñ: ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà‡πÑ‡∏ß ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥!</div>
    </div>
  </section>

  <!-- BUTTONS (required: hudBtns) -->
  <nav id="hudBtns">
    <button class="btn ghost" id="btnPause" type="button">‚è∏ Pause</button>
    <button class="btn ghost" id="btnRestart" type="button">üîÅ Restart</button>
    <button class="btn" id="btnEnterVR" type="button">üï∂ Enter VR</button>
  </nav>

  <!-- PAUSED overlay (required: hudPaused) -->
  <div id="hudPaused">
    <div class="pausedCard">
      <div class="pausedTitle">Paused</div>
      <div class="pausedText">‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏° Pause ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠</div>
    </div>
  </div>

  <!-- START overlay (required: startOverlay + btnStart) -->
  <div id="startOverlay">
    <div class="startCard">
      <div class="startTitle">ü•ó Balanced Plate VR</div>
      <div class="startSub">
        ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ô‡∏∏‡∏Å + ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÇ‡∏´‡∏î!<br/>
        <span class="muted">Plate Rush: ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô 8 ‡∏ß‡∏¥ + ‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏î‡∏ô‡∏Ç‡∏¢‡∏∞</span>
      </div>

      <div class="startMeta">
        <div class="metaPill">diff: <b id="uiDiffPreview">normal</b></div>
        <div class="metaPill">time: <b id="uiTimePreview">90</b>s</div>
        <div class="metaPill">run: <b id="uiRunPreview">play</b></div>
      </div>

      <div class="startBtns">
        <button class="btn big" id="btnStart" type="button">‚ñ∂ Start</button>
        <button class="btn ghost big" id="btnEnterVR2" type="button">üï∂ Enter VR</button>
      </div>

      <div class="startFoot">
        Tip: ‡∏ö‡∏ô iOS ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î Start ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå motion
      </div>
    </div>
  </div>

  <!-- RESULT overlay (required: resultBackdrop + rScore/rG1..rG5 etc.) -->
  <div id="resultBackdrop" style="display:none;">
    <div class="resultCard">
      <div class="resultTitle">üèÅ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>

      <div class="resultGrid">
        <div class="resultItem"><div class="k">MODE</div><div class="v" id="rMode">play</div></div>
        <div class="resultItem"><div class="k">GRADE</div><div class="v" id="rGrade">C</div></div>
        <div class="resultItem"><div class="k">SCORE</div><div class="v" id="rScore">0</div></div>
        <div class="resultItem"><div class="k">MAX COMBO</div><div class="v" id="rMaxCombo">0</div></div>
        <div class="resultItem"><div class="k">MISS</div><div class="v" id="rMiss">0</div></div>
        <div class="resultItem"><div class="k">FAST HIT</div><div class="v" id="rPerfect">0</div></div>
        <div class="resultItem"><div class="k">GOALS</div><div class="v" id="rGoals">0/0</div></div>
        <div class="resultItem"><div class="k">MINIS</div><div class="v" id="rMinis">0/0</div></div>
      </div>

      <div class="resultPlate">
        <div class="plateRow">
          <span class="pill">ü•¶ ‡∏´‡∏°‡∏π‡πà1 <b id="rG1">0</b></span>
          <span class="pill">üçé ‡∏´‡∏°‡∏π‡πà2 <b id="rG2">0</b></span>
          <span class="pill">üêü ‡∏´‡∏°‡∏π‡πà3 <b id="rG3">0</b></span>
          <span class="pill">üçö ‡∏´‡∏°‡∏π‡πà4 <b id="rG4">0</b></span>
          <span class="pill">ü•ë ‡∏´‡∏°‡∏π‡πà5 <b id="rG5">0</b></span>
        </div>
        <div class="totalRow">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="rGTotal">0</b></div>
      </div>

      <div class="resultBtns">
        <button class="btn ghost" id="btnBackHub" type="button">‚Ü© ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
        <button class="btn" id="btnPlayAgain" type="button">üîÅ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
      </div>
    </div>
  </div>

  <script>
    // --- view mode helper (pc/mobile/vr/cvr) ---
    (function(){
      function setView(view){
        var b = document.body;
        b.classList.remove('view-pc','view-mobile','view-vr','view-cvr');
        b.classList.add('view-' + view);
        var hint = document.getElementById('viewHint');
        if(hint) hint.textContent = 'view: ' + view;
      }
      function guess(){
        try{
          var u = new URL(location.href);
          var v = (u.searchParams.get('view') || '').toLowerCase();
          if(v === 'cvr' || v === 'cardboard' || u.searchParams.get('cvr') === '1') return 'cvr';
          if(v === 'vr') return 'vr';
        }catch(e){}
        var isMobile = matchMedia && matchMedia('(pointer:coarse)').matches;
        return isMobile ? 'mobile' : 'pc';
      }
      setView(guess());
      // debug flag
      try{
        var u2 = new URL(location.href);
        if(u2.searchParams.get('debug') === '1') document.body.classList.add('debug-view');
      }catch(e){}
    })();

    // --- EnterVR buttons + optional orientation lock attempt ---
    (function(){
      function lockLandscape(){
        try{
          if (screen && screen.orientation && screen.orientation.lock){
            // some browsers require user gesture; this is best-effort
            return screen.orientation.lock('landscape').catch(function(){});
          }
        }catch(e){}
        return Promise.resolve();
      }

      function enterVR(){
        try{
          var scene = document.querySelector('a-scene');
          if (scene && scene.enterVR){
            lockLandscape();
            scene.enterVR();
          }
        }catch(e){}
      }

      var b1 = document.getElementById('btnEnterVR');
      var b2 = document.getElementById('btnEnterVR2');
      if (b1) b1.addEventListener('click', enterVR, { passive:true });
      if (b2) b2.addEventListener('click', enterVR, { passive:true });

      // Preview query params
      try{
        var u = new URL(location.href);
        var diff = u.searchParams.get('diff') || 'normal';
        var time = u.searchParams.get('time') || '90';
        var run  = u.searchParams.get('run') || u.searchParams.get('runMode') || 'play';
        var el;
        el = document.getElementById('uiDiffPreview'); if(el) el.textContent = String(diff);
        el = document.getElementById('uiTimePreview'); if(el) el.textContent = String(time);
        el = document.getElementById('uiRunPreview');  if(el) el.textContent  = String(run);
      }catch(e){}
    })();
  </script>
</body>
</html>