<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (VR) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + (optional) logger -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- Plate game (DOM targets on top of A-Frame) -->
  <script src="./plate.safe.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.72);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.22);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#facc15;
      --danger:#fb7185;
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      background: radial-gradient(1200px 900px at 50% 30%, #0b1228, #020617 55%, #020617);
      color:var(--text);
      overflow:hidden;
      touch-action:none;
      -webkit-tap-highlight-color: transparent;
    }

    /* A-Frame full screen behind */
    .vrStage{
      position:fixed; inset:0;
      z-index:10;
    }
    a-scene{ width:100%; height:100%; }

    /* HUD zones (‡πÉ‡∏´‡πâ JS ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô safezone ‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡∏ö) */
    #hudTop, #hudLeft, #hudRight, #hudBottom{
      position:fixed;
      z-index:850;
      pointer-events:auto;
    }

    /* TOP ‚Äî compact */
    #hudTop{
      left:10px; right:10px; top:10px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:10px 10px;
      box-shadow:0 18px 46px rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
    }
    .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .row + .row{ margin-top:8px; }
    .left{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .right{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(2,6,23,.62);
      border:1px solid rgba(148,163,184,.20);
      font-weight:900;
      letter-spacing:.02em;
      line-height:1;
      white-space:nowrap;
    }
    .pill .k{
      font-size:12px;
      color:rgba(229,231,235,.78);
      font-weight:900;
    }
    .pill .v{
      font-size:13px;
      color:var(--text);
      font-weight:1000;
    }
    .pill.big .v{ font-size:14px; }

    .barWrap{
      flex:1;
      min-width:160px;
      display:flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(2,6,23,.62);
      border:1px solid rgba(148,163,184,.20);
    }
    .barLabel{
      font-weight:1000;
      font-size:12px;
      color:rgba(229,231,235,.78);
      white-space:nowrap;
    }
    .bar{
      position:relative;
      flex:1;
      height:10px;
      border-radius:999px;
      background:rgba(148,163,184,.16);
      overflow:hidden;
      border:1px solid rgba(148,163,184,.18);
    }
    #hudFever{
      position:absolute; inset:0;
      width:0%;
      background:linear-gradient(90deg, rgba(34,197,94,.65), rgba(250,204,21,.70));
    }
    #hudFeverPct{
      font-weight:1000;
      font-size:12px;
      color:rgba(229,231,235,.86);
      min-width:46px;
      text-align:right;
    }

    /* LEFT ‚Äî goals/minis (‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° gameplay) */
    #hudLeft{
      left:10px;
      top:92px;
      width:min(340px, 56vw);
    }
    .panel{
      background:var(--panel2);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:10px 10px;
      box-shadow:0 18px 46px rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
    }
    .title{
      font-weight:1000;
      letter-spacing:.02em;
      margin:0 0 6px 0;
      font-size:13px;
      color:rgba(229,231,235,.92);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .line{
      font-weight:950;
      font-size:13px;
      color:rgba(229,231,235,.92);
      margin:0;
    }
    .hint{
      margin-top:6px;
      font-size:12px;
      font-weight:900;
      color:rgba(148,163,184,.95);
    }
    #miniPanel{
      margin-top:10px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.58);
    }

    /* RIGHT ‚Äî buttons compact */
    #hudRight{
      right:10px;
      top:92px;
      width:min(220px, 40vw);
    }
    .btnCol{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.72);
      color:var(--text);
      border-radius:16px;
      padding:10px 10px;
      font-weight:1000;
      letter-spacing:.02em;
      box-shadow:0 12px 26px rgba(0,0,0,.22);
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color:rgba(34,197,94,.32); }
    .btn.warn{ border-color:rgba(250,204,21,.34); }
    .btn.danger{ border-color:rgba(251,113,133,.34); }

    /* BOTTOM ‚Äî minimal */
    #hudBottom{
      left:10px; right:10px; bottom:10px;
    }
    .bottomRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .tip{
      font-size:12px;
      color:rgba(148,163,184,.95);
      font-weight:900;
    }
    #hudPaused{
      display:none;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(2,6,23,.74);
      border:1px solid rgba(148,163,184,.22);
      font-weight:1000;
    }

    /* Result overlay */
    #resultBackdrop{
      position:fixed; inset:0;
      z-index:999;
      display:none;
      background:rgba(2,6,23,.72);
      backdrop-filter: blur(10px);
      padding:18px;
    }
    .resultCard{
      max-width:860px;
      margin:0 auto;
      background:rgba(2,6,23,.78);
      border:1px solid rgba(148,163,184,.22);
      border-radius:22px;
      box-shadow:0 26px 80px rgba(0,0,0,.40);
      padding:16px;
    }
    .resultHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .resultTitle{
      font-weight:1100;
      font-size:18px;
      margin:0;
      letter-spacing:.02em;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }
    .stat{
      background:rgba(15,23,42,.62);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px;
      padding:10px;
    }
    .stat .k{ font-size:12px; color:rgba(148,163,184,.95); font-weight:900; }
    .stat .v{ font-size:16px; font-weight:1100; margin-top:4px; }

    .grid2{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }

    @media (max-width: 900px){
      #hudLeft{ width:min(320px, 62vw); }
      #hudRight{ width:min(210px, 44vw); }
      .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .grid2{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    @media (max-width: 560px){
      #hudLeft{ width:min(300px, 74vw); top:88px; }
      #hudRight{ width:min(190px, 46vw); top:88px; }
      .tip{ font-size:11px; }
      .pill .k{ display:none; } /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡∏ã‡πà‡∏≠‡∏ô label ‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πà‡∏á */
    }
  </style>
</head>

<body>
  <!-- VR Stage (behind HUD & DOM targets) -->
  <div class="vrStage">
    <a-scene
      embedded
      vr-mode-ui="enabled: true"
      renderer="colorManagement: true; physicallyCorrectLights: true"
    >
      <!-- Camera -->
      <a-entity id="cam" camera position="0 1.6 0" look-controls="pointerLockEnabled: false"></a-entity>

      <!-- Optional hands for controller events -->
      <a-entity laser-controls="hand: left"></a-entity>
      <a-entity laser-controls="hand: right"></a-entity>

      <!-- Minimal background -->
      <a-sky color="#060b1a"></a-sky>
      <a-entity light="type: ambient; intensity: 0.9"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="0 3 2"></a-entity>
    </a-scene>
  </div>

  <!-- HUD TOP (compact + necessary only) -->
  <div id="hudTop">
    <div class="card">
      <!-- row[0] -->
      <div class="row">
        <div class="left">
          <span class="pill big">‚è±Ô∏è <span class="k">TIME</span> <span class="v" id="hudTime">0</span></span>
          <span class="pill big">üèÜ <span class="k">SCORE</span> <span class="v" id="hudScore">0</span></span>
          <span class="pill">üî• <span class="k">COMBO</span> <span class="v" id="hudCombo">0</span></span>
          <span class="pill">üí• <span class="k">MISS</span> <span class="v" id="hudMiss">0</span></span>
          <span class="pill">‚≠ê <span class="k">PERF</span> <span class="v" id="hudPerfectCount">0</span></span>
          <span class="pill">üè∑Ô∏è <span class="k">GRADE</span> <span class="v" id="hudGrade">C</span></span>
        </div>
        <div class="right">
          <span class="pill">üéÆ <span class="k">MODE</span> <span class="v" id="hudMode">Play</span></span>
          <span class="pill">üéöÔ∏è <span class="k">DIFF</span> <span class="v" id="hudDiff">Normal</span></span>
          <span class="pill">üçΩÔ∏è <span class="k">HAVE</span> <span class="v" id="hudGroupsHave">0/5</span></span>
        </div>
      </div>

      <!-- row[1]  (JS ‡∏à‡∏∞ append Shield/Lives/State pills ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) -->
      <div class="row">
        <div class="left" style="flex:1; min-width:220px;">
          <div class="barWrap">
            <div class="barLabel">FEVER</div>
            <div class="bar"><div id="hudFever"></div></div>
            <div id="hudFeverPct">0%</div>
          </div>
        </div>
        <div class="right"></div>
      </div>
    </div>
  </div>

  <!-- HUD LEFT (Goal + Mini) -->
  <div id="hudLeft">
    <div class="panel">
      <div class="title">üéØ QUEST</div>
      <p class="line" id="hudGoalLine">Goal ‚Ä¶</p>

      <div class="panel" id="miniPanel">
        <div class="title">üß© MINI</div>
        <p class="line" id="hudMiniLine">Mini ‚Ä¶</p>
        <div class="hint" id="hudMiniHint">‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- HUD RIGHT (Controls) -->
  <div id="hudRight">
    <div class="panel">
      <div class="title">‚öôÔ∏è CONTROLS</div>
      <div class="btnCol">
        <button class="btn primary" id="btnEnterVR" type="button">ü•Ω ENTER VR</button>
        <button class="btn warn" id="btnPause" type="button">‚è∏Ô∏è PAUSE</button>
        <button class="btn danger" id="btnRestart" type="button">üîÑ RESTART</button>
      </div>
    </div>
  </div>

  <!-- HUD BOTTOM (minimal tip + paused) -->
  <div id="hudBottom">
    <div class="card">
      <div class="bottomRow">
        <div class="tip">‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠/‡∏Ñ‡∏•‡∏¥‡∏Å = ‡∏¢‡∏¥‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ ‚Ä¢ VR = ‡∏Å‡∏î Trigger ‚Ä¢ ‡πÄ‡∏•‡πá‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤ ‚ÄúPERFECT ZONE‚Äù</div>
        <div id="hudPaused">‚è∏Ô∏è PAUSED</div>
      </div>
    </div>
  </div>

  <!-- RESULT -->
  <div id="resultBackdrop">
    <div class="resultCard">
      <div class="resultHead">
        <h2 class="resultTitle">üèÅ GAME SUMMARY</h2>
        <button class="btn primary" id="btnPlayAgain" type="button">‚ñ∂Ô∏è PLAY AGAIN</button>
      </div>

      <div class="grid">
        <div class="stat"><div class="k">MODE</div><div class="v" id="rMode">Play</div></div>
        <div class="stat"><div class="k">GRADE</div><div class="v" id="rGrade">C</div></div>
        <div class="stat"><div class="k">SCORE</div><div class="v" id="rScore">0</div></div>
        <div class="stat"><div class="k">MAX COMBO</div><div class="v" id="rMaxCombo">0</div></div>
        <div class="stat"><div class="k">MISS</div><div class="v" id="rMiss">0</div></div>
        <div class="stat"><div class="k">PERFECT</div><div class="v" id="rPerfect">0</div></div>
        <div class="stat"><div class="k">GOALS</div><div class="v" id="rGoals">0/2</div></div>
        <div class="stat"><div class="k">MINIS</div><div class="v" id="rMinis">0/7</div></div>
      </div>

      <div class="grid2">
        <div class="stat"><div class="k">G1</div><div class="v" id="rG1">0</div></div>
        <div class="stat"><div class="k">G2</div><div class="v" id="rG2">0</div></div>
        <div class="stat"><div class="k">G3</div><div class="v" id="rG3">0</div></div>
        <div class="stat"><div class="k">G4</div><div class="v" id="rG4">0</div></div>
        <div class="stat"><div class="k">G5</div><div class="v" id="rG5">0</div></div>
        <div class="stat"><div class="k">TOTAL</div><div class="v" id="rGTotal">0</div></div>
      </div>
    </div>
  </div>
</body>
</html>