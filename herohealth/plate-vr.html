<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- Global IIFE modules (no inline JS) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-compat-input.js" defer></script>
  <script src="./vr/hha-reticlefx.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --stroke:rgba(148,163,184,.32);
      --txt:#e5e7eb;
      --muted:#9ca3af;
      --good:#22c55e;
      --warn:#facc15;
      --bad:#fb7185;
      --radius:18px;
    }
    html,body{ margin:0; height:100%; background:var(--bg); color:var(--txt);
      font-family:system-ui,-apple-system,"Segoe UI","Noto Sans Thai",sans-serif; overflow:hidden; }

    .hud-top, .hud-bottom, .hud-left, .hud-right{
      position:fixed; z-index:900;
      display:flex; gap:10px;
      pointer-events:none;
    }
    .hud-top{ top:10px; left:10px; right:10px; justify-content:space-between; align-items:flex-start; }
    .hud-bottom{ bottom:10px; left:10px; right:10px; justify-content:space-between; align-items:flex-end; }
    .hud-left{ left:10px; top:88px; flex-direction:column; }
    .hud-right{ right:10px; top:88px; flex-direction:column; align-items:flex-end; }

    .card{
      pointer-events:auto;
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:10px 12px;
      box-shadow:0 18px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      max-width: 72vw;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:rgba(15,23,42,.82);
      border:1px solid rgba(148,163,184,.25);
      border-radius:999px;
      padding:6px 10px;
      font-weight:800;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .k{ color:var(--muted); font-weight:800; }
    .v{ font-weight:900; }
    .bar{
      width:160px; height:10px; border-radius:999px;
      background:rgba(148,163,184,.18);
      border:1px solid rgba(148,163,184,.22);
      overflow:hidden;
    }
    .bar > div{ height:100%; width:0%; background:var(--warn); transition:width .2s ease; }

    .btn{
      pointer-events:auto;
      cursor:pointer;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(15,23,42,.85);
      color:var(--txt);
      padding:10px 12px;
      font-weight:900;
    }
    .btn:active{ transform:translateY(1px); }

    .quest-panel{ max-width: 56vw; }
    .mini-panel{ max-width: 56vw; }
    .hint{ margin-top:6px; color:var(--muted); font-weight:900; line-height:1.2; }

    #resultBackdrop{
      position:fixed; inset:0; display:none; z-index:950;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.62);
      padding:18px;
      pointer-events:auto;
    }
    #resultCard{ width:min(720px, 92vw); }
    .big{ font-size:22px; font-weight:1000; letter-spacing:.06em; }
    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr; } .card{ max-width: 90vw; } }

    /* Tap-to-start overlay */
    #startOverlay{
      position:fixed; inset:0; z-index:960;
      display:flex; align-items:center; justify-content:center;
      background:radial-gradient(900px 520px at 50% 40%, rgba(34,197,94,0.10), rgba(2,6,23,0.92));
      padding:18px;
      pointer-events:auto;
    }
    #startOverlay .box{
      width:min(720px, 92vw);
      background:rgba(2,6,23,.78);
      border:1px solid rgba(148,163,184,.32);
      border-radius:22px;
      padding:16px 16px;
      box-shadow:0 26px 80px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    #startOverlay .title{
      font-size:22px; font-weight:1000; letter-spacing:.04em;
    }
    #startOverlay .sub{
      margin-top:8px; color:rgba(226,232,240,.82); font-weight:900; line-height:1.35;
    }
    #startOverlay .sub b{ color:#fff; }
    #startOverlay .hint{
      margin-top:10px; color:rgba(148,163,184,.95); font-weight:900;
    }
    #startOverlay .row2{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    #startOverlay .cta{
      pointer-events:auto;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(34,197,94,.18);
      color:var(--txt);
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
    }
    #startOverlay .cta:active{ transform:translateY(1px); }
  </style>
</head>

<body>

  <!-- TAP TO START -->
  <div id="startOverlay">
    <div class="box">
      <div class="title">üçΩÔ∏è Balanced Plate VR</div>
      <div class="sub">
        <b>‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô (‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Motion ‡∏ö‡∏ô iPhone)<br/>
        ‡∏´‡∏°‡∏∏‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡∏•‡∏≤‡∏Å‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏á‡πÅ‡∏ö‡∏ö VR ‚Ä¢ ‡∏¢‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞ (tap-anywhere) ‚Ä¢ ‡∏à‡πâ‡∏≠‡∏á + fuse ‡∏Å‡πá‡πÑ‡∏î‡πâ
      </div>
      <div class="row2">
        <button id="btnStart" class="cta">‚ñ∂Ô∏è START (Tap Anywhere)</button>
        <button id="btnEnterVR2" class="cta">ü•Ω ENTER VR</button>
      </div>
      <div class="hint">Tip: ‡πÇ‡∏´‡∏°‡∏î Play ‡∏°‡∏µ Adaptive / ‡πÇ‡∏´‡∏°‡∏î Research ‡∏à‡∏∞‡∏¢‡∏∂‡∏î‡∏ï‡∏≤‡∏° Easy/Normal/Hard ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
    </div>
  </div>

  <!-- TOP HUD -->
  <div id="hudTop" class="hud-top">
    <div class="card">
      <div class="row">
        <span class="pill">‚è±Ô∏è <span class="k">TIME</span> <span id="hudTime" class="v">0</span></span>
        <span class="pill">‚≠ê <span class="k">SCORE</span> <span id="hudScore" class="v">0</span></span>
        <span class="pill">üî• <span class="k">COMBO</span> <span id="hudCombo" class="v">0</span></span>
        <span class="pill">üí• <span class="k">MISS</span> <span id="hudMiss" class="v">0</span></span>
        <span class="pill" id="hudPaused" style="display:none;">‚è∏Ô∏è <span class="k">PAUSED</span></span>
      </div>

      <div class="row" style="margin-top:8px;">
        <span class="k">FEVER</span>
        <div class="bar"><div id="hudFever"></div></div>
        <span id="hudFeverPct" class="v">0%</span>

        <span class="pill">üèÖ <span class="k">GRADE</span> <span id="hudGrade" class="v">C</span></span>
        <span class="pill">üéÆ <span id="hudMode">Play</span></span>
        <span class="pill">‚öôÔ∏è <span id="hudDiff">Normal</span></span>
        <span class="pill">üçΩÔ∏è <span class="k">PLATE</span> <span id="hudGroupsHave" class="v">0/5</span></span>
        <span class="pill">üåü <span class="k">PERFECT</span> <span id="hudPerfectCount" class="v">0</span></span>
      </div>
    </div>
  </div>

  <!-- LEFT HUD -->
  <div id="hudLeft" class="hud-left">
    <div id="questPanel" class="card quest-panel">
      <div class="big">üéØ QUEST</div>
      <div id="hudGoalLine" style="margin-top:6px; font-weight:900;">‚Ä¶</div>
    </div>
    <div id="miniPanel" class="card mini-panel">
      <div class="big">üß© MINI</div>
      <div id="hudMiniLine" style="margin-top:6px; font-weight:900;">‚Ä¶</div>
      <div id="hudMiniHint" class="hint">‚Ä¶</div>
    </div>
  </div>

  <!-- RIGHT HUD -->
  <div id="hudRight" class="hud-right">
    <button id="btnEnterVR" class="btn">ü•Ω ENTER VR</button>
    <button id="btnPause" class="btn">‚è∏Ô∏è PAUSE</button>
    <button id="btnRestart" class="btn">üîÅ RESTART</button>
  </div>

  <!-- BOTTOM HUD -->
  <div id="hudBottom" class="hud-bottom">
    <div class="card" style="max-width:72vw;">
      <div class="k">Tip</div>
      <div style="font-weight:900;">‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‚Äî ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ç‡∏¢‡∏∞! (Plate Rush ‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞)</div>
    </div>
  </div>

  <!-- RESULT MODAL -->
  <div id="resultBackdrop">
    <div id="resultCard" class="card">
      <div class="big">üìä RESULT</div>
      <div class="grid" style="margin-top:10px;">
        <div class="card">
          <div class="row"><span class="k">MODE</span> <span id="rMode" class="v">Play</span></div>
          <div class="row"><span class="k">GRADE</span> <span id="rGrade" class="v">C</span></div>
          <div class="row"><span class="k">SCORE</span> <span id="rScore" class="v">0</span></div>
          <div class="row"><span class="k">MAX COMBO</span> <span id="rMaxCombo" class="v">0</span></div>
          <div class="row"><span class="k">MISS</span> <span id="rMiss" class="v">0</span></div>
          <div class="row"><span class="k">PERFECT</span> <span id="rPerfect" class="v">0</span></div>
        </div>
        <div class="card">
          <div class="row"><span class="k">GOALS</span> <span id="rGoals" class="v">0/0</span></div>
          <div class="row"><span class="k">MINI</span> <span id="rMinis" class="v">0/0</span></div>
          <div class="row"><span class="k">G1</span> <span id="rG1" class="v">0</span></div>
          <div class="row"><span class="k">G2</span> <span id="rG2" class="v">0</span></div>
          <div class="row"><span class="k">G3</span> <span id="rG3" class="v">0</span></div>
          <div class="row"><span class="k">G4</span> <span id="rG4" class="v">0</span></div>
          <div class="row"><span class="k">G5</span> <span id="rG5" class="v">0</span></div>
          <div class="row"><span class="k">TOTAL</span> <span id="rGTotal" class="v">0</span></div>
        </div>
      </div>

      <div class="row" style="justify-content:flex-end; margin-top:12px;">
        <button id="btnPlayAgain" class="btn">üéÆ PLAY AGAIN</button>
      </div>
    </div>
  </div>

  <!-- A-Frame Scene -->
  <a-scene
    renderer="colorManagement:true; physicallyCorrectLights:false"
    background="color:#020617"
    vr-mode-ui="enabled:true"
    embedded
  >
    <!-- Camera -->
    <a-entity
      id="cam"
      camera
      position="0 1.6 0"
      look-controls="enabled:false"
      hha-vrlook="enabled:true; gyro:true; drag:true; inertia:0.08; pitchLimit:78"
    >
      <a-cursor
        id="cursor"
        fuse="true"
        fuse-timeout="700"
        raycaster="objects:.plateTarget; far: 6"
        material="color:#ffffff; shader:flat; opacity:0.88"
        geometry="primitive:ring; radiusInner:0.010; radiusOuter:0.018"
        hha-reticlefx="hoverScale:1.28; hoverOpacity:1.0; idleOpacity:0.70; fusePulse:1"
      ></a-cursor>
    </a-entity>

    <a-entity light="type:ambient; intensity:1.0; color:#ffffff"></a-entity>

    <!-- world root for targets -->
    <a-entity id="worldTargets"></a-entity>
    <!-- legacy (kept harmless) -->
    <a-entity id="targetRoot" position="0 0 -1.35" rotation="0 0 0"></a-entity>
  </a-scene>

  <!-- Module -->
  <script type="module" src="./plate/plate.safe.js"></script>
</body>
</html>
