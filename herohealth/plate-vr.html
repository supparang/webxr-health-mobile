<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (for Enter VR button reliability) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + Logger + Universal VR UI -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>
  <script src="./vr/vr-ui.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;

      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --violet:#a78bfa;

      --radius:18px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; width:100%; margin:0; overflow:hidden; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Thai", sans-serif;
    }

    /* Background */
    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 12% 10%, rgba(34,211,238,.16), transparent 40%),
        radial-gradient(circle at 88% 20%, rgba(167,139,250,.14), transparent 42%),
        radial-gradient(circle at 50% 92%, rgba(34,197,94,.12), transparent 48%),
        linear-gradient(180deg, rgba(2,6,23,.98), rgba(2,6,23,1));
      z-index:0;
    }

    /* A-Frame scene behind UI */
    a-scene{
      position:fixed !important; inset:0 !important;
      z-index:1 !important;
      pointer-events:none;
      background:transparent !important;
    }

    /* Main */
    .ui{
      position:fixed; inset:0;
      z-index:20;
      display:block;
    }

    /* hit FX overlay */
    #hitFx{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:0;
      z-index:25;
      transition: opacity .14s ease;
    }

    /* Play layer (targets live here) */
    #plate-layer{
      position:fixed;
      inset:0;
      z-index:22;
      pointer-events:auto;
      touch-action:none;
      transform:translate3d(0,0,0);
    }
    .plateTarget{
      cursor:pointer;
    }

    /* HUD TOP */
    #hudTop{
      position:fixed;
      left: calc(12px + var(--sal));
      right: calc(12px + var(--sar));
      top: calc(12px + var(--sat));
      z-index:40;
      display:grid;
      gap:10px;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:stretch;
    }

    .card{
      background: var(--panel);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:10px 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,.25);
      min-height: 46px;
    }

    .pill{
      border-radius: var(--pill);
      padding:8px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      background: var(--panel2);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
    }

    .kpi{
      display:flex;
      align-items:center;
      gap:10px;
      flex:1;
      justify-content:space-between;
    }
    .kpi .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .kpi .ico{
      width:34px; height:34px;
      display:grid; place-items:center;
      border-radius: 12px;
      background: rgba(148,163,184,.08);
      border:1px solid rgba(148,163,184,.14);
      flex:0 0 auto;
    }
    .kpi .meta{
      min-width:0;
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .kpi .label{
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .kpi .val{
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    /* progress bars */
    .bar{
      position:relative;
      height:10px;
      border-radius:999px;
      background: rgba(148,163,184,.12);
      overflow:hidden;
      border:1px solid rgba(148,163,184,.14);
      margin-top:8px;
    }
    .bar > i{
      position:absolute; inset:0 auto 0 0;
      width:0%;
      background: rgba(34,197,94,.70);
    }
    .bar.warn > i{ background: rgba(245,158,11,.78); }
    .bar.bad > i{ background: rgba(239,68,68,.78); }

    /* goal + mini panels */
    #miniPanel, #coachPanel{
      position:fixed;
      left: calc(12px + var(--sal));
      right: calc(12px + var(--sar));
      z-index:40;
      display:grid;
      gap:10px;
    }
    #miniPanel{
      top: calc(140px + var(--sat));
    }
    #coachPanel{
      top: calc(250px + var(--sat));
      pointer-events:none;
    }

    .questCard{
      background: var(--panel);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:10px 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
    }
    .questHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .questTitle{
      font-weight:900;
      font-size:13px;
      color: var(--text);
      opacity:.95;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .questCount{
      font-size:12px;
      color: var(--muted);
      flex:0 0 auto;
    }
    .questSub{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted);
    }
    .hint{
      margin-top:6px;
      font-size:12px;
      color: rgba(229,231,235,.85);
    }

    /* Coach */
    .coachWrap{
      display:flex;
      align-items:center;
      gap:10px;
      pointer-events:none;
    }
    #coachImg{
      width:48px; height:48px;
      border-radius: 16px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(148,163,184,.06);
      object-fit:cover;
      flex:0 0 auto;
    }
    #coachMsg{
      flex:1;
      min-width:0;
      padding:10px 12px;
      border-radius: 16px;
      background: rgba(2,6,23,.70);
      border:1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 36px rgba(0,0,0,.20);
      font-size:13px;
      line-height:1.25;
      color: rgba(229,231,235,.95);
    }

    /* HUD buttons bottom */
    #hudBtns{
      position:fixed;
      left: calc(12px + var(--sal));
      right: calc(12px + var(--sar));
      bottom: calc(12px + var(--sab));
      z-index:45;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      pointer-events:auto;
    }

    .btn{
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.74);
      color: var(--text);
      border-radius: 16px;
      padding:12px 14px;
      font-weight:900;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      box-shadow: 0 16px 44px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      flex:1;
      min-height: 46px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: rgba(34,197,94,.20);
      border-color: rgba(34,197,94,.35);
    }
    .btn.warn{
      background: rgba(245,158,11,.18);
      border-color: rgba(245,158,11,.30);
    }
    .btn.bad{
      background: rgba(239,68,68,.14);
      border-color: rgba(239,68,68,.30);
    }
    .btn.small{
      flex:0 0 auto;
      width: 56px;
      padding: 12px 0;
    }

    /* Pause overlay */
    #hudPaused{
      position:fixed;
      inset:0;
      z-index:80;
      display:none;
      place-items:center;
      background: rgba(2,6,23,.62);
      backdrop-filter: blur(10px);
    }
    .pausedCard{
      width:min(520px, calc(100vw - 28px));
      background: rgba(2,6,23,.86);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 22px;
      padding:16px;
      box-shadow: 0 24px 70px rgba(0,0,0,.35);
    }
    .pausedTitle{ font-size:18px; font-weight:900; }
    .pausedDesc{ font-size:13px; color: var(--muted); margin-top:6px; margin-bottom:12px; }
    .pausedBtns{ display:flex; gap:10px; }
    .pausedBtns .btn{ flex:1; }

    /* Start overlay */
    #startOverlay{
      position:fixed; inset:0;
      z-index:90;
      display:none;
      place-items:center;
      background: rgba(2,6,23,.66);
      backdrop-filter: blur(10px);
    }
    .startCard{
      width:min(560px, calc(100vw - 28px));
      background: rgba(2,6,23,.90);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 26px 80px rgba(0,0,0,.40);
    }
    .startTop{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:10px;
    }
    .startTitle{ font-size:18px; font-weight:900; }
    .startMeta{ font-size:12px; color: var(--muted); }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin: 10px 0 12px;
    }
    .miniKpi{
      background: rgba(15,23,42,.70);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 18px;
      padding:10px;
    }
    .miniKpi .k{ font-size:12px; color: var(--muted); }
    .miniKpi .v{ font-size:16px; font-weight:900; margin-top:4px; }
    .startBtns{ display:flex; gap:10px; margin-top:12px; }

    /* Boss/Storm overlays (top center) */
    .eventHud{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      top: calc(12px + var(--sat));
      z-index:60;
      display:none;
      pointer-events:none;
      width: min(560px, calc(100vw - 28px));
    }
    .eventCard{
      background: rgba(2,6,23,.84);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 22px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 70px rgba(0,0,0,.35);
    }
    .eventRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .eventTitle{ font-weight:900; font-size:14px; }
    .eventHint{ font-size:12px; color: rgba(229,231,235,.85); }
    .eventProg{ font-size:12px; color: var(--muted); margin-top:6px; }

    /* Result */
    #resultBackdrop{
      position:fixed;
      inset:0;
      z-index:95;
      display:none;
      place-items:center;
      background: rgba(2,6,23,.70);
      backdrop-filter: blur(12px);
    }
    .resultCard{
      width:min(680px, calc(100vw - 28px));
      background: rgba(2,6,23,.92);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 28px 90px rgba(0,0,0,.45);
    }
    .resultTop{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .resultTitle{
      font-size:18px;
      font-weight:900;
    }
    .resultBadge{
      font-size:12px;
      color: var(--muted);
    }
    .resultGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-bottom:12px;
    }
    .rBox{
      background: rgba(15,23,42,.70);
      border:1px solid rgba(148,163,184,.18);
      border-radius: 18px;
      padding: 10px;
      min-height: 64px;
    }
    .rBox .k{ font-size:12px; color: var(--muted); }
    .rBox .v{ font-size:18px; font-weight:900; margin-top:4px; }
    .resultCounts{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .resultBtns{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .resultBtns .btn{ flex:1; }

    /* Responsive */
    @media (max-width: 520px){
      .grid3{ grid-template-columns: 1fr; }
      .resultGrid{ grid-template-columns: 1fr 1fr; }
      .resultCounts{ grid-template-columns: 1fr 1fr 1fr; }
      #miniPanel{ top: calc(155px + var(--sat)); }
      #coachPanel{ top: calc(280px + var(--sat)); }
    }

    /* Hide pointer-events for strict cVR if desired */
    body.view-cvr #plate-layer .plateTarget{
      pointer-events:none;
    }
  </style>
</head>

<body>
  <div class="bg"></div>

  <!-- Minimal A-Frame scene (enables enterVR) -->
  <a-scene embedded vr-mode-ui="enabled:false" renderer="alpha:true; antialias:true" background="color: #0000">
    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

  <div class="ui">
    <!-- hit FX overlay -->
    <div id="hitFx"></div>

    <!-- Targets layer -->
    <div id="plate-layer" aria-label="plate layer"></div>

    <!-- TOP HUD -->
    <div id="hudTop">
      <div class="row">
        <div class="pill kpi">
          <div class="left">
            <div class="ico">üèÅ</div>
            <div class="meta">
              <div class="label">‡πÄ‡∏ß‡∏•‡∏≤</div>
              <div class="val"><span id="uiTime">0</span>s</div>
            </div>
          </div>
          <div class="meta" style="text-align:right">
            <div class="label">‡πÇ‡∏´‡∏°‡∏î/‡∏¢‡∏≤‡∏Å</div>
            <div class="val" style="font-size:14px">
              <span id="uiRunPreview">play</span> ‚Ä¢ <span id="uiDiffPreview">normal</span>
            </div>
          </div>
        </div>

        <div class="pill kpi">
          <div class="left">
            <div class="ico">‚≠ê</div>
            <div class="meta">
              <div class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
              <div class="val" id="uiScore">0</div>
            </div>
          </div>
          <div class="meta" style="text-align:right">
            <div class="label">‡πÄ‡∏Å‡∏£‡∏î</div>
            <div class="val"><span id="uiGrade">C</span></div>
          </div>
        </div>
      </div>

      <div class="row split">
        <div class="card">
          <div class="questHead">
            <div class="questTitle">üéØ GOAL: <span id="uiGoalTitle">‚Äî</span></div>
            <div class="questCount"><span id="uiGoalCount">0/0</span></div>
          </div>
          <div class="bar"><i id="uiGoalFill"></i></div>
          <div class="questSub">
            <div>Accuracy: <b id="uiAcc">0%</b></div>
            <div>Miss: <b id="uiMiss">0</b></div>
          </div>
        </div>

        <div class="card">
          <div class="questHead">
            <div class="questTitle">üçΩÔ∏è ‡∏à‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö</div>
            <div class="questCount"><span id="uiPlateHave">0</span>/5</div>
          </div>
          <div class="questSub" style="margin-top:4px;">
            <div>ü•¶ <b id="uiG1">0</b></div>
            <div>üçé <b id="uiG2">0</b></div>
            <div>üêü <b id="uiG3">0</b></div>
            <div>üçö <b id="uiG4">0</b></div>
            <div>ü•ë <b id="uiG5">0</b></div>
          </div>
          <div class="questSub" style="margin-top:8px;">
            <div>Combo: <b id="uiCombo">0</b> (<span id="uiComboMax">0</span>)</div>
            <div>üõ°Ô∏è <b id="uiShieldN">0</b></div>
          </div>
          <div class="bar bad"><i id="uiFeverFill"></i></div>
        </div>
      </div>
    </div>

    <!-- MINI PANEL -->
    <div id="miniPanel">
      <div class="questCard">
        <div class="questHead">
          <div class="questTitle">‚ö° MINI: <span id="uiMiniTitle">‚Äî</span></div>
          <div class="questCount"><span id="uiMiniCount">0/0</span></div>
        </div>
        <div class="bar warn"><i id="uiMiniFill"></i></div>
        <div class="questSub">
          <div>‚è±Ô∏è <b id="uiMiniTime">--</b></div>
          <div id="uiHint" style="text-align:right; max-width:70%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;"></div>
        </div>
      </div>
    </div>

    <!-- COACH PANEL -->
    <div id="coachPanel">
      <div class="coachWrap">
        <img id="coachImg" alt="coach" src="./img/coach-neutral.png" />
        <div id="coachMsg">‡πÅ‡∏ï‡∏∞ Start ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</div>
      </div>
    </div>

    <!-- Storm HUD -->
    <div id="stormHud" class="eventHud">
      <div class="eventCard">
        <div class="eventRow">
          <div class="eventTitle" id="stormTitle">üå™Ô∏è STORM</div>
          <div class="eventHint" id="stormHint">‚Äî</div>
        </div>
      </div>
    </div>
    <div id="stormFx" style="display:none"></div>

    <!-- Boss HUD -->
    <div id="bossHud" class="eventHud">
      <div class="eventCard">
        <div class="eventRow">
          <div class="eventTitle" id="bossTitle">üëπ BOSS</div>
          <div class="eventHint" id="bossHint">‚Äî</div>
        </div>
        <div class="eventProg" id="bossProg">‚Äî</div>
      </div>
    </div>
    <div id="bossFx" style="display:none"></div>

    <!-- Bottom buttons -->
    <div id="hudBtns">
      <button id="btnEnterVR" class="btn small" type="button" title="Enter VR">ü•Ω</button>
      <button id="btnPause" class="btn warn" type="button">‚è∏ Pause</button>
      <button id="btnRestart" class="btn bad" type="button">‚Üª Restart</button>
    </div>

    <!-- Paused overlay -->
    <div id="hudPaused">
      <div class="pausedCard">
        <div class="pausedTitle">‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</div>
        <div class="pausedDesc">‡∏Å‡∏î Resume ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ Back ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö HUB</div>
        <div class="pausedBtns">
          <button class="btn warn" id="btnPauseResume" type="button" onclick="document.getElementById('btnPause')?.click()">‚ñ∂Ô∏è Resume</button>
          <button class="btn bad" id="btnBackHub" type="button">üè† Back HUB</button>
        </div>
      </div>
    </div>

    <!-- Start overlay -->
    <div id="startOverlay">
      <div class="startCard">
        <div class="startTop">
          <div>
            <div class="startTitle">üçΩÔ∏è Balanced Plate VR</div>
            <div class="startMeta">‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà + ‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
          </div>
          <div class="startMeta" style="text-align:right">
            seed: <span id="uiSeed">‚Äî</span>
          </div>
        </div>

        <div class="grid3">
          <div class="miniKpi">
            <div class="k">‡πÇ‡∏´‡∏°‡∏î</div>
            <div class="v"><span id="uiRunPreview2">play</span></div>
          </div>
          <div class="miniKpi">
            <div class="k">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</div>
            <div class="v"><span id="uiDiffPreview2">normal</span></div>
          </div>
          <div class="miniKpi">
            <div class="k">‡πÄ‡∏ß‡∏•‡∏≤</div>
            <div class="v"><span id="uiTimePreview">90</span>s</div>
          </div>
        </div>

        <div class="startMeta">
          ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: Mobile / VR / Cardboard (‡∏ú‡πà‡∏≤‡∏ô Universal VR UI)<br/>
          üéØ Tips: ‡πÄ‡∏Å‡πá‡∏ö GOOD ‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‡∏Ñ‡∏∏‡∏° MISS ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≥ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏£‡∏î‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô S / SS / SSS!
        </div>

        <div class="startBtns">
          <button id="btnStart" class="btn primary" type="button">‚ñ∂Ô∏è START</button>
          <button id="btnBackHub2" class="btn bad" type="button">üè† HUB</button>
        </div>
      </div>
    </div>

    <!-- Result -->
    <div id="resultBackdrop">
      <div class="resultCard">
        <div class="resultTop">
          <div class="resultTitle">üèÅ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏Å‡∏°</div>
          <div class="resultBadge">Mode: <b id="rMode">play</b></div>
        </div>

        <div class="resultGrid">
          <div class="rBox"><div class="k">‡πÄ‡∏Å‡∏£‡∏î</div><div class="v" id="rGrade">C</div></div>
          <div class="rBox"><div class="k">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div><div class="v" id="rScore">0</div></div>
          <div class="rBox"><div class="k">Max Combo</div><div class="v" id="rMaxCombo">0</div></div>
          <div class="rBox"><div class="k">Miss</div><div class="v" id="rMiss">0</div></div>
          <div class="rBox"><div class="k">Perfect</div><div class="v" id="rPerfect">0%</div></div>
          <div class="rBox"><div class="k">Goals / Minis</div><div class="v"><span id="rGoals">0/0</span> ‚Ä¢ <span id="rMinis">0/0</span></div></div>
        </div>

        <div class="resultCounts">
          <div class="rBox"><div class="k">ü•¶</div><div class="v" id="rG1">0</div></div>
          <div class="rBox"><div class="k">üçé</div><div class="v" id="rG2">0</div></div>
          <div class="rBox"><div class="k">üêü</div><div class="v" id="rG3">0</div></div>
          <div class="rBox"><div class="k">üçö</div><div class="v" id="rG4">0</div></div>
          <div class="rBox"><div class="k">ü•ë</div><div class="v" id="rG5">0</div></div>
          <div class="rBox"><div class="k">‡∏£‡∏ß‡∏°</div><div class="v" id="rGTotal">0</div></div>
        </div>

        <div class="resultBtns">
          <button id="btnPlayAgain" class="btn primary" type="button">üîÅ Play Again</button>
          <button id="btnBackHub" class="btn bad" type="button">üè† Back HUB</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Sync preview fields for overlay
    (function(){
      const u = new URL(location.href);
      const runRaw = (u.searchParams.get('run') || u.searchParams.get('runMode') || 'play').toLowerCase();
      const diff = (u.searchParams.get('diff') || 'normal').toLowerCase();
      const time = u.searchParams.get('time') || 90;
      const seed = u.searchParams.get('seed') || '';
      const run = (runRaw === 'study' || runRaw === 'research') ? 'study' : 'play';

      const set = (id, v)=>{ const el=document.getElementById(id); if(el) el.textContent = String(v); };

      set('uiRunPreview', run);
      set('uiDiffPreview', diff);
      set('uiTimePreview', time);

      set('uiRunPreview2', run);
      set('uiDiffPreview2', diff);
      set('uiSeed', seed || '(auto)');
      set('uiTimePreview', time);

      // HUB back on start overlay
      const hub = u.searchParams.get('hub') || './hub.html';
      const b2 = document.getElementById('btnBackHub2');
      if(b2) b2.addEventListener('click', ()=> location.href = hub, {passive:true});
    })();
  </script>

  <!-- GAME ENGINE -->
  <script type="module" src="./plate/plate.safe.js"></script>
</body>
</html>