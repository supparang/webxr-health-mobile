<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Food Groups VR (Launcher)</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- ‡πÉ‡∏ä‡πâ CSS ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏™‡∏ß‡∏¢/‡∏Ñ‡∏∏‡∏°‡πÇ‡∏ó‡∏ô -->
  <link rel="stylesheet" href="./vr-groups/groups-vr.css" />

  <style>
    body{ overflow:auto; }
    .overlay{ position:relative; inset:auto; min-height:100vh; }
    .panel{ margin: 22px auto; }
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width:720px){ .grid3{ grid-template-columns:1fr; } }
    .btn-big{
      padding: 14px 14px;
      border-radius: 16px;
      font-weight: 1000;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .btn-big .r{ opacity:.9; font-weight:900; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke);
      background: rgba(15,23,42,.45);
      padding: 8px 10px; border-radius: var(--pill);
      font-weight: 900; color: var(--text);
    }
    .minihelp{ color: var(--muted); font-weight:800; font-size:13px; line-height:1.35; }
    .warnline{ color: #f59e0b; font-weight:900; }
  </style>
</head>

<body>
  <div class="overlay">
    <div class="panel">
      <div class="title">ü•ó Food Groups VR</div>
      <div class="sub">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î + ‡∏£‡∏∞‡∏î‡∏±‡∏ö + ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‚Äù ‡∏ï‡∏≤‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (PC / Mobile / Cardboard)
      </div>

      <div class="hr"></div>

      <div class="grid2">
        <div class="kv">
          <div class="k">RUN MODE</div>
          <div class="v">
            <button id="runPlay" class="chip chip-on" type="button">üéÆ play</button>
            <button id="runResearch" class="chip" type="button">üß™ research</button>
            <span class="hint">research = deterministic (‡πÑ‡∏°‡πà adaptive)</span>
          </div>
        </div>

        <div class="kv">
          <div class="k">DIFFICULTY</div>
          <div class="v">
            <button data-diff="easy" class="chip" type="button">‡∏á‡πà‡∏≤‡∏¢</button>
            <button data-diff="normal" class="chip chip-on" type="button">‡∏õ‡∏Å‡∏ï‡∏¥</button>
            <button data-diff="hard" class="chip" type="button">‡∏¢‡∏≤‡∏Å</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">STYLE</div>
          <div class="v">
            <button data-style="mix" class="chip chip-on" type="button">mix</button>
            <button data-style="feel" class="chip" type="button">feel</button>
            <button data-style="hard" class="chip" type="button">hard</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">TIME (sec)</div>
          <div class="v">
            <input id="timeSec" class="input" type="number" min="30" max="180" value="90" />
            <span class="hint">30‚Äì180</span>
          </div>
        </div>

        <div class="kv">
          <div class="k">SEED</div>
          <div class="v">
            <input id="seedTxt" class="input" type="text" value="" placeholder="auto" style="width:160px" />
            <button id="btnSeedNow" class="chip" type="button">‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">AI</div>
          <div class="v">
            <button id="aiOn" class="chip chip-on" type="button">AI ON</button>
            <button id="aiOff" class="chip" type="button">AI OFF</button>
            <span class="hint">research: AI ‡∏à‡∏∞ ‚Äú‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‚Äù ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</span>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="sub">
        <span class="badge">üéØ PC</span>
        <span class="badge">üì± Mobile</span>
        <span class="badge">üï∂Ô∏è Cardboard</span>
        <div class="minihelp" style="margin-top:10px;">
          <div class="warnline">Cardboard:</div>
          - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>ENTER VR</b> ‡∏°‡∏∏‡∏°‡∏•‡πà‡∏≤‡∏á (‡∏à‡∏≤‡∏Å <code>vr-ui.js</code>)<br/>
          - ‡πÇ‡∏´‡∏°‡∏î <b>Cardboard = view=cvr</b> ‡∏¢‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢ crosshair ‡∏ú‡πà‡∏≤‡∏ô tap-to-shoot (event <code>hha:shoot</code>)
        </div>
      </div>

      <div class="hr"></div>

      <div class="grid3">
        <button id="btnPC" class="btn btn-big" type="button">
          <span>üñ•Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô PC</span><span class="r">view=pc</span>
        </button>
        <button id="btnMobile" class="btn btn-big btn-strong" type="button">
          <span>üì± ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô Mobile</span><span class="r">view=mobile</span>
        </button>
        <button id="btnCVR" class="btn btn-big" type="button">
          <span>üï∂Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô Cardboard</span><span class="r">view=cvr</span>
        </button>
      </div>

      <div class="row row2" style="margin-top:14px;">
        <button id="btnHub" class="btn btn-ghost" type="button">üè† ‡πÑ‡∏õ HUB</button>
        <button id="btnCopy" class="btn" type="button">üìã Copy Link (run)</button>
      </div>

      <div class="note" style="margin-top:10px;">
        ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå passthrough: <code>hub</code>, <code>log</code>, <code>studyId</code>, <code>phase</code>, ‡∏Ø‡∏•‡∏Ø ‚Äî ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ run ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const $ = (id)=>DOC.getElementById(id);

  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }
  function clamp(v,a,b){ v = Number(v)||0; return v<a?a:(v>b?b:v); }

  const state = {
    run: (String(qs('run','play')||'play').toLowerCase()==='research') ? 'research' : 'play',
    diff: String(qs('diff','normal')||'normal').toLowerCase(),
    style: String(qs('style','mix')||'mix').toLowerCase(),
    time: clamp(qs('time',90), 30, 180),
    seed: String(qs('seed','')||''),
    ai: (String(qs('ai','on')||'on').toLowerCase()!=='off'),
  };

  function chipOn(el, on){ el.classList.toggle('chip-on', !!on); }

  function syncUI(){
    chipOn($('runPlay'), state.run==='play');
    chipOn($('runResearch'), state.run==='research');

    DOC.querySelectorAll('[data-diff]').forEach(b=>{
      chipOn(b, String(b.dataset.diff)===state.diff);
    });
    DOC.querySelectorAll('[data-style]').forEach(b=>{
      chipOn(b, String(b.dataset.style)===state.style);
    });

    $('timeSec').value = String(state.time|0);
    $('seedTxt').value = state.seed || '';
    chipOn($('aiOn'), !!state.ai);
    chipOn($('aiOff'), !state.ai);

    // ‡∏ñ‡πâ‡∏≤ research -> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ai on ‡πÑ‡∏î‡πâ (coach) ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà adaptive ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
  }

  function passthroughParams(u){
    // ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢/‡πÇ‡∏•‡∏à‡∏¥‡∏Å‡∏ó‡∏µ‡πà user ‡∏≠‡∏≤‡∏à‡πÉ‡∏™‡πà‡∏°‡∏≤
    const pass = ['hub','log','studyId','phase','conditionGroup','sessionOrder','blockLabel','siteCode','schoolYear','semester','sessionId','studentKey','schoolCode','schoolName','classRoom','studentNo','nickName','gender','age','gradeLevel','heightCm','weightKg','bmi','bmiGroup','vrExperience','gameFrequency','handedness','visionIssue','healthDetail','consentParent'];
    pass.forEach(k=>{
      const v = qs(k, null);
      if (v !== null && v !== '') u.searchParams.set(k, v);
    });
  }

  function buildRunUrl(view){
    const u = new URL('./vr-groups/groups.html', location.href);
    u.searchParams.set('view', view);
    u.searchParams.set('run', state.run);
    u.searchParams.set('diff', state.diff);
    u.searchParams.set('style', state.style);
    u.searchParams.set('time', String(state.time|0));
    u.searchParams.set('ai', state.ai ? 'on' : 'off');
    const seed = state.seed || String(Date.now());
    u.searchParams.set('seed', seed);
    passthroughParams(u);
    return u;
  }

  async function copyText(text){
    try { await navigator.clipboard.writeText(String(text||'')); return true; }
    catch{
      try{
        const ta = DOC.createElement('textarea');
        ta.value = String(text||'');
        DOC.body.appendChild(ta);
        ta.select();
        DOC.execCommand('copy');
        ta.remove();
        return true;
      }catch{ return false; }
    }
  }

  // run mode
  $('runPlay').addEventListener('click', ()=>{ state.run='play'; syncUI(); });
  $('runResearch').addEventListener('click', ()=>{ state.run='research'; syncUI(); });

  // diff/style chips
  DOC.querySelectorAll('[data-diff]').forEach(b=>{
    b.addEventListener('click', ()=>{ state.diff=String(b.dataset.diff); syncUI(); });
  });
  DOC.querySelectorAll('[data-style]').forEach(b=>{
    b.addEventListener('click', ()=>{ state.style=String(b.dataset.style); syncUI(); });
  });

  // time/seed
  $('timeSec').addEventListener('change', ()=>{
    state.time = clamp($('timeSec').value, 30, 180);
    syncUI();
  });
  $('seedTxt').addEventListener('change', ()=>{
    state.seed = String($('seedTxt').value||'').trim();
    syncUI();
  });
  $('btnSeedNow').addEventListener('click', ()=>{
    state.seed = String(Date.now());
    syncUI();
  });

  // AI
  $('aiOn').addEventListener('click', ()=>{ state.ai=true; syncUI(); });
  $('aiOff').addEventListener('click', ()=>{ state.ai=false; syncUI(); });

  // launch buttons
  $('btnPC').addEventListener('click', ()=> location.href = buildRunUrl('pc').toString());
  $('btnMobile').addEventListener('click', ()=> location.href = buildRunUrl('mobile').toString());
  $('btnCVR').addEventListener('click', ()=> location.href = buildRunUrl('cvr').toString());

  $('btnHub').addEventListener('click', ()=>{
    const hub = String(qs('hub','')||'');
    if (!hub){ alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå hub=...'); return; }
    location.href = hub;
  });

  $('btnCopy').addEventListener('click', async ()=>{
    const u = buildRunUrl('mobile').toString();
    const ok = await copyText(u);
    alert(ok ? '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå run ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ' : 'Copy ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  });

  // init defaults
  syncUI();
})();
</script>
</body>
</html>