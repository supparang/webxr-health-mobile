<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR ‚Äî FULL HTML (SAFE START + MORE GAMEPLAY SPACE)
- ‡πÑ‡∏°‡πà‡∏ù‡∏∑‡∏ô start logic: ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ goodjunk-vr.boot.js ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
- ‡πÄ‡∏û‡∏¥‡πà‡∏° Fatal Overlay ‡∏ö‡∏ô‡∏à‡∏≠: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ error ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Å‡πá‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
- ‡∏õ‡∏£‡∏±‡∏ö layout ‡πÉ‡∏´‡πâ gameplay ‡πÇ‡∏•‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô: HUD ‡∏ö‡∏≤‡∏á‡∏•‡∏á + Quest/Coach ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ö‡πÄ‡∏•‡πá‡∏Å + compact auto
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame core (‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÉ‡∏ä‡πâ Enter VR UI) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: particles ‡∏Å‡πà‡∏≠‡∏ô boot ‡πÄ‡∏™‡∏°‡∏≠ -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>

  <!-- Boot module -->
  <script type="module" src="./vr-goodjunk/goodjunk-vr.boot.js"></script>

  <style>
    :root{
      color-scheme: light dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;

      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);

      /* ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ gameplay ‡πÇ‡∏•‡πà‡∏á */
      --hudH: 44px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% -10%, rgba(59,130,246,.18), transparent 55%),
        radial-gradient(900px 600px at 70% 10%, rgba(34,197,94,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", "Noto Sans", Arial,
                   "Apple Color Emoji","Segoe UI Emoji";
    }

    /* ===== Gameplay layer (DOM targets spawn here) ===== */
    #gj-layer{
      position:fixed; inset:0;
      z-index:2;
      overflow:hidden;
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
    }

    /* ===== Top HUD (‡∏ö‡∏≤‡∏á‡∏•‡∏á) ===== */
    #hudTop, .hha-topbar, .hha-hud-top{
      position:fixed;
      left:12px; right:12px;
      top: calc(var(--safeTop) + 10px);
      height: var(--hudH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 6px 10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(2,6,23,.50);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      z-index:10;
      min-width:0;
    }
    .hud-group{ display:flex; align-items:center; gap:10px; min-width:0; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(15,23,42,.30);
      white-space:nowrap;
      min-width:0;
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 14px rgba(34,197,94,.55); }
    .kv{ display:flex; flex-direction:column; gap:1px; min-width:0; }
    .kv .label{ font-size:10px; color:var(--muted); letter-spacing:.06em; }
    .kv .big{ font-size:18px; font-weight:900; line-height:1; }

    /* ===== Fever mount (‡πÉ‡∏´‡πâ ui-fever.js ‡πÅ‡∏õ‡∏∞‡πÄ‡∏≠‡∏á) ===== */
    #feverMount{
      position:fixed;
      right:12px;
      top: calc(var(--safeTop) + 62px);
      z-index:10;
      pointer-events:auto;
    }

    /* ===== Coach bubble (‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á) ===== */
    #coachBox{
      position:fixed;
      left:12px;
      bottom: calc(var(--safeBottom) + 92px);
      z-index:10;
      max-width: min(70vw, 380px);
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 10px;
      border-radius:16px;
      background: rgba(2,6,23,.48);
      border: 1px solid rgba(148,163,184,.16);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 50px rgba(0,0,0,.28);
    }
    #coachImg{ width:36px; height:36px; object-fit:contain; }
    #coachText{
      font-size:12px;
      line-height:1.25;
      font-weight:800;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient: vertical;
    }

    /* ===== Quest pill (‡∏¢‡∏≤‡∏ß‡πÅ‡∏ï‡πà‡πÄ‡∏ï‡∏µ‡πâ‡∏¢) ===== */
    #questBox{
      position:fixed;
      left:12px; right:12px;
      bottom: calc(var(--safeBottom) + 12px);
      z-index:10;
      padding:10px 12px;
      border-radius:16px;
      background: rgba(2,6,23,.52);
      border: 1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 50px rgba(0,0,0,.30);
      max-height:78px;
      overflow:hidden;
      cursor:pointer;
    }
    #questTitle{
      font-size:13px;
      font-weight:900;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .qrow{ display:flex; gap:10px; align-items:center; margin-top:6px; }
    .bar{
      flex:1;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(148,163,184,.10);
      overflow:hidden;
      position:relative;
    }
    #questBar{
      position:absolute; inset:0 auto 0 0;
      width:0%;
      background: linear-gradient(90deg, rgba(34,197,94,.9), rgba(59,130,246,.85));
      border-radius:999px;
      box-shadow:0 0 18px rgba(59,130,246,.28);
    }
    #questNum{ font-size:12px; color:var(--muted); font-weight:800; white-space:nowrap; }

    /* ===== Compact mode: ‡∏¢‡∏∏‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á ===== */
    body.hha-compact #questBox{ max-height:44px; padding:8px 10px; opacity:.86; }
    body.hha-compact #coachBox{ opacity:.78; transform: translateY(6px); }
    body.hha-compact.hha-peek #questBox{ max-height:92px; opacity:1; }

    /* ===== Fatal overlay (‡πÇ‡∏ä‡∏ß‡πå error ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ===== */
    #hhaFatal{
      position:fixed; inset:0;
      display:none;
      z-index:9999;
      padding: 18px 14px calc(var(--safeBottom) + 18px);
      background: rgba(2,6,23,.92);
      backdrop-filter: blur(12px);
      color:#fff;
    }
    #hhaFatal .card{
      width:min(820px, 100%);
      margin: 0 auto;
      border:1px solid rgba(255,255,255,.12);
      border-radius:20px;
      background: rgba(15,23,42,.55);
      padding: 14px;
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
    }
    #hhaFatal h3{ margin:0 0 10px; font-size:18px; }
    #hhaFatal pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-size:12px;
      color: rgba(255,255,255,.92);
      line-height:1.35;
    }
    #hhaFatal .btn{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      background: rgba(255,255,255,.08);
      color:#fff;
      cursor:pointer;
    }
  </style>
</head>

<body>

  <!-- Gameplay layer -->
  <div id="gj-layer" aria-label="GoodJunk gameplay layer"></div>

  <!-- HUD top -->
  <div id="hudTop" class="hha-topbar" role="status" aria-label="HUD">
    <div class="hud-group" style="min-width:0">
      <div class="pill" title="Mode">
        <span class="dot" id="hudDot"></span>
        <span style="font-weight:1000;font-size:12px;letter-spacing:.06em;">MODE</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudGame" style="font-weight:1000;font-size:12px;">GOODJUNK</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudRun" style="font-weight:1000;font-size:12px;">PLAY</span>
      </div>
    </div>

    <div class="hud-group">
      <div class="pill">
        <div class="kv"><div class="label">SCORE</div><div class="big" id="hudScore">0</div></div>
      </div>
      <div class="pill">
        <div class="kv"><div class="label">COMBO MAX</div><div class="big" id="hudComboMax">0</div></div>
      </div>
      <div class="pill">
        <div class="kv"><div class="label">MISS</div><div class="big" id="hudMiss">0</div></div>
      </div>
    </div>
  </div>

  <!-- Fever mount -->
  <div id="feverMount"></div>

  <!-- Coach bubble -->
  <div id="coachBox" aria-live="polite">
    <img id="coachImg" src="./img/coach-neutral.png" alt="coach" />
    <div id="coachText">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏¢‡∏∞‡∏ô‡∏∞ üí™</div>
  </div>

  <!-- Quest pill -->
  <div id="questBox" title="‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ">
    <div id="questTitle">Goal: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‚Ä¶</div>
    <div class="qrow">
      <div class="bar"><i id="questBar"></i></div>
      <div id="questNum">0/0</div>
    </div>
  </div>

  <!-- Fatal overlay -->
  <div id="hhaFatal">
    <div class="card">
      <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡πÄ‡∏Å‡∏° (Fatal)</h3>
      <pre id="hhaFatalText">‚Äî</pre>
      <button class="btn" id="hhaFatalReload">‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤</button>
    </div>
  </div>

  <script>
    // ---- Fatal overlay: ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô error ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ----
    (function(){
      const box = document.getElementById('hhaFatal');
      const txt = document.getElementById('hhaFatalText');
      const btn = document.getElementById('hhaFatalReload');
      function show(msg){
        if(!box || !txt) return;
        txt.textContent = String(msg || 'Unknown error');
        box.style.display = 'block';
      }
      window.addEventListener('error', (e)=>{
        const m = (e && (e.message || e.error && e.error.stack)) || 'Unknown error';
        show(m);
      });
      window.addEventListener('unhandledrejection', (e)=>{
        const m = (e && (e.reason && (e.reason.stack || e.reason.message) || e.reason)) || 'Unhandled rejection';
        show(m);
      });
      if(btn) btn.onclick = ()=> location.reload();
    })();

    // ---- Compact/peek: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà gameplay ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á logic ‡πÄ‡∏Å‡∏° ----
    (function(){
      const body = document.body;
      const q = document.getElementById('questBox');

      function compact(on){ body.classList.toggle('hha-compact', !!on); }

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏¢‡∏¥‡∏á event ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏¢‡∏∏‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
      window.addEventListener('hha:start', ()=> compact(true));
      window.addEventListener('hha:end',   ()=> compact(false));

      // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏á hha:start: ‡∏£‡∏≠ 700ms ‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡πÇ‡∏ú‡∏•‡πà -> ‡∏¢‡∏∏‡∏ö
      setTimeout(()=>{
        const layer = document.getElementById('gj-layer');
        const hasTargets = layer && layer.children && layer.children.length > 0;
        if(hasTargets) compact(true);
      }, 700);

      // ‡πÅ‡∏ï‡∏∞ quest ‡πÄ‡∏û‡∏∑‡πà‡∏≠ peek 2 ‡∏ß‡∏¥
      if(q){
        q.addEventListener('click', ()=>{
          body.classList.add('hha-peek');
          clearTimeout(window.__hhaPeekT);
          window.__hhaPeekT = setTimeout(()=> body.classList.remove('hha-peek'), 2000);
        });
      }
    })();
  </script>

</body>
</html>