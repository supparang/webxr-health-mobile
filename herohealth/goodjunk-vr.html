<!-- === /herohealth/goodjunk-vr.html ===
     GoodJunkVR (PRODUCTION) ‚Äî H+ (FULL)
     ‚úÖ Boss attack overlays: #atk-ring #atk-laser
     ‚úÖ NEW: Storm overlay #atk-storm
     ‚úÖ RESTORE: FX binder (hha:fx / hha:fever / hha:bossPulse / hha:bossAtk)
     ‚úÖ RESTORE: Drag view pan (targets move with view, aim point sync)
     ‚úÖ Mobile auto-fit HUD (A15/A54) ‚Äî no cut off
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    :root{
      color-scheme: light dark;
      --bg-main:#020617;
      --panel:#020617;
      --panel-soft:#0b1120;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,0.18);
      --danger:#f97316;
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;

      --shakeAmp: 0px;
      --shakeDur: 0.24s;

      --kickAmp: 10px;
      --kickRot: 4deg;

      --ringSize: 420px;
      --ringGapStart: 40deg;
      --ringGapSize: 70deg;

      /* ‚úÖ view pan vars */
      --camX: 0px;
      --camY: 0px;

      /* safe area */
      --safeT: env(safe-area-inset-top, 0px);
      --safeR: env(safe-area-inset-right, 0px);
      --safeB: env(safe-area-inset-bottom, 0px);
      --safeL: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.22), transparent 55%),
        var(--bg-main);
      color:var(--text-main);
      overflow:hidden;
    }

    #game-root{
      position:fixed; inset:0;
      z-index:0;
      pointer-events:none;
    }

    /* ‚úÖ camera wrapper (pan + shake + kick) */
    #game-cam{
      position:absolute; inset:0;
      transform: translate3d(var(--camX), var(--camY), 0);
      will-change: transform, filter;
      pointer-events:none;
    }

    #game-cam.shake{ animation: gj-shake var(--shakeDur) linear infinite; }
    #game-cam.kick{ animation: gj-kick .22s ease-out 1; }
    #game-cam.shake.kick{
      animation: gj-shake var(--shakeDur) linear infinite, gj-kick .22s ease-out 1;
    }

    @keyframes gj-shake{
      0%   { transform: translate3d(calc(var(--camX) + (var(--shakeAmp) * 0.15)), calc(var(--camY) + (var(--shakeAmp) * -0.30)), 0); }
      20%  { transform: translate3d(calc(var(--camX) + (var(--shakeAmp) * -0.35)), calc(var(--camY) + (var(--shakeAmp) * 0.25)), 0); }
      45%  { transform: translate3d(calc(var(--camX) + (var(--shakeAmp) * 0.42)), calc(var(--camY) + (var(--shakeAmp) * 0.18)), 0); }
      70%  { transform: translate3d(calc(var(--camX) + (var(--shakeAmp) * -0.28)), calc(var(--camY) + (var(--shakeAmp) * -0.40)), 0); }
      100% { transform: translate3d(calc(var(--camX) + (var(--shakeAmp) * 0.12)), calc(var(--camY) + (var(--shakeAmp) * 0.30)), 0); }
    }
    @keyframes gj-kick{
      0%{ transform: translate3d(calc(var(--camX) + (var(--kickAmp) * 0.55)), calc(var(--camY) + (var(--kickAmp) * -0.45)), 0) rotate(calc(var(--kickRot) * -0.7)); }
      45%{ transform: translate3d(calc(var(--camX) + (var(--kickAmp) * -0.75)), calc(var(--camY) + (var(--kickAmp) * 0.55)), 0) rotate(var(--kickRot)); }
      100%{ transform: translate3d(var(--camX), var(--camY), 0) rotate(0deg); }
    }

    /* STUN fire overlay */
    #game-cam.stun-fire::before{
      content:"";
      position:absolute; inset:-12%;
      background:
        radial-gradient(circle at 25% 80%, rgba(255,120,0,0.22), transparent 52%),
        radial-gradient(circle at 55% 85%, rgba(255,200,0,0.18), transparent 55%),
        radial-gradient(circle at 80% 78%, rgba(255,40,0,0.20), transparent 55%),
        radial-gradient(circle at 50% 40%, rgba(255,255,255,0.06), transparent 60%);
      filter: blur(2px) saturate(1.2);
      mix-blend-mode: screen;
      opacity:0;
      animation: firePulse 0.55s ease-in-out infinite;
      pointer-events:none;
    }
    #game-cam.stun-fire::after{
      content:"";
      position:absolute; inset:0;
      border:2px solid rgba(255,120,0,0.45);
      box-shadow: 0 0 0 9999px rgba(2,6,23,0.05) inset;
      opacity:0;
      animation: fireEdge 0.38s linear infinite;
      pointer-events:none;
    }
    @keyframes firePulse{
      0%{ opacity:0.10; transform:translateY(0) scale(1); }
      50%{ opacity:0.28; transform:translateY(-6px) scale(1.02); }
      100%{ opacity:0.12; transform:translateY(0) scale(1); }
    }
    @keyframes fireEdge{
      0%{ opacity:0.20; }
      50%{ opacity:0.52; }
      100%{ opacity:0.20; }
    }

    /* Chromatic overlay */
    #fx-chroma{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      mix-blend-mode: screen;
      background:
        radial-gradient(circle at 40% 40%, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at 60% 60%, rgba(249,115,22,0.18), transparent 58%),
        linear-gradient(90deg, rgba(255,0,100,0.06), transparent 40%, rgba(0,255,220,0.06));
      filter: saturate(1.4) contrast(1.1);
    }
    #fx-chroma.show{ animation: chromaFlash .18s ease-out 1; }
    @keyframes chromaFlash{
      0%{ opacity:0.00; transform:scale(1); }
      30%{ opacity:0.55; transform:scale(1.01); }
      100%{ opacity:0.00; transform:scale(1); }
    }
    #fx-chroma.hero{
      background:
        radial-gradient(circle at 50% 60%, rgba(34,197,94,0.18), transparent 58%),
        radial-gradient(circle at 45% 45%, rgba(56,189,248,0.16), transparent 55%),
        linear-gradient(90deg, rgba(34,197,94,0.06), transparent 40%, rgba(56,189,248,0.06));
    }

    /* ===== H+ Boss Attack Overlay: RING ===== */
    #atk-ring{
      position:absolute;
      width: var(--ringSize);
      height: var(--ringSize);
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      pointer-events:none;
      z-index:7;
      opacity:0;
      filter: drop-shadow(0 0 18px rgba(251,191,36,0.22));
    }
    #atk-ring.show{ opacity:1; animation: ringPulse .22s ease-in-out infinite; }
    @keyframes ringPulse{
      0%{ transform: translate(-50%,-50%) scale(0.995); }
      50%{ transform: translate(-50%,-50%) scale(1.01); }
      100%{ transform: translate(-50%,-50%) scale(0.995); }
    }
    #atk-ring::before{
      content:"";
      position:absolute; inset:0;
      border-radius:999px;
      border: 4px dashed rgba(251,191,36,0.85);
      box-shadow: inset 0 0 18px rgba(251,191,36,0.16);
      opacity:0.95;
    }
    #atk-ring::after{
      content:"";
      position:absolute; inset:-10px;
      border-radius:999px;
      background:
        conic-gradient(
          from var(--ringGapStart),
          rgba(249,115,22,0.24) 0deg,
          rgba(249,115,22,0.24) calc(360deg - var(--ringGapSize)),
          rgba(0,0,0,0) calc(360deg - var(--ringGapSize)),
          rgba(0,0,0,0) 360deg
        );
      -webkit-mask:
        radial-gradient(circle, transparent 54%, #000 56%, #000 64%, transparent 66%);
      mask:
        radial-gradient(circle, transparent 54%, #000 56%, #000 64%, transparent 66%);
      box-shadow: 0 0 22px rgba(249,115,22,0.18);
    }

    /* ===== H+ Boss Attack Overlay: LASER ===== */
    #atk-laser{
      position:absolute;
      left:50%;
      top:50%;
      width: min(92vw, 900px);
      height: 18px;
      transform: translate(-50%,-50%);
      border-radius: 999px;
      background:
        linear-gradient(90deg,
          rgba(56,189,248,0.00),
          rgba(56,189,248,0.25),
          rgba(56,189,248,0.85),
          rgba(56,189,248,0.25),
          rgba(56,189,248,0.00)
        );
      box-shadow: 0 0 26px rgba(56,189,248,0.22);
      opacity:0;
      pointer-events:none;
      z-index:7;
    }
    #atk-laser.warn{
      opacity:0.85;
      animation: laserWarn .12s linear infinite;
    }
    #atk-laser.fire{
      opacity:1;
      height:26px;
      box-shadow: 0 0 36px rgba(56,189,248,0.45);
      filter: saturate(1.25);
      animation: none;
    }
    @keyframes laserWarn{
      0%{ transform: translate(-50%,-50%) scaleY(0.9); opacity:0.65; }
      50%{ transform: translate(-50%,-50%) scaleY(1.05); opacity:0.95; }
      100%{ transform: translate(-50%,-50%) scaleY(0.9); opacity:0.65; }
    }

    /* ‚úÖ NEW: STORM overlay */
    #atk-storm{
      position:absolute; inset:-8%;
      z-index:7;
      pointer-events:none;
      opacity:0;
      background:
        radial-gradient(circle at 50% 60%, rgba(168,85,247,0.12), transparent 60%),
        radial-gradient(circle at 20% 25%, rgba(56,189,248,0.12), transparent 55%),
        radial-gradient(circle at 80% 30%, rgba(34,197,94,0.10), transparent 55%);
      filter: blur(1px) saturate(1.15);
      mix-blend-mode: screen;
    }
    #atk-storm.show{
      opacity:1;
      animation: stormWaves .42s linear infinite;
    }
    #atk-storm::before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          115deg,
          rgba(255,255,255,0.00) 0px,
          rgba(255,255,255,0.00) 22px,
          rgba(255,255,255,0.06) 26px,
          rgba(255,255,255,0.00) 34px
        );
      opacity:.55;
      transform: translateX(0);
    }
    #atk-storm::after{
      content:"";
      position:absolute; inset:0;
      box-shadow: 0 0 0 9999px rgba(2,6,23,0.10) inset;
      border: 2px solid rgba(168,85,247,0.22);
      opacity:.85;
    }
    @keyframes stormWaves{
      0%{ transform: translate3d(0,0,0) rotate(0deg); }
      50%{ transform: translate3d(-10px,6px,0) rotate(-0.6deg); }
      100%{ transform: translate3d(0,0,0) rotate(0deg); }
    }

    a-scene{
      width:100vw; height:100vh;
      position:absolute; inset:0;
      z-index:0;
      pointer-events:auto;
    }

    /* DOM target layer */
    #gj-layer{
      position:absolute; inset:0;
      z-index:5;
      pointer-events:auto;
      touch-action:none;
    }

    /* Emoji sticker feel */
    .gj-target{
      position:absolute;
      transform: translate(-50%,-50%) scale(var(--tScale, 1)) rotate(var(--tRot, 0deg));
      font-size: clamp(48px, 8.4vw, 82px);
      line-height:1;
      user-select:none;
      pointer-events:auto;
      cursor:pointer;
      will-change: transform, left, top, opacity, filter;
      opacity:0;
      filter:
        drop-shadow(0 10px 18px rgba(0,0,0,0.58))
        drop-shadow(0 2px 0 rgba(255,255,255,0.10));
      transition: opacity .18s ease-out, transform .18s ease-out;
    }
    .gj-target.spawn{ opacity:1; }
    .gj-target.gone{ opacity:0; transform:translate(-50%,-50%) scale(0.72) rotate(var(--tRot, 0deg)); }

    .gj-junk{ filter: drop-shadow(0 14px 24px rgba(249,115,22,0.28)) drop-shadow(0 2px 0 rgba(255,255,255,0.08)); }
    .gj-gold{ filter: drop-shadow(0 16px 30px rgba(250,204,21,0.36)) drop-shadow(0 2px 0 rgba(255,255,255,0.10)); }
    .gj-fake{ filter: drop-shadow(0 14px 26px rgba(168,85,247,0.30)) drop-shadow(0 2px 0 rgba(255,255,255,0.09)); }
    .gj-power{ filter: drop-shadow(0 14px 26px rgba(56,189,248,0.32)) drop-shadow(0 2px 0 rgba(255,255,255,0.10)); }
    .gj-boss{
      font-size: clamp(62px, 11vw, 120px);
      filter: drop-shadow(0 20px 34px rgba(250,204,21,0.28)) drop-shadow(0 2px 0 rgba(255,255,255,0.12));
    }

    /* VORTEX */
    #stun-vortex{
      position:absolute;
      width:18px; height:18px;
      border-radius:999px;
      left:50%; top:62%;
      transform:translate(-50%,-50%);
      z-index:6;
      pointer-events:none;
      opacity:0;
    }
    #stun-vortex.show{ opacity:1; }
    #stun-vortex::before{
      content:"";
      position:absolute; inset:-44px;
      border-radius:999px;
      border:2px solid rgba(56,189,248,0.75);
      box-shadow:0 0 18px rgba(56,189,248,0.35), inset 0 0 18px rgba(56,189,248,0.20);
      animation: vortexSpin 1.15s linear infinite;
    }
    #stun-vortex::after{
      content:"";
      position:absolute; inset:-8px;
      border-radius:999px;
      background:rgba(56,189,248,0.95);
      box-shadow:0 0 18px rgba(56,189,248,0.85);
      animation: vortexPulse 0.42s ease-in-out infinite;
    }
    @keyframes vortexSpin{ from{ transform:rotate(0deg); } to{ transform:rotate(360deg);} }
    @keyframes vortexPulse{ 0%{transform:scale(0.9)} 50%{transform:scale(1.12)} 100%{transform:scale(0.9)} }

    /* Boss Beacon */
    #boss-beacon{
      position:absolute;
      left:50%; top:50%;
      width:18px; height:18px;
      border-radius:999px;
      transform:translate(-50%,-50%);
      z-index:7;
      pointer-events:none;
      opacity:0;
    }
    #boss-beacon.show{ opacity:1; }
    #boss-beacon::before{
      content:"";
      position:absolute; inset:-54px;
      border-radius:999px;
      border:2px dashed rgba(251,191,36,0.85);
      box-shadow:0 0 22px rgba(251,191,36,0.20), inset 0 0 18px rgba(251,191,36,0.12);
      animation: beaconSpin 0.9s linear infinite;
    }
    #boss-beacon::after{
      content:"";
      position:absolute; inset:-10px;
      border-radius:999px;
      background:rgba(251,191,36,0.96);
      box-shadow:0 0 22px rgba(251,191,36,0.95);
      animation: beaconPulse 0.28s ease-in-out infinite;
    }
    @keyframes beaconSpin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
    @keyframes beaconPulse{ 0%{transform:scale(0.86)} 50%{transform:scale(1.18)} 100%{transform:scale(0.86)} }

    /* ===== HUD ===== */
    .hud-root{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:650;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      padding: calc(10px + var(--safeT)) calc(10px + var(--safeR)) calc(14px + var(--safeB)) calc(10px + var(--safeL));
      gap:8px;
    }
    .hud-top{
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .hud-card{
      background:linear-gradient(135deg, rgba(15,23,42,0.94), rgba(15,23,42,0.78));
      border-radius:18px;
      padding:8px 10px;
      box-shadow:0 18px 40px rgba(15,23,42,0.65);
      border:1px solid rgba(148,163,184,0.18);
      pointer-events:auto;
      min-width:0; /* ‚úÖ allow shrink */
      max-width:100%;
      flex: 1 1 320px; /* ‚úÖ auto-fit */
    }

    .hud-main{ display:flex; gap:10px; align-items:center; margin-bottom:4px; flex-wrap:wrap; }
    .hud-main-title{ font-size:14px; font-weight:600; letter-spacing:.03em; text-transform:uppercase; color:var(--text-soft); }
    .hud-pill{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(15,118,110,0.2);
      border:1px solid rgba(45,212,191,0.4);
      color:#a5f3fc;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .hud-pill.research{
      background:rgba(37,99,235,0.18);
      border-color:rgba(59,130,246,0.55);
      color:#bfdbfe;
    }
    .hud-metrics{ display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start; }
    .metric{ min-width:92px; }
    .metric-label{ font-size:10px; text-transform:uppercase; letter-spacing:.06em; color:var(--text-soft); }
    .metric-value{ font-size:15px; font-weight:800; margin-top:2px; }
    .metric-value.accent{ color:var(--accent); }
    .metric-value.danger{ color:var(--danger); }

    .hud-quest{ font-size:12px; }
    .quest-title{ font-size:11px; text-transform:uppercase; letter-spacing:.12em; color:var(--text-soft); margin-bottom:2px; }
    .quest-main-label{ font-size:13px; font-weight:700; }
    .quest-mini-label{ font-size:12px; color:var(--text-soft); margin-top:4px; }
    .quest-progress-wrap{ margin-top:5px; display:flex; flex-direction:column; gap:4px; }
    .quest-bar{ position:relative; width:100%; height:4px; border-radius:999px; background:rgba(15,23,42,0.9); overflow:hidden; }
    .quest-bar-fill{ position:absolute; inset:0; width:0%; border-radius:999px; background:linear-gradient(90deg, var(--accent-soft), var(--accent)); transition:width .18s ease-out; }
    .quest-caption{ font-size:10px; color:var(--text-soft); display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap; }

    .hud-fever{ margin-top:6px; display:flex; flex-direction:column; gap:6px; }
    .fever-row{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .fever-label{ font-size:10px; letter-spacing:.14em; text-transform:uppercase; color:#9ca3af; font-weight:900; }
    .fever-bar{ width:140px; height:6px; border-radius:999px; background:rgba(15,23,42,0.9); overflow:hidden; border:1px solid rgba(148,163,184,0.18); }
    .fever-fill{ height:100%; width:0%; border-radius:999px; background:linear-gradient(90deg, rgba(250,204,21,0.25), rgba(250,204,21,0.95)); transition:width .16s ease-out; }
    .fever-pct{ font-size:10px; color:#fde68a; font-weight:900; min-width:44px; text-align:right; }
    .shield-row{ display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
    .shield-count{ font-weight:950; color:#93c5fd; }

    #hud-stun{
      display:none; align-items:center; gap:8px;
      font-weight:950; letter-spacing:.10em; text-transform:uppercase; font-size:11px;
      color:#fff7ed;
      background:linear-gradient(135deg, rgba(249,115,22,0.20), rgba(250,204,21,0.14));
      border:1px solid rgba(251,146,60,0.55);
      border-radius:999px;
      padding:4px 10px;
      box-shadow:0 0 22px rgba(249,115,22,0.18);
    }
    #hud-stun.show{ display:inline-flex; }
    #hud-stun .dot{
      width:8px; height:8px; border-radius:999px;
      background:#fb923c;
      box-shadow:0 0 12px rgba(249,115,22,0.85);
      animation: stunDot 0.22s linear infinite;
    }
    @keyframes stunDot{ 0%{transform:scale(1)} 50%{transform:scale(1.25)} 100%{transform:scale(1)} }

    .boss-wrap{ margin-top:6px; display:none; flex-direction:column; gap:4px; }
    .boss-wrap.show{ display:flex; }
    .boss-top{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .boss-name{ font-size:11px; font-weight:950; letter-spacing:.10em; text-transform:uppercase; color:#fde68a; }
    .boss-phase{ font-size:11px; font-weight:900; color:#93c5fd; }
    .boss-bar{ height:7px; border-radius:999px; background:rgba(15,23,42,0.9); border:1px solid rgba(148,163,184,0.18); overflow:hidden; }
    .boss-fill{ height:100%; width:0%; border-radius:999px; background:linear-gradient(90deg, rgba(251,191,36,0.22), rgba(251,191,36,0.98)); transition: width .14s ease-out; }

    .hud-bottom{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding-bottom: calc(72px + var(--safeB));
    }
    .coach-bubble{
      min-width:60%;
      max-width:680px;
      text-align:left;
      background:radial-gradient(circle at top left, rgba(52,211,153,0.18), transparent 55%), rgba(15,23,42,0.96);
      border-radius:999px;
      padding:8px 14px;
      border:1px solid rgba(52,211,153,0.45);
      font-size:13px;
      display:none;
      align-items:center;
      gap:8px;
      pointer-events:auto;
      position:relative;
      overflow:hidden;
      box-shadow:0 18px 40px rgba(15,23,42,0.65);
    }
    .coach-bubble.show{ display:flex; }
    .coach-emoji{
      width:40px; height:40px;
      border-radius:999px;
      background-size:cover;
      background-position:center;
      flex-shrink:0;
      box-shadow:0 0 12px rgba(16,185,129,0.8);
      animation:coach-idle 1.4s ease-in-out infinite;
    }
    @keyframes coach-idle{
      0%{ transform:translateY(0) scale(1); }
      30%{ transform:translateY(-2px) scale(1.03); }
      60%{ transform:translateY(1px) scale(0.99); }
      100%{ transform:translateY(0) scale(1); }
    }

    .vr-btn{
      position:fixed; right: calc(12px + var(--safeR)); bottom: calc(16px + var(--safeB));
      z-index:653;
      border-radius:999px;
      border:1px solid rgba(56,189,248,0.7);
      padding:8px 14px;
      font-size:12px;
      font-weight:800;
      cursor:pointer;
      background:radial-gradient(circle at top left, rgba(56,189,248,0.35), transparent 55%), rgba(15,23,42,0.96);
      color:#e0f2fe;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:0 14px 30px rgba(15,23,42,0.9);
    }
    .vr-btn span{ font-size:16px; }

    .countdown-overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      z-index:655;
      font-size:clamp(3rem, 10vw, 5rem);
      font-weight:900;
      color:#fbbf24;
      text-shadow:0 0 40px rgba(0,0,0,0.85);
      pointer-events:none;
      transition:opacity .25s ease-out, transform .25s ease-out;
    }
    .countdown-hidden{ opacity:0; visibility:hidden; transform:scale(0.8); }

    /* ‚úÖ Mobile auto-fit (A15/A54) */
    @media (max-width: 420px){
      .hud-root{ padding: calc(8px + var(--safeT)) calc(8px + var(--safeR)) calc(10px + var(--safeB)) calc(8px + var(--safeL)); }
      .hud-card{ padding: 7px 9px; border-radius:16px; flex-basis: 100%; }
      .hud-main-title{ font-size:12px; }
      .metric{ min-width:80px; }
      .metric-label{ font-size:9px; }
      .metric-value{ font-size:14px; }
      .hud-quest{ font-size:11px; }
      .quest-main-label{ font-size:12px; }
      .quest-mini-label{ font-size:11px; }
      .fever-bar{ width:116px; }
      .coach-bubble{ min-width: 92%; font-size:12px; }
      .vr-btn{ padding:7px 12px; font-size:11px; }
    }
  </style>

  <script src="./vr/particles.js"></script>
  <script src="./vr/ui-fever.js"></script>
  <script src="./vr/hha-summary.js"></script>
  <script src="./vr/hha-cloud-logger.js"></script>

  <script type="module">
    const $ = (sel) => document.querySelector(sel);
    function setBadge(ok, msg){
      const dot = $('#logdot');
      const text = $('#logtext');
      if (dot) dot.style.background = ok ? '#22c55e' : '#ef4444';
      if (text) text.textContent = msg;
    }

    async function loadBoot(){
      const candidates = [
        './vr-goodjunk/goodjunk-vr.boot.js',
        './vr-goodjunk/goodjunk-vr.boot.mjs',
        './vr-goodjunk/goodjunk.boot.js',
        './vr-goodjunk/goodjunk.safe.js'
      ];

      let lastErr = null;
      for (const p of candidates){
        try{
          const mod = await import(p);
          const bootFn = mod.boot || mod.start || mod.init || mod.default;
          if (typeof bootFn === 'function'){
            setBadge(true, 'boot: ' + p);
            bootFn();
            return;
          }
          lastErr = new Error('Boot loaded but no boot/start/init/default: ' + p);
        }catch(e){ lastErr = e; }
      }
      console.error('[GoodJunk] BOOT LOAD FAILED', lastErr);
      setBadge(false, 'boot failed: ' + (lastErr?.message || 'unknown'));
      const sub = $('#start-sub');
      if (sub) sub.textContent = '‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏π‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏ï‡∏£‡∏ß‡∏à path ./vr-goodjunk/goodjunk-vr.boot.js';
    }

    window.addEventListener('load', ()=>{ setBadge(false,'boot: loading‚Ä¶'); loadBoot(); });
  </script>
</head>

<body>
  <div id="game-root">
    <div id="game-cam">
      <a-scene embedded vr-mode-ui="enabled: false" renderer="colorManagement: true; physicallyCorrectLights: true">
        <a-entity id="gj-camera" camera look-controls="enabled: true" position="0 1.6 0"></a-entity>
        <a-entity light="type: ambient; intensity: 1.0"></a-entity>
        <a-entity light="type: directional; intensity: 0.7" position="1 2 1"></a-entity>
        <a-sky color="#061225"></a-sky>
      </a-scene>

      <div id="gj-layer" aria-label="GoodJunk Targets Layer"></div>

      <div id="stun-vortex" aria-hidden="true"></div>
      <div id="boss-beacon" aria-hidden="true"></div>

      <!-- H+ overlays -->
      <div id="atk-ring" aria-hidden="true"></div>
      <div id="atk-laser" aria-hidden="true"></div>
      <div id="atk-storm" aria-hidden="true"></div>

      <div id="fx-chroma" aria-hidden="true"></div>
    </div>
  </div>

  <!-- HUD -->
  <div class="hud-root" aria-label="HUD">
    <div class="hud-top">
      <div class="hud-card">
        <div class="hud-main">
          <div class="hud-main-title">GOODJUNK</div>
          <div class="hud-pill" id="hud-pill"><span>‚óè</span><span id="hud-run-label">PLAY</span></div>
          <div id="hud-stun"><span class="dot"></span><span>STUN</span></div>
        </div>

        <div class="hud-metrics">
          <div class="metric"><div class="metric-label">Score</div><div class="metric-value accent" id="hud-score">0</div></div>
          <div class="metric"><div class="metric-label">Combo Max</div><div class="metric-value" id="hud-combo">0</div></div>
          <div class="metric"><div class="metric-label">Miss</div><div class="metric-value danger" id="hud-miss">0</div></div>
          <div class="metric"><div class="metric-label">Time</div><div class="metric-value" id="hud-time-label">‚Äî</div></div>
        </div>

        <div style="margin-top:6px; font-size:11px; color:var(--text-soft);">
          Diff: <b id="hud-diff-label">NORMAL</b> ‚Ä¢ Challenge: <b id="hud-challenge-label">RUSH</b>
          <span style="margin-left:8px;">|</span>
          <span id="hud-judge" style="margin-left:8px; font-weight:900;">&nbsp;</span>
        </div>
      </div>

      <div class="hud-card hud-quest">
        <div class="quest-title">Quest</div>

        <div class="quest-main-label" id="hud-quest-main">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å</div>
        <div class="quest-progress-wrap">
          <div class="quest-bar"><div class="quest-bar-fill" id="hud-quest-main-bar"></div></div>
          <div class="quest-caption"><span id="hud-quest-main-caption">0 / 0</span><span id="hud-quest-hint"></span></div>
        </div>

        <div class="quest-mini-label" id="hud-quest-mini">Mini: ‚Äî</div>
        <div class="quest-progress-wrap">
          <div class="quest-bar"><div class="quest-bar-fill" id="hud-quest-mini-bar"></div></div>
          <div class="quest-caption"><span id="hud-quest-mini-caption">0 / 0</span><span id="hud-mini-count">mini ‡∏ú‡πà‡∏≤‡∏ô 0 ‚Ä¢ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà 1</span></div>
        </div>

        <div class="hud-fever">
          <div class="fever-row">
            <div class="fever-label">FEVER</div>
            <div class="fever-bar"><div class="fever-fill" id="fever-fill" style="width:0%"></div></div>
            <div class="fever-pct" id="fever-pct">0%</div>
          </div>
          <div class="shield-row"><div class="shield-label">üõ°Ô∏è</div><div>Shield</div><div class="shield-count" id="shield-count">0</div></div>

          <div class="boss-wrap" id="boss-wrap">
            <div class="boss-top"><div class="boss-name">BOSS</div><div class="boss-phase" id="boss-phase">P1</div></div>
            <div class="boss-bar"><div class="boss-fill" id="boss-fill" style="width:0%"></div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="hud-bottom">
      <div class="coach-bubble show" id="coach-bubble">
        <div class="coach-emoji" id="coach-emoji" style="background-image:url('./img/coach-neutral.png')"></div>
        <div style="display:flex; flex-direction:column; gap:2px;">
          <div style="font-size:11px; text-transform:uppercase; letter-spacing:.16em; color:#6ee7b7; font-weight:800;">Coach</div>
          <div id="coach-text">‡πÅ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏á‡∏î‡∏µ! ‡∏´‡∏•‡∏ö junk! ‚ö°</div>
        </div>
      </div>
    </div>
  </div>

  <div class="countdown-overlay countdown-hidden" id="start-countdown">3</div>
  <button class="vr-btn" id="btn-vr" type="button" aria-label="Enter VR"><span>ü•Ω</span> Enter VR</button>

  <div id="logbadge" style="position:fixed; left:calc(10px + var(--safeL)); bottom:calc(10px + var(--safeB)); z-index:690;
    background:rgba(15,23,42,0.88); border:1px solid rgba(148,163,184,0.22); border-radius:999px;
    padding:6px 10px; font-size:11px; color:#e5e7eb; display:flex; align-items:center; gap:8px;
    pointer-events:none; max-width:92vw; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
    <div id="logdot" style="width:8px;height:8px;border-radius:999px;background:#9ca3af;"></div>
    <div id="logtext">boot: loading‚Ä¶</div>
  </div>

  <!-- START overlay (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) -->
  <div class="start-overlay" id="start-overlay" style="position:fixed; inset:0; z-index:700; display:flex; align-items:center; justify-content:center; padding:18px;
    background:radial-gradient(circle at 50% 35%, rgba(34,197,94,0.18), transparent 55%), rgba(2,6,23,0.92);">
    <div class="start-card" style="width:min(560px, 96vw); border-radius:22px; background:linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.84));
      border:1px solid rgba(148,163,184,0.2); box-shadow:0 30px 80px rgba(0,0,0,0.55); padding:16px 16px 14px; text-align:left;">
      <h1 class="start-title" style="font-size:18px; font-weight:950; margin:0 0 6px; letter-spacing:.02em;">GoodJunk VR</h1>
      <p class="start-sub" id="start-sub" style="margin:0 0 12px; color:var(--text-soft); font-size:13px; line-height:1.35;">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å + ‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡∏ô‡∏™‡πå ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏° 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚úÖ
      </p>

      <div class="start-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <div>
          <div class="start-label" style="font-size:11px; color:var(--text-soft); text-transform:uppercase; letter-spacing:.14em;">Difficulty</div>
          <select id="sel-diff" style="width:100%; border-radius:12px; border:1px solid rgba(30,64,175,0.6); background:rgba(15,23,42,0.9); padding:7px 9px; color:var(--text-main); font-size:13px; outline:none;">
            <option value="easy">Easy</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div>
          <div class="start-label" style="font-size:11px; color:var(--text-soft); text-transform:uppercase; letter-spacing:.14em;">Challenge</div>
          <select id="sel-challenge" style="width:100%; border-radius:12px; border:1px solid rgba(30,64,175,0.6); background:rgba(15,23,42,0.9); padding:7px 9px; color:var(--text-main); font-size:13px; outline:none;">
            <option value="rush" selected>Rush</option>
            <option value="boss">Boss</option>
            <option value="survival">Survival</option>
          </select>
        </div>
      </div>

      <div class="start-row" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; margin-top:12px;">
        <button class="start-btn secondary" id="btn-start-2d" type="button" style="border-radius:999px; border:1px solid rgba(148,163,184,0.6);
          background:rgba(15,23,42,0.86); color:var(--text-main); font-weight:850; padding:10px 14px; cursor:pointer;">‚ñ∂ Start 2D</button>
        <button class="start-btn" id="btn-start-vr" type="button" style="border-radius:999px; border:1px solid rgba(187,247,208,0.9);
          background:linear-gradient(135deg,#22c55e,#16a34a); color:#052e16; padding:10px 14px; font-weight:950; cursor:pointer;">ü•Ω Start VR</button>
      </div>

      <div style="font-size:11px; color:var(--text-soft); margin-top:8px;">
        * ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å Hub ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô
      </div>
    </div>
  </div>

  <!-- SUMMARY overlay (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) -->
  <div class="sum-overlay" id="sum-overlay" style="position:fixed; inset:0; z-index:800; display:none; align-items:center; justify-content:center; padding:18px;
    background:radial-gradient(circle at 50% 35%, rgba(56,189,248,0.12), transparent 55%), rgba(2,6,23,0.92);">
    <div class="sum-card" style="width:min(560px, 96vw); border-radius:22px; background:linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.84));
      border:1px solid rgba(148,163,184,0.2); box-shadow:0 30px 80px rgba(0,0,0,0.55); padding:16px 16px 14px; text-align:left;">
      <h2 class="sum-title" style="margin:0 0 6px; font-size:18px; font-weight:950;">üéâ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß!</h2>
      <div style="color:var(--text-soft); font-size:13px;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ</div>

      <div class="sum-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
        <div class="sum-item" style="border:1px solid rgba(148,163,184,0.18); border-radius:14px; padding:10px; background:rgba(2,6,23,0.35);">
          <div class="sum-k" style="font-size:10px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-soft);">Score</div>
          <div class="sum-v" id="sum-score" style="font-size:16px; font-weight:950; margin-top:2px;">0</div>
        </div>
        <div class="sum-item" style="border:1px solid rgba(148,163,184,0.18); border-radius:14px; padding:10px; background:rgba(2,6,23,0.35);">
          <div class="sum-k" style="font-size:10px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-soft);">Good Hits</div>
          <div class="sum-v" id="sum-good" style="font-size:16px; font-weight:950; margin-top:2px;">0</div>
        </div>
        <div class="sum-item" style="border:1px solid rgba(148,163,184,0.18); border-radius:14px; padding:10px; background:rgba(2,6,23,0.35);">
          <div class="sum-k" style="font-size:10px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-soft);">Miss</div>
          <div class="sum-v" id="sum-miss" style="font-size:16px; font-weight:950; margin-top:2px;">0</div>
        </div>
        <div class="sum-item" style="border:1px solid rgba(148,163,184,0.18); border-radius:14px; padding:10px; background:rgba(2,6,23,0.35);">
          <div class="sum-k" style="font-size:10px; letter-spacing:.12em; text-transform:uppercase; color:var(--text-soft);">Combo Max</div>
          <div class="sum-v" id="sum-combo" style="font-size:16px; font-weight:950; margin-top:2px;">0</div>
        </div>
      </div>

      <div class="sum-row" style="display:flex; justify-content:flex-end; gap:10px; margin-top:12px; flex-wrap:wrap;">
        <button class="sum-btn" id="btn-replay" style="border-radius:999px; border:1px solid rgba(148,163,184,0.6); background:rgba(15,23,42,0.86);
          color:var(--text-main); font-weight:900; padding:10px 14px; cursor:pointer;">üîÅ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="sum-btn primary" id="btn-exit" style="border-radius:999px; border:1px solid rgba(187,247,208,0.9); background:linear-gradient(135deg,#22c55e,#16a34a);
          color:#052e16; font-weight:900; padding:10px 14px; cursor:pointer;">üè† ‡∏Å‡∏•‡∏±‡∏ö Hub</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ RESTORE: Drag view + Aim sync -->
  <script>
  (function(){
    const root = window;
    const cam = document.getElementById('game-cam');
    const layer = document.getElementById('gj-layer');

    const state = {
      x: 0, y: 0,
      down: false,
      pid: null,
      sx: 0, sy: 0,
      ox: 0, oy: 0,
      moved: false,
      maxX: 0,
      maxY: 0
    };

    function clamp(v,a,b){ v=Number(v)||0; return v<a?a:(v>b?b:v); }

    function computeBounds(){
      // clamp safe zone (feel like VR)
      const w = Math.max(320, innerWidth);
      const h = Math.max(480, innerHeight);
      state.maxX = Math.round(Math.min(140, w * 0.18)); // A15/A54 ok
      state.maxY = Math.round(Math.min(110, h * 0.12));
    }

    function apply(){
      if (!cam) return;
      document.documentElement.style.setProperty('--camX', (state.x|0) + 'px');
      document.documentElement.style.setProperty('--camY', (state.y|0) + 'px');

      // expose to game logic
      root.__GJ_VIEW_OFFSET__ = { x: state.x|0, y: state.y|0 };

      // aim point in WORLD coords under fixed crosshair (center-ish)
      // world point = screen point - camOffset
      root.__GJ_AIM_POINT__ = {
        x: ((innerWidth*0.5) - state.x)|0,
        y: ((innerHeight*0.62) - state.y)|0
      };
    }

    function shouldStartDrag(ev){
      const t = ev.target;
      if (!t) return true;
      // if tapping a target, don't drag
      if (t.classList && t.classList.contains('gj-target')) return false;
      // if inside HUD/buttons (pointer-events auto) won't reach here
      return true;
    }

    computeBounds();
    apply();
    window.addEventListener('resize', ()=>{ computeBounds(); apply(); }, { passive:true });

    // drag on empty space of targets layer
    layer.addEventListener('pointerdown', (ev)=>{
      if (!shouldStartDrag(ev)) return;
      state.down = true;
      state.pid = ev.pointerId;
      state.sx = ev.clientX; state.sy = ev.clientY;
      state.ox = state.x; state.oy = state.y;
      state.moved = false;
      try{ layer.setPointerCapture(ev.pointerId); }catch(_){}
    }, { passive:false });

    layer.addEventListener('pointermove', (ev)=>{
      if (!state.down || ev.pointerId !== state.pid) return;

      const dx = (ev.clientX - state.sx);
      const dy = (ev.clientY - state.sy);
      if (!state.moved && (Math.abs(dx) + Math.abs(dy)) > 8) state.moved = true;

      // drag => pan world
      state.x = clamp(state.ox + dx, -state.maxX, state.maxX);
      state.y = clamp(state.oy + dy, -state.maxY, state.maxY);
      apply();
      ev.preventDefault?.();
    }, { passive:false });

    function end(ev){
      if (!state.down || ev.pointerId !== state.pid) return;
      state.down = false;
      state.pid = null;
      apply();
    }
    layer.addEventListener('pointerup', end, { passive:true });
    layer.addEventListener('pointercancel', end, { passive:true });
  })();
  </script>

  <!-- ‚úÖ RESTORE: FX Binder (‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≠‡∏™‡∏±‡πà‡∏ô/‡πÑ‡∏ü STUN/‡∏ä‡∏±‡πâ‡∏ô‡∏ö‡∏≠‡∏™/‡∏û‡∏≤‡∏¢‡∏∏) -->
  <script>
  (function(){
    const $ = (s)=>document.querySelector(s);
    const cam = ()=> $('#game-cam');
    const chroma = ()=> $('#fx-chroma');
    const beacon = ()=> $('#boss-beacon');
    const storm = ()=> $('#atk-storm');

    function clamp(v,a,b){ v=Number(v)||0; return v<a?a:(v>b?b:v); }

    function kickFX(intensity){
      const el = cam(); if(!el) return;
      const amp = clamp(10 * (Number(intensity)||1), 6, 24);
      document.documentElement.style.setProperty('--kickAmp', amp.toFixed(1)+'px');
      document.documentElement.style.setProperty('--kickRot', clamp(4*(Number(intensity)||1), 2.5, 9).toFixed(1)+'deg');
      el.classList.remove('kick');
      void el.offsetWidth;
      el.classList.add('kick');
      setTimeout(()=>{ try{ el.classList.remove('kick'); }catch(_){} }, 240);
    }

    function chromaFX(ms, hero){
      const el = chroma(); if(!el) return;
      el.classList.toggle('hero', !!hero);
      el.classList.remove('show');
      void el.offsetWidth;
      el.classList.add('show');
      setTimeout(()=>{ try{ el.classList.remove('show'); }catch(_){} }, Math.max(90, (ms|0)||180));
    }

    window.addEventListener('hha:fx', (e)=>{
      const d = (e && e.detail) || {};
      const type = String(d.type||'');
      if (type === 'kick') kickFX(d.intensity || 1);
      if (type === 'chroma') chromaFX(d.ms || 180, false);
      if (type === 'hero') chromaFX(d.ms || 240, true);
    });

    window.addEventListener('hha:fever', (e)=>{
      const d = (e && e.detail) || {};
      const fever = clamp(d.fever, 0, 100);
      const stun = !!d.stunActive;

      // ‡∏™‡∏±‡πà‡∏ô‡∏ï‡∏≤‡∏° FEVER% (‡πÇ‡∏´‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏° %)
      const amp = (fever/100) * 6.7;
      document.documentElement.style.setProperty('--shakeAmp', amp.toFixed(2)+'px');

      const el = cam(); if(!el) return;
      if (stun || fever >= 25) el.classList.add('shake');
      else el.classList.remove('shake');

      el.classList.toggle('stun-fire', stun);

      // HUD stun pill
      const pill = document.getElementById('hud-stun');
      if (pill) pill.classList.toggle('show', stun);
    });

    window.addEventListener('hha:bossPulse', (e)=>{
      const d = (e && e.detail) || {};
      const el = beacon(); if(!el) return;
      const x = Number(d.x), y = Number(d.y);
      if (!Number.isFinite(x) || !Number.isFinite(y)) return;

      el.style.left = (x|0) + 'px';
      el.style.top  = (y|0) + 'px';
      el.classList.add('show');
      setTimeout(()=>{ try{ el.classList.remove('show'); }catch(_){} }, Math.max(200, (d.ttlMs|0) || 1200));
    });

    window.addEventListener('hha:bossAtk', (e)=>{
      const d = (e && e.detail) || {};
      const name = String(d.name||'');
      if (name === 'storm'){
        const el = storm(); if(!el) return;
        el.classList.add('show');
        setTimeout(()=>{ try{ el.classList.remove('show'); }catch(_){} }, 1300);
      }
      if (name === 'laser'){
        // extra "panic" on warn
        chromaFX(120, false);
        kickFX(0.85);
      }
    });
  })();
  </script>
</body>
</html>