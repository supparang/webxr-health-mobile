<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR ‚Äî FULL HTML (FIX: BOOT START + MORE GAMEPLAY SPACE)
‚úÖ Restore Start Overlay IDs that boot expects (prevents "black screen / no spawn")
‚úÖ No forced start logic in HTML (boot owns start)
‚úÖ Compact HUD/Quest/Coach for more gameplay space + Quest peek
‚úÖ Fatal overlay shows runtime errors on mobile
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (Enter VR button) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + optional logger + UI binders (IIFE) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>

  <!-- ‚úÖ Boot (module) -->
  <script type="module" src="./vr-goodjunk/goodjunk-vr.boot.js"></script>

  <style>
    :root{
      color-scheme: light dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;

      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);

      /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏° */
      --hudH: 44px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% -10%, rgba(59,130,246,.18), transparent 55%),
        radial-gradient(900px 600px at 70% 10%, rgba(34,197,94,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", "Noto Sans",
                   Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Optional A-Frame background behind DOM gameplay (safe) */
    .sceneWrap{
      position:fixed; inset:0;
      z-index:0;
      pointer-events:none;
    }
    a-scene{ width:100%; height:100%; }

    /* ===== Gameplay DOM layer (targets spawn here) ===== */
    #gj-layer{
      position:fixed; inset:0;
      z-index:2;
      overflow:hidden;
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
    }

    /* ===== Top HUD (thin) ===== */
    #hudTop, .hha-topbar, .hha-hud-top{
      position:fixed;
      left:12px; right:12px;
      top: calc(var(--safeTop) + 10px);
      height: var(--hudH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 6px 10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(2,6,23,.48);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      z-index:10;
      min-width:0;
    }
    .hud-group{ display:flex; align-items:center; gap:10px; min-width:0; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(15,23,42,.30);
      white-space:nowrap;
      min-width:0;
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 14px rgba(34,197,94,.55); }
    .kv{ display:flex; flex-direction:column; gap:1px; min-width:0; }
    .kv .label{ font-size:10px; color:var(--muted); letter-spacing:.06em; }
    .kv .big{ font-size:18px; font-weight:900; line-height:1; }

    /* ===== Coach bubble (small) ===== */
    #coachBox{
      position:fixed;
      left:12px;
      bottom: calc(var(--safeBottom) + 92px);
      z-index:10;
      max-width: min(70vw, 380px);
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 10px;
      border-radius:16px;
      background: rgba(2,6,23,.48);
      border: 1px solid rgba(148,163,184,.16);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 50px rgba(0,0,0,.28);
      pointer-events:none; /* ‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤ */
    }
    #coachImg{ width:36px; height:36px; object-fit:contain; }
    #coachText{
      font-size:12px;
      line-height:1.25;
      font-weight:800;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient: vertical;
    }

    /* ===== Quest pill (bottom, low height) ===== */
    #questBox{
      position:fixed;
      left:12px; right:12px;
      bottom: calc(var(--safeBottom) + 12px);
      z-index:10;
      padding:10px 12px;
      border-radius:16px;
      background: rgba(2,6,23,.52);
      border: 1px solid rgba(148,163,184,.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 50px rgba(0,0,0,.30);
      max-height:78px;
      overflow:hidden;
      cursor:pointer;
    }
    #questTitle{
      font-size:13px;
      font-weight:900;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .qrow{ display:flex; gap:10px; align-items:center; margin-top:6px; }
    .bar{
      flex:1;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(148,163,184,.10);
      overflow:hidden;
      position:relative;
    }
    #questBar{
      position:absolute; inset:0 auto 0 0;
      width:0%;
      background: linear-gradient(90deg, rgba(34,197,94,.9), rgba(59,130,246,.85));
      border-radius:999px;
      box-shadow:0 0 18px rgba(59,130,246,.28);
    }
    #questNum{ font-size:12px; color:var(--muted); font-weight:800; white-space:nowrap; }

    /* ===== Compact mode (during gameplay) ===== */
    body.hha-compact #questBox{ max-height:44px; padding:8px 10px; opacity:.86; }
    body.hha-compact #coachBox{ opacity:.78; transform: translateY(6px); }
    body.hha-compact.hha-peek #questBox{ max-height:92px; opacity:1; }

    /* ===== Start Overlay (RESTORED IDs) ===== */
    #startOverlay{
      position:fixed; inset:0;
      z-index:30;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: 22px 16px calc(var(--safeBottom) + 18px);
      background: radial-gradient(900px 500px at 50% 5%, rgba(59,130,246,.18), transparent 60%),
                  rgba(2,6,23,.78);
      backdrop-filter: blur(12px);
    }
    .startCard{
      width:min(640px, 100%);
      border:1px solid var(--stroke);
      border-radius:24px;
      background: rgba(2,6,23,.68);
      box-shadow: 0 18px 70px rgba(0,0,0,.45);
      padding: 16px 16px 14px;
    }
    .startTitle{ font-size:20px; font-weight:1000; margin:0 0 6px 0; }
    .startSub{ margin:0 0 12px 0; color:var(--muted); font-size:13px; line-height:1.3; }
    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      appearance:none;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.45);
      color:var(--text);
      border-radius:14px;
      padding: 12px 14px;
      font-weight:1000;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
    }
    .btn.primary{
      border-color: rgba(34,197,94,.35);
      background: linear-gradient(180deg, rgba(34,197,94,.28), rgba(34,197,94,.10));
    }
    .btn.ghost{ background: rgba(2,6,23,.30); }
    .btn:active{ transform: translateY(1px); }

    /* ===== End Overlay (keep IDs for summary) ===== */
    #endOverlay{
      position:fixed; inset:0;
      z-index:40;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px 14px;
      background: rgba(2,6,23,.78);
      backdrop-filter: blur(14px);
    }

    /* ===== Fatal overlay (mobile debug) ===== */
    #hhaFatal{
      position:fixed; inset:0;
      display:none;
      z-index:9999;
      padding: 18px 14px calc(var(--safeBottom) + 18px);
      background: rgba(2,6,23,.92);
      backdrop-filter: blur(12px);
      color:#fff;
    }
    #hhaFatal .card{
      width:min(820px, 100%);
      margin: 0 auto;
      border:1px solid rgba(255,255,255,.12);
      border-radius:20px;
      background: rgba(15,23,42,.55);
      padding: 14px;
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
    }
    #hhaFatal h3{ margin:0 0 10px; font-size:18px; }
    #hhaFatal pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-size:12px;
      color: rgba(255,255,255,.92);
      line-height:1.35;
    }
    #hhaFatal .btn{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      padding:10px 12px;
      font-weight:1000;
      background: rgba(255,255,255,.08);
      color:#fff;
      cursor:pointer;
    }

    @media (max-width: 420px){
      .pill{ padding:6px 8px; }
      .kv .big{ font-size:17px; }
    }
  </style>
</head>

<body>

  <!-- Optional A-Frame background -->
  <div class="sceneWrap" aria-hidden="true">
    <a-scene embedded renderer="antialias: true; colorManagement: true" vr-mode-ui="enabled: true">
      <a-entity camera position="0 1.6 0" look-controls="enabled:true"></a-entity>
      <a-sky color="#050b1a"></a-sky>
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 2 1"></a-entity>
    </a-scene>
  </div>

  <!-- Gameplay DOM layer -->
  <div id="gj-layer" aria-label="GoodJunk gameplay layer"></div>

  <!-- HUD -->
  <div id="hudTop" class="hha-topbar" role="status" aria-label="HUD">
    <div class="hud-group" style="min-width:0">
      <div class="pill" title="Mode">
        <span class="dot" id="hudDot"></span>
        <span style="font-weight:1000;font-size:12px;letter-spacing:.06em;">MODE</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudGame" style="font-weight:1000;font-size:12px;">GOODJUNK</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudRun" style="font-weight:1000;font-size:12px;">PLAY</span>
      </div>
    </div>

    <div class="hud-group">
      <div class="pill"><div class="kv"><div class="label">SCORE</div><div class="big" id="hudScore">0</div></div></div>
      <div class="pill"><div class="kv"><div class="label">COMBO MAX</div><div class="big" id="hudComboMax">0</div></div></div>
      <div class="pill"><div class="kv"><div class="label">MISS</div><div class="big" id="hudMiss">0</div></div></div>
    </div>
  </div>

  <!-- Coach -->
  <div id="coachBox" aria-live="polite">
    <img id="coachImg" src="./img/coach-neutral.png" alt="coach" />
    <div id="coachText">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏¢‡∏∞‡∏ô‡∏∞ üí™</div>
  </div>

  <!-- Quest -->
  <div id="questBox" title="‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ">
    <div id="questTitle">Goal: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‚Ä¶</div>
    <div class="qrow">
      <div class="bar"><i id="questBar"></i></div>
      <div id="questNum">0/0</div>
    </div>
  </div>

  <!-- Start Overlay (RESTORED for boot) -->
  <div id="startOverlay">
    <div class="startCard">
      <h1 class="startTitle">GoodJunk VR ü•¶üóëÔ∏è</h1>
      <p class="startSub">
        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß UI ‡∏à‡∏∞‡∏¢‡∏∏‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô<br/>
        (‡πÅ‡∏ï‡∏∞‡πÅ‡∏ñ‡∏ö Goal ‡πÄ‡∏û‡∏∑‡πà‡∏≠ peek 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
      </p>
      <div class="btnRow">
        <!-- ‚úÖ IDs ‡∏ó‡∏µ‡πà boot ‡∏°‡∏±‡∏Å‡πÉ‡∏ä‡πâ -->
        <button id="btnStart" class="btn primary">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <button id="btnEnterVR" class="btn ghost">ü•Ω Enter VR</button>
      </div>
    </div>
  </div>

  <!-- End Overlay (‡πÉ‡∏´‡πâ boot/hud ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏≠‡∏á) -->
  <div id="endOverlay" aria-hidden="true"></div>

  <!-- Fatal -->
  <div id="hhaFatal">
    <div class="card">
      <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡πÄ‡∏Å‡∏° (Fatal)</h3>
      <pre id="hhaFatalText">‚Äî</pre>
      <button class="btn" id="hhaFatalReload">‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤</button>
    </div>
  </div>

  <script>
    // Fatal overlay
    (function(){
      const box = document.getElementById('hhaFatal');
      const txt = document.getElementById('hhaFatalText');
      const btn = document.getElementById('hhaFatalReload');
      function show(msg){
        if(!box || !txt) return;
        txt.textContent = String(msg || 'Unknown error');
        box.style.display = 'block';
      }
      window.addEventListener('error', (e)=>{
        const m = (e && (e.message || (e.error && e.error.stack))) || 'Unknown error';
        show(m);
      });
      window.addEventListener('unhandledrejection', (e)=>{
        const m = (e && (e.reason && (e.reason.stack || e.reason.message) || e.reason)) || 'Unhandled rejection';
        show(m);
      });
      if(btn) btn.onclick = ()=> location.reload();
    })();

    // Compact/peek only (no start logic)
    (function(){
      const body = document.body;
      const q = document.getElementById('questBox');

      function compact(on){ body.classList.toggle('hha-compact', !!on); }

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏¢‡∏¥‡∏á event ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      window.addEventListener('hha:start', ()=> compact(true));
      window.addEventListener('hha:end',   ()=> compact(false));

      // ‡πÅ‡∏ï‡∏∞ quest ‡πÄ‡∏û‡∏∑‡πà‡∏≠ peek
      if(q){
        q.addEventListener('click', ()=>{
          body.classList.add('hha-peek');
          clearTimeout(window.__hhaPeekT);
          window.__hhaPeekT = setTimeout(()=> body.classList.remove('hha-peek'), 2000);
        });
      }
    })();
  </script>

</body>
</html>