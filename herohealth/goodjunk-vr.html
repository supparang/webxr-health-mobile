<!-- === /herohealth/goodjunk-vr.html ===
HeroHealth ‚Äî GoodJunkVR ROOT LAUNCHER (Warmup Gate + Zone Status)
‚úÖ Path: /herohealth/goodjunk-vr.html  (THIS is the launcher)
‚úÖ Sends to Warmup Gate when Nutrition zone NOT done today
‚úÖ If Nutrition done today -> goes straight to run (still can choose Warmup manually)
‚úÖ Shows daily status for: nutrition / hygiene / fitness (NOT DONE vs DONE TODAY)
‚úÖ Pass-through ctx: pid,run,diff,time,seed,studyId,phase,conditionGroup,log,view (+ keeps any extra params)
‚úÖ Does NOT override view if already provided (per your rule)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR (Launcher)</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.70);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;

      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --cyan:#22d3ee; --violet:#a78bfa; --pink:#ff4fd8;

      --radius:22px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      background:
        radial-gradient(1200px 700px at 12% 12%, rgba(34,197,94,.16), transparent 55%),
        radial-gradient(1000px 600px at 82% 20%, rgba(34,211,238,.14), transparent 55%),
        radial-gradient(900px 520px at 55% 92%, rgba(255,79,216,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      overflow:auto;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:980px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }

    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      flex-wrap:wrap;
      padding: 6px 6px 0;
    }
    .brand{ display:flex; flex-direction:column; gap:6px; }
    .title{
      margin:0;
      font-size: clamp(22px, 2.2vw, 30px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.4;
      max-width: 78ch;
    }

    .panel{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .head{
      padding: 12px 14px;
      border-bottom:1px solid var(--stroke);
      background: rgba(2,6,23,.35);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .pillrow{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .pill{
      background: rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(8px);
      white-space:nowrap;
      user-select:none;
    }
    .pill b{ color:var(--text); font-weight:900; }

    .body{
      padding: 12px 12px 14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 12px;
    }
    @media (max-width: 900px){
      .body{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      border-radius: 18px;
      padding: 14px;
      position:relative;
      overflow:hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,.22);
      min-height: 160px;
    }
    .card h3{ margin:0 0 6px 0; font-size: 16px; letter-spacing:.2px; }
    .card p{ margin:0; color:var(--muted); font-size: 13px; line-height:1.45; }

    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.46);
      padding: 12px 12px;
      border-radius: 16px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, opacity .12s ease, border-color .12s ease, background .12s ease;
      display:flex; align-items:center; gap:10px;
      white-space:nowrap;
      font-weight:1000;
      font-size: 13px;
    }
    .btn:hover{ border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .btn:active{ transform: translateY(1px); }
    .btn.good{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.10); }
    .btn.cyan{ border-color: rgba(34,211,238,.28); background: rgba(34,211,238,.10); }
    .btn.warn{ border-color: rgba(245,158,11,.28); background: rgba(245,158,11,.10); }
    .btn.ghost{ color: var(--muted); }
    .btn.disabled{ opacity:.55; cursor:not-allowed; transform:none !important; }

    .zoneGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .zoneLine{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.34);
      padding: 10px 10px;
      border-radius: 14px;
      font-size: 13px;
    }
    .dot{
      width:10px; height:10px; border-radius: 999px;
      background: var(--warn);
      box-shadow: 0 0 16px rgba(245,158,11,.35);
      flex: 0 0 auto;
    }
    .zoneLine.ok .dot{ background: var(--good); box-shadow: 0 0 16px rgba(34,197,94,.35); }
    .zoneLeft{ display:flex; align-items:center; gap:10px; }
    .zoneName{ font-weight:1000; letter-spacing:.2px; }
    .zoneVal{ color: var(--muted); font-weight:900; }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .note{
      margin-top: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(2,6,23,.30);
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + var(--sab));
      transform: translateX(-50%);
      background: rgba(2,6,23,.85);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      z-index: 9999;
      max-width: 92vw;
      font-size: 13px;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1 class="title">üç≠ GoodJunk VR ‚Äî Launcher</h1>
        <p class="subtitle">
          ‡∏ñ‡πâ‡∏≤ <b>Nutrition ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà DONE ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b> ‚Üí ‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ <b>Warmup Gate 20 ‡∏ß‡∏¥</b> ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πà‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á<br/>
          ‡∏ñ‡πâ‡∏≤ DONE ‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πà‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Warmup ‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ)
        </p>
      </div>
      <div class="pillrow" id="pillrow"></div>
    </div>

    <section class="panel" aria-label="Launcher">
      <div class="head">
        <div class="pillrow">
          <span class="pill"><b>today</b>: <span id="todayText">‚Äî</span></span>
          <span class="pill"><b>zone</b>: nutrition</span>
          <span class="pill"><b>launcher</b>: /herohealth/goodjunk-vr.html</span>
        </div>
        <div class="pillrow">
          <span class="pill"><b>run</b>: <span class="mono" id="runPath">‚Äî</span></span>
        </div>
      </div>

      <div class="body">
        <!-- LEFT: main actions -->
        <div class="card">
          <h3>üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô</h3>
          <p id="gateText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Daily Gate‚Ä¶</p>

          <div class="btnrow">
            <button class="btn good" id="btnPlayAuto">‚ñ∂Ô∏è Play (Auto Gate)</button>
            <button class="btn cyan" id="btnWarmup">‚öîÔ∏è Warmup Gate</button>
            <button class="btn warn" id="btnRunOnly">üéØ Run (Skip Gate)</button>
            <button class="btn ghost" id="btnHub">üè† ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
          </div>

          <div class="note">
            <div><b>Auto Gate rule:</b> ‡∏ñ‡πâ‡∏≤ nutrition <b>NOT DONE</b> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Üí ‡∏™‡πà‡∏á‡πÑ‡∏õ <span class="mono">warmup-gate.html</span> (autonext=1)</div>
            <div style="margin-top:6px;"><b>Skip Gate:</b> ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö/‡∏î‡∏µ‡∏ö‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞ research)</div>
          </div>

          <div class="note" id="routeNote"></div>
        </div>

        <!-- RIGHT: zone status -->
        <div class="card">
          <h3>üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‚Äù</h3>
          <p>‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏° localStorage ‡∏£‡∏≤‡∏¢‡πÇ‡∏ã‡∏ô (DONE TODAY / NOT DONE)</p>

          <div class="zoneGrid">
            <div class="zoneLine" id="zNutrition">
              <div class="zoneLeft"><span class="dot"></span><span class="zoneName">ü•ó Nutrition</span></div>
              <div class="zoneVal" id="vNutrition">‚Äî</div>
            </div>
            <div class="zoneLine" id="zHygiene">
              <div class="zoneLeft"><span class="dot"></span><span class="zoneName">üßº Hygiene</span></div>
              <div class="zoneVal" id="vHygiene">‚Äî</div>
            </div>
            <div class="zoneLine" id="zFitness">
              <div class="zoneLeft"><span class="dot"></span><span class="zoneName">üèÉ Fitness</span></div>
              <div class="zoneVal" id="vFitness">‚Äî</div>
            </div>
          </div>

          <div class="btnrow" style="margin-top:12px;">
            <button class="btn ghost" id="btnResetToday">‚ôªÔ∏è Reset today (‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô)</button>
          </div>

          <div class="note">
            Key ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <span class="mono">HHA_ZONE_DONE::&lt;zone&gt;::YYYY-MM-DD</span><br/>
            ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£ ‚ÄúDONE‚Äù ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏î‡∏¢ <b>‡∏î‡πà‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á/‡∏Ñ‡∏π‡∏•‡∏î‡∏≤‡∏ß‡∏ô‡πå</b> (‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡πá‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏™‡πà‡πÉ‡∏ô run)
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  // -----------------------------
  // constants
  // -----------------------------
  const ZONE = 'nutrition';
  const RUN_PATH = './vr-goodjunk/goodjunk-vr.html';
  const WARMUP_GATE = './warmup-gate.html';
  const DEFAULT_WARMUP_SEC = 20;
  const DEFAULT_COOLDOWN_SEC = 20;

  // -----------------------------
  // helpers: QS / URL
  // -----------------------------
  function pageUrl(){ return location.href.split('#')[0]; }
  function parseQS(){ try{ return new URL(pageUrl()).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = parseQS();

  function q(k, def=''){ const v = QS.get(k); return (v==null ? def : v); }

  function ymdLocal(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  function zoneDoneKey(zone){ return `HHA_ZONE_DONE::${zone}::${ymdLocal()}`; }
  function isZoneDoneToday(zone){
    try{ return localStorage.getItem(zoneDoneKey(zone)) === '1'; }catch(_){ return false; }
  }
  function clearZoneToday(zone){
    try{ localStorage.removeItem(zoneDoneKey(zone)); }catch(_){}
  }

  // Build URL with passthrough: keep ALL params except a deny set (we don't want to forward "next/hub/phase/dur/..." from gate)
  function buildUrl(base, add){
    const u = new URL(base, location.href);
    // add explicit extras
    Object.entries(add||{}).forEach(([k,v])=>{
      if(v===undefined || v===null || String(v).trim()==='') return;
      u.searchParams.set(k, String(v));
    });
    return u.toString();
  }

  // passthrough all current params EXCEPT those that are gate-routing internals
  function getPassthrough(){
    const deny = new Set([
      'next','hub','phase','dur','cdur','games','autonext','wmode'
    ]);
    const out = {};
    QS.forEach((v,k)=>{ if(!deny.has(k)) out[k]=v; });
    return out;
  }

  // always ensure hub param (for return)
  function resolveHub(){
    const hub = (q('hub','')||'').trim();
    if(hub) return hub;
    // fallback: if came from hub.html without hub param, set hub to /herohealth/hub.html
    // (safe default; you can change to './hub.html' if your hub is in /herohealth)
    return './hub.html';
  }

  // toast
  const toastEl = document.getElementById('toast');
  let toastTimer=null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    toastTimer = setTimeout(()=> toastEl.classList.remove('show'), 1400);
  }

  // pills (ctx display)
  function renderPills(){
    const keys = ['pid','run','diff','time','seed','studyId','phase','conditionGroup','log','view'];
    const pills = keys
      .map(k => [k, QS.get(k)])
      .filter(x => x[1]!=null && String(x[1]).trim()!=='')
      .slice(0, 12);

    const el = document.getElementById('pillrow');
    el.innerHTML = (pills.length ? pills : [['ctx','none']])
      .map(([k,v]) => `<span class="pill"><b>${k}</b>: ${String(v).replace(/</g,'&lt;')}</span>`)
      .join('');
  }

  // zone status UI
  function setZoneLine(lineId, valId, done){
    const line = document.getElementById(lineId);
    const val = document.getElementById(valId);
    if(!line || !val) return;
    line.classList.toggle('ok', !!done);
    val.textContent = done ? 'DONE TODAY' : 'NOT DONE';
  }

  function syncZoneStatus(){
    document.getElementById('todayText').textContent = ymdLocal();

    const nut = isZoneDoneToday('nutrition');
    const hyg = isZoneDoneToday('hygiene');
    const fit = isZoneDoneToday('fitness');

    setZoneLine('zNutrition','vNutrition', nut);
    setZoneLine('zHygiene','vHygiene', hyg);
    setZoneLine('zFitness','vFitness', fit);

    return { nut, hyg, fit };
  }

  // route note
  function renderRouteNote(nutDone){
    const hub = resolveHub();
    const warm = Math.max(5, Math.min(60, Number(q('dur', String(DEFAULT_WARMUP_SEC))) || DEFAULT_WARMUP_SEC));
    const cdur = Math.max(5, Math.min(60, Number(q('cdur', String(DEFAULT_COOLDOWN_SEC))) || DEFAULT_COOLDOWN_SEC));

    const note = document.getElementById('routeNote');
    const gateText = document.getElementById('gateText');
    const runPath = document.getElementById('runPath');
    runPath.textContent = RUN_PATH;

    gateText.innerHTML = nutDone
      ? `‚úÖ Nutrition <b>DONE TODAY</b> ‚Äî ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞ Warmup ‡∏ã‡πâ‡∏≥‡∏Å‡πá‡πÑ‡∏î‡πâ)`
      : `‚ö†Ô∏è Nutrition <b>NOT DONE</b> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô <b>Warmup Gate</b> ‡∏Å‡πà‡∏≠‡∏ô`;

    // preview where buttons go
    const nextRun = buildUrl(RUN_PATH, { ...getPassthrough(), hub });
    const toWarmup = buildUrl(WARMUP_GATE, {
      ...getPassthrough(),
      phase: 'warmup',
      autonext: 1,
      dur: warm,
      cdur: cdur,
      hub,
      next: nextRun
    });

    note.innerHTML = `
      <b>Route preview</b><br/>
      hub: <span class="mono">${hub.replace(/</g,'&lt;')}</span><br/>
      warmup: <span class="mono">${toWarmup.replace(/</g,'&lt;')}</span><br/>
      run: <span class="mono">${nextRun.replace(/</g,'&lt;')}</span>
    `;
  }

  // navigation actions
  function goHub(){
    const hub = resolveHub();
    location.href = hub;
  }

  function goRun(){
    const hub = resolveHub();
    const url = buildUrl(RUN_PATH, { ...getPassthrough(), hub });
    location.href = url;
  }

  function goWarmupGate(){
    const hub = resolveHub();
    const warm = Math.max(5, Math.min(60, Number(q('dur', String(DEFAULT_WARMUP_SEC))) || DEFAULT_WARMUP_SEC));
    const cdur = Math.max(5, Math.min(60, Number(q('cdur', String(DEFAULT_COOLDOWN_SEC))) || DEFAULT_COOLDOWN_SEC));

    const nextRun = buildUrl(RUN_PATH, { ...getPassthrough(), hub });
    const url = buildUrl(WARMUP_GATE, {
      ...getPassthrough(),
      phase: 'warmup',
      autonext: 1,
      dur: warm,
      cdur: cdur,
      hub,
      next: nextRun
    });
    location.href = url;
  }

  function goAuto(){
    // Auto Gate rule: if zone not done -> warmup, else run
    const nutDone = isZoneDoneToday('nutrition');
    if(nutDone) goRun();
    else goWarmupGate();
  }

  // -----------------------------
  // init
  // -----------------------------
  renderPills();
  const st = syncZoneStatus();
  renderRouteNote(st.nut);

  // buttons
  document.getElementById('btnHub').addEventListener('click', goHub);
  document.getElementById('btnRunOnly').addEventListener('click', ()=>{
    toast('Skip Gate ‚Üí Run (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)');
    setTimeout(goRun, 220);
  });
  document.getElementById('btnWarmup').addEventListener('click', goWarmupGate);
  document.getElementById('btnPlayAuto').addEventListener('click', goAuto);

  document.getElementById('btnResetToday').addEventListener('click', ()=>{
    clearZoneToday('nutrition');
    clearZoneToday('hygiene');
    clearZoneToday('fitness');
    syncZoneStatus();
    renderRouteNote(false);
    toast('Reset today ‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô)');
  });

  // Optional: if user passes ?autostart=1 -> apply auto immediately (good for kiosk)
  const autostart = String(q('autostart','0')||'0') === '1';
  if(autostart){
    setTimeout(goAuto, 350);
  }

})();
</script>

</body>
</html>