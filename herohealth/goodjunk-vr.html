<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR LAUNCHER — ROOT (Production)
✅ Redirects to ./vr-goodjunk/goodjunk-vr.html
✅ Auto-detect view (only if no ?view= set)
✅ Pass-through: hub/run/diff/time/seed/studyId/phase/conditionGroup/log/v/style
✅ Never override an explicit ?view=
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GoodJunkVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --radius:22px;
      --sat: env(safe-area-inset-top,0px);
      --sab: env(safe-area-inset-bottom,0px);
    }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 15%, rgba(34,197,94,.14), transparent 55%),
                  radial-gradient(900px 600px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(16px + var(--sat)) 16px calc(16px + var(--sab));
    }
    .card{
      width:min(560px, 92vw);
      border-radius: 26px;
      background: var(--panel);
      border:1px solid var(--stroke);
      box-shadow: 0 22px 60px rgba(0,0,0,.40);
      padding: 18px 18px;
    }
    h1{ margin:0; font-size:22px; font-weight:950; }
    p{ margin:10px 0 0; opacity:.78; }
    .row{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(15,23,42,.70);
      border: 1px solid rgba(148,163,184,.18);
      color: var(--text);
      font-weight:900;
    }
    .btn.primary{
      background: rgba(34,197,94,.16);
      border-color: rgba(34,197,94,.35);
    }
    .meta{
      margin-top:12px;
      font-size:12px;
      opacity:.72;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>GoodJunkVR</h1>
    <p>กำลังเปิดเกม… ถ้าไม่เด้งอัตโนมัติ ให้กด “Start”</p>
    <div class="row">
      <button class="btn primary" id="btnStart" type="button">Start</button>
      <button class="btn" id="btnBack" type="button">กลับ HUB</button>
    </div>
    <div class="meta" id="meta">—</div>
  </div>

  <script>
    (function(){
      const qs = (k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };

      const hub = qs('hub', null);

      function detectView(){
        const forced = (qs('view','')||'').toLowerCase();
        if(forced) return forced; // ✅ do not override
        const ua = (navigator.userAgent||'').toLowerCase();
        const isMobile = /android|iphone|ipad|ipod/.test(ua);
        const isXRUA = /oculus|quest|vive|pico|webkitxr/.test(ua);
        if(isXRUA) return 'vr';
        return isMobile ? 'mobile' : 'pc';
      }

      function buildUrl(){
        // ✅ target run page
        const base = new URL('./vr-goodjunk/goodjunk-vr.html', location.href);

        // pass-through keys (add more if you want)
        const keys = ['hub','run','diff','time','seed','studyId','phase','conditionGroup','log','v','style'];
        for(const k of keys){
          const v = qs(k, null);
          if(v != null) base.searchParams.set(k, v);
        }

        // only set view if not provided
        if(qs('view', null) == null){
          base.searchParams.set('view', detectView());
        }

        // always have seed
        if(!base.searchParams.get('seed')){
          base.searchParams.set('seed', String(Date.now()));
        }

        // default cache tag if missing
        if(!base.searchParams.get('v')){
          base.searchParams.set('v', '20260131a');
        }

        return base.toString();
      }

      function go(){
        const url = buildUrl();
        document.getElementById('meta').textContent = url;
        location.replace(url);
      }

      document.getElementById('btnStart').addEventListener('click', go);
      document.getElementById('btnBack').addEventListener('click', ()=>{
        if(hub) location.href = hub;
        else alert('ยังไม่ได้ใส่ hub url');
      });

      // auto
      setTimeout(go, 150);
    })();
  </script>
</body>
</html>