<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR ‚Äî FULL HTML (UPDATED: MORE GAMEPLAY SPACE)
‚úÖ HUD/Quest/Coach compact layout (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà gameplay ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô)
‚úÖ Compact mode ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô + ‡πÅ‡∏ï‡∏∞ Quest ‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‚Äúpeek‚Äù 2 ‡∏ß‡∏¥
‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á production: DOM target layer (#gj-layer) + End Summary overlay
‚úÖ ‡πÇ‡∏´‡∏•‡∏î particles.js BEFORE boot module (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame core (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Enter VR / ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + logger + HUD + Fever (IIFE) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>

  <!-- Boot (module) ‚Äî MUST come after particles.js -->
  <script type="module" src="./vr-goodjunk/goodjunk-vr.boot.js"></script>

  <style>
    :root{
      color-scheme: light dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;

      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 18px 70px rgba(0,0,0,.45);

      /* ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏° */
      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);
      --hudH: 46px;
      --hudGap: 10px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% -10%, rgba(59,130,246,.18), transparent 55%),
                  radial-gradient(900px 600px at 70% 10%, rgba(34,197,94,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", "Noto Sans", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* --- A-Frame canvas behind UI --- */
    .sceneWrap{
      position:fixed; inset:0;
      z-index:0;
      pointer-events:none; /* UI ‡∏ó‡∏±‡∏ö‡πÑ‡∏î‡πâ */
    }
    a-scene{ width:100%; height:100%; }

    /* --- Gameplay layer (DOM targets) --- */
    #gj-layer{
      position:fixed; inset:0;
      z-index:2;
      overflow:hidden;
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
    }

    /* --- HUD top bar --- */
    .hha-topbar{
      position:fixed;
      left:12px; right:12px;
      top: calc(var(--safeTop) + 10px);
      height: var(--hudH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 8px 10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(2,6,23,.55);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 40px rgba(0,0,0,.28);
      z-index:10;
    }
    .hha-topbar .group{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(15,23,42,.35);
      white-space:nowrap;
      min-width:0;
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 14px rgba(34,197,94,.55); }
    .kv{ display:flex; flex-direction:column; gap:1px; min-width:0; }
    .kv .label{ font-size:10px; color:var(--muted); letter-spacing:.06em; }
    .kv .big{ font-size:18px; font-weight:800; line-height:1; }

    /* --- Quest panel (pill bottom) --- */
    #questBox{
      position:fixed;
      left:12px; right:12px;
      bottom: calc(var(--safeBottom) + 12px);
      z-index:10;

      padding:10px 12px;
      border-radius:16px;
      background: rgba(2,6,23,.55);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 14px 50px rgba(0,0,0,.34);

      max-height:78px;
      overflow:hidden;
    }
    #questBox .title{
      font-size:13px;
      font-weight:800;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    #questBox .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:6px;
    }
    .bar{
      flex:1;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(148,163,184,.10);
      overflow:hidden;
      position:relative;
    }
    .bar > i{
      position:absolute; inset:0 auto 0 0;
      width:0%;
      background: linear-gradient(90deg, rgba(34,197,94,.9), rgba(59,130,246,.85));
      border-radius:999px;
      box-shadow:0 0 18px rgba(59,130,246,.28);
    }
    .qnum{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      white-space:nowrap;
    }

    /* --- Coach bubble (small) --- */
    #coachBox{
      position:fixed;
      left:12px;
      bottom: calc(var(--safeBottom) + 96px);
      z-index:10;
      max-width: min(68vw, 360px);

      display:flex;
      gap:10px;
      align-items:center;

      padding:8px 10px;
      border-radius:16px;
      background: rgba(2,6,23,.50);
      border: 1px solid rgba(148,163,184,.16);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 50px rgba(0,0,0,.30);
    }
    #coachImg{
      width:36px; height:36px;
      object-fit:contain;
      filter: drop-shadow(0 8px 20px rgba(0,0,0,.35));
    }
    #coachText{
      font-size:12px;
      color:var(--text);
      line-height:1.25;
      font-weight:700;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    /* --- Fever UI container (if ui-fever.js binds into it) --- */
    #feverMount{
      position:fixed;
      right:12px;
      bottom: calc(var(--safeBottom) + 86px);
      z-index:10;
      pointer-events:none;
    }

    /* --- Start overlay --- */
    #startOverlay{
      position:fixed; inset:0;
      z-index:30;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: 22px 16px calc(var(--safeBottom) + 18px);
      background: radial-gradient(900px 500px at 50% 5%, rgba(59,130,246,.18), transparent 60%),
                  rgba(2,6,23,.72);
      backdrop-filter: blur(12px);
    }
    .startCard{
      width:min(640px, 100%);
      border:1px solid var(--stroke);
      border-radius:24px;
      background: rgba(2,6,23,.65);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
    }
    .startTitle{
      font-size:20px;
      font-weight:900;
      margin:0 0 6px 0;
      letter-spacing:.2px;
    }
    .startSub{
      margin:0 0 12px 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.3;
    }
    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.45);
      color:var(--text);
      border-radius:14px;
      padding: 12px 14px;
      font-weight:900;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
    }
    .btn.primary{
      border-color: rgba(34,197,94,.35);
      background: linear-gradient(180deg, rgba(34,197,94,.28), rgba(34,197,94,.10));
    }
    .btn.ghost{
      background: rgba(2,6,23,.30);
    }
    .btn:active{ transform: translateY(1px); }

    /* --- End summary overlay --- */
    #endOverlay{
      position:fixed; inset:0;
      z-index:40;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px 14px;
      background: rgba(2,6,23,.78);
      backdrop-filter: blur(14px);
    }
    .endCard{
      width:min(720px, 100%);
      border-radius:26px;
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.70);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .endHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .endTitle{
      font-size:22px;
      font-weight:1000;
      margin:0;
    }
    .endMeta{
      font-size:13px;
      color:var(--muted);
      font-weight:700;
      text-align:right;
      line-height:1.25;
    }
    .gradeBox{
      margin: 10px 0 12px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(15,23,42,.42);
      border-radius:20px;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .gradeLeft{
      display:flex;
      align-items:baseline;
      gap:14px;
      min-width:0;
    }
    .gradeLabel{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      letter-spacing:.08em;
    }
    #endGrade{
      font-size:56px;
      font-weight:1000;
      letter-spacing:1px;
      line-height:1;
      margin:0;
    }
    #endCoachLine{
      font-size:14px;
      font-weight:900;
      color:var(--text);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 56vw;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }
    .stat{
      border:1px solid rgba(148,163,184,.14);
      background: rgba(15,23,42,.35);
      border-radius:18px;
      padding: 12px 12px;
    }
    .stat .k{
      font-size:11px;
      color:var(--muted);
      font-weight:900;
      letter-spacing:.08em;
    }
    .stat .v{
      margin-top:6px;
      font-size:26px;
      font-weight:1000;
      line-height:1;
    }
    .tip{
      margin: 10px 2px 12px;
      color: var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .endActions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
      margin-top:10px;
    }

    /* --- Compact mode (during gameplay) --- */
    body.hha-compact #questBox{
      max-height:44px;
      padding:8px 10px;
      opacity:.85;
    }
    body.hha-compact #coachBox{
      opacity:.75;
      transform: translateY(6px);
    }
    body.hha-compact.hha-peek #questBox{
      max-height:92px;
      opacity:1;
    }

    /* --- Small screens --- */
    @media (max-width: 420px){
      #endGrade{ font-size:52px; }
      .grid{ grid-template-columns:1fr; }
      #endCoachLine{ max-width: 54vw; }
    }
  </style>
</head>

<body>

  <!-- A-Frame background (optional) -->
  <div class="sceneWrap" aria-hidden="true">
    <a-scene embedded renderer="antialias: true; colorManagement: true" vr-mode-ui="enabled: true">
      <a-entity camera position="0 1.6 0" look-controls="enabled:true"></a-entity>
      <a-sky color="#050b1a"></a-sky>
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 2 1"></a-entity>
    </a-scene>
  </div>

  <!-- Gameplay DOM layer (targets spawn here) -->
  <div id="gj-layer" aria-label="gameplay layer"></div>

  <!-- HUD top -->
  <div id="hudTop" class="hha-topbar" role="status" aria-label="HUD">
    <div class="group" style="min-width:0">
      <div class="pill" title="Mode">
        <span class="dot" id="hudDot"></span>
        <span style="font-weight:1000;font-size:12px;letter-spacing:.06em;">MODE</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudGame" style="font-weight:1000;font-size:12px;">GOODJUNK</span>
        <span style="opacity:.65">‚Ä¢</span>
        <span id="hudRun" style="font-weight:1000;font-size:12px;">PLAY</span>
      </div>
    </div>

    <div class="group">
      <div class="pill">
        <div class="kv">
          <div class="label">SCORE</div>
          <div class="big" id="hudScore">0</div>
        </div>
      </div>

      <div class="pill">
        <div class="kv">
          <div class="label">COMBO MAX</div>
          <div class="big" id="hudComboMax">0</div>
        </div>
      </div>

      <div class="pill">
        <div class="kv">
          <div class="label">MISS</div>
          <div class="big" id="hudMiss">0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Fever UI mount (ui-fever.js will attach/position itself if needed) -->
  <div id="feverMount"></div>

  <!-- Coach bubble -->
  <div id="coachBox" aria-live="polite">
    <img id="coachImg" src="./img/coach-neutral.png" alt="coach" />
    <div id="coachText">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏¢‡∏∞‡∏ô‡∏∞ üí™</div>
  </div>

  <!-- Quest pill -->
  <div id="questBox" title="‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ">
    <div class="title" id="questTitle">Goal: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‚Ä¶</div>
    <div class="row">
      <div class="bar" aria-label="quest progress"><i id="questBar"></i></div>
      <div class="qnum" id="questNum">0/0</div>
    </div>
  </div>

  <!-- Start overlay -->
  <div id="startOverlay">
    <div class="startCard">
      <h1 class="startTitle">GoodJunk VR ü•¶üóëÔ∏è</h1>
      <p class="startSub">
        ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á (Play) ‚Äî ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡πÑ‡∏ß ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏¢‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô!<br/>
        * ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô UI ‡∏à‡∏∞‡∏¢‡∏∏‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô (‡πÅ‡∏ï‡∏∞ Quest ‡πÄ‡∏û‡∏∑‡πà‡∏≠ peek)
      </p>
      <div class="btnRow">
        <button id="btnStart" class="btn primary">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <button id="btnEnterVR" class="btn ghost">ü•Ω Enter VR</button>
      </div>
    </div>
  </div>

  <!-- End summary overlay -->
  <div id="endOverlay">
    <div class="endCard" role="dialog" aria-label="end summary">
      <div class="endHeader">
        <h2 class="endTitle">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
        <div class="endMeta">
          <div id="endMetaLine">Diff: ‚Äî ¬∑ Challenge: ‚Äî ¬∑ ‡πÄ‡∏ß‡∏•‡∏≤ ‚Äîs</div>
        </div>
      </div>

      <div class="gradeBox">
        <div class="gradeLeft">
          <div>
            <div class="gradeLabel">GRADE</div>
            <div id="endGrade">A</div>
          </div>
        </div>
        <div style="text-align:right; min-width:0;">
          <div class="gradeLabel" style="text-align:right;">COACH</div>
          <div id="endCoachLine">‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢! üî•</div>
        </div>
      </div>

      <div class="grid">
        <div class="stat">
          <div class="k">SCORE</div>
          <div class="v" id="endScore">0</div>
        </div>
        <div class="stat">
          <div class="k">COMBO MAX</div>
          <div class="v" id="endComboMax">0</div>
        </div>
        <div class="stat">
          <div class="k">MISS</div>
          <div class="v" id="endMiss">0</div>
        </div>
        <div class="stat">
          <div class="k">GOOD HITS</div>
          <div class="v" id="endGoodHits">0</div>
        </div>
      </div>

      <div class="tip">
        ‡∏ó‡∏¥‡∏õ: miss = ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏´‡∏≤‡∏¢ (good expired) + ‡πÇ‡∏î‡∏ô‡∏Ç‡∏¢‡∏∞ (junk hit) |
        ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏•‡πà ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡∏¢‡∏∞‡πÑ‡∏î‡πâ ‚Äú‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° miss‚Äù üõ°Ô∏è
      </div>

      <div class="endActions">
        <button id="btnMenu" class="btn ghost">‚Ü©Ô∏è ‡πÄ‡∏°‡∏ô‡∏π</button>
        <button id="btnRetry" class="btn primary">üîÅ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
      </div>

      <div class="tip" style="margin-top:10px;">
        * ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet ‡πÄ‡∏°‡∏∑‡πà‡∏≠ endpoint logger ‡∏û‡∏£‡πâ‡∏≠‡∏°
      </div>
    </div>
  </div>

  <!-- Layout helper: compact mode + peek -->
  <script>
    (function(){
      const doc = document;
      const body = doc.body;

      function setCompact(on){
        body.classList.toggle('hha-compact', !!on);
      }

      // ‡∏ü‡∏±‡∏á event ‡∏Å‡∏•‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤ engine ‡∏¢‡∏¥‡∏á‡∏°‡∏≤)
      window.addEventListener('hha:start', ()=> setCompact(true));
      window.addEventListener('hha:end',   ()=> setCompact(false));

      // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ö‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏á hha:start ‚Üí ‡∏¢‡∏∏‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°
      const btnStart = doc.getElementById('btnStart');
      const startOverlay = doc.getElementById('startOverlay');
      if(btnStart && startOverlay){
        btnStart.addEventListener('click', ()=>{
          startOverlay.style.display = 'none';
          setTimeout(()=> setCompact(true), 250);
          // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ engine ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ trigger ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å UI
          window.dispatchEvent(new CustomEvent('hha:uiStart'));
        });
      }

      // Enter VR
      const btnVR = doc.getElementById('btnEnterVR');
      if(btnVR){
        btnVR.addEventListener('click', ()=>{
          const scene = doc.querySelector('a-scene');
          if(scene && scene.enterVR) scene.enterVR();
        });
      }

      // Quest peek 2 ‡∏ß‡∏¥
      const q = doc.getElementById('questBox');
      if(q){
        q.style.cursor = 'pointer';
        q.addEventListener('click', ()=>{
          body.classList.add('hha-peek');
          clearTimeout(window.__hhaPeekT);
          window.__hhaPeekT = setTimeout(()=> body.classList.remove('hha-peek'), 2000);
        });
      }

      // End overlay buttons (‡πÉ‡∏´‡πâ engine ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏¢‡∏¥‡∏á event ‡∏ä‡πà‡∏ß‡∏¢)
      const endOverlay = doc.getElementById('endOverlay');
      const btnRetry = doc.getElementById('btnRetry');
      const btnMenu  = doc.getElementById('btnMenu');
      if(btnRetry){
        btnRetry.addEventListener('click', ()=>{
          endOverlay.style.display = 'none';
          setCompact(true);
          window.dispatchEvent(new CustomEvent('hha:retry'));
        });
      }
      if(btnMenu){
        btnMenu.addEventListener('click', ()=>{
          window.dispatchEvent(new CustomEvent('hha:menu'));
        });
      }

      // helpers: ‡πÉ‡∏´‡πâ HUD binder/engine ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
      window.HHA_UI = window.HHA_UI || {};
      window.HHA_UI.showEnd = function(payload){
        // payload: {diff, challenge, timeSec, grade, coachLine, score, comboMax, miss, goodHits}
        try{
          const p = payload || {};
          const meta = doc.getElementById('endMetaLine');
          if(meta) meta.textContent = `Diff: ${p.diff ?? '‚Äî'} ¬∑ Challenge: ${p.challenge ?? '‚Äî'} ¬∑ ‡πÄ‡∏ß‡∏•‡∏≤ ${p.timeSec ?? '‚Äî'}s`;

          const set = (id,val)=>{ const el=doc.getElementById(id); if(el) el.textContent = String(val ?? 0); };
          set('endGrade', p.grade ?? 'A');
          set('endCoachLine', p.coachLine ?? '‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢! üî•');
          set('endScore', p.score ?? 0);
          set('endComboMax', p.comboMax ?? 0);
          set('endMiss', p.miss ?? 0);
          set('endGoodHits', p.goodHits ?? 0);

          endOverlay.style.display = 'flex';
          setCompact(false);
        }catch(e){}
      };
    })();
  </script>

</body>
</html>