<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
  <title>ü•¶ Good vs Junk VR ‚Äî Hero Health</title>
  <meta name="color-scheme" content="dark light"/>

  <link rel="icon" href="./favicon.ico" type="image/x-icon"/>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏ó‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      color-scheme: dark light;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      overflow:hidden;
      font-family:'IBM Plex Sans Thai',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡πá‡∏Å ‡∏õ.5 ‚Äî ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• + ‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏° ‡πÜ */
      background:
        radial-gradient(circle at 0% 0%, #e0f2fe 0, transparent 55%),
        radial-gradient(circle at 100% 0%, #fee2e2 0, transparent 55%),
        radial-gradient(circle at 0% 100%, #dcfce7 0, transparent 55%),
        radial-gradient(circle at 100% 100%, #fef9c3 0, transparent 55%),
        #020617;
      color:#e5e7eb;
    }

    /* ===== UI Overlay (Start / Result) ===== */
    #uiOverlay{
      position:fixed;
      inset:0;
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      padding:16px;
      text-align:center;
      color:#0f172a;
      transition:opacity .28s ease, visibility .28s ease;
      /* ‡∏ï‡∏≠‡∏ô overlay ‡πÇ‡∏ä‡∏ß‡πå ‚Üí ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
      pointer-events:auto;
    }
    #uiOverlay::before,
    #uiOverlay::after{
      content:"";
      position:absolute;
      inset:12%;
      border-radius:32px;
      background:
        radial-gradient(circle at 10% 20%, rgba(56,189,248,.25) 0, transparent 55%),
        radial-gradient(circle at 90% 80%, rgba(52,211,153,.25) 0, transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(251,146,60,.25) 0, transparent 55%);
      filter:blur(2px);
      z-index:-2;
    }
    #uiOverlay::after{
      inset:20%;
      background:
        radial-gradient(circle at 0% 100%, rgba(129,140,248,.28) 0, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(248,250,252,.5) 0, transparent 50%);
      opacity:.9;
    }
    #uiOverlay.hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none; /* ‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‚Üí overlay ‡πÇ‡∏õ‡∏£‡πà‡∏á ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô/‡πÅ‡∏ï‡∏∞ */
    }

    .ui-card{
      position:relative;
      max-width:520px;
      width:100%;
      padding:20px 20px 18px;
      border-radius:24px;
      background:rgba(15,23,42,.88);
      border:1px solid rgba(148,163,184,.9);
      box-shadow:0 24px 60px rgba(15,23,42,.9);
      color:#e5e7eb;
      backdrop-filter:blur(14px);
    }

    .ui-card h1{
      margin:0 0 6px;
      font-size:1.8rem;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.35em;
    }
    .ui-card h1 span.small{
      font-size:1.1rem;
      font-weight:400;
      opacity:.9;
    }
    .ui-card p{
      margin:4px 0 14px;
      font-size:.95rem;
      opacity:.9;
    }

    .kid-chip-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:6px;
      font-size:.8rem;
      margin-bottom:10px;
    }
    .kid-chip{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.6);
      display:flex;
      align-items:center;
      gap:4px;
      color:#e5e7eb;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px;
      margin-top:6px;
    }
    .game-button{
      font-family:'IBM Plex Sans Thai',system-ui;
      font-weight:700;
      font-size:.95rem;
      padding:10px 18px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      color:#f9fafb;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      box-shadow:0 10px 25px rgba(34,197,94,.45);
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .game-button span.lvl{
      padding:1px 8px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      font-size:.75rem;
    }
    .game-button:hover{
      transform:translateY(-1px);
      filter:brightness(1.03);
      box-shadow:0 16px 32px rgba(34,197,94,.55);
    }
    .game-button.hard{
      background:linear-gradient(135deg,#f97316,#ef4444);
      box-shadow:0 10px 25px rgba(239,68,68,.55);
    }

    #resultsScreen h2{
      margin:0 0 6px;
      font-size:1.5rem;
      color:#fbbf24;
    }
    #finalScore{
      margin:0 0 6px;
      font-size:1.8rem;
      color:#f9fafb;
    }
    #finalGrade{
      margin:0 0 12px;
      font-size:1.1rem;
      color:#facc15;
    }
    .result-line{
      font-size:.9rem;
      opacity:.9;
      margin-bottom:2px;
    }

    @media (max-width:600px){
      .ui-card{
        padding:16px 14px 14px;
        border-radius:20px;
      }
      .ui-card h1{
        font-size:1.45rem;
      }
      .ui-card p{
        font-size:.9rem;
      }
      .game-button{
        width:100%;
        justify-content:center;
      }
    }

    /* ===== A-Frame Canvas full screen ===== */
    a-scene{
      position:fixed !important;
      inset:0;
    }

    /* ===== HUD ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤/‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö/‡∏û‡∏•‡∏≤‡∏î (‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô) ===== */
    #hhaHudVR{
      position:fixed;
      left:12px;
      top:12px;
      z-index:950;
      padding:8px 12px;
      border-radius:14px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.95);
      color:#e5e7eb;
      font:600 13px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Thonburi,sans-serif;
      box-shadow:0 14px 40px rgba(15,23,42,.9);
      backdrop-filter:blur(8px);
    }
    #hhaHudVR .line{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:2px;
    }
    #hhaHudVR .line:last-child{ margin-bottom:0; }
    #hhaHudVR .big{ font-size:15px; }
    #hhaHudVR .pill{
      padding:2px 8px;
      border-radius:999px;
      background:rgba(56,189,248,.15);
    }
    #hhaHudVR .bad{ color:#fecaca; }

    @media (max-width:640px){
      #hhaHudVR{
        left:8px;
        top:8px;
        padding:6px 9px;
        font-size:12px;
      }
      #hhaHudVR .big{ font-size:13px; }
    }

    /* ===== QUEST HUD (Goal + Mini + Grade bar) ===== */
    #questHudVR{
      position:fixed;
      right:12px;
      top:80px;
      z-index:960;
      max-width:260px;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(15,23,42,.92);
      border:1px solid rgba(148,163,184,.95);
      color:#e5e7eb;
      font:500 12px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Thonburi,sans-serif;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      backdrop-filter:blur(10px);
    }
    #questHudVR .q-title{
      font-size:13px;
      font-weight:700;
      margin-bottom:4px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    #questHudVR .q-main{
      font-size:12px;
      margin-bottom:4px;
    }
    #questHudVR .q-mini-label{
      font-size:11px;
      opacity:.8;
      margin-top:2px;
    }
    #questHudVR .q-mini{
      font-size:11px;
      margin-bottom:4px;
    }
    #questHudVR .q-hint{
      font-size:11px;
      opacity:.85;
      margin-top:2px;
      color:#bfdbfe;
    }
    #questHudVR .q-grade-row{
      margin-top:6px;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    #questHudVR .q-grade-head{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:11px;
    }
    #questHudVR .q-grade-val{
      font-weight:700;
      font-size:13px;
      color:#facc15;
    }
    #questHudVR .q-grade-bar{
      position:relative;
      width:100%;
      height:5px;
      border-radius:999px;
      background:rgba(51,65,85,.8);
      overflow:hidden;
    }
    
    #questHudVR .q-grade-fill{
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#a855f7);
      transition:width .2s ease-out;
    }
      #questHudVR .q-row{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:6px;
    }
    #questHudVR .q-prog{
      font-size:11px;
      font-weight:600;
      color:#bbf7d0;
      white-space:nowrap;
    }
    #questHudVR .q-prog.done{
      color:#4ade80;
    }
    #questHudVR .q-status{
      margin-top:4px;
      font-size:11px;
      color:#a5b4fc;
    }

    #questHudVR .q-row{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:6px;
    }
    #questHudVR .q-prog{
      font-size:11px;
      font-weight:600;
      color:#bbf7d0;
      white-space:nowrap;
    }
    #questHudVR .q-prog.done{
      color:#4ade80;
    }
    #questHudVR .q-status{
      margin-top:4px;
      font-size:11px;
      color:#a5b4fc;
    }

    @media (max-width:640px){
      #questHudVR{
        right:8px;
        top:72px;
        max-width:220px;
        padding:8px 10px;
      }
    }

    /* ===== ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏¥‡∏á! ‡∏Å‡∏•‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠ (PC + Mobile) ===== */
    #fireBtn{
      position:fixed;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      z-index:980;
      min-width:130px;
      padding:10px 20px;
      border-radius:999px;
      border:1px solid rgba(254,215,170,0.9);
      background:
        radial-gradient(circle at 0 0, rgba(248,113,113,0.35), transparent 55%),
        linear-gradient(135deg,#fb923c,#f97316);
      color:#451a03;
      font-family:'IBM Plex Sans Thai',system-ui;
      font-size:1rem;
      font-weight:700;
      display:none; /* ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° */
      align-items:center;
      justify-content:center;
      gap:6px;
      box-shadow:0 14px 30px rgba(15,23,42,.9);
      cursor:pointer;
      pointer-events:auto;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    #fireBtn span.small{
      font-size:.8rem;
      opacity:.85;
    }
    #fireBtn:hover{
      transform:translateX(-50%) translateY(-1px);
      box-shadow:0 20px 40px rgba(15,23,42,1);
      filter:brightness(1.03);
    }
    #fireBtn:active{
      transform:translateX(-50%) translateY(0);
      box-shadow:0 10px 22px rgba(15,23,42,.9);
    }

    @media (max-width:640px){
      #fireBtn{
        bottom:12px;
        min-width:120px;
        padding:9px 18px;
        font-size:.95rem;
      }
    }
  </style>
</head>
<body>

  <!-- ===== UI Overlay (Start + Result) ===== -->
  <div id="uiOverlay">
    <div id="startScreen" class="ui-card">
      <h1>ü•¶ Good vs Junk VR <span class="small">Hero Health</span></h1>
      <p>
        ‡πÄ‡∏•‡πá‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏¢‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡∏Å‡∏±‡∏ö ‚Äú‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏±‡∏õ‚Äù ‚≠êüíé<br/>
        ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞ üçüüç© ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!
      </p>

      <div class="kid-chip-row">
        <div class="kid-chip">üçé ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ú‡∏±‡∏Å‚Äì‡∏ú‡∏•‡πÑ‡∏°‡πâ‚Äì‡∏ô‡∏° ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÜ</div>
        <div class="kid-chip">‚è± ‡πÄ‡∏Å‡∏°‡∏¢‡∏≤‡∏ß ~60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
        <div class="kid-chip">üéØ ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á PC / Mobile / VR Headset</div>
      </div>

      <div class="btn-row">
        <button class="game-button" id="startButtonEasy">
          üå± ‡∏á‡πà‡∏≤‡∏¢
          <span class="lvl">Easy</span>
        </button>
        <button class="game-button" id="startButtonNormal">
          ‚öñÔ∏è ‡∏õ‡∏Å‡∏ï‡∏¥
          <span class="lvl">Normal</span>
        </button>
        <button class="game-button hard" id="startButtonHard">
          üî• ‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢
          <span class="lvl">Hard</span>
        </button>
      </div>
    </div>

    <div id="resultsScreen" class="ui-card" style="display:none;">
      <h2>‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h2>
      <h1 id="finalScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</h1>
      <div id="finalGrade">‡πÄ‡∏Å‡∏£‡∏î: C</div>
      <div class="result-line" id="resultDetailMain">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ô‡∏∞ üéØ</div>
      <div class="result-line" id="resultDetailCombo"></div>
      <div class="result-line" id="resultDetailMiss"></div>
      <div class="result-line" id="resultDetailMini"></div> <!-- ‚¨Ö ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà -->

      <div class="btn-row" style="margin-top:12px;">
        <button class="game-button" id="playAgainButton">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚ñ∂</button>
      </div>
    </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏¥‡∏á! ‡∏Å‡∏•‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠ -->
  <button id="fireBtn">üî´ ‡∏¢‡∏¥‡∏á! <span class="small">(‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á‡πÄ‡∏õ‡πâ‡∏≤)</span></button>

  <!-- ===== A-Frame Scene (VR World) ===== -->
  <a-scene id="gameScene"
           renderer="colorManagement: true"
           loading-screen="dotsColor: white; backgroundColor: #0b1222"
           background="color: #020617"
           device-orientation-permission-ui="enabled: true">

    <!-- Ambient + Directional light -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.4" position="-0.5 1 1"></a-entity>

    <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô/‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera id="camera"
                wasd-controls-enabled="false"
                look-controls="touchEnabled: true; magicWindowTrackingEnabled: true; pointerLockEnabled: true">
        <!-- Cursor ‡πÅ‡∏ö‡∏ö ring ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gaze/VR + ‡πÉ‡∏ä‡πâ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ -->
        <a-entity id="cursor"
                  cursor="fuse: false"
                  raycaster="objects: [data-hha-tgt]; interval: 50"
                  position="0 0 0">
          <a-ring geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.018"
                  material="color: #ffffff; shader: flat; opacity: 0.95"
                  position="0 0 -1">
          </a-ring>
        </a-entity>
      </a-camera>

      <!-- ‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ (VR controller) -->
      <a-entity id="rightHand"
                laser-controls="hand: right"
                raycaster="objects: [data-hha-tgt]; interval: 30">
      </a-entity>
    </a-entity>

  </a-scene>

  <!-- ===== Launcher + ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° GameEngine + Cloud Logger (ES Module) ===== -->
  <script type="module">
    import { GameEngine } from './vr-goodjunk/GameEngine.js';
    import { initCloudLogger } from './vr/hha-cloud-logger.js';

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß logger ‚Üí ‡∏™‡πà‡∏á‡πÑ‡∏õ Google Apps Script
    initCloudLogger({
      endpoint: 'https://script.google.com/macros/s/AKfycbxunS2aJ3NlznqAtn2iTln0JsMJ2OdsYx6pVvfVDVn-CkQzDiSDh1tep3yJHnKa0VIH/exec',
      projectTag: 'HeroHealth-GoodJunkVR',
      debug: true
    });

    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á UI
    const uiOverlay     = document.getElementById('uiOverlay');
    const startScreen   = document.getElementById('startScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const finalScoreEl  = document.getElementById('finalScore');
    const finalGradeEl  = document.getElementById('finalGrade');
    const resultComboEl = document.getElementById('resultDetailCombo');
    const resultMissEl  = document.getElementById('resultDetailMiss');
    const resultMainEl  = document.getElementById('resultDetailMain');
    const fireBtn       = document.getElementById('fireBtn');

    const btnEasy   = document.getElementById('startButtonEasy');
    const btnNormal = document.getElementById('startButtonNormal');
    const btnHard   = document.getElementById('startButtonHard');
    const btnAgain  = document.getElementById('playAgainButton');

    const GAME_DURATION_MS = 60_000; // 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    let gameTimer = null;
    let currentDifficulty = 'normal';

    const GRADES = [
      { label:'SSS', min:2400, msg:'‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¢ üéâ' },
      { label:'SS',  min:2000, msg:'‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° üí™' },
      { label:'S',   min:1600, msg:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞ üòÑ' },
      { label:'A',   min:1200, msg:'‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢! ‡∏ñ‡πâ‡∏≤‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏à‡∏∞‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å ü•ó' },
      { label:'B',   min:800,  msg:'‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏≠‡πÄ‡∏Ñ ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‚ú®' },
      { label:'C',   min:0,    msg:'‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏∞ üòä' }
    ];

    function computeGrade(score){
      const s = Math.max(0, score|0);
      for (const g of GRADES){
        if (s >= g.min) return g;
      }
      return GRADES[GRADES.length - 1];
    }

    function clearGameTimer(){
      if (gameTimer){
        clearTimeout(gameTimer);
        gameTimer = null;
      }
    }

    function hideOverlay(){
      uiOverlay.classList.add('hidden');
      if (fireBtn) fireBtn.style.display = 'flex'; // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏¥‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô
    }
    function showStart(){
      resultsScreen.style.display = 'none';
      startScreen.style.display   = 'block';
      uiOverlay.classList.remove('hidden');
      if (fireBtn) fireBtn.style.display = 'none';
    }
    function showResult(score, extra = {}){
      startScreen.style.display   = 'none';
      resultsScreen.style.display = 'block';
      uiOverlay.classList.remove('hidden');
      if (fireBtn) fireBtn.style.display = 'none';

      const s = score|0;
      finalScoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${s}`;

      const grade = computeGrade(s);
      finalGradeEl.textContent = `‡πÄ‡∏Å‡∏£‡∏î: ${grade.label}`;
      resultMainEl.textContent = grade.msg;

      if (typeof extra.comboMax === 'number'){
        resultComboEl.textContent = `‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: x${extra.comboMax|0}`;
      }else{
        resultComboEl.textContent = '';
      }
      if (typeof extra.misses === 'number'){
        resultMissEl.textContent = `‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${extra.misses|0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
      }else{
        resultMissEl.textContent = '';
      }
    }

    function startGame(diff){
      currentDifficulty = diff || 'normal';
      clearGameTimer();
      hideOverlay();

      // ‡πÄ‡∏£‡∏¥‡πà‡∏° Engine ‡∏ù‡∏±‡πà‡∏á VR
      GameEngine.start(currentDifficulty);

      // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà 60 ‡∏ß‡∏¥
      gameTimer = setTimeout(()=>{
        GameEngine.stop();
        const score  = (window.score|0) || 0;
        const comboM = (window.comboMax|0) || 0;
        const miss   = (window.misses|0)  || 0;
        showResult(score, { comboMax: comboM, misses: miss });
      }, GAME_DURATION_MS);
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
    btnEasy  .addEventListener('click', ()=> startGame('easy'));
    btnNormal.addEventListener('click', ()=> startGame('normal'));
    btnHard  .addEventListener('click', ()=> startGame('hard'));

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å
    btnAgain.addEventListener('click', ()=>{
      resultsScreen.style.display = 'none';
      startScreen.style.display   = 'block';
      if (fireBtn) fireBtn.style.display = 'none';
    });

    // ‡∏ñ‡πâ‡∏≤ Engine ‡∏¢‡∏¥‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì hha:end ‡∏°‡∏≤‡πÄ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô‡∏à‡∏ö‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô + session logger)
    window.addEventListener('hha:end', (ev)=>{
      clearGameTimer();

      // ‡∏ñ‡πâ‡∏≤ overlay ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≥
      if (!uiOverlay.classList.contains('hidden') && resultsScreen.style.display === 'block'){
        return;
      }

      const d = ev && ev.detail ? ev.detail : {};
      const score  = (typeof d.scoreFinal === 'number')
        ? d.scoreFinal
        : (typeof d.score === 'number')
          ? d.score
          : ((window.score|0) || 0);

      const comboM = (typeof d.comboMax === 'number')
        ? d.comboMax
        : ((window.comboMax|0) || 0);

      const miss   = (typeof d.misses === 'number')
        ? d.misses
        : ((window.misses|0) || 0);

      showResult(score, { comboMax: comboM, misses: miss });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Start
    showStart();
  </script>

  <!-- ===== ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° fireBtn (PC + Mobile) ===== -->
  <script>
  (function(){
    'use strict';

    const fireBtn  = document.getElementById('fireBtn');
    const cursorEl = document.getElementById('cursor');

    if (!fireBtn || !cursorEl) {
      console.warn('[GoodJunk VR] fireBtn ‡∏´‡∏£‡∏∑‡∏≠ cursor ‡πÑ‡∏°‡πà‡∏û‡∏ö');
      return;
    }

    function shootFromCenter(){
      const rayComp = cursorEl.components && cursorEl.components.raycaster;
      if (!rayComp){
        console.warn('[GoodJunk VR] raycaster ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏ô cursor');
        return;
      }

      // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä list ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤ [data-hha-tgt]
      try {
        rayComp.refreshObjects && rayComp.refreshObjects();
      } catch(e){}

      const targets = rayComp.intersectedEls || [];
      if (!targets.length){
        flashCursorMiss();
        return;
      }

      const hitEl = targets[0];
      // ‡∏™‡πà‡∏á event click ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏ô ray
      hitEl.emit('click', { origin:'center-ray', cursor: cursorEl });
      flashCursorHit();
    }

    function flashCursorHit(){
      const ring = cursorEl.querySelector('a-ring');
      if (!ring) return;
      const origMat = ring.getAttribute('material') || {};
      const origColor = origMat.color || '#ffffff';
      ring.setAttribute('material','color','#22c55e');
      setTimeout(()=> ring.setAttribute('material','color',origColor), 120);
    }

    function flashCursorMiss(){
      const ring = cursorEl.querySelector('a-ring');
      if (!ring) return;
      const origMat = ring.getAttribute('material') || {};
      const origColor = origMat.color || '#ffffff';
      ring.setAttribute('material','color','#f97316');
      setTimeout(()=> ring.setAttribute('material','color',origColor), 120);
    }

    fireBtn.addEventListener('click', shootFromCenter);
    fireBtn.addEventListener('touchstart', function(ev){
      ev.preventDefault();
      shootFromCenter();
    }, { passive:false });
  })();
  </script>

  <!-- ===== HUD Script (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / ‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö / ‡∏û‡∏•‡∏≤‡∏î) ===== -->
  <script>
  (function(){
    'use strict';

    const HUD_ID = 'hhaHudVR';
    const GAME_SECONDS = 60; // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 60 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏°

    let wrap, scoreEl, comboEl, missEl, timeEl;
    let running = false;
    let timerId = null;

    function createHud(){
      if (wrap && document.getElementById(HUD_ID)) return wrap;

      wrap = document.createElement('div');
      wrap.id = HUD_ID;
      wrap.setAttribute('data-hha-ui','');

      wrap.innerHTML = `
        <div class="line big">
          <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="hudScoreVR">0</span></span>
          <span class="pill">‡πÄ‡∏ß‡∏•‡∏≤: <span id="hudTimeVR">${GAME_SECONDS}</span>s</span>
        </div>
        <div class="line">
          <span>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö: <span id="hudComboVR">0</span></span>
          <span>‡∏û‡∏•‡∏≤‡∏î: <span id="hudMissVR" class="bad">0</span></span>
        </div>
      `;
      document.body.appendChild(wrap);

      scoreEl = document.getElementById('hudScoreVR');
      comboEl = document.getElementById('hudComboVR');
      missEl  = document.getElementById('hudMissVR');
      timeEl  = document.getElementById('hudTimeVR');

      return wrap;
    }

    function startTimer(){
      createHud();
      if (timerId) clearInterval(timerId);
      let left = GAME_SECONDS;
      if (timeEl) timeEl.textContent = left;
      running = true;

      timerId = setInterval(function(){
        if (!running){
          clearInterval(timerId);
          timerId = null;
          return;
        }
        left--;
        if (left < 0) left = 0;
        if (timeEl) timeEl.textContent = left;
        if (left <= 0){
          clearInterval(timerId);
          timerId = null;
          running = false;
        }
      }, 1000);
    }

    function stopTimer(){
      running = false;
      if (timerId){
        clearInterval(timerId);
        timerId = null;
      }
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ hha:score
    window.addEventListener('hha:score', function(e){
      const d = (e && e.detail) || {};
      createHud();

      // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      if (typeof d.score === 'number'){
        scoreEl.textContent = d.score;
      }else if (typeof d.total === 'number'){
        scoreEl.textContent = d.total;
      }else if (typeof window.score === 'number'){
        scoreEl.textContent = window.score|0;
      }

      // ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö
      let combo = 0;
      if (typeof d.combo === 'number') combo = d.combo;
      else if (typeof window.combo === 'number') combo = window.combo;
      comboEl.textContent = combo|0;

      if (!running){
        startTimer();
      }
    });

    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏•‡∏≤‡∏î (‡∏ï‡∏µ‡πÇ‡∏î‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞)
    window.addEventListener('hha:miss', function(){
      createHud();
      if (typeof window.misses === 'number'){
        missEl.textContent = window.misses|0;
      }
      if (typeof window.combo === 'number'){
        comboEl.textContent = window.combo|0;
      }
    });

    // ‡πÄ‡∏Å‡∏°‡∏à‡∏ö
    window.addEventListener('hha:end', function(e){
      const d = (e && e.detail) || {};
      createHud();
      if (typeof d.score === 'number'){
        scoreEl.textContent = d.score;
      }else if (typeof window.score === 'number'){
        scoreEl.textContent = window.score|0;
      }
      stopTimer();
    });

    window.addEventListener('beforeunload', stopTimer);
  })();
  </script>

  <!-- ===== QUEST HUD Script (Goal + Mini + Grade bar ‡∏Ç‡∏ì‡∏∞‡πÄ‡∏•‡πà‡∏ô) ===== -->
  <script>
  (function(){
    'use strict';

    const HUD_ID = 'questHudVR';

    let wrap, mainEl, miniEl, hintEl, gradeEl, gradeFillEl;
    let mainProgEl, miniProgEl, statusEl;

    function createQuestHud(){
      if (wrap && document.getElementById(HUD_ID)) return wrap;

      wrap = document.createElement('div');
      wrap.id = HUD_ID;
      wrap.setAttribute('data-hha-ui','');

      wrap.innerHTML = `
        <div class="q-title">üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>

        <div class="q-row">
          <div class="q-main" id="qMainVR">‚Äì</div>
          <div class="q-prog" id="qMainProgVR"></div>
        </div>

        <div class="q-mini-label">Mini quest</div>
        <div class="q-row">
          <div class="q-mini" id="qMiniVR">‚Äì</div>
          <div class="q-prog" id="qMiniProgVR"></div>
        </div>

        <div class="q-hint" id="qHintVR"></div>
        <div class="q-status" id="qStatusVR"></div>

        <div class="q-grade-row">
          <div class="q-grade-head">
            <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏Å‡∏£‡∏î‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</span>
            <span class="q-grade-val" id="qGradeVR">C</span>
          </div>
          <div class="q-grade-bar">
            <div class="q-grade-fill" id="qGradeFillVR"></div>
          </div>
        </div>
      `;
      document.body.appendChild(wrap);

      mainEl      = document.getElementById('qMainVR');
      miniEl      = document.getElementById('qMiniVR');
      hintEl      = document.getElementById('qHintVR');
      gradeEl     = document.getElementById('qGradeVR');
      gradeFillEl = document.getElementById('qGradeFillVR');

      mainProgEl  = document.getElementById('qMainProgVR');
      miniProgEl  = document.getElementById('qMiniProgVR');
      statusEl    = document.getElementById('qStatusVR');

      return wrap;
    }

    function updateQuestUI(detail){
      createQuestHud();
      const d = detail || {};
      const goal = d.goal || {};
      const mini = d.mini || {};

      // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° main goal
      mainEl.textContent = goal.label || '‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!';
      if (d.hint){
        hintEl.textContent = d.hint;
      } else {
        hintEl.textContent = '';
      }

      // progress main: goodCount / target
      if (goal.progress) {
        const cur = goal.progress.current | 0;
        const tgt = goal.progress.target | 0;
        mainProgEl.textContent = `${Math.min(cur, tgt)}/${tgt}`;
        mainProgEl.classList.toggle('done', !!goal.done);
      } else {
        mainProgEl.textContent = '';
        mainProgEl.classList.remove('done');
      }

      // mini quest ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      miniEl.textContent = mini.label || 'Mini quest ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°';

      if (mini.progress) {
        const cur = mini.progress.current | 0;
        const tgt = mini.progress.target | 0;
        miniProgEl.textContent = `x${Math.min(cur, tgt)}/x${tgt}`;
        // ‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥ mini ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß quest-serial ‡∏à‡∏∞‡∏™‡πà‡∏á done: true ‡∏°‡∏≤
        miniProgEl.classList.toggle('done', !!mini.done);
      } else {
        miniProgEl.textContent = '';
        miniProgEl.classList.remove('done');
      }

      // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ß‡∏°: ‡∏ú‡πà‡∏≤‡∏ô goal? ‡∏ú‡πà‡∏≤‡∏ô mini ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏µ‡πà‡∏≠‡∏±‡∏ô?
      const mainDone     = !!goal.done;
      const miniDoneAll  = !!mini.done; // true = ‡∏ú‡πà‡∏≤‡∏ô mini ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß
      const cleared      = mini.clearedCount | 0;
      const totalMini    = mini.total | 0;
      const idx          = (mini.index | 0); // 0-based

      if (totalMini > 0) {
        if (mainDone && miniDoneAll) {
          statusEl.textContent =
            `‚úÖ ‡∏ú‡πà‡∏≤‡∏ô Goal ‡πÅ‡∏•‡∏∞ Mini quest ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${cleared}/${totalMini}) ‡πÅ‡∏•‡πâ‡∏ß!`;
        } else if (mainDone && !miniDoneAll) {
          statusEl.textContent =
            `‚úÖ ‡∏ú‡πà‡∏≤‡∏ô Goal ‡πÅ‡∏•‡πâ‡∏ß ‚Ä¢ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà Mini quest ‡∏ó‡∏µ‡πà ${idx + 1}/${totalMini} (‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ${cleared} ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à)`;
        } else if (!mainDone && miniDoneAll) {
          statusEl.textContent =
            `‚úÖ ‡∏ú‡πà‡∏≤‡∏ô Mini quest ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${cleared}/${totalMini}) ‡πÅ‡∏•‡πâ‡∏ß ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö Goal ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞`;
        } else {
          statusEl.textContent =
            `Mini quest ‡∏ó‡∏µ‡πà ${Math.min(idx + 1, totalMini)}/${totalMini} (‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ${cleared} ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à)`;
        }
      } else {
        statusEl.textContent = '';
      }
    }

    const GRADES = [
      { label:'SSS', min:2400 },
      { label:'SS',  min:2000 },
      { label:'S',   min:1600 },
      { label:'A',   min:1200 },
      { label:'B',   min:800  },
      { label:'C',   min:0    }
    ];
    const MAX_FOR_BAR = 2400; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö SSS

    function updateGrade(score){
      createQuestHud();
      const s = Math.max(0, score|0);

      let g = GRADES[GRADES.length - 1]; // default C
      for (const gr of GRADES){
        if (s >= gr.min){
          g = gr;
          break;
        }
      }
      gradeEl.textContent = g.label;

      const pct = Math.max(0, Math.min(100, (s / MAX_FOR_BAR) * 100));
      gradeFillEl.style.width = pct + '%';
    }

    // Quest system ‚Üí ‡∏¢‡∏¥‡∏á quest:update ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
    window.addEventListener('quest:update', function(ev){
      const d = (ev && ev.detail) || {};
      updateQuestUI(d);
    });

    // ‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üí ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö grade bar
    window.addEventListener('hha:score', function(ev){
      const d = (ev && ev.detail) || {};
      const score = (typeof d.score === 'number')
        ? d.score
        : (typeof d.total === 'number')
          ? d.total
          : (window.score|0) || 0;
      updateGrade(score);
    });

    // ‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏°‡∏à‡∏ö ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï grade ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    window.addEventListener('hha:end', function(ev){
      const d = (ev && ev.detail) || {};
      const score = (typeof d.scoreFinal === 'number')
        ? d.scoreFinal
        : (typeof d.score === 'number')
          ? d.score
          : (window.score|0) || 0;
      updateGrade(score);
    });
  })();
  </script>
</body>
</html>
