<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR LAUNCHER ‚Äî ROOT (PRODUCTION)
‚úÖ Redirects to: ./vr-goodjunk/goodjunk-vr.html
‚úÖ Auto-detect view (pc/mobile/cvr/vr) ‚Äî BUT never override if ?view exists
‚úÖ Pass-through: hub/run/diff/time/seed/studyId/phase/conditionGroup/log/gate/dur/cdur/...
‚úÖ Supports ctx: /herohealth/vr/hha-ctx.js + /herohealth/vr/hha-launch.js
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR (Launcher)</title>
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#020617" />
  <link rel="icon" href="./favicon.ico" />

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --radius:22px;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    html,body{
      height:100%; margin:0;
      background: radial-gradient(1200px 900px at 20% 10%, rgba(34,197,94,.16), transparent 55%),
                  radial-gradient(900px 700px at 90% 20%, rgba(34,211,238,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;
      overscroll-behavior:none;
    }
    .wrap{
      min-height:100%;
      display:flex; align-items:center; justify-content:center;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
    }
    .card{
      width:min(720px, 96vw);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.55));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .row{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .title{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      font-weight: 1000; letter-spacing:.2px;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.45);
      font-weight:900;
      color: var(--text);
      user-select:none;
    }
    .sub{ color: var(--muted); font-weight:800; font-size:12px; margin-top:8px; line-height:1.35; }
    .bar{
      height:10px; border-radius:999px;
      background: rgba(148,163,184,.16);
      overflow:hidden;
      margin-top: 14px;
      border:1px solid rgba(148,163,184,.14);
    }
    .bar > i{
      display:block; height:100%;
      width: 62%;
      background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(34,211,238,.85));
      border-radius:999px;
      animation: ind 1.2s ease-in-out infinite;
    }
    @keyframes ind{
      0%{ transform: translateX(-60%); opacity:.55; }
      50%{ opacity:1; }
      100%{ transform: translateX(120%); opacity:.55; }
    }
    .kv{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    .k{
      border:1px solid rgba(148,163,184,.14);
      background: rgba(2,6,23,.35);
      border-radius:16px;
      padding:10px 12px;
    }
    .k .h{ color:rgba(148,163,184,.9); font-size:11px; font-weight:900; }
    .k .v{ font-size:13px; font-weight:950; margin-top:3px; word-break:break-word; }
    .hint{
      margin-top:12px;
      color: rgba(229,231,235,.82);
      font-size:12px;
      font-weight:850;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="status" aria-live="polite">
      <div class="row">
        <div class="title">
          <span class="pill">ü•ó GoodJunkVR</span>
          <span class="pill" id="pillView">VIEW: ‚Ä¶</span>
          <span class="pill" id="pillMode">MODE: ‚Ä¶</span>
        </div>
        <div class="pill" style="border-color:rgba(34,197,94,.35);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‚Ä¶</div>
      </div>

      <div class="sub">
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢/‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ RUN
      </div>

      <div class="bar" aria-hidden="true"><i></i></div>

      <div class="kv" aria-label="debug params">
        <div class="k"><div class="h">run</div><div class="v" id="vRun">‚Äî</div></div>
        <div class="k"><div class="h">diff</div><div class="v" id="vDiff">‚Äî</div></div>
        <div class="k"><div class="h">time</div><div class="v" id="vTime">‚Äî</div></div>
        <div class="k"><div class="h">seed</div><div class="v" id="vSeed">‚Äî</div></div>
      </div>

      <div class="hint">
        ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á: ‡πÄ‡∏û‡∏¥‡πà‡∏° <b>?view=pc</b> / <b>?view=mobile</b> / <b>?view=cvr</b> / <b>?view=vr</b>
        (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ view ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß Launcher ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏õ override)
      </div>
    </div>
  </div>

  <!-- Optional ctx helpers (if you already have them) -->
  <script src="./vr/hha-ctx.js"></script>
  <script src="./vr/hha-launch.js"></script>

  <script>
  (function(){
    'use strict';

    const RUN_URL = './vr-goodjunk/goodjunk-vr.html';

    function getQS(){
      try { return new URL(location.href).searchParams; }
      catch { return new URLSearchParams(); }
    }
    const QS = getQS();

    const q = (k, def='') => (QS.get(k) ?? def);

    function hasViewInUrl(){
      const v = String(q('view','')).trim();
      return !!v;
    }

    function detectView(){
      // If WebXR immersive-vr is likely available => 'vr'
      // If device is mobile => 'mobile'
      // If explicit cVR context => 'cvr'
      // Else => 'pc'
      try{
        // heuristics for cVR: cardboard-like / split-screen usage often has small width and "cvr" hint
        const hint = String(q('hint','')).toLowerCase();
        if(hint.includes('cvr') || hint.includes('cardboard')) return 'cvr';
      }catch(_){}

      const ua = navigator.userAgent || '';
      const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);

      // If they already forced "cvr" elsewhere, keep it
      if(String(q('view','')).toLowerCase() === 'cvr') return 'cvr';

      // WebXR hint (non-blocking)
      // We won't await; just pick a reasonable default quickly.
      if(isMobile) return 'mobile';
      return 'pc';
    }

    function collectCtx(){
      // ctx fields: ctx.run ctx.diff ctx.time ctx.seed ctx.studyId ctx.phase ctx.conditionGroup ctx.log ctx.hub
      try{
        if(window.HHA_CTX && typeof window.HHA_CTX.readCtx === 'function'){
          return window.HHA_CTX.readCtx() || null;
        }
      }catch(_){}
      return null;
    }

    function mergeParams(){
      const ctx = collectCtx();

      // Start with current URL params (user-provided > ctx)
      const out = {};
      QS.forEach((v,k)=>{ out[k] = v; });

      // Fill missing from ctx (only if not present)
      if(ctx && typeof ctx === 'object'){
        const map = {
          run: 'run',
          diff: 'diff',
          time: 'time',
          seed: 'seed',
          studyId: 'studyId',
          phase: 'phase',
          conditionGroup: 'conditionGroup',
          log: 'log',
          hub: 'hub'
        };
        Object.keys(map).forEach((k)=>{
          const key = map[k];
          if(out[key] == null || out[key] === ''){
            const v = ctx[k];
            if(v != null && v !== '') out[key] = String(v);
          }
        });
      }

      // Ensure hub exists if provided by ctx; else keep whatever
      return out;
    }

    function buildUrl(base, params){
      const u = new URL(base, location.href);
      Object.entries(params||{}).forEach(([k,v])=>{
        if(v === undefined || v === null || v === '') return;
        u.searchParams.set(k, String(v));
      });
      return u.toString();
    }

    // Decide view
    const params = mergeParams();
    if(!hasViewInUrl()){
      params.view = detectView();
    }

    // tiny debug UI
    try{
      const pillView = document.getElementById('pillView');
      const pillMode = document.getElementById('pillMode');
      const vRun  = document.getElementById('vRun');
      const vDiff = document.getElementById('vDiff');
      const vTime = document.getElementById('vTime');
      const vSeed = document.getElementById('vSeed');

      const view = String(params.view || '').toUpperCase();
      const run  = String(params.run || 'play').toUpperCase();
      if(pillView) pillView.textContent = 'VIEW: ' + (view || 'AUTO');
      if(pillMode) pillMode.textContent = 'MODE: ' + run;

      if(vRun)  vRun.textContent  = String(params.run  || 'play');
      if(vDiff) vDiff.textContent = String(params.diff || 'normal');
      if(vTime) vTime.textContent = String(params.time || '80');
      if(vSeed) vSeed.textContent = String(params.seed || '');
    }catch(_){}

    // Prefer using HHA_LAUNCH if available (keeps behavior consistent across games)
    function go(url){
      try{
        if(window.HHA_LAUNCH && typeof window.HHA_LAUNCH.go === 'function'){
          // If HHA_LAUNCH.go accepts url only, pass full url
          window.HHA_LAUNCH.go(url);
          return;
        }
      }catch(_){}
      location.replace(url);
    }

    const url = buildUrl(RUN_URL, params);
    go(url);
  })();
  </script>
</body>
</html>