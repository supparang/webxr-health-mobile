<!-- === /herohealth/goodjunk-vr.html (UPDATED) === -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health — GoodJunk VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    :root{
      color-scheme: light dark;
      --bg-main:#020617;
      --panel:#020617;
      --panel-soft:#0b1120;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,0.18);
      --danger:#f97316;
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.22), transparent 55%),
        var(--bg-main);
      color:var(--text-main);
      overflow:hidden;
    }
    a-scene{ width:100vw; height:100vh; position:fixed; inset:0; z-index:0; }

    /* ---------- STUN FX: border flash + shake ---------- */
    .stun-frame{
      position:fixed; inset:0;
      z-index:657;
      pointer-events:none;
      opacity:0;
      transition:opacity .12s ease-out;
    }
    .stun-frame::before{
      content:"";
      position:absolute; inset:10px;
      border-radius:22px;
      border:2px solid rgba(251,191,36,0.0);
      box-shadow:
        0 0 0 2px rgba(251,191,36,0.0),
        0 0 60px rgba(251,191,36,0.0);
    }
    body.stun-on .stun-frame{ opacity:1; }
    body.stun-on .stun-frame::before{
      animation: stunBorder 0.45s ease-in-out infinite;
    }
    @keyframes stunBorder{
      0%{
        border-color: rgba(251,191,36,0.30);
        box-shadow: 0 0 0 2px rgba(251,191,36,0.12), 0 0 50px rgba(249,115,22,0.10);
      }
      50%{
        border-color: rgba(251,191,36,0.85);
        box-shadow: 0 0 0 2px rgba(251,191,36,0.28), 0 0 80px rgba(249,115,22,0.22);
      }
      100%{
        border-color: rgba(251,191,36,0.35);
        box-shadow: 0 0 0 2px rgba(251,191,36,0.14), 0 0 60px rgba(249,115,22,0.14);
      }
    }

    body.stun-on #gj-layer{
      animation: stunShakeSoft 0.22s linear infinite;
    }
    body.stun-impact #gj-layer{
      animation: stunShakeImpact 0.08s linear infinite;
    }
    @keyframes stunShakeSoft{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(0.8px,-0.6px); }
      50%{ transform: translate(-0.6px,0.7px); }
      75%{ transform: translate(0.6px,0.6px); }
      100%{ transform: translate(0,0); }
    }
    @keyframes stunShakeImpact{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(2px,-2px); }
      50%{ transform: translate(-2px,2px); }
      75%{ transform: translate(2px,2px); }
      100%{ transform: translate(0,0); }
    }

    /* ---------- STUN FIRE overlay ---------- */
    .fire-overlay{
      position:fixed; inset:-20px;
      z-index:648;
      pointer-events:none;
      opacity:0;
      transition:opacity .18s ease-out, transform .18s ease-out;
      transform:scale(1.02);
      background:
        radial-gradient(circle at 50% 80%, rgba(251,191,36,0.22), transparent 50%),
        radial-gradient(circle at 20% 90%, rgba(244,63,94,0.18), transparent 55%),
        radial-gradient(circle at 80% 90%, rgba(249,115,22,0.18), transparent 55%);
      mix-blend-mode: screen;
      filter: blur(0.5px) saturate(1.25);
    }
    body.stun-on .fire-overlay{
      opacity:1;
      animation:firePulse .65s ease-in-out infinite;
    }
    @keyframes firePulse{
      0%{ opacity:0.70; transform:scale(1.01); }
      50%{ opacity:1; transform:scale(1.03); }
      100%{ opacity:0.75; transform:scale(1.01); }
    }

    /* ---------- DOM target layer ---------- */
    #gj-layer{
      position:fixed; inset:0;
      z-index:649;
      pointer-events:auto;
      touch-action:none;
      will-change: transform;
    }
    .gj-target{
      position:absolute;
      transform: translate(-50%,-50%) scale(var(--tScale, 1)) rotate(var(--tRot, 0deg));
      font-size: clamp(46px, 8.2vw, 82px);
      line-height:1;
      user-select:none;
      pointer-events:auto;
      cursor:pointer;
      padding: 8px 10px;
      border-radius: 18px;
      background: rgba(255,255,255,0.06);
      border: 2px solid rgba(255,255,255,0.22);
      box-shadow:
        0 18px 44px rgba(0,0,0,0.55),
        0 0 0 6px rgba(255,255,255,0.03) inset;
      backdrop-filter: blur(0.5px);
      opacity:0;
      transition: transform .12s ease-out, opacity .16s ease-out, filter .16s ease-out;
      will-change: transform, left, top, opacity;
    }
    .gj-target.in{ opacity:1; }
    .gj-target.gone{ opacity:0; transform:translate(-50%,-50%) scale(0.78) rotate(var(--tRot, 0deg)); }
    .gj-junk{ filter: drop-shadow(0 16px 26px rgba(249,115,22,0.28)); }
    .gj-gold{ filter: drop-shadow(0 18px 30px rgba(250,204,21,0.36)); }
    .gj-power{ filter: drop-shadow(0 18px 30px rgba(56,189,248,0.30)); }
    .gj-boss{ font-size: clamp(56px, 10.5vw, 118px); filter: drop-shadow(0 22px 38px rgba(250,204,21,0.28)); }

    /* ---------- STUN vortex indicator ---------- */
    .stun-vortex{
      position:fixed;
      width:86px; height:86px;
      border-radius:999px;
      transform: translate(-50%,-50%);
      z-index:652;
      pointer-events:none;
      opacity:0;
      transition:opacity .12s ease-out, transform .12s ease-out;
      background:
        radial-gradient(circle at center, rgba(56,189,248,0.28), rgba(56,189,248,0.02) 55%, transparent 70%),
        conic-gradient(from 0deg, rgba(250,204,21,0.35), rgba(34,197,94,0.22), rgba(56,189,248,0.35), rgba(250,204,21,0.35));
      filter: blur(0.2px) saturate(1.2);
      box-shadow: 0 0 40px rgba(56,189,248,0.18);
      animation: vortexSpin 0.65s linear infinite;
    }
    .stun-vortex.show{ opacity:1; }
    @keyframes vortexSpin{ to{ transform: translate(-50%,-50%) rotate(360deg); } }

    /* ---------- HUD / Start overlay / etc. (เหมือนเดิมจากไฟล์คุณ) ---------- */
    /* ... (คงเดิม) ... */

    /* ---------- End Summary Overlay ---------- */
    .end-overlay{
      position:fixed; inset:0;
      z-index:720;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:radial-gradient(circle at 50% 35%, rgba(56,189,248,0.18), transparent 55%), rgba(2,6,23,0.92);
    }
    .end-overlay.show{ display:flex; }
    .end-card{
      width:min(640px, 96vw);
      border-radius:22px;
      background:linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.84));
      border:1px solid rgba(148,163,184,0.2);
      box-shadow:0 30px 80px rgba(0,0,0,0.55);
      padding:16px 16px 14px;
      text-align:left;
    }
    .end-title{ font-size:18px; font-weight:950; margin:0 0 8px; }
    .end-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin:10px 0 12px;
    }
    .end-item{
      background:rgba(15,23,42,0.72);
      border:1px solid rgba(148,163,184,0.18);
      border-radius:16px;
      padding:10px;
    }
    .end-k{ font-size:11px; color:var(--text-soft); text-transform:uppercase; letter-spacing:.12em; }
    .end-v{ font-size:16px; font-weight:950; margin-top:4px; }
    .end-row{ display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; }
    .end-btn{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.86);
      color:var(--text-main);
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
    }
    .end-btn.primary{
      border-color: rgba(187,247,208,0.9);
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#052e16;
    }
  </style>

  <script src="./vr/particles.js"></script>
  <script src="./vr/ui-fever.js"></script>
  <script src="./vr/hha-summary.js"></script>
  <script src="./vr/hha-cloud-logger.js"></script>

  <script type="module">
    const $ = (sel) => document.querySelector(sel);
    function setBadge(ok, msg){
      const dot = $('#logdot');
      const text = $('#logtext');
      if (dot) dot.className = 'dot ' + (ok ? 'ok' : 'bad');
      if (text) text.textContent = msg;
    }
    async function loadBoot(){
      const candidates = ['./vr-goodjunk/goodjunk-vr.boot.js'];
      let lastErr = null;
      for (const p of candidates){
        try{
          const mod = await import(p);
          const bootFn = mod.boot || mod.default;
          if (typeof bootFn === 'function'){
            setBadge(true, 'boot: ' + p);
            bootFn();
            return;
          }
          lastErr = new Error('Boot loaded but no boot/default: ' + p);
        }catch(e){ lastErr = e; }
      }
      console.error('[GoodJunk] BOOT LOAD FAILED', lastErr);
      setBadge(false, 'boot failed: ' + (lastErr?.message || 'unknown'));
    }
    window.addEventListener('load', () => { setBadge(false, 'boot: loading…'); loadBoot(); });
  </script>
</head>

<body>
  <div class="fire-overlay" id="fire-overlay"></div>
  <div class="stun-frame" id="stun-frame"></div>

  <a-scene embedded vr-mode-ui="enabled:false" renderer="colorManagement:true; physicallyCorrectLights:true">
    <a-entity id="gj-rig" rotation="0 0 0">
      <a-entity id="gj-camera" camera look-controls="enabled:true" position="0 1.6 0"></a-entity>
    </a-entity>
    <a-entity light="type: ambient; intensity: 1.0"></a-entity>
    <a-entity light="type: directional; intensity: 0.7" position="1 2 1"></a-entity>
    <a-sky color="#061225"></a-sky>
  </a-scene>

  <div id="gj-layer"></div>
  <div class="stun-vortex" id="stun-vortex"></div>

  <!-- (HUD + start overlay + logger badge + VR button คงเดิมของคุณ) -->
  <!-- ... วาง HUD/Start เดิมจากไฟล์คุณ ... -->

  <!-- ✅ End Summary -->
  <div class="end-overlay" id="end-overlay">
    <div class="end-card">
      <h2 class="end-title">สรุปผลเกม (GOODJUNK)</h2>
      <div style="color:var(--text-soft); font-size:13px;">
        Diff: <b id="end-diff">—</b> • Challenge: <b id="end-ch">—</b>
        • Goals ผ่าน <b id="end-goals">0</b> • Mini ผ่าน <b id="end-minis">0</b>
      </div>

      <div class="end-grid">
        <div class="end-item"><div class="end-k">Score</div><div class="end-v" id="end-score">0</div></div>
        <div class="end-item"><div class="end-k">Good Hits</div><div class="end-v" id="end-good">0</div></div>
        <div class="end-item"><div class="end-k">Miss</div><div class="end-v" id="end-miss">0</div></div>
        <div class="end-item"><div class="end-k">Combo Max</div><div class="end-v" id="end-combo">0</div></div>
        <div class="end-item"><div class="end-k">Gold</div><div class="end-v" id="end-gold">0</div></div>
        <div class="end-item"><div class="end-k">Fever (end)</div><div class="end-v" id="end-fever">0%</div></div>
      </div>

      <div class="end-row">
        <button class="end-btn" id="btn-end-close" type="button">ปิด</button>
        <button class="end-btn primary" id="btn-end-restart" type="button">เล่นใหม่</button>
      </div>
    </div>
  </div>
</body>
</html>
