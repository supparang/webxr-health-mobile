<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR LAUNCHER ‚Äî ROOT (Warmup Gate)
‚úÖ Hub -> launcher -> warmup-gate (phase=warmup) -> run (./vr-goodjunk/goodjunk-vr.html)
‚úÖ Prevent loop: if wType exists (already warmed) -> go run directly
‚úÖ Pass-through: all params except internal launcher keys
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunkVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{ --bg:#020617; --panel:rgba(2,6,23,.72); --stroke:rgba(148,163,184,.18); --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e; --sat: env(safe-area-inset-top,0px); --sab: env(safe-area-inset-bottom,0px); }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial; background:
      radial-gradient(900px 520px at 20% 15%, rgba(34,197,94,.14), transparent 55%),
      linear-gradient(180deg, #0b1226, var(--bg));
    }
    .wrap{ height:100%; display:flex; align-items:center; justify-content:center; padding: calc(14px + var(--sat)) 14px calc(14px + var(--sab)); }
    .card{ width:min(860px,100%); border:1px solid var(--stroke); background: linear-gradient(180deg, rgba(2,6,23,.72), rgba(2,6,23,.55)); border-radius:22px; padding:16px; box-shadow: 0 18px 60px rgba(0,0,0,.45); }
    .h{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; }
    .title{ margin:0; font-weight:1000; letter-spacing:.2px; font-size:18px; }
    .sub{ margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.4; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:var(--muted); }
    .pill{ border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; font-size:12px; color:var(--muted); }
    .pill b{ color:var(--text); font-weight:1000; }
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{ border:1px solid var(--stroke); background: rgba(2,6,23,.55); color:var(--text); padding:10px 12px; border-radius:14px; cursor:pointer; font-weight:1000; }
    .btn.primary{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.14); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="h">
        <div>
          <div class="title">üç≠ GoodJunk VR ‚Äî Launcher</div>
          <p class="sub">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ <b>Warmup Gate</b> ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á‚Ä¶</p>
        </div>
        <div class="pill">mode: <b id="modeText">‚Äî</b></div>
      </div>
      <div class="mono" id="dbg" style="margin-top:10px;"></div>
      <div class="btnrow">
        <button class="btn primary" id="btnGo">‡πÑ‡∏õ‡πÄ‡∏•‡∏¢</button>
        <button class="btn" id="btnHub">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const RUN_PATH = './vr-goodjunk/goodjunk-vr.html'; // ‚úÖ run ‡∏à‡∏£‡∏¥‡∏á
  const WARMUP_GATE = './warmup-gate.html';

  function qs(){ try{ return new URL(location.href).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = qs();
  const q = (k, d='') => (QS.get(k) ?? d);

  function getPid(){
    return (q('pid','') || q('studyId','') || 'anon').trim() || 'anon';
  }

  function getView(){
    // ‚úÖ do not override if view exists
    const v = (q('view','')||'').toLowerCase();
    if(v) return v;
    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
    return isMobile ? 'mobile' : 'pc';
  }

  function passthrough(denySet){
    const deny = denySet || new Set();
    const out = {};
    QS.forEach((v,k)=>{ if(!deny.has(k)) out[k]=v; });
    return out;
  }

  function buildUrl(base, add){
    const u = new URL(base, location.href);
    Object.entries(add||{}).forEach(([k,v])=>{
      if(v===undefined || v===null || String(v).trim()==='') return;
      u.searchParams.set(k, String(v));
    });
    return u.toString();
  }

  const HUB = q('hub','') || './hub.html';

  function goHub(){ location.href = HUB; }

  function goRun(){
    const deny = new Set(['next','phase','dur','cdur','games','autonext','wmode','skipWarmup']);
    const add = passthrough(deny);
    if(!add.hub) add.hub = HUB;
    if(!add.pid) add.pid = getPid();
    if(!add.view) add.view = getView();
    location.href = buildUrl(RUN_PATH, add);
  }

  function goWarmup(){
    const deny = new Set(['next','phase','dur','cdur','games','autonext','wmode']);
    const ctx = passthrough(deny);

    if(!ctx.hub) ctx.hub = HUB;
    if(!ctx.pid) ctx.pid = getPid();
    if(!ctx.view) ctx.view = getView();

    const dur = q('dur','20') || '20';
    location.href = buildUrl(WARMUP_GATE, {
      phase: 'warmup',
      dur,
      next: RUN_PATH,
      hub: HUB,
      autonext: '1',
      wmode: 'random',
      ...ctx
    });
  }

  // prevent loop: warmup already done => has wType (or wPct)
  const alreadyWarm = !!(q('wType','') || q('wPct',''));
  const skipWarm = (q('skipWarmup','0') === '1');

  document.getElementById('modeText').textContent = alreadyWarm ? 'RUN (warmed)' : 'WARMUP ‚Üí RUN';
  document.getElementById('dbg').textContent =
    `pid=${getPid()}  view=${getView()}  warmed=${alreadyWarm?1:0}  skipWarmup=${skipWarm?1:0}`;

  document.getElementById('btnHub').addEventListener('click', goHub);
  document.getElementById('btnGo').addEventListener('click', ()=>{
    if(skipWarm || alreadyWarm) goRun();
    else goWarmup();
  });

  // auto
  if(skipWarm || alreadyWarm) goRun();
  else goWarmup();

})();
</script>
</body>
</html>