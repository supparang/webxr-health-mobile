<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR (PRODUCTION) ‚Äî HHA Standard + Stereo/Cardboard scaffolding
‚úÖ DOM emoji targets on #gj-layer
‚úÖ HUD + Quest + Coach + Fever/Shield (Normal mode)
‚úÖ Stereo mode (body.gj-stereo): uses split eyes + VR HUD + dual shoot
‚úÖ Boot module -> safe engine + touch-look
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- Main CSS (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å) -->
  <link rel="stylesheet" href="./vr-goodjunk/goodjunk-vr.css" />

  <!-- Global modules (IIFE) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- Boot (ESM) -->
  <script type="module" src="./vr-goodjunk/goodjunk-vr.boot.js"></script>
</head>

<body>
  <!-- ===== HUD (Normal mode) ===== -->
  <div class="hha-hud">
    <div class="hud-top">
      <div class="hud-badge">
        <div class="hud-title">GoodJunkVR</div>
        <div class="hud-sub" id="hudMeta">‚Äî</div>
      </div>

      <div class="hud-stats">
        <div class="hud-stat"><div class="k">Score</div><div class="v" id="hhaScore">0</div></div>
        <div class="hud-stat"><div class="k">Combo</div><div class="v" id="hhaCombo">0</div></div>
        <div class="hud-stat"><div class="k">Miss</div><div class="v" id="hhaMiss">0</div></div>
        <div class="hud-stat"><div class="k">Time</div><div class="v" id="hhaTime">0</div></div>
        <div class="hud-stat grade"><div class="k">Grade</div><div class="v" id="hhaGrade">‚Äî</div></div>
      </div>
    </div>

    <div class="hud-mid">
      <div class="hud-quest">
        <div class="q-row">
          <div class="q-title" id="hudGoalTitle">Goal: ‚Äî</div>
          <div class="q-count" id="hudGoalCount">0/0</div>
        </div>
        <div class="q-row">
          <div class="q-title mini" id="hudMiniTitle">Mini: ‚Äî</div>
          <div class="q-count" id="hudMiniCount">0/0</div>
          <div class="q-timer" id="hudMiniTimer"></div>
        </div>
        <div class="q-progress" id="hudQProgress">Goals 0/0 ‚Ä¢ Minis 0/0</div>
      </div>

      <div class="hud-coach">
        <img id="hudCoachImg" class="coach-img" src="./img/coach-neutral.png" alt="coach" />
        <div class="coach-talk">
          <div class="coach-line" id="hudCoachLine">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡∏´‡∏•‡∏µ‡∏Å‡∏Ç‡∏¢‡∏∞ ü•¶üö´</div>
          <div class="coach-sub" id="hudCoachSub">‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏¢‡∏¥‡∏á / ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏Å‡πá‡πÑ‡∏î‡πâ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Fever/Shield UI (Normal mode) ===== -->
  <div class="hha-fever" id="hhaFever">
    <div class="fever-row">
      <div class="fever-label">FEVER</div>
      <div class="fever-bar"><div class="fever-fill" id="feverBar"></div></div>
      <div class="fever-text" id="feverText">0%</div>
    </div>
    <div class="shield-row">
      <div class="shield-label">SHIELD</div>
      <div class="shield-pills" id="shieldPills"></div>
    </div>
  </div>

  <!-- ===== Stereo VR HUD (Cardboard) ===== -->
  <div class="gj-vr-hud" aria-hidden="false">
    <div class="eye l">
      <div class="row"><span class="k">Score</span><span class="v" id="vrScoreL">0</span></div>
      <div class="row"><span class="k">Combo</span><span class="v" id="vrComboL">0</span></div>
      <div class="row"><span class="k">Miss</span><span class="v" id="vrMissL">0</span></div>
      <div class="row"><span class="k">Time</span><span class="v" id="vrTimeL">0</span></div>
      <div class="row"><span class="k">Grade</span><span class="v" id="vrGradeL">‚Äî</span></div>
    </div>
    <div class="eye r">
      <div class="row"><span class="k">Score</span><span class="v" id="vrScoreR">0</span></div>
      <div class="row"><span class="k">Combo</span><span class="v" id="vrComboR">0</span></div>
      <div class="row"><span class="k">Miss</span><span class="v" id="vrMissR">0</span></div>
      <div class="row"><span class="k">Time</span><span class="v" id="vrTimeR">0</span></div>
      <div class="row"><span class="k">Grade</span><span class="v" id="vrGradeR">‚Äî</span></div>
    </div>
  </div>

  <!-- ===== Playfield (Stereo-ready) ===== -->
  <div id="gj-stage">
    <!-- Left eye -->
    <section class="gj-eye" id="gj-eyeL" aria-label="left eye">
      <div id="gj-layer" aria-label="targets layer (L)"></div>
      <div id="gj-crosshair" aria-hidden="true"></div>
      <div id="atk-ring" aria-hidden="true"></div>
      <div id="atk-laser" aria-hidden="true"></div>
      <div id="end-summary"></div>
    </section>

    <!-- Right eye (shown only when body.gj-stereo) -->
    <section class="gj-eye" id="gj-eyeR" aria-label="right eye">
      <div id="gj-layerR" aria-label="targets layer (R)"></div>
      <div id="gj-crosshairR" aria-hidden="true"></div>
      <div id="atk-ringR" aria-hidden="true"></div>
      <div id="atk-laserR" aria-hidden="true"></div>
      <div id="end-summaryR"></div>
    </section>
  </div>

  <!-- ===== Controls (Normal mode) ===== -->
  <div class="hha-controls">
    <button id="btnShoot" class="btn-shoot">‡∏¢‡∏¥‡∏á</button>
  </div>

  <!-- ===== Stereo VR Controls (Dual shoot buttons) ===== -->
  <div class="gj-vr-controls" aria-hidden="false">
    <button id="btnShootL" class="btn-shoot vr">‡∏¢‡∏¥‡∏á ‚óÄ</button>
    <button id="btnShootR" class="btn-shoot vr">‡∏¢‡∏¥‡∏á ‚ñ∂</button>
  </div>

  <!-- ===== Start Overlay (Stereo split via CSS patch) ===== -->
  <div id="startOverlay" class="start-overlay">
    <div class="start-card">
      <div class="start-title">GoodJunk VR</div>
      <div class="start-desc">
        ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ü•¶ ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡∏Ç‡∏¢‡∏∞ üçü<br/>
        <span class="muted">‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏ô‡∏∏‡πà‡∏° ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏≠‡∏á</span>
      </div>
      <div class="start-meta" id="startMeta">‚Äî</div>
      <button id="btnStart" class="btn-start">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
    </div>

    <!-- clone for right eye (Stereo) -->
    <div class="start-card clone" aria-hidden="true">
      <div class="start-title">GoodJunk VR</div>
      <div class="start-desc">
        ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ü•¶ ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡∏Ç‡∏¢‡∏∞ üçü<br/>
        <span class="muted">‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏ô‡∏∏‡πà‡∏° ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏≠‡∏á</span>
      </div>
      <div class="start-meta" id="startMetaR">‚Äî</div>
      <button id="btnStartR" class="btn-start">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
    </div>
  </div>

  <!-- ===== Stereo glue (no boot changes) ===== -->
  <script>
  (function(){
    const qs = new URLSearchParams(location.search);
    const stereo = (qs.get('stereo') === '1' || qs.get('cardboard') === '1');

    if (stereo) document.body.classList.add('gj-stereo');
    else document.body.classList.remove('gj-stereo');

    // Start (R) -> Start (main)
    const btnStart = document.getElementById('btnStart');
    const btnStartR = document.getElementById('btnStartR');
    if (btnStart && btnStartR){
      const go = ()=>{ try{ btnStart.click(); }catch(_){ } };
      btnStartR.addEventListener('click', go, { passive:true });
      btnStartR.addEventListener('pointerdown', (e)=>{ e.preventDefault(); go(); }, { passive:false });
      btnStartR.addEventListener('touchstart', (e)=>{ e.preventDefault(); go(); }, { passive:false });
    }

    // Dual shoot -> original shoot
    const btnShoot = document.getElementById('btnShoot');
    const btnShootL = document.getElementById('btnShootL');
    const btnShootR = document.getElementById('btnShootR');
    const fire = ()=>{ try{ btnShoot && btnShoot.click(); }catch(_){ } };
    [btnShootL, btnShootR].forEach(b=>{
      if (!b) return;
      b.addEventListener('click', fire, { passive:true });
      b.addEventListener('pointerdown', (e)=>{ e.preventDefault(); fire(); }, { passive:false });
      b.addEventListener('touchstart', (e)=>{ e.preventDefault(); fire(); }, { passive:false });
    });

    // Mirror end summary L -> R (so end overlay appears in both eyes)
    const endL = document.getElementById('end-summary');
    const endR = document.getElementById('end-summaryR');
    if (endL && endR && window.MutationObserver){
      const mo = new MutationObserver(()=>{ endR.innerHTML = endL.innerHTML; });
      mo.observe(endL, { childList:true, subtree:true, attributes:true, characterData:true });
    }

    // Mirror startMeta -> startMetaR
    const metaL = document.getElementById('startMeta');
    const metaR = document.getElementById('startMetaR');
    if (metaL && metaR && window.MutationObserver){
      const mo2 = new MutationObserver(()=>{ metaR.textContent = metaL.textContent; });
      mo2.observe(metaL, { childList:true, subtree:true, characterData:true });
    }

    // VR HUD listens to events
    const set2 = (idL, idR, val)=>{
      const a = document.getElementById(idL);
      const b = document.getElementById(idR);
      if (a) a.textContent = val;
      if (b) b.textContent = val;
    };

    window.addEventListener('hha:score', (ev)=>{
      const d = (ev && ev.detail) || {};
      set2('vrScoreL','vrScoreR', String(d.score ?? 0));

      // combo: prefer current combo if present; else comboMax
      const c = (d.combo != null) ? d.combo : (d.comboMax != null ? d.comboMax : 0);
      set2('vrComboL','vrComboR', String(c));

      const m = (d.misses != null) ? d.misses : (d.miss != null ? d.miss : 0);
      set2('vrMissL','vrMissR', String(m));
    });

    window.addEventListener('hha:time', (ev)=>{
      const d = (ev && ev.detail) || {};
      set2('vrTimeL','vrTimeR', String(d.sec ?? d.left ?? 0));
    });

    // grade event (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    window.addEventListener('hha:rank', (ev)=>{
      const d = (ev && ev.detail) || {};
      set2('vrGradeL','vrGradeR', String(d.grade ?? '‚Äî'));
    });
  })();
  </script>
</body>
</html>