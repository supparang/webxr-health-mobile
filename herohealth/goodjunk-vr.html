<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
  <title>ü•¶ Good vs Junk VR ‚Äî Hero Health</title>
  <meta name="color-scheme" content="dark light"/>

  <link rel="icon" href="./favicon.ico" type="image/x-icon"/>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏ó‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI -->
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      color-scheme: dark light;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      overflow:hidden;
      font-family:'IBM Plex Sans Thai',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡πá‡∏Å ‡∏õ.5 ‚Äî ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• + ‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏° ‡πÜ */
      background:
        radial-gradient(circle at 0% 0%, #e0f2fe 0, transparent 55%),
        radial-gradient(circle at 100% 0%, #fee2e2 0, transparent 55%),
        radial-gradient(circle at 0% 100%, #dcfce7 0, transparent 55%),
        radial-gradient(circle at 100% 100%, #fef9c3 0, transparent 55%),
        #020617;
      color:#e5e7eb;
    }

    /* ===== UI Overlay (Start / Result) ===== */
    #uiOverlay{
      position:fixed;
      inset:0;
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      padding:16px;
      text-align:center;
      color:#0f172a;
      transition:opacity .28s ease, visibility .28s ease;
    }
    #uiOverlay::before,
    #uiOverlay::after{
      content:"";
      position:absolute;
      inset:12%;
      border-radius:32px;
      background:
        radial-gradient(circle at 10% 20%, rgba(56,189,248,.25) 0, transparent 55%),
        radial-gradient(circle at 90% 80%, rgba(52,211,153,.25) 0, transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(251,146,60,.25) 0, transparent 55%);
      filter:blur(2px);
      z-index:-2;
    }
    #uiOverlay::after{
      inset:20%;
      background:
        radial-gradient(circle at 0% 100%, rgba(129,140,248,.28) 0, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(248,250,252,.5) 0, transparent 50%);
      opacity:.9;
    }
    #uiOverlay.hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }

    .ui-card{
      position:relative;
      max-width:520px;
      width:100%;
      padding:20px 20px 18px;
      border-radius:24px;
      background:rgba(15,23,42,.88);
      border:1px solid rgba(148,163,184,.9);
      box-shadow:0 24px 60px rgba(15,23,42,.9);
      color:#e5e7eb;
      backdrop-filter:blur(14px);
    }

    .ui-card h1{
      margin:0 0 6px;
      font-size:1.8rem;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.35em;
    }
    .ui-card h1 span.small{
      font-size:1.1rem;
      font-weight:400;
      opacity:.9;
    }
    .ui-card p{
      margin:4px 0 14px;
      font-size:.95rem;
      opacity:.9;
    }

    .kid-chip-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:6px;
      font-size:.8rem;
      margin-bottom:10px;
    }
    .kid-chip{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.6);
      display:flex;
      align-items:center;
      gap:4px;
      color:#e5e7eb;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px;
      margin-top:6px;
    }
    .game-button{
      font-family:'IBM Plex Sans Thai',system-ui;
      font-weight:700;
      font-size:.95rem;
      padding:10px 18px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      color:#f9fafb;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      box-shadow:0 10px 25px rgba(34,197,94,.45);
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .game-button span.lvl{
      padding:1px 8px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      font-size:.75rem;
    }
    .game-button:hover{
      transform:translateY(-1px);
      filter:brightness(1.03);
      box-shadow:0 16px 32px rgba(34,197,94,.55);
    }
    .game-button.hard{
      background:linear-gradient(135deg,#f97316,#ef4444);
      box-shadow:0 10px 25px rgba(239,68,68,.55);
    }

    #resultsScreen h2{
      margin:0 0 6px;
      font-size:1.5rem;
      color:#fbbf24;
    }
    #finalScore{
      margin:0 0 6px;
      font-size:1.8rem;
      color:#f9fafb;
    }
    .result-line{
      font-size:.9rem;
      opacity:.9;
      margin-bottom:2px;
    }
    #finalGrade{
      font-size:1.6rem;
      margin:6px 0 10px;
    }

    @media (max-width:600px){
      .ui-card{
        padding:16px 14px 14px;
        border-radius:20px;
      }
      .ui-card h1{
        font-size:1.45rem;
      }
      .ui-card p{
        font-size:.9rem;
      }
      .game-button{
        width:100%;
        justify-content:center;
      }
    }

    /* ===== A-Frame Canvas full screen ===== */
    a-scene{
      position:fixed !important;
      inset:0;
    }

    /* ===== HUD ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤/‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö/‡∏û‡∏•‡∏≤‡∏î (‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô) ===== */
    #hhaHudVR{
      position:fixed;
      left:12px;
      top:12px;
      z-index:950;
      padding:8px 12px;
      border-radius:14px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.95);
      color:#e5e7eb;
      font:600 13px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Thonburi,sans-serif;
      box-shadow:0 14px 40px rgba(15,23,42,.9);
      backdrop-filter:blur(8px);
    }
    #hhaHudVR .line{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:2px;
    }
    #hhaHudVR .line:last-child{ margin-bottom:0; }
    #hhaHudVR .big{ font-size:15px; }
    #hhaHudVR .pill{
      padding:2px 8px;
      border-radius:999px;
      background:rgba(56,189,248,.15);
    }
    #hhaHudVR .bad{ color:#fecaca; }

    /* ===== Quest Panel (Goal + Mini) ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô ===== */
    #hhaQuestPanel{
      position:fixed;
      right:12px;
      top:12px;
      z-index:950;
      max-width:280px;
      padding:8px 10px;
      border-radius:14px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.9);
      color:#e5e7eb;
      font:600 12px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Thonburi,sans-serif;
      box-shadow:0 14px 40px rgba(15,23,42,.85);
      backdrop-filter:blur(8px);
    }
    #hhaQuestPanel h3{
      margin:0 0 4px;
      font-size:12px;
      letter-spacing:.03em;
      text-transform:uppercase;
      color:#a5b4fc;
    }
    .quest-main{
      margin-bottom:4px;
      font-size:12px;
    }
    .quest-mini{
      font-size:11px;
      opacity:.95;
    }
    .quest-label{
      font-weight:600;
    }
    .quest-progress{
      font-weight:500;
      color:#bbf7d0;
    }
    .quest-hint{
      margin-top:4px;
      font-size:11px;
      color:#e5e7eb;
      opacity:.9;
    }

    /* ===== Grade Bar (‡∏ö‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠) ===== */
    #gradeHud{
      position:fixed;
      left:50%;
      top:12px;
      transform:translateX(-50%);
      z-index:940;
      min-width:160px;
      max-width:260px;
      padding:6px 10px 8px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.9);
      font:600 12px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Thonburi,sans-serif;
      color:#e5e7eb;
      box-shadow:0 12px 32px rgba(15,23,42,.9);
      backdrop-filter:blur(8px);
    }
    #gradeHudTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }
    #gradeLabel{
      font-size:11px;
      opacity:.9;
    }
    #gradeText{
      font-size:16px;
    }
    #gradeBarOuter{
      width:100%;
      height:6px;
      border-radius:999px;
      background:rgba(30,64,175,.7);
      overflow:hidden;
    }
    #gradeBarFill{
      width:0%;
      height:100%;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#a3e635);
      transition:width .25s ease;
    }

    @media (max-width:640px){
      #hhaHudVR{
        left:8px;
        top:8px;
        padding:6px 9px;
        font-size:12px;
      }
      #hhaHudVR .big{ font-size:13px; }
      #hhaQuestPanel{
        right:8px;
        top:8px;
        max-width:220px;
        padding:6px 8px;
      }
      #gradeHud{
        top:54px;
      }
    }
  </style>
</head>
<body>

  <!-- ===== UI Overlay (Start + Result) ===== -->
  <div id="uiOverlay">
    <div id="startScreen" class="ui-card">
      <h1>ü•¶ Good vs Junk VR <span class="small">Hero Health</span></h1>
      <p>
        ‡πÄ‡∏•‡πá‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏¢‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‚Äù ‡∏Å‡∏±‡∏ö ‚Äú‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏±‡∏õ‚Äù ‚≠êüíé<br/>
        ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞ üçüüç© ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!
      </p>

      <div class="kid-chip-row">
        <div class="kid-chip">üçé ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ú‡∏±‡∏Å‚Äì‡∏ú‡∏•‡πÑ‡∏°‡πâ‚Äì‡∏ô‡∏° ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÜ</div>
        <div class="kid-chip">‚è± ‡πÄ‡∏Å‡∏°‡∏¢‡∏≤‡∏ß ~60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
        <div class="kid-chip">üéØ ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á PC / Mobile / VR Headset</div>
      </div>

      <div class="btn-row">
        <button class="game-button" id="startButtonEasy">
          üå± ‡∏á‡πà‡∏≤‡∏¢
          <span class="lvl">Easy</span>
        </button>
        <button class="game-button" id="startButtonNormal">
          ‚öñÔ∏è ‡∏õ‡∏Å‡∏ï‡∏¥
          <span class="lvl">Normal</span>
        </button>
        <button class="game-button hard" id="startButtonHard">
          üî• ‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢
          <span class="lvl">Hard</span>
        </button>
      </div>
    </div>

    <div id="resultsScreen" class="ui-card" style="display:none;">
      <h2>‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h2>
      <h1 id="finalScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</h1>
      <div id="finalGrade">‡πÄ‡∏Å‡∏£‡∏î: C</div>
      <div class="result-line" id="resultDetailMain">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ô‡∏∞ üéØ</div>
      <div class="result-line" id="resultDetailCombo"></div>
      <div class="result-line" id="resultDetailMiss"></div>

      <div class="btn-row" style="margin-top:12px;">
        <button class="game-button" id="playAgainButton">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚ñ∂</button>
      </div>
    </div>
  </div>

  <!-- ===== HUD Quest Panel ===== -->
  <div id="hhaQuestPanel" style="display:none;">
    <h3>Quest Board</h3>
    <div class="quest-main">
      <span class="quest-label" id="questGoalLabel">Goal: -</span><br/>
      <span class="quest-progress" id="questGoalProg"></span>
    </div>
    <div class="quest-mini">
      <span class="quest-label" id="questMiniLabel">Mini: -</span><br/>
      <span class="quest-progress" id="questMiniProg"></span>
      <div class="quest-hint" id="questHint"></div>
    </div>
  </div>

  <!-- ===== Grade Bar HUD ===== -->
  <div id="gradeHud">
    <div id="gradeHudTop">
      <span id="gradeLabel">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
      <span id="gradeText">C</span>
    </div>
    <div id="gradeBarOuter">
      <div id="gradeBarFill"></div>
    </div>
  </div>

  <!-- ===== A-Frame Scene ===== -->
  <a-scene id="gameScene"
           renderer="colorManagement: true"
           loading-screen="dotsColor: white; backgroundColor: #0b1222"
           background="color: #020617">

    <!-- Ambient + Directional light -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.6"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.4" position="-0.5 1 1"></a-entity>

    <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô/‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera id="camera" look-controls="pointerLockEnabled: true">
        <a-cursor id="cursor"
                  raycaster="objects: [data-hha-tgt]; interval: 50"
                  fuse="true"
                  fuse-timeout="900"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.018"
                  material="color: #ffffff; shader: flat; opacity: 0.95"
                  position="0 0 -1">
        </a-cursor>
      </a-camera>

      <!-- ‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ (VR controller) -->
      <a-entity id="rightHand"
                laser-controls="hand: right"
                raycaster="objects: [data-hha-tgt]; interval: 30">
      </a-entity>
    </a-entity>
  </a-scene>

  <!-- ===== Launcher + ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° GameEngineVR (ES Module) ===== -->
  <script type="module">
    import { GameEngine } from './vr-goodjunk/GameEngine.js';
    import { initCloudLogger } from './vr/hha-cloud-logger.js';

    // ---- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Cloud Logger (‡πÑ‡∏õ Google Apps Script) ----
    initCloudLogger({
      endpoint: 'https://script.google.com/macros/s/AKfycbxNor4osZ3NI_pGtYd8hGlwyMRTF9J2I4kCFiHUO-G_4VBj2ZqtTXiqsFU8KWDqRSTQ/exec',
      projectTag: 'HeroHealth-GoodJunkVR',
      debug: true   // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ true, ‡∏ñ‡πâ‡∏≤ production ‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô false ‡∏Å‡πá‡πÑ‡∏î‡πâ
    });

    const uiOverlay     = document.getElementById('uiOverlay');
    const startScreen   = document.getElementById('startScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const finalScoreEl  = document.getElementById('finalScore');
    const resultComboEl = document.getElementById('resultDetailCombo');
    const resultMissEl  = document.getElementById('resultDetailMiss');

    const btnEasy   = document.getElementById('startButtonEasy');
    const btnNormal = document.getElementById('startButtonNormal');
    const btnHard   = document.getElementById('startButtonHard');
    const btnAgain  = document.getElementById('playAgainButton');

    const GAME_DURATION_MS = 60_000; // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö logic ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    let gameTimer = null;
    let currentDifficulty = 'normal';

    function hideOverlay(){
      uiOverlay.classList.add('hidden');
    }
    function showStart(){
      resultsScreen.style.display = 'none';
      startScreen.style.display   = 'block';
      uiOverlay.classList.remove('hidden');
    }
    function showResult(score, extra = {}){
      startScreen.style.display   = 'none';
      resultsScreen.style.display = 'block';
      uiOverlay.classList.remove('hidden');

      finalScoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score|0}`;
      if (typeof extra.comboMax === 'number'){
        resultComboEl.textContent = `‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: x${extra.comboMax|0}`;
      }else{
        resultComboEl.textContent = '';
      }
      if (typeof extra.misses === 'number'){
        resultMissEl.textContent = `‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${extra.misses|0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
      }else{
        resultMissEl.textContent = '';
      }
    }

    function clearGameTimer(){
      if (gameTimer){
        clearTimeout(gameTimer);
        gameTimer = null;
      }
    }

    function startGame(diff){
      currentDifficulty = diff || 'normal';
      clearGameTimer();

      hideOverlay();

      // ‡πÄ‡∏£‡∏¥‡πà‡∏° Engine ‡∏ù‡∏±‡πà‡∏á VR
      GameEngine.start(currentDifficulty);

      // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà 60 ‡∏ß‡∏¥ (‡∏Å‡∏±‡∏ô‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏≤‡∏ß)
      gameTimer = setTimeout(()=>{
        GameEngine.stop();
        const score  = (window.score|0) || 0;
        const comboM = (window.comboMax|0) || 0;
        const miss   = (window.misses|0)  || 0;
        showResult(score, { comboMax: comboM, misses: miss });
      }, GAME_DURATION_MS);
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
    btnEasy  .addEventListener('click', ()=> startGame('easy'));
    btnNormal.addEventListener('click', ()=> startGame('normal'));
    btnHard  .addEventListener('click', ()=> startGame('hard'));

    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å
    btnAgain.addEventListener('click', ()=>{
      resultsScreen.style.display = 'none';
      startScreen.style.display   = 'block';
    });

    // ‡∏ñ‡πâ‡∏≤ Engine ‡∏¢‡∏¥‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì hha:end ‡∏°‡∏≤‡πÄ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô‡∏à‡∏ö‡πÄ‡∏ß‡∏•‡∏≤/‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å)
    window.addEventListener('hha:end', (ev)=>{
      clearGameTimer();
      const d = ev && ev.detail ? ev.detail : {};
      const score  = (typeof d.scoreFinal === 'number') ? d.scoreFinal
                    : (typeof d.score === 'number')      ? d.score
                    : ((window.score|0) || 0);
      const comboM = (typeof d.comboMax === 'number')    ? d.comboMax
                    : ((window.comboMax|0) || 0);
      const miss   = (typeof d.misses === 'number')      ? d.misses
                    : ((window.misses|0)  || 0);

      showResult(score, { comboMax: comboM, misses: miss });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏ô‡πâ‡∏≤ Start
    showStart();
  </script>

  <!-- ===== HUD ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / ‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö / ‡∏û‡∏•‡∏≤‡∏î (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà module) ===== -->
  <script>
  (function(){
    'use strict';

    const HUD_ID = 'hhaHudVR';
    const GAME_SECONDS = 60; // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 60 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏°

    let wrap, scoreEl, comboEl, missEl, timeEl;
    let running = false;
    let timerId = null;

    function createHud(){
      if (wrap && document.getElementById(HUD_ID)) return wrap;

      wrap = document.createElement('div');
      wrap.id = HUD_ID;
      wrap.setAttribute('data-hha-ui','');

      wrap.innerHTML = `
        <div class="line big">
          <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="hudScoreVR">0</span></span>
          <span class="pill">‡πÄ‡∏ß‡∏•‡∏≤: <span id="hudTimeVR">${GAME_SECONDS}</span>s</span>
        </div>
        <div class="line">
          <span>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö: <span id="hudComboVR">0</span></span>
          <span>‡∏û‡∏•‡∏≤‡∏î: <span id="hudMissVR" class="bad">0</span></span>
        </div>
      `;
      document.body.appendChild(wrap);

      scoreEl = document.getElementById('hudScoreVR');
      comboEl = document.getElementById('hudComboVR');
      missEl  = document.getElementById('hudMissVR');
      timeEl  = document.getElementById('hudTimeVR');

      return wrap;
    }

    function startTimer(){
      createHud();
      if (timerId) clearInterval(timerId);
      let left = GAME_SECONDS;
      if (timeEl) timeEl.textContent = left;
      running = true;

      timerId = setInterval(function(){
        if (!running){
          clearInterval(timerId);
          timerId = null;
          return;
        }
        left--;
        if (left < 0) left = 0;
        if (timeEl) timeEl.textContent = left;
        if (left <= 0){
          clearInterval(timerId);
          timerId = null;
          running = false;
        }
      }, 1000);
    }

    function stopTimer(){
      running = false;
      if (timerId){
        clearInterval(timerId);
        timerId = null;
      }
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ hha:score
    window.addEventListener('hha:score', function(e){
      const d = (e && e.detail) || {};
      createHud();

      // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      if (typeof d.score === 'number'){
        scoreEl.textContent = d.score;
      }else if (typeof d.total === 'number'){
        scoreEl.textContent = d.total;
      }else if (typeof window.score === 'number'){
        scoreEl.textContent = window.score|0;
      }

      // ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö
      let combo = 0;
      if (typeof d.combo === 'number') combo = d.combo;
      else if (typeof window.combo === 'number') combo = window.combo;
      comboEl.textContent = combo|0;

      if (!running){
        startTimer();
      }
    });

    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏•‡∏≤‡∏î (‡∏ï‡∏µ‡πÇ‡∏î‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞)
    window.addEventListener('hha:miss', function(){
      createHud();
      if (typeof window.misses === 'number'){
        missEl.textContent = window.misses|0;
      }
      if (typeof window.combo === 'number'){
        comboEl.textContent = window.combo|0;
      }
    });

    // ‡πÄ‡∏Å‡∏°‡∏à‡∏ö
    window.addEventListener('hha:end', function(e){
      const d = (e && e.detail) || {};
      createHud();
      if (typeof d.scoreFinal === 'number'){
        scoreEl.textContent = d.scoreFinal;
      }else if (typeof d.score === 'number'){
        scoreEl.textContent = d.score;
      }else if (typeof window.score === 'number'){
        scoreEl.textContent = window.score|0;
      }
      stopTimer();
    });

    window.addEventListener('beforeunload', stopTimer);
  })();
  </script>

</body>
</html>
