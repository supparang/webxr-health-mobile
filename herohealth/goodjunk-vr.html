<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GroupsVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --radius:24px;
      --pill:999px;
      --soft: 0 10px 28px rgba(0,0,0,.30);
    }
    *{ box-sizing:border-box; }
    html,body{ width:100%; height:100%; margin:0;
      background:
        radial-gradient(circle at top left, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(167,139,250,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    .wrap{ min-height:100%; display:flex; align-items:center; justify-content:center; padding:18px; }
    .card{
      width:min(560px, 100%);
      background: rgba(2,6,23,.80);
      border: 1px solid rgba(148,163,184,.18);
      border-radius: 26px;
      box-shadow: 0 24px 70px rgba(0,0,0,.55);
      padding: 16px;
      backdrop-filter: blur(10px);
    }
    .title{ font-size:20px; font-weight:1000; letter-spacing:.2px; }
    .sub{ margin-top:6px; color:var(--muted); font-weight:800; font-size:13px; line-height:1.35; }
    .grid{ margin-top:14px; display:grid; gap:10px; }
    .row{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
    .btn{
      flex:1 1 180px;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(15,23,42,.65);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
      box-shadow: var(--soft);
    }
    .btn-strong{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.32); }
    .btn-ghost{ background: rgba(2,6,23,.35); }
    .pill{
      display:flex; justify-content:space-between; align-items:center;
      padding: 10px 12px; border-radius: var(--pill);
      background: rgba(2,6,23,.65);
      border: 1px solid rgba(148,163,184,.16);
      box-shadow: var(--soft);
      font-weight:900; font-size:13px;
    }
    .pill span{ color:var(--muted); font-weight:900; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; color:rgba(148,163,184,.95); }
    .hint{ margin-top:10px; color:var(--muted); font-weight:800; font-size:12px; }
    .sep{ height:1px; background: rgba(148,163,184,.12); margin:12px 0; }

    .overlay{
      position:fixed; inset:0; display:none;
      align-items:center; justify-content:center;
      padding:18px;
      background: rgba(2,6,23,.78);
      backdrop-filter: blur(10px);
    }
    .overlay.show{ display:flex; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title">Food Groups VR</div>
      <div class="sub" id="subText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‚Ä¶</div>

      <div class="sep"></div>

      <div class="grid">
        <div class="pill"><span>View</span><div id="vView">‚Äî</div></div>
        <div class="pill"><span>Start Mode</span><div id="vStart">‚Äî</div></div>
        <div class="pill"><span>Run</span><div id="vRun">‚Äî</div></div>
        <div class="pill"><span>Diff</span><div id="vDiff">‚Äî</div></div>
        <div class="pill"><span>Time</span><div id="vTime">‚Äî</div></div>
        <div class="pill"><span>AI</span><div id="vAI">‚Äî</div></div>
        <div class="pill"><span>Seed</span><div class="mono" id="vSeed">‚Äî</div></div>
      </div>

      <div class="row">
        <button class="btn btn-strong" id="btnGo" type="button">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
        <button class="btn btn-ghost" id="btnForceAuto" type="button">‚ö° Auto (‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞)</button>
        <button class="btn btn-ghost" id="btnForceTap" type="button">üñê Tap-to-start</button>
      </div>

      <div class="hint">
        ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö HUB ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢):<br/>
        <span class="mono">?auto=1</span> ‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Ä¢
        <span class="mono">?tap=1</span> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏ï‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ ‚Ä¢
        <span class="mono">?cvr=1</span> ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô cVR<br/>
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ENTER VR ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏° (‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î WebXR)
      </div>
    </div>
  </div>

  <div class="overlay" id="tapOverlay">
    <div class="card">
      <div class="title">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>
      <div class="sub" id="tapSub">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</div>
      <div class="row">
        <button class="btn btn-strong" id="btnTapStart" type="button">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</button>
        <button class="btn btn-ghost" id="btnCancel" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
      <div class="hint">‡πÅ‡∏ï‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢ unlock gesture ‡πÉ‡∏´‡πâ fullscreen/‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤</div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const $ = (id)=>DOC.getElementById(id);

  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }
  function qOn(k){
    const v = String(qs(k,'')||'').toLowerCase();
    return (v==='1' || v==='true' || v==='yes' || v==='on');
  }
  function clamp(v,a,b){ v = Number(v)||0; return v<a?a:(v>b?b:v); }

  // ---------- Start policy (1‚Äì2) ----------
  // default = tap-to-start (recommended)
  // ?auto=1 => immediate redirect
  // ?tap=1  => force tap overlay
  function startPolicy(){
    if (qOn('auto')) return 'auto';
    if (qOn('tap'))  return 'tap';
    return 'tap';
  }

  // ---------- Detect (3 included) ----------
  // ?cvr=1 => on mobile => cvr
  function detectViewAuto(){
    const vp = String(qs('view','')||'').toLowerCase();
    if (vp) return vp;

    const isMobile = matchMedia('(pointer:coarse)').matches || (navigator.maxTouchPoints||0) > 0;
    const isSmall  = (Math.min(innerWidth||0, innerHeight||0) <= 520);

    // 3) mobile auto cVR toggle
    const forceCvr = qOn('cvr');

    if (isMobile && forceCvr && isSmall) return 'cvr';
    return isMobile ? 'mobile' : 'pc';
  }

  function aiFromParams(run){
    const a = String(qs('ai','0')||'0').toLowerCase();
    if (run === 'research') return '0';
    return (a==='1' || a==='true' || a==='on') ? '1' : '0';
  }

  // ---------- Params ----------
  const P = {
    view:'mobile', run:'play', diff:'normal', style:'mix', time:90,
    seed:String(Date.now()), ai:'0', hub:null,
    start:'tap'
  };

  function computeParams(){
    P.start = startPolicy();

    P.view  = detectViewAuto();
    P.run   = (String(qs('run','play')||'play').toLowerCase()==='research') ? 'research' : 'play';
    P.diff  = String(qs('diff','normal')||'normal').toLowerCase();
    P.style = String(qs('style','mix')||'mix').toLowerCase();
    P.time  = clamp(qs('time', 90), 30, 180);
    P.seed  = String(qs('seed', Date.now()) || Date.now());
    P.hub   = qs('hub', null);
    P.ai    = aiFromParams(P.run);
  }

  function setText(){
    $('vView').textContent  = P.view;
    $('vStart').textContent = (P.start==='auto') ? 'AUTO' : 'TAP';
    $('vRun').textContent   = P.run.toUpperCase();
    $('vDiff').textContent  = P.diff.toUpperCase();
    $('vTime').textContent  = String(P.time);
    $('vAI').textContent    = (P.ai==='1') ? 'ON' : 'OFF';
    $('vSeed').textContent  = P.seed;

    $('subText').textContent =
      (P.start==='auto')
        ? '‡πÇ‡∏´‡∏°‡∏î Auto: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‚Ä¶'
        : '‡πÇ‡∏´‡∏°‡∏î Tap-to-start: ‡πÅ‡∏ï‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°';

    $('tapSub').textContent =
      (P.view==='cvr')
        ? '‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö Cardboard (cVR) ‚Äî ‡πÅ‡∏ï‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°'
        : (P.view==='pc')
          ? '‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö PC ‚Äî ‡πÅ‡∏ï‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°'
          : '‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö Mobile ‚Äî ‡πÅ‡∏ï‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°';
  }

  function buildRunUrl(){
    const base = './vr-groups/groups-vr.html';
    const u = new URL(base, location.href);

    u.searchParams.set('view', P.view);
    u.searchParams.set('run', P.run);
    u.searchParams.set('diff', P.diff);
    u.searchParams.set('style', P.style);
    u.searchParams.set('time', String(P.time));
    u.searchParams.set('seed', P.seed);
    u.searchParams.set('ai', P.ai);
    if (P.hub) u.searchParams.set('hub', P.hub);

    return u.toString();
  }

  function showTap(on){
    $('tapOverlay').classList.toggle('show', !!on);
  }

  function go(){
    location.href = buildRunUrl();
  }

  function goAuto(){
    // replace: back button won't return to this page (nice for UX)
    location.replace(buildRunUrl());
  }

  function boot(){
    computeParams();
    setText();

    $('btnGo').addEventListener('click', ()=>{
      if (P.start === 'auto') goAuto();
      else showTap(true);
    }, {passive:true});

    $('btnTapStart').addEventListener('click', go, {passive:true});
    $('btnCancel').addEventListener('click', ()=>showTap(false), {passive:true});

    $('btnForceAuto').addEventListener('click', ()=>{
      const u = new URL(location.href);
      u.searchParams.set('auto','1');
      u.searchParams.delete('tap');
      location.href = u.toString();
    }, {passive:true});

    $('btnForceTap').addEventListener('click', ()=>{
      const u = new URL(location.href);
      u.searchParams.set('tap','1');
      u.searchParams.delete('auto');
      location.href = u.toString();
    }, {passive:true});

    // 1) Auto redirect immediately (no tap)
    if (P.start === 'auto') {
      // small delay for UI paint (very tiny)
      setTimeout(goAuto, 30);
    }
  }

  boot();
})();
</script>
</body>
</html>