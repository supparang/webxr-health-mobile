<!-- === /herohealth/goodjunk-vr.html ===
GoodJunkVR (PRODUCTION) ‚Äî HHA Standard
‚úÖ PC/Mobile/VR/cVR viewbar
‚úÖ VR = WebXR via A-Frame (Enter VR)
‚úÖ cVR = Cardboard split (CSS)
‚úÖ Rotate notice + fullscreen helper
‚úÖ FX Layer: vignette/flash/shake + shoot ring/laser
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GoodJunk VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (WebXR Enter VR button) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="./vr-goodjunk/goodjunk-vr.css" />

  <!-- Global FX + Fever + HUD + Logger -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <!-- Boot (ESM) -->
  <script type="module" src="./vr-goodjunk/goodjunk-vr.boot.js"></script>

  <!-- View mode / orientation helper -->
  <script>
  (function(){
    function qs(name, def){
      try{ return (new URL(location.href)).searchParams.get(name) ?? def; }catch(_){ return def; }
    }
    function setParam(k,v){
      const u = new URL(location.href);
      if (v==null) u.searchParams.delete(k);
      else u.searchParams.set(k, v);
      if(!u.searchParams.get('v')) u.searchParams.set('v', Date.now());
      location.href = u.toString();
    }

    const view = String(qs('view','')).toLowerCase(); // pc | mobile | vr | cvr
    const root = document.documentElement;

    function applyView(v){
      root.classList.toggle('view-pc', v==='pc');
      root.classList.toggle('view-mobile', v==='mobile');
      root.classList.toggle('view-vr', v==='vr');
      root.classList.toggle('view-cvr', v==='cvr');
    }

    if(!view){
      const coarse = matchMedia && matchMedia('(pointer: coarse)').matches;
      const w = innerWidth||360, h = innerHeight||640;
      const auto = (coarse || Math.min(w,h)<520) ? 'mobile' : 'pc';
      applyView(auto);
    } else {
      applyView(view);
    }

    function isVRLike(){
      return root.classList.contains('view-vr') || root.classList.contains('view-cvr');
    }

    function updateRotate(){
      const portrait = (innerHeight||0) > (innerWidth||0);
      const rot = document.getElementById('rotateNotice');
      if(!rot) return;
      rot.hidden = !(isVRLike() && portrait);
    }

    async function enterFullscreenLandscape(){
      try{
        const el = document.documentElement;
        if (!document.fullscreenElement && el.requestFullscreen) await el.requestFullscreen();
      }catch(_){}
      try{
        if (screen.orientation && screen.orientation.lock){
          await screen.orientation.lock('landscape');
        }
      }catch(_){}
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      const btnPC = document.getElementById('btnViewPC');
      const btnM  = document.getElementById('btnViewMobile');
      const btnVR = document.getElementById('btnViewVR');
      const btnCVR= document.getElementById('btnViewCVR');
      const btnFS = document.getElementById('btnEnterFS');
      const btnEnterVR = document.getElementById('btnEnterVR');

      if(btnPC) btnPC.onclick = ()=>setParam('view','pc');
      if(btnM)  btnM.onclick  = ()=>setParam('view','mobile');

      if(btnVR) btnVR.onclick = async ()=>{
        if (String(qs('view','')).toLowerCase() !== 'vr') {
          setParam('view','vr'); return;
        }
        await enterFullscreenLandscape();
        try{
          const scene = document.getElementById('xrScene');
          if (scene && scene.enterVR) scene.enterVR();
        }catch(_){}
      };

      if(btnCVR) btnCVR.onclick = async ()=>{
        if (String(qs('view','')).toLowerCase() !== 'cvr') {
          setParam('view','cvr'); return;
        }
        await enterFullscreenLandscape();
      };

      if(btnFS) btnFS.onclick = enterFullscreenLandscape;

      if(btnEnterVR){
        btnEnterVR.onclick = async ()=>{
          await enterFullscreenLandscape();
          try{
            const scene = document.getElementById('xrScene');
            if (scene && scene.enterVR) scene.enterVR();
          }catch(_){}
        };
      }

      updateRotate();
    });

    window.addEventListener('resize', updateRotate);
    window.addEventListener('orientationchange', updateRotate);
  })();
  </script>
</head>

<body>

  <!-- ===== A-FRAME XR SCENE ===== -->
  <a-scene
    id="xrScene"
    embedded
    renderer="colorManagement: true; physicallyCorrectLights: true"
    vr-mode-ui="enabled: true"
    webxr="optionalFeatures: dom-overlay; overlayElement: #domOverlay"
    background="color: #020617"
  >
    <a-entity id="xrRig" position="0 1.6 0">
      <a-camera id="xrCam" look-controls="enabled:true" wasd-controls="enabled:false">
        <a-cursor
          id="xrCursor"
          fuse="false"
          raycaster="objects: .xr-target"
          material="color: white; shader: flat"
        ></a-cursor>
      </a-camera>
    </a-entity>

    <a-entity light="type: ambient; intensity: 0.65"></a-entity>
    <a-entity light="type: directional; intensity: 0.75" position="1 2 1"></a-entity>
    <a-entity id="xrTargets"></a-entity>

    <a-entity id="xrHint" position="0 1.15 -2.1" visible="false"
      text="value: ‡∏¢‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å ; align:center; width:3.2; color:#E5E7EB"
    ></a-entity>
  </a-scene>

  <!-- ===== DOM Overlay wrapper ===== -->
  <div id="domOverlay">

    <!-- ===== FX LAYER ===== -->
    <div class="gj-fx" aria-hidden="true">
      <div class="fx-vignette"></div>
      <div class="fx-flash"></div>
      <div class="fx-edge"></div>
    </div>

    <!-- ===== Rotate Notice ===== -->
    <div id="rotateNotice" class="rotate-notice" hidden>
      <div class="rotate-card">
        <div class="t">‡πÇ‡∏´‡∏°‡∏î VR/‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏≠‡∏£‡πå‡∏î</div>
        <div class="d">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏°‡∏∏‡∏ô‡∏à‡∏≠‡πÄ‡∏õ‡πá‡∏ô <b>‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏≤‡∏¢‡∏ï‡∏≤</div>
        <div class="hint">Tip: ‡∏Å‡∏î ‚ÄúEnter Fullscreen‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ VR/cVR ‡∏à‡∏∞‡∏ô‡∏¥‡πà‡∏á‡∏Å‡∏ß‡πà‡∏≤</div>
      </div>
    </div>

    <!-- ===== View Switcher ===== -->
    <div class="viewbar" aria-hidden="false">
      <button id="btnViewPC" class="viewbtn">PC</button>
      <button id="btnViewMobile" class="viewbtn">Mobile</button>
      <button id="btnViewVR" class="viewbtn">VR</button>
      <button id="btnViewCVR" class="viewbtn accent">cVR</button>
      <button id="btnEnterFS" class="viewbtn ghost">Enter Fullscreen</button>
      <button id="btnEnterVR" class="viewbtn ghost">Enter VR</button>
    </div>

    <!-- ===== HUD ===== -->
    <div class="hha-hud">
      <div class="hud-top">
        <div class="hud-badge">
          <div class="hud-title">GoodJunkVR</div>
          <div class="hud-sub" id="hudMeta">‚Äî</div>
        </div>

        <div class="hud-stats">
          <div class="hud-stat"><div class="k">Score</div><div class="v" id="hhaScore">0</div></div>
          <div class="hud-stat"><div class="k">Combo</div><div class="v" id="hhaCombo">0</div></div>
          <div class="hud-stat"><div class="k">Miss</div><div class="v" id="hhaMiss">0</div></div>
          <div class="hud-stat"><div class="k">Time</div><div class="v" id="hhaTime">0</div></div>
          <div class="hud-stat grade"><div class="k">Grade</div><div class="v" id="hhaGrade">‚Äî</div></div>
        </div>
      </div>

      <div class="hud-mid">
        <div class="hud-quest">
          <div class="q-row">
            <div class="q-title" id="hudGoalTitle">Goal: ‚Äî</div>
            <div class="q-count" id="hudGoalCount">0/0</div>
          </div>
          <div class="q-row">
            <div class="q-title mini" id="hudMiniTitle">Mini: ‚Äî</div>
            <div class="q-count" id="hudMiniCount">0/0</div>
            <div class="q-timer" id="hudMiniTimer"></div>
          </div>
          <div class="q-progress" id="hudQProgress">Goals 0/0 ‚Ä¢ Minis 0/0</div>
        </div>

        <div class="hud-coach">
          <img id="hudCoachImg" class="coach-img" src="./img/coach-neutral.png" alt="coach" />
          <div class="coach-talk">
            <div class="coach-line" id="hudCoachLine">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢! ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ‡∏´‡∏•‡∏µ‡∏Å‡∏Ç‡∏¢‡∏∞ ü•¶üö´</div>
            <div class="coach-sub" id="hudCoachSub">‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏¢‡∏¥‡∏á / ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏Å‡πá‡πÑ‡∏î‡πâ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== Fever/Shield UI ===== -->
    <div class="hha-fever" id="hhaFever">
      <div class="fever-row">
        <div class="fever-label">FEVER</div>
        <div class="fever-bar"><div class="fever-fill" id="feverBar"></div></div>
        <div class="fever-text" id="feverText">0%</div>
      </div>
      <div class="shield-row">
        <div class="shield-label">SHIELD</div>
        <div class="shield-pills" id="shieldPills"></div>
      </div>
    </div>

    <!-- ===== Playfield ===== -->
    <div id="gj-stage">
      <div id="gj-layer" aria-label="targets layer"></div>

      <div id="gj-crosshair" aria-hidden="true"></div>
      <div id="gj-crosshair-r" aria-hidden="true"></div>

      <div id="atk-ring" aria-hidden="true"></div>
      <div id="atk-laser" aria-hidden="true"></div>

      <div id="end-summary"></div>
    </div>

    <!-- ===== Controls ===== -->
    <div class="hha-controls">
      <button id="btnShoot" class="btn-shoot">‡∏¢‡∏¥‡∏á</button>
    </div>

    <!-- ===== Start Overlay ===== -->
    <div id="startOverlay" class="start-overlay">
      <div class="start-card">
        <div class="start-title">GoodJunk VR</div>
        <div class="start-desc">
          ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏î‡∏µ ü•¶ ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡∏Ç‡∏¢‡∏∞ üçü<br/>
          <span class="muted">‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏ô‡∏∏‡πà‡∏° ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏≠‡∏á</span>
        </div>
        <div class="start-meta" id="startMeta">‚Äî</div>
        <button id="btnStart" class="btn-start">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <div class="start-minihelp">
          Cardboard: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>cVR</b> ‚Üí ‡∏Å‡∏î <b>Enter Fullscreen</b> ‚Üí ‡∏´‡∏°‡∏∏‡∏ô‡∏à‡∏≠‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô<br/>
          WebXR: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>VR</b> ‚Üí ‡∏Å‡∏î <b>Enter VR</b> (‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
        </div>
      </div>
    </div>

  </div><!-- /#domOverlay -->

</body>
</html>