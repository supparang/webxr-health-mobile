<!-- === /herohealth/bloom-gate.html ===
HeroHealth Bloom Gate — PER ZONE DAILY (v20260225)
✅ root file
✅ marks localStorage: HHA_BLOOM_DONE:{zone}:{pid}:{YYYY-MM-DD}=1 when Continue
✅ next=... -> redirect
✅ supports bloom=a|b|c (Remember/Apply/Analyze framing)
✅ uses cat/zone/theme/pid from QS
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — Bloom Gate</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#020617;
      --panel: rgba(2,6,23,.78);
      --panel2: rgba(15,23,42,.60);
      --stroke: rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --good:#22c55e;
      --warn:#f59e0b;
      --violet:#a78bfa;
      --cyan:#22d3ee;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0;
      background:
        radial-gradient(1000px 700px at 15% 0%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 650px at 92% 12%, rgba(167,139,250,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;
      overscroll-behavior:none;
    }
    .wrap{
      min-height:100%;
      padding: calc(14px + var(--sat)) calc(12px + var(--sar)) calc(14px + var(--sab)) calc(12px + var(--sal));
      display:flex; align-items:center; justify-content:center;
    }
    .card{
      width:min(820px, 100%);
      border:1px solid var(--stroke);
      border-radius:24px;
      background:linear-gradient(180deg, rgba(2,6,23,.88), rgba(2,6,23,.62));
      box-shadow:0 18px 70px rgba(0,0,0,.42);
      overflow:hidden;
    }
    .top{
      padding:14px 16px;
      border-bottom:1px solid var(--stroke);
      background:rgba(2,6,23,.44);
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{display:flex; gap:10px; align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      border:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(34,211,238,.20), rgba(167,139,250,.16));
      display:grid; place-items:center; font-weight:1000;
    }
    .title{font-weight:1100}
    .sub{font-size:12px; color:var(--muted); font-weight:800; margin-top:2px}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.26);
      border-radius:999px;
      padding:6px 10px;
      font-size:11px; font-weight:1000;
      white-space:nowrap;
    }
    .main{ padding:16px; display:grid; gap:12px; grid-template-columns: 1.2fr .8fr; }
    @media (max-width:860px){ .main{ grid-template-columns:1fr; } }
    .panel{
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.30);
      border-radius:18px;
      padding:14px;
    }
    h2{ margin:0; font-size:18px; font-weight:1100; }
    .muted{ color:rgba(229,231,235,.74); font-size:12px; line-height:1.4; font-weight:750; margin-top:8px; }
    .box{
      margin-top:12px;
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.24);
      border-radius:16px;
      padding:12px;
    }
    .k{ font-size:10px; color:var(--muted); font-weight:900; }
    .v{ margin-top:6px; font-size:14px; font-weight:1050; }
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{
      appearance:none; border:none; outline:none; cursor:pointer;
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.30);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font-weight:1100; font-size:13px;
      min-height:42px;
    }
    .btn.primary{ border-color:rgba(34,197,94,.30); background:rgba(34,197,94,.14); }
    .btn.warn{ border-color:rgba(245,158,11,.32); background:rgba(245,158,11,.12); }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(167,139,250,.28);
      background:rgba(167,139,250,.10);
      padding:6px 10px; border-radius:999px;
      font-weight:1100; font-size:12px;
    }
    .mini{
      display:grid; gap:8px; margin-top:10px;
    }
    .item{
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.22);
      border-radius:14px;
      padding:10px;
    }
    .item b{ font-weight:1100; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="brand">
          <div class="logo">HH</div>
          <div>
            <div class="title" id="tTitle">Bloom Gate</div>
            <div class="sub" id="tSub">เข้า 1 ครั้ง/วัน/โซน เพื่อจัดกรอบการคิดก่อนเล่น</div>
          </div>
        </div>
        <div class="chips">
          <div class="chip" id="pillBloom">BLOOM: C</div>
          <div class="chip" id="pillZone">ZONE: NUTRITION</div>
          <div class="chip" id="pillTheme">THEME: —</div>
          <div class="chip" id="pillPid">PID: anon</div>
          <div class="chip" id="pillDay">DAY: —</div>
        </div>
      </div>

      <div class="main">
        <div class="panel">
          <h2 id="h">โหมด Bloom (C) — วิเคราะห์ก่อนเล่น</h2>
          <div class="muted" id="desc">
            ตั้งเป้าหมายให้ชัดก่อนลงมือ: “วันนี้เราจะทำให้ดีขึ้นตรงไหน?”
          </div>

          <div class="box">
            <div class="k">โจทย์สั้น (ทำในใจ 10–15 วิ)</div>
            <div class="v" id="prompt">—</div>
            <div class="mini" id="mini"></div>
          </div>

          <div class="btnrow">
            <button class="btn warn" id="btnSkip">ข้าม Bloom</button>
            <button class="btn primary" id="btnGo">ไปต่อ</button>
          </div>

          <div class="muted" id="note">
            * หน้านี้จะไม่เข้าซ้ำในโซนเดิมภายในวันเดียวกัน (ต่อ pid)
          </div>
        </div>

        <div class="panel">
          <div class="badge" id="badge">✅ Bloom per-zone: READY</div>

          <div class="box">
            <div class="k">Next</div>
            <div class="v" id="nextLine">—</div>
          </div>

          <div class="box">
            <div class="k">Key (debug)</div>
            <div class="v" id="keyLine">—</div>
          </div>

          <div class="muted">
            โหมดวิจัย (research) จะยัง deterministic ได้ เพราะ “เข้า Bloom ครั้งเดียวต่อโซน” และบันทึกด้วยวัน+pid+zone
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC=document, WIN=window;
  const $=(id)=>DOC.getElementById(id);

  function getQS(){ try{ return new URL(location.href).searchParams; }catch{ return new URLSearchParams(); } }
  const QS=getQS();
  const q=(k,d='')=> (QS.get(k) ?? d);

  function localDayKey(){
    const d=new Date();
    const yyyy=d.getFullYear();
    const mm=String(d.getMonth()+1).padStart(2,'0');
    const dd=String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  const bloom = String(q('bloom','c')).toLowerCase();
  const zone  = String(q('zone', q('cat','nutrition'))).toLowerCase();
  const theme = String(q('theme','')).toLowerCase();
  const pid   = (String(q('pid','')).trim() || 'anon');
  const day   = String(q('day','')).trim() || localDayKey();
  const next  = String(q('next','')).trim() || String(q('hub','./hub.html')).trim() || './hub.html';

  function bloomKey(){
    const z = zone || 'nutrition';
    const p = pid || 'anon';
    return `HHA_BLOOM_DONE:${z}:${p}:${day}`;
  }

  function markDone(){
    try{ localStorage.setItem(bloomKey(),'1'); }catch(_){}
  }

  function goNext(){
    // mark then go
    markDone();
    try{ location.replace(next); }catch(_){ location.href = next; }
  }

  // UI
  $('pillBloom').textContent = `BLOOM: ${String(bloom).toUpperCase()}`;
  $('pillZone').textContent  = `ZONE: ${String(zone).toUpperCase()}`;
  $('pillTheme').textContent = `THEME: ${theme ? theme.toUpperCase() : '—'}`;
  $('pillPid').textContent   = `PID: ${pid}`;
  $('pillDay').textContent   = `DAY: ${day}`;

  $('nextLine').textContent  = next;
  $('keyLine').textContent   = bloomKey();

  // content by bloom level
  const H = $('h');
  const DESC = $('desc');
  const PROMPT = $('prompt');
  const MINI = $('mini');

  function addMini(title, text){
    const d = DOC.createElement('div');
    d.className = 'item';
    d.innerHTML = `<b>${title}</b><div class="muted" style="margin-top:4px">${text}</div>`;
    MINI.appendChild(d);
  }

  MINI.innerHTML = '';
  if(bloom === 'a'){
    H.textContent = 'โหมด Bloom (A) — จำให้ได้ก่อนเล่น';
    DESC.textContent = 'โฟกัส “จำกติกา/สัญลักษณ์/เป้าหมาย” ให้ชัด เพื่อไม่พลาดง่าย ๆ';
    PROMPT.textContent = 'วันนี้ “สิ่งที่ต้องไม่พลาด” ในโซนนี้คืออะไร 1 ข้อ?';
    addMini('Remember', 'ทบทวน 1 กติกาหลัก + 1 สิ่งที่มักพลาด');
    addMini('Target', 'ตั้งเป้า: miss ลดลง 1–2 ครั้ง');
  }else if(bloom === 'b'){
    H.textContent = 'โหมด Bloom (B) — ลงมือทำแบบมีแผน';
    DESC.textContent = 'โฟกัส “วิธีทำให้ดีขึ้น” ด้วยแผนสั้น ๆ ก่อนเริ่ม';
    PROMPT.textContent = 'วันนี้จะปรับวิธีเล่นอย่างไร 1 อย่าง (เช่น จังหวะ/เป้าหมาย/ลำดับ)?';
    addMini('Apply', 'เลือก 1 เทคนิคแล้วทำซ้ำให้ได้ตลอดรอบ');
    addMini('Checkpoint', 'ถ้าพลาด → หยุด 1 วิ แล้วเริ่มใหม่แบบตั้งใจ');
  }else{
    H.textContent = 'โหมด Bloom (C) — วิเคราะห์ก่อนเล่น';
    DESC.textContent = 'โฟกัส “เหตุ-ผล” และ “เลือกวิธีที่ดีกว่า”';
    PROMPT.textContent = 'ถ้าเกมยากขึ้น 1 ระดับ… คุณจะรับมืออย่างไร (เลือก 1 วิธี)?';
    addMini('Analyze', 'แยกปัญหา: พลาดเพราะช้า/เพราะเลือกเป้าผิด/เพราะลน?');
    addMini('Strategy', 'เลือก 1 กลยุทธ์: โฟกัสเป้าคุ้มค่า / รักษาสตรีค / ลด miss');
  }

  // buttons
  $('btnGo').addEventListener('click', (e)=>{ e.preventDefault(); goNext(); });
  $('btnSkip').addEventListener('click', (e)=>{ e.preventDefault(); goNext(); });

  // optional: auto-continue after short time (keep gentle)
  // ถ้าอยาก auto ให้เปิดเอง: QS ?auto=1
  const auto = String(q('auto','0')) === '1';
  if(auto){
    setTimeout(goNext, 1200);
  }
})();
</script>
</body>
</html>