<!-- === /herohealth/hydration-vr.html ===
Hydration Quest VR (PLAY MODE) ‚Äî ROOT HTML
‚úÖ paths ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
‚úÖ import ./hydration-vr/hydration.safe.js
‚úÖ vr libs: ./vr/particles.js ./vr/mode-factory.js ./vr/ui-water.js
‚úÖ goHub -> ./hub.html
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- ‚úÖ FX (IIFE) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-compat-input.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.74);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.22);
      --txt:#e5e7eb;
      --muted:#9ca3af;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow:0 18px 55px rgba(0,0,0,.55);
      --radius:18px;
      --pill:999px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% -10%, rgba(34,197,94,.18), transparent 60%),
                  radial-gradient(900px 700px at 20% 30%, rgba(96,165,250,.14), transparent 55%),
                  radial-gradient(800px 700px at 80% 35%, rgba(245,158,11,.10), transparent 55%),
                  var(--bg);
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", "Noto Sans", Arial, sans-serif;
      overflow:hidden;
    }

    /* wrapper (wobble applies here) */
    #hvr-wrap{
      position:relative;
      width:100%;
      height:100%;
      overflow:hidden;
      transform: translateZ(0);
      will-change: transform, filter;
    }

    /* ‚úÖ Score FX layer from particles.js should be on top */
    .hha-fx-layer{
      position:fixed !important;
      inset:0 !important;
      pointer-events:none !important;
      z-index:99990 !important;
    }

    /* Blink overlay */
    #hvr-screen-blink{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:99980;
      opacity:0;
      transition:opacity 90ms ease;
      mix-blend-mode:screen;
    }
    #hvr-screen-blink.on{ opacity:1; }
    #hvr-screen-blink.good{ background:rgba(34,197,94,.22); }
    #hvr-screen-blink.bad{ background:rgba(239,68,68,.22); }
    #hvr-screen-blink.perfect{ background:rgba(250,204,21,.22); }

    /* ‚úÖ Canvas postFX overlay (created by hydration.safe.js) */
    #hvr-postfx{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:99970;
    }

    /* HUD */
    .hud{
      position:fixed;
      left:12px; right:12px;
      top:10px;
      display:flex;
      gap:10px;
      align-items:stretch;
      z-index:50;
      pointer-events:none;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter:blur(10px);
      padding:10px 12px;
      min-width:0;
    }

    /* ‚úÖ mark HUD as exclusion (safe zone) */
    .hud, .hud *{ }
    .hud{ pointer-events:none; }
    .hud[data-hha-exclude="1"]{ }

    .hud-left{ flex:1.25; display:flex; gap:10px; min-width:0; }
    .hud-mid{ flex:1; display:flex; gap:10px; min-width:0; }
    .hud-right{ flex:0.85; display:flex; gap:10px; justify-content:flex-end; min-width:0; }

    .row{ display:flex; align-items:center; gap:10px; }
    .kpi{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .kpi .label{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.02em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .kpi .value{
      font-size:18px;
      font-weight:900;
      letter-spacing:.02em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:var(--pill);
      border:1px solid var(--stroke);
      background:rgba(15,23,42,.62);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      white-space:nowrap;
    }

    /* Water gauge */
    .water{ width:240px; min-width:240px; }
    .bar{
      position:relative;
      height:12px;
      border-radius:var(--pill);
      overflow:hidden;
      background:rgba(148,163,184,.16);
      border:1px solid rgba(148,163,184,.22);
    }
    #hha-water-fill{
      position:absolute; left:0; top:0; bottom:0;
      width:50%;
      background:linear-gradient(90deg, rgba(34,197,94,.95), rgba(96,165,250,.75), rgba(239,68,68,.85));
      border-radius:var(--pill);
      transition:width 160ms ease, background 160ms ease;
    }
    .water-meta{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:6px;
      font-size:12px; color:var(--muted); gap:8px;
    }
    #hha-water-zone-text{
      color:#dbeafe;
      font-weight:900;
      letter-spacing:.08em;
    }

    /* Grade progress */
    .grade{ width:260px; min-width:260px; }
    .progress{
      position:relative;
      height:12px;
      border-radius:var(--pill);
      overflow:hidden;
      background:rgba(148,163,184,.16);
      border:1px solid rgba(148,163,184,.22);
    }
    #hha-grade-progress-fill{
      position:absolute; left:0; top:0; bottom:0;
      width:0%;
      background:linear-gradient(90deg, rgba(245,158,11,.95), rgba(34,197,94,.95));
      border-radius:var(--pill);
      transition:width 180ms ease;
    }
    #hha-grade-badge{
      font-weight:1000;
      letter-spacing:.08em;
      padding:6px 10px;
      border-radius:var(--pill);
      border:1px solid rgba(148,163,184,.28);
      background:rgba(2,6,23,.55);
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    #hha-grade-progress-text{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Quest */
    .quest{ width:100%; min-width:0; }
    .quest-line{
      font-size:12px;
      color:var(--txt);
      font-weight:800;
      letter-spacing:.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-top:3px;
    }
    .quest-counts{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
    }
    .quest-counts b{ color:var(--txt); }

    /* Playfield */
    #hvr-playfield{
      position:absolute;
      inset:0;
      z-index:1;
      pointer-events:auto;
      touch-action:none;
      transform: translate3d(0,0,0);
      will-change: transform, filter;
    }

    /* Start overlay */
    #hvr-start{
      position:fixed;
      inset:0;
      z-index:120;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:linear-gradient(180deg, rgba(2,6,23,.88), rgba(2,6,23,.92));
      backdrop-filter:blur(12px);
    }
    .start-card{
      width:min(720px, 100%);
      background:var(--panel2);
      border:1px solid rgba(148,163,184,.24);
      border-radius:24px;
      padding:16px;
      box-shadow:0 22px 70px rgba(0,0,0,.60);
    }
    .start-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      font-size:20px;
      font-weight:1000;
      letter-spacing:.02em;
    }
    .subtitle{
      margin-top:4px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      pointer-events:auto;
      border:1px solid rgba(148,163,184,.28);
      background:rgba(2,6,23,.55);
      color:var(--txt);
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      letter-spacing:.02em;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      box-shadow:0 14px 36px rgba(0,0,0,.45);
    }
    .btn.primary{
      border-color:rgba(34,197,94,.45);
      background:rgba(34,197,94,.14);
    }
    .btn:active{ transform:translateY(1px); }

    /* ‚úÖ ensure buttons are clickable */
    #btn-start,#btn-reload,#btn-exit{
      position:relative;
      z-index:99999;
      pointer-events:auto;
      touch-action:manipulation;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(2,6,23,.40);
      color:var(--muted);
      font-size:12px;
      font-weight:800;
      letter-spacing:.02em;
    }
    .chip b{ color:var(--txt); }

    /* End overlay (hydration.safe.js will populate detail) */
    #hvr-end{
      position:fixed;
      inset:0;
      z-index:140;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:linear-gradient(180deg, rgba(2,6,23,.90), rgba(2,6,23,.94));
      backdrop-filter:blur(12px);
    }
    #hvr-end.on{ display:flex; }

    @media (max-width: 720px){
      .hud{ top:8px; }
      .water,.grade{ min-width:0; width:100%; }
      .hud{ flex-direction:column; }
      .hud-left,.hud-mid,.hud-right{ width:100%; }
    }
  </style>
</head>

<body>
  <div id="hvr-wrap">

    <!-- FX overlays -->
    <canvas id="hvr-postfx"></canvas>
    <div id="hvr-screen-blink"></div>

    <!-- HUD (exclude zone) -->
    <div class="hud" data-hha-exclude="1">
      <div class="hud-left">
        <div class="card quest">
          <div class="row" style="justify-content:space-between;">
            <div class="kpi">
              <div class="label">Quest</div>
              <div class="value">Hydration</div>
            </div>
            <div class="pill">
              <span style="color:var(--muted); font-weight:900;">Grade</span>
              <span id="hha-grade-badge">C</span>
            </div>
          </div>

          <div id="hha-quest-goal" class="quest-line">Goal: ‚Äî</div>
          <div id="hha-quest-mini" class="quest-line">Mini: ‚Äî</div>

          <div class="quest-counts">
            <div class="pill">üéØ Goal <b><span id="hha-goal-done">0</span>/<span id="hha-goal-total">2</span></b></div>
            <div class="pill">‚ú® Mini <b><span id="hha-mini-done">0</span>/<span id="hha-mini-total">3</span></b></div>
          </div>
        </div>

        <div class="card water">
          <div class="row" style="justify-content:space-between;">
            <div class="kpi">
              <div class="label">Water</div>
              <div class="value" id="hha-water-status">GREEN 50%</div>
            </div>
            <div class="pill">
              <span style="color:var(--muted); font-weight:900;">ZONE</span>
              <span id="hha-water-zone-text">GREEN</span>
            </div>
          </div>
          <div class="bar" style="margin-top:8px;">
            <div id="hha-water-fill"></div>
          </div>
          <div class="water-meta">
            <span>‡∏•‡∏≤‡∏Å‡∏à‡∏≠ = ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á ü´ß</span>
            <span style="opacity:.9;">‡πÅ‡∏ï‡∏∞‡∏™‡∏±‡πâ‡∏ô = ‡∏¢‡∏¥‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠</span>
          </div>
        </div>
      </div>

      <div class="hud-mid">
        <div class="card grade">
          <div class="row" style="justify-content:space-between;">
            <div class="kpi">
              <div class="label">Progress</div>
              <div class="value"><span id="hha-score-main">0</span> pts</div>
            </div>
            <div class="pill">
              <span style="color:var(--muted); font-weight:900;">Combo Max</span>
              <span style="font-weight:1000;"><span id="hha-combo-max">0</span></span>
            </div>
          </div>

          <div class="progress" style="margin-top:8px;">
            <div id="hha-grade-progress-fill"></div>
          </div>
          <div id="hha-grade-progress-text">Progress to S: 0%</div>
        </div>
      </div>

      <div class="hud-right">
        <div class="card" style="min-width:170px;">
          <div class="kpi">
            <div class="label">Miss</div>
            <div class="value"><span id="hha-miss">0</span></div>
          </div>
          <div style="margin-top:6px; color:var(--muted); font-size:12px; line-height:1.35;">
            JUNK hit = miss + ‡∏•‡∏î‡∏ô‡πâ‡∏≥/‡∏•‡∏î‡πÅ‡∏ï‡πâ‡∏°
          </div>
        </div>
      </div>
    </div>

    <!-- Playfield -->
    <div id="hvr-playfield" aria-label="playfield"></div>

    <!-- Start overlay -->
    <div id="hvr-start">
      <div class="start-card">
        <div class="start-top">
          <div>
            <div class="title">üíß Hydration Quest VR (Play)</div>
            <div class="subtitle">
              ‡πÅ‡∏ï‡∏∞ ‚Äú‡∏ô‡πâ‡∏≥‡∏î‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏ã‡∏ô GREEN ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ß‡∏±‡∏á ‚ÄúJUNK‚Äù<br>
              ‚úÖ PERFECT = ‡πÅ‡∏ï‡∏Å‡∏î‡∏≤‡∏ß‡∏´‡∏ô‡∏±‡∏Å ‡πÜ ‚Ä¢ ‚úÖ Storm = ‡∏™‡πà‡∏≤‡∏¢‡πÅ‡∏£‡∏á/‡πÄ‡∏£‡πá‡∏ß + speedlines + chroma
            </div>
          </div>
          <div class="pill" style="pointer-events:auto;">
            <span style="color:var(--muted); font-weight:900;">URL</span>
            <span id="hvr-url-info" style="font-weight:1000;">diff=easy ‚Ä¢ time=90</span>
          </div>
        </div>

        <div class="chips">
          <div class="chip">ü´ß Bubble = ‡πÉ‡∏™ + iridescence + shimmer + tilt</div>
          <div class="chip">üéØ ‡πÅ‡∏ï‡∏∞‡∏™‡∏±‡πâ‡∏ô = ‡∏¢‡∏¥‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ ‚Ä¢ ‡∏•‡∏≤‡∏Å = ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á</div>
          <div class="chip">üå™Ô∏è Storm Wave = speedlines + wobble + chroma split</div>
        </div>

        <div class="controls">
          <button id="btn-start" class="btn primary">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
          <button id="btn-reload" class="btn">üîÑ ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î</button>
          <button id="btn-exit" class="btn">üè† ‡∏Å‡∏•‡∏±‡∏ö Hub</button>
        </div>

        <div class="subtitle" style="margin-top:10px;">
          ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡πÅ‡∏ï‡∏∞‡∏à‡∏≠ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ device-tilt ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        </div>
      </div>
    </div>

    <!-- End overlay (hydration.safe.js ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤) -->
    <div id="hvr-end"></div>

  </div>

  <!-- ‚úÖ bind ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ import ‡πÄ‡∏Å‡∏°‡πÅ‡∏ö‡∏ö dynamic -->
  <script type="module">
    'use strict';
    const ROOT = window;
    const $ = (id)=>document.getElementById(id);

    function qs(){
      const u = new URL(location.href);
      return {
        diff: (u.searchParams.get('diff') || u.searchParams.get('difficulty') || 'easy').toLowerCase(),
        time: Number(u.searchParams.get('time') || u.searchParams.get('duration') || 90) || 90
      };
    }
    function bindTap(el, fn){
      if (!el) return;
      const h = (e)=>{ try{ e.preventDefault(); e.stopPropagation(); }catch{} fn(e); };
      el.addEventListener('pointerdown', h, { passive:false });
      el.addEventListener('touchstart', h, { passive:false });
      el.addEventListener('click', h, { passive:false });
    }
    function goHub(){ location.href = './hub.html'; }

    const p = qs();
    const urlInfo = $('hvr-url-info');
    if (urlInfo) urlInfo.textContent = `diff=${p.diff} ‚Ä¢ time=${p.time}`;

    const playfield = $('hvr-playfield');
    if (playfield) playfield.style.pointerEvents = 'none';

    bindTap($('btn-reload'), ()=>location.reload());
    bindTap($('btn-exit'), goHub);

    let inst = null;

    async function startGame(){
      const start = $('hvr-start');
      if (start) start.style.display = 'none';
      if (playfield) playfield.style.pointerEvents = 'auto';

      try{
        const mod = await import('./hydration-vr/hydration.safe.js');
        if (!mod || typeof mod.boot !== 'function') throw new Error('boot() not found');
        inst = await mod.boot({ difficulty: p.diff, duration: p.time });
        ROOT.__HVR_INST = inst;
      }catch(err){
        console.error('[Hydration] start failed:', err);
        if (start) start.style.display = 'flex';
        if (playfield) playfield.style.pointerEvents = 'none';
        alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ‡∏ï‡∏£‡∏ß‡∏à path import / ‡πÑ‡∏ü‡∏•‡πå 404 / syntax error\n‡πÄ‡∏õ‡∏¥‡∏î Console ‡∏î‡∏π error');
      }
    }
    bindTap($('btn-start'), startGame);
  </script>
</body>
</html>
