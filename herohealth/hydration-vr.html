<!-- === /herohealth/hydration-vr/hydration-vr.html ===
HydrationVR (PRODUCTION) ‚Äî Hydro-Orb Identity + Full HUD
‚úÖ IDs match hydration.safe.js
‚úÖ WaterGauge + Fever + Quest + Stats
‚úÖ Safe-zone excludes for mode-factory
‚úÖ Start/End overlays + back-to-hub
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (optional; keeps consistency across games) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- FX + Logger (optional) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.62);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;

      --green:#22c55e;
      --low:#38bdf8;
      --high:#f59e0b;
      --danger:#ef4444;

      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    html,body{ margin:0; padding:0; width:100%; height:100%; background: radial-gradient(1200px 700px at 50% 20%, #0b1224 0%, #020617 60%, #020617 100%); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; overflow:hidden; }
    *{ box-sizing:border-box; }

    /* --- Layout --- */
    .ui{
      position:fixed; inset:0;
      padding: calc(12px + var(--sat)) calc(12px + var(--sar)) calc(12px + var(--sab)) calc(12px + var(--sal));
      pointer-events:none;
      z-index:20;
    }
    .top{
      display:flex; align-items:center; justify-content:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .barCard{
      width:min(980px, 96vw);
      background: rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      border-radius: 999px;
      padding: 10px 12px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .barLeft{ display:flex; align-items:center; gap:10px; font-weight:950; letter-spacing:.2px; }
    .barRight{ display:flex; align-items:center; gap:12px; font-weight:950; color:var(--muted); }
    .barTrack{
      position:relative;
      flex:1;
      height: 10px;
      background: rgba(148,163,184,.12);
      border-radius: 999px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.10);
    }
    .barFill{
      position:absolute; left:0; top:0; bottom:0;
      width:34%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(34,197,94,.6), rgba(34,197,94,1));
      box-shadow: 0 0 18px rgba(34,197,94,.35);
      transition: width .22s ease;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1.1fr;
      gap:12px;
      width:min(1180px, 96vw);
      margin: 0 auto;
    }
    @media (max-width: 920px){
      .row{ grid-template-columns: 1fr; }
    }
    .card{
      background: var(--panel);
      border:1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      padding: 12px;
      pointer-events:none;
    }
    .title{
      font-weight:1000;
      letter-spacing:.2px;
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .statsGrid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:8px 10px;
      font-weight:950;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .statsGrid .k{ color: var(--muted); }
    .statsGrid .v{ text-align:right; }

    .questLines{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-weight:950;
      letter-spacing:.2px;
      line-height:1.25;
    }
    .questLines .big{ font-size: 16px; }
    .questLines .muted{ color: var(--muted); }

    /* --- Playfield --- */
    #playfield{
      position:fixed;
      inset:0;
      z-index:10;
      overflow:hidden;
      /* hydration vibe */
      background:
        radial-gradient(900px 520px at 50% 55%, rgba(56,189,248,.08), rgba(2,6,23,0) 60%),
        radial-gradient(1200px 700px at 50% 15%, rgba(34,197,94,.06), rgba(2,6,23,0) 60%);
    }

    /* subtle ‚Äúcurrent‚Äù */
    #playfield::before{
      content:"";
      position:absolute; inset:-20%;
      background:
        repeating-linear-gradient(120deg,
          rgba(56,189,248,.06) 0px,
          rgba(56,189,248,.02) 36px,
          rgba(34,197,94,.04) 72px,
          rgba(2,6,23,0) 110px);
      filter: blur(14px);
      opacity:.45;
      animation: currentDrift 9s linear infinite;
      transform: translate3d(0,0,0);
      pointer-events:none;
    }
    @keyframes currentDrift{
      from{ transform: translate3d(-6%, -2%, 0) rotate(0.001deg); }
      to  { transform: translate3d(6%,  2%, 0) rotate(0.001deg); }
    }

    /* target layer */
    #hvr-layer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:12;
    }
    #hvr-layer .hvr-target{ pointer-events:auto; }

    /* crosshair */
    #hvr-crosshair{
      position:absolute;
      left:50%; top:52%;
      transform: translate(-50%,-50%);
      width: 22px; height: 22px;
      border-radius: 999px;
      border:2px solid rgba(226,232,240,.35);
      box-shadow: 0 0 18px rgba(56,189,248,.25);
      pointer-events:none;
      z-index:13;
    }
    #hvr-crosshair::after{
      content:"";
      position:absolute; left:50%; top:50%;
      width: 4px; height:4px;
      border-radius:999px;
      background: rgba(226,232,240,.6);
      transform: translate(-50%,-50%);
    }

    /* bottom strip */
    .bottom{
      width:min(1180px, 96vw);
      margin: 10px auto 0;
      display:grid;
      grid-template-columns: 1.3fr .7fr;
      gap:12px;
    }
    @media (max-width: 920px){
      .bottom{ grid-template-columns: 1fr; }
    }

    .coachCard{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .coachIcon{
      width:42px; height:42px;
      border-radius: 14px;
      background: rgba(34,197,94,.16);
      border:1px solid rgba(34,197,94,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
    }
    .coachTxt{ display:flex; flex-direction:column; gap:2px; }
    .coachTxt .t1{ font-weight:1100; }
    .coachTxt .t2{ color: var(--muted); font-weight:900; font-size: 12px; }

    /* fever */
    .feverTrack{
      position:relative;
      height: 10px;
      border-radius:999px;
      overflow:hidden;
      background: rgba(148,163,184,.12);
      border:1px solid rgba(148,163,184,.10);
    }
    .feverFill{
      position:absolute; left:0; top:0; bottom:0;
      width: 0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(251,146,60,.65), rgba(239,68,68,1));
      box-shadow: 0 0 18px rgba(239,68,68,.25);
      transition: width .22s ease;
    }

    /* Buttons row */
    .btnRow{
      position:fixed;
      left:50%;
      bottom: calc(12px + var(--sab));
      transform: translateX(-50%);
      display:flex;
      gap:10px;
      z-index:30;
      pointer-events:auto;
    }
    .btn{
      min-width: 96px;
      border-radius: 16px;
      padding: 10px 14px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.55);
      color: var(--text);
      font-weight:1000;
      letter-spacing:.2px;
      cursor:pointer;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{ background: rgba(56,189,248,.14); }
    .btn.danger{ background: rgba(239,68,68,.14); }

    /* Start overlay */
    #start-overlay{
      position:fixed; inset:0;
      z-index:50;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 16px;
      background: rgba(2,6,23,.65);
      backdrop-filter: blur(10px);
    }
    .startCard{
      width:min(720px, 94vw);
      border-radius: 22px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.72);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding: 16px;
    }
    .startCard h2{ margin:0 0 6px; font-size: 18px; letter-spacing:.2px; }
    .startCard p{ margin:0; color: var(--muted); font-weight:850; line-height:1.4; }
    .startBtns{ display:flex; gap:10px; margin-top: 12px; flex-wrap:wrap; }

    /* End overlay */
    #hvr-end{
      position:fixed; inset:0;
      z-index:60;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      background: rgba(2,6,23,.72);
      backdrop-filter: blur(10px);
      pointer-events:auto;
    }
    .endCard{
      width:min(720px, 94vw);
      border-radius: 22px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.78);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding: 16px;
    }
    .endGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px 12px;
      margin-top: 10px;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .endGrid .k{ color: var(--muted); font-weight:900; }
    .endGrid .v{ text-align:right; }

    /* Hydration target identity (Hydro-Orb) */
    .hy-orb{
      --glow: rgba(56,189,248,.35);
      --edge: rgba(226,232,240,.22);
      --sheen: rgba(255,255,255,.22);
      --core: rgba(56,189,248,.26);
      border:1px solid rgba(226,232,240,.10) !important;
      box-shadow:
        0 18px 42px rgba(0,0,0,.45),
        0 0 0 2px rgba(56,189,248,.12),
        0 0 40px var(--glow) !important;
      overflow:hidden;
    }
    .hy-orb.hy-good{ --glow: rgba(56,189,248,.35); }
    .hy-orb.hy-bad{  --glow: rgba(239,68,68,.22); }

    .hy-orb::before{
      content:"";
      position:absolute; inset:-20%;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.22), rgba(255,255,255,0) 45%),
        radial-gradient(circle at 55% 70%, rgba(56,189,248,.25), rgba(2,6,23,0) 55%);
      filter: blur(1px);
      opacity:.9;
      pointer-events:none;
      transform: translate3d(0,0,0);
      animation: orbSheen 1.9s ease-in-out infinite;
    }
    @keyframes orbSheen{
      0%{ transform: translate3d(-2%, -1%, 0); opacity:.78; }
      50%{ transform: translate3d(2%, 1%, 0); opacity:1; }
      100%{ transform: translate3d(-2%, -1%, 0); opacity:.78; }
    }

    .hy-symbol{
      width: 52%;
      height: 52%;
      opacity:.95;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.55));
    }
    .hy-symbol svg{ width:100%; height:100%; display:block; }

    /* stamp animation (optional) */
    #hha-stamp{
      position:fixed; left:50%; top:46%;
      transform: translate(-50%,-50%) scale(.88);
      z-index:55;
      pointer-events:none;
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
    }
    #hha-stamp.show{
      opacity:1;
      transform: translate(-50%,-50%) scale(1);
    }
    .stampBox{
      border-radius: 18px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.65);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding: 10px 14px;
      text-align:center;
      backdrop-filter: blur(10px);
    }
    .stampBig{ font-weight:1200; font-size: 18px; letter-spacing:.3px; }
    .stampSmall{ color: var(--muted); font-weight:900; margin-top: 2px; font-size: 12px; }

    /* Water zone theming */
    body.water-low .barFill{ background: linear-gradient(90deg, rgba(56,189,248,.55), rgba(56,189,248,1)); box-shadow:0 0 18px rgba(56,189,248,.35); }
    body.water-green .barFill{ background: linear-gradient(90deg, rgba(34,197,94,.6), rgba(34,197,94,1)); box-shadow:0 0 18px rgba(34,197,94,.35); }
    body.water-high .barFill{ background: linear-gradient(90deg, rgba(245,158,11,.55), rgba(245,158,11,1)); box-shadow:0 0 18px rgba(245,158,11,.25); }
  </style>
</head>

<body>

  <!-- PLAYFIELD -->
  <div id="playfield">
    <div id="hvr-layer" aria-label="spawn-layer"></div>
    <div id="hvr-crosshair" aria-label="crosshair"></div>
  </div>

  <!-- UI LAYER -->
  <div class="ui">
    <!-- TOP WATER -->
    <div class="top" id="hha-water-header" data-hha-exclude="1">
      <div class="barCard">
        <div class="barLeft">
          <span>üíß</span>
          <span>Water balance</span>
        </div>

        <div class="barTrack" aria-label="water-bar-track">
          <div class="barFill" id="water-bar" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

        <div class="barRight">
          <span id="water-zone">LOW</span>
          <span id="water-pct">34%</span>
        </div>
      </div>
    </div>

    <!-- STATS + QUEST -->
    <div class="row">
      <section class="card" id="hha-card-left" data-hha-exclude="1">
        <div class="title">STATS</div>
        <div class="statsGrid">
          <div class="k">SCORE</div><div class="v" id="stat-score">0</div>
          <div class="k">COMBO</div><div class="v" id="stat-combo">0</div>
          <div class="k">MAX</div><div class="v" id="stat-combo-max">0</div>
          <div class="k">MISS</div><div class="v" id="stat-miss">0</div>
          <div class="k">TIME</div><div class="v" id="stat-time">0</div>
          <div class="k">GRADE</div><div class="v" id="stat-grade">C</div>
        </div>
      </section>

      <section class="card" id="hha-card-right" data-hha-exclude="1">
        <div class="title">QUEST</div>
        <div class="questLines">
          <div class="big" id="quest-title">Quest 1</div>
          <div id="quest-line1" class="muted">Goal: ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô GREEN ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö üü¢</div>
          <div id="quest-line2" class="muted">‡∏™‡∏∞‡∏™‡∏° GREEN ‡∏£‡∏ß‡∏° 0/18 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
          <div id="quest-line3" class="muted">Goals done: 0 ¬∑ Minis done: 0</div>
          <div id="quest-line4" class="muted">Water: LOW ¬∑ Cause: -</div>
        </div>
      </section>
    </div>

    <!-- BOTTOM -->
    <div class="bottom">
      <section class="card coachCard" data-hha-exclude="1">
        <div class="coachIcon">ü•¶</div>
        <div class="coachTxt">
          <div class="t1" id="coach-text">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡∏î‡∏µ ‡πÜ ‡∏ô‡∏∞! üíß</div>
          <div class="t2" id="coach-sub">‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÅ‡∏ï‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á crosshair</div>
        </div>
      </section>

      <section class="card" data-hha-exclude="1">
        <div class="title" style="display:flex;align-items:center;justify-content:space-between">
          <span>üî• Fever</span>
          <span id="fever-pct">0%</span>
        </div>
        <div class="feverTrack">
          <div class="feverFill" id="fever-bar"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- Buttons -->
  <div class="btnRow" data-hha-exclude="1">
    <button class="btn primary" id="btn-vr" type="button">VR</button>
    <button class="btn danger" id="btn-stop" type="button">STOP</button>
  </div>

  <!-- START OVERLAY -->
  <div id="start-overlay">
    <div class="startCard">
      <h2>üíß HydrationVR ‚Äî Hydro-Orb</h2>
      <p>
        ‡πÄ‡∏õ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏≠ ‚Äú‡∏•‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡πâ‡∏≥‚Äù (Hydro-Orb) ‚Äî ‡πÄ‡∏ô‡πâ‡∏ô <b>‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô GREEN</b> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à<br/>
        ‡πÇ‡∏´‡∏°‡∏î Play ‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏î‡πÅ‡∏ö‡∏ö‡∏ß‡∏¥‡∏à‡∏±‡∏¢: <b>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏≤‡∏¢‡∏°‡∏µ‡∏ú‡∏•</b> ‡πÅ‡∏•‡∏∞ <b>‡∏õ‡∏•‡πà‡∏≠‡∏¢ BAD ‡∏´‡∏•‡∏∏‡∏î‡∏Å‡πá‡πÇ‡∏î‡∏ô</b>
      </p>
      <div class="startBtns">
        <button class="btn primary" id="btn-start" type="button">üöÄ START</button>
        <button class="btn" id="btn-backhub" type="button">üè† HUB</button>
      </div>
      <p style="margin-top:10px">
        Tip: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏î‡∏≠‡∏∞‡πÑ‡∏£ ‡∏ô‡πâ‡∏≥‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢ ‡πÜ ‚Äú‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•‚Äù (regression-to-mean) ‡πÅ‡∏ï‡πà‡πÉ‡∏ô Play ‡∏à‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏Å‡πà‡∏≠‡∏ô
      </p>
    </div>
  </div>

  <!-- STAMP -->
  <div id="hha-stamp">
    <div class="stampBox">
      <div class="stampBig" id="stamp-big">GOAL!</div>
      <div class="stampSmall" id="stamp-small">+1</div>
    </div>
  </div>

  <!-- END OVERLAY -->
  <div id="hvr-end">
    <div class="endCard">
      <h2 style="margin:0">üèÅ Summary</h2>
      <div class="endGrid">
        <div class="k">SCORE</div><div class="v" id="end-score">0</div>
        <div class="k">GRADE</div><div class="v" id="end-grade">C</div>
        <div class="k">COMBO MAX</div><div class="v" id="end-combo">0</div>
        <div class="k">MISS</div><div class="v" id="end-miss">0</div>
        <div class="k">GOALS</div><div class="v" id="end-goals">0/1</div>
        <div class="k">MINIS</div><div class="v" id="end-minis">0/‚àû</div>
      </div>
      <div class="startBtns" style="margin-top:12px">
        <button class="btn primary" id="btn-retry" type="button">üîÅ RETRY</button>
        <button class="btn" id="btn-backhub-2" type="button">üè† HUB</button>
      </div>
    </div>
  </div>

  <script type="module">
    // wire end overlay hub button
    const qs = new URLSearchParams(location.search||'');
    const hub = qs.get('hub') || './hub.html';
    const b1 = document.getElementById('btn-backhub');
    const b2 = document.getElementById('btn-backhub-2');
    if (b1) b1.addEventListener('click', ()=> location.href = hub);
    if (b2) b2.addEventListener('click', ()=> location.href = hub);
  </script>

  <!-- GAME -->
  <script type="module" src="./hydration-vr/hydration.safe.js"></script>

</body>
</html>
