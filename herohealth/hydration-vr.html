<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon">

  <style>
    :root{
      --bg-main:#020617;
      --panel:#020617;
      --panel-soft:#020617;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,0.18);
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
      --danger:#f97316;
      --radius-lg:18px;
      --radius-pill:999px;
    }

    *{box-sizing:border-box;}

    html, body{
      margin:0;
      padding:0;
      background:var(--bg-main);
      color:var(--text-main);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
      height:100%;
      overflow-y:auto;
    }

    body{ -webkit-font-smoothing:antialiased; }

    #hvr-wrap{
      min-height:180vh;
      padding:12px 10px 64px;
      position:relative;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .hha-water-bar{
      background:linear-gradient(135deg,#020617,#020617);
      border-radius:999px;
      padding:10px 16px;
      border:1px solid rgba(148,163,184,0.35);
      display:flex;
      align-items:center;
      gap:10px;
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter:blur(18px);
    }

    .hha-water-bar-label{
      font-size:14px;
      color:var(--text-soft);
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    .hha-water-bar-label span.emoji{ font-size:17px; }

    .hha-water-bar-status{
      margin-left:auto;
      font-size:14px;
    }

    .hha-water-bar-fill{
      flex:1 1 auto;
      height:8px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      overflow:hidden;
    }
    .hha-water-bar-fill-inner{
      height:100%;
      width:38%;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#4ade80);
      transition:width .3s ease;
    }

    .hha-main-row{
      display:flex;
      gap:10px;
      margin-top:8px;
    }
    .hha-card{
      background:radial-gradient(circle at top left,#0b1120,#020617 60%);
      border-radius:var(--radius-lg);
      border:1px solid rgba(148,163,184,0.25);
      padding:12px 14px;
      box-shadow:0 18px 40px rgba(15,23,42,0.85);
    }

    .hha-card-left{ flex:1.1 1 0; min-width:0; }
    .hha-card-right{ flex:1 1 0; min-width:0; }

    .hha-title{
      font-size:15px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--text-soft);
      margin-bottom:2px;
    }
    .hha-mode{
      font-size:20px;
      font-weight:600;
      margin-bottom:6px;
    }

    .hha-pill-row{
      display:flex;
      gap:8px;
      margin:6px 0 10px;
      flex-wrap:wrap;
    }
    .hha-pill{
      border-radius:999px;
      padding:4px 10px;
      font-size:12px;
      letter-spacing:.06em;
      text-transform:uppercase;
      border:1px solid rgba(148,163,184,0.4);
      color:var(--text-soft);
    }
    .hha-pill-primary{
      border-color:rgba(56,189,248,0.8);
      color:#e0f2fe;
    }
    .hha-pill-diff{
      border-color:rgba(34,197,94,0.8);
      color:#bbf7d0;
    }

    .hha-score-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      margin-top:6px;
      gap:10px;
    }
    .hha-score-block{ font-size:13px; }
    .hha-score-block strong{
      display:block;
      font-size:26px;
      line-height:1.1;
    }
    .hha-score-label{
      font-size:12px;
      color:var(--text-soft);
      margin-top:2px;
    }

    .hha-grade{
      text-align:right;
      font-size:12px;
      color:var(--text-soft);
    }
    .hha-grade span.badge{
      display:inline-block;
      min-width:36px;
      text-align:center;
      padding:3px 8px;
      border-radius:999px;
      font-weight:600;
      font-size:13px;
      background:rgba(15,23,42,0.95);
      border:1px solid rgba(148,163,184,0.4);
      margin-left:4px;
    }

    .hha-quest-title{
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--text-soft);
      margin-bottom:4px;
    }
    .hha-quest-main{
      font-size:16px;
      font-weight:600;
      margin-bottom:4px;
    }
    .hha-quest-mini{
      font-size:14px;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .hha-quest-progress{
      font-size:13px;
      color:var(--text-soft);
      margin-top:4px;
    }
    .hha-quest-progress strong{ color:var(--accent); }

    /* ===== PLAYFIELD ===== */
    #hvr-playfield{
      position:relative;
      height:60vh;
      margin-top:14vh;
      margin-bottom:38vh;
      overflow:visible;

      /* ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô‡∏ó‡∏±‡∏ö */
      z-index:30;
    }

    .hvr-target{
      position:absolute;
      transform:translate(-50%,-50%);
      border-radius:999px;
      border:2px solid rgba(15,23,42,0.85);
      box-shadow:
        0 0 0 2px rgba(15,23,42,0.9),
        0 16px 35px rgba(0,0,0,0.75),
        0 0 28px rgba(34,197,94,0.55);
      display:flex;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at 30% 30%,#4ade80,#16a34a);
      color:#f9fafb;
      user-select:none;
      cursor:pointer;
      transition:transform .08s ease-out, box-shadow .12s ease-out;

      /* ‚úÖ ‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô‡∏ó‡∏±‡∏ö */
      z-index:35;
    }
    .hvr-target.bad{
      background:radial-gradient(circle at 30% 30%,#fb923c,#ea580c);
      box-shadow:
        0 0 0 2px rgba(15,23,42,0.9),
        0 16px 35px rgba(0,0,0,0.85),
        0 0 26px rgba(248,113,113,0.66);
    }
    .hvr-target:active{
      transform:translate(-50%,-50%) scale(.93);
      box-shadow:
        0 0 0 2px rgba(15,23,42,0.9),
        0 10px 24px rgba(0,0,0,0.85);
    }

    .hvr-crosshair{
      position:fixed;
      left:50%;
      top:58%;
      transform:translate(-50%,-50%);
      width:48px;
      height:48px;
      border-radius:999px;
      border:2px solid rgba(148,163,184,0.9);
      box-shadow:0 0 0 1px rgba(15,23,42,0.85);
      display:flex;
      align-items:center;
      justify-content:center;
      color:rgba(148,163,184,0.9);
      font-size:18px;
      pointer-events:none;
      z-index:50;
      backdrop-filter:blur(8px);
      background:radial-gradient(circle at 30% 30%,rgba(15,23,42,0.9),rgba(15,23,42,0.4));
    }

    .hha-coach-wrap{ margin-top:6px; }
    .hha-coach-bubble{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-radius:var(--radius-lg);
      background:radial-gradient(circle at top left,#064e3b,#022c22);
      border:1px solid rgba(34,197,94,0.5);
      color:#dcfce7;
      box-shadow:0 14px 32px rgba(6,95,70,0.7);
    }
    .hha-coach-avatar{
      width:40px;
      height:40px;
      border-radius:999px;
      overflow:hidden;
      background:#064e3b;
      flex-shrink:0;
    }
    .hha-coach-avatar img{ width:100%; height:100%; object-fit:cover; }
    .hha-coach-text{ font-size:14px; line-height:1.45; }
    .hha-coach-name{ font-weight:600; margin-bottom:2px; }

    .hha-bottom-row{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      padding:6px 12px 10px;
      display:flex;
      gap:10px;
      align-items:center;
      z-index:45;
      pointer-events:none;
    }
    .hha-bottom-row > *{ pointer-events:auto; }

    .hha-fever-card{
      flex:1 1 auto;
      border-radius:var(--radius-lg);
      background:radial-gradient(circle at top left,#020617,#020617 65%);
      border:1px solid rgba(148,163,184,0.4);
      padding:6px 10px 8px;
      font-size:12px;
      color:var(--text-soft);
      box-shadow:0 14px 32px rgba(15,23,42,0.95);
    }
    .hha-fever-label{
      display:flex;
      align-items:center;
      gap:6px;
      margin-bottom:4px;
    }
    .hha-fever-label span.emoji{ font-size:16px; }
    .hha-fever-bar{
      height:8px;
      border-radius:999px;
      background:rgba(15,23,42,0.95);
      overflow:hidden;
      position:relative;
    }
    .hha-fever-bar-inner{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#f97316,#fb923c,#facc15);
      transition:width .2s ease-out;
    }
    .hha-fever-extra{
      font-size:11px;
      margin-top:3px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--text-soft);
    }

    .hha-btn-vr{
      flex:0 0 auto;
      min-width:132px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.55);
      padding:10px 14px;
      background:radial-gradient(circle at top left,#020617,#020617 70%);
      color:#e5e7eb;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      text-decoration:none;
      box-shadow:0 14px 32px rgba(15,23,42,0.95);
    }

    .hha-btn-vr span.emoji{ font-size:18px; }

    @media (min-width:900px){
      #hvr-wrap{ max-width:960px; margin:0 auto; }
      .hha-bottom-row{
        left:50%;
        transform:translateX(-50%);
        max-width:960px;
      }
    }
  </style>
</head>
<body>

<div id="hvr-wrap">

  <header class="hha-water-bar" id="hha-water-header">
    <div class="hha-water-bar-label">
      <span class="emoji">üíß</span>
      <span>Water balance</span>
    </div>
    <div class="hha-water-bar-fill">
      <div class="hha-water-bar-fill-inner" id="hha-water-fill"></div>
    </div>
    <div class="hha-water-bar-status" id="hha-water-status">GREEN 50%</div>
  </header>

  <section class="hha-main-row">
    <article class="hha-card hha-card-left" id="hha-card-left">
      <div class="hha-title">HERO HEALTH ‚Ä¢ HYDRATION VR</div>
      <div class="hha-mode" id="hha-mode-label">Hydration Quest</div>

      <div class="hha-pill-row">
        <div class="hha-pill hha-pill-primary" id="hha-mode-pill">PLAY MODE</div>
        <div class="hha-pill hha-pill-diff" id="hha-diff-pill">EASY ‚Ä¢ 80s</div>
      </div>

      <div class="hha-score-row">
        <div class="hha-score-block">
          ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
          <strong id="hha-score-main">0</strong>
          <div class="hha-score-label">
            ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:
            <span id="hha-combo-max">0</span>
          </div>
        </div>
        <div class="hha-score-block">
          ‡∏û‡∏•‡∏≤‡∏î
          <strong id="hha-miss">0</strong>
          <div class="hha-score-label">
            ‡∏ô‡πâ‡∏≥‡πÇ‡∏ã‡∏ô:
            <span id="hha-water-zone-text">GREEN</span>
          </div>
        </div>
        <div class="hha-grade">
          ‡πÄ‡∏Å‡∏£‡∏î (REAL-TIME)
          <span class="badge" id="hha-grade-badge">C</span>
        </div>
      </div>
    </article>

    <article class="hha-card hha-card-right" id="hha-card-right">
      <div class="hha-quest-title">QUEST</div>
      <div class="hha-quest-main" id="hha-quest-goal">Goal: ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏ã‡∏ô‡∏ô‡πâ‡∏≥‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</div>
      <div class="hha-quest-mini" id="hha-quest-mini">Mini: ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡∏î‡∏µ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á</div>

      <div class="hha-quest-progress">
        Goal:
        <strong><span id="hha-goal-done">0</span>/<span id="hha-goal-total">2</span></strong>
      </div>
      <div class="hha-quest-progress">
        Mini quest:
        <strong><span id="hha-mini-done">0</span>/<span id="hha-mini-total">3</span></strong>
      </div>
    </article>
  </section>

  <main id="hvr-playfield"></main>

  <div id="hvr-crosshair" class="hvr-crosshair">‚óã</div>

  <section class="hha-coach-wrap">
    <div class="hha-coach-bubble" id="hha-coach-bubble">
      <div class="hha-coach-avatar"></div>
      <div class="hha-coach-text">
        <div class="hha-coach-name">‡πÇ‡∏Ñ‡πâ‡∏ä</div>
        <div id="hha-coach-text">
          ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡∏∑‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ã‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß üíß ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏î‡∏µ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡∏∞
        </div>
      </div>
    </div>
  </section>

</div>

<div class="hha-bottom-row">
  <div class="hha-fever-card">
    <div class="hha-fever-label">
      <span class="emoji">üî•</span>
      <span>FEVER GAUGE</span>
    </div>
    <div class="hha-fever-bar">
      <div class="hha-fever-bar-inner" id="hha-fever-fill"></div>
    </div>
    <div class="hha-fever-extra">
      <span>‡πÄ‡∏Å‡∏£‡∏≤‡∏∞: <span id="hha-shield-count">0</span></span>
      <span id="hha-fever-percent">0%</span>
    </div>
  </div>

  <a href="#" id="hha-btn-vr" class="hha-btn-vr">
    <span class="emoji">üï∂Ô∏è</span>
    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î VR</span>
  </a>
</div>

<script src="./vr/particles.js"></script>
<script src="./vr/ui-fever.js"></script>
<script src="./vr/hha-hud.js"></script>

<script type="module">
  import { boot as hydrationBoot } from './hydration-vr/hydration.safe.js';

  function parseQuery() {
    const url = new URL(window.location.href);
    const diff = (url.searchParams.get('diff') || 'easy').toLowerCase();
    let time = parseInt(url.searchParams.get('time') || '80', 10);
    if (!Number.isFinite(time) || time <= 0) time = 80;
    if (time < 20) time = 20;
    if (time > 180) time = 180;
    return { diff, time };
  }

  window.addEventListener('DOMContentLoaded', async () => {
    const { diff, time } = parseQuery();

    const diffText = diff.toUpperCase();
    const diffPill = document.getElementById('hha-diff-pill');
    if (diffPill) diffPill.textContent = diffText + ' ‚Ä¢ ' + time + 's';

    try {
      await hydrationBoot({
        difficulty: diff,
        duration: time
      });

      // ‚úÖ watchdog: ‡∏ö‡∏≠‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ß‡πà‡∏≤ spawn ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà spawn
      setTimeout(() => {
        const pf = document.getElementById('hvr-playfield');
        const n = pf ? pf.querySelectorAll('.hvr-target').length : 0;
        console.log('[HydrationVR] targets in playfield =', n);

        if (n === 0) {
          console.warn('[HydrationVR] No targets spawned. -> mode-factory.js ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤ container/spawnLayer ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° spawn');
        } else {
          const t = pf.querySelector('.hvr-target');
          if (t) console.log('[HydrationVR] first target opacity/transform =',
            getComputedStyle(t).opacity,
            getComputedStyle(t).transform
          );
        }
      }, 2500);

    } catch (err) {
      console.error('[HydrationVR] boot error', err);
      alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration Quest ‡πÑ‡∏î‡πâ');
    }
  });
</script>

</body>
</html>