<!-- === /herohealth/hydration-vr.html ===
HydrationVR ROOT Launcher ‚Äî PRODUCTION (Hardened)
‚úÖ Enforce flow: Warmup(20s) ‚Üí RUN ‚Üí Cooldown(20s) ‚Üí HUB
‚úÖ RUN file: ./hydration-vr/hydration-vr.html
‚úÖ Auto view: pc/mobile (coarse pointer OR UA) IF no ?view=
‚úÖ Pass-through all query params (except next/phase/dur/cdur/autonext)
‚úÖ Adds: gate=1, cdur=20
‚úÖ Harden: hub decode-once to avoid double-encoding
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî HydrationVR (Launcher)</title>
  <meta name="color-scheme" content="dark light"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    html,body{height:100%;margin:0;background:#020617;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;}
    .c{min-height:100%;display:flex;align-items:center;justify-content:center;padding:16px;}
    .p{max-width:780px;width:100%;border:1px solid rgba(148,163,184,.18);background:rgba(2,6,23,.72);border-radius:22px;padding:14px;box-shadow:0 20px 70px rgba(0,0,0,.45);}
    .t{font-weight:1000;font-size:16px;}
    .s{color:rgba(148,163,184,.95);margin-top:6px;font-size:12.5px;line-height:1.4;}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:rgba(229,231,235,.9);margin-top:10px;white-space:pre-wrap;}
  </style>
</head>
<body>
<div class="c">
  <div class="p">
    <div class="t">üíß HydrationVR ‚Äî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô Warmup Gate‚Ä¶</div>
    <div class="s">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö: Warmup (20s) ‚Üí ‡πÄ‡∏Å‡∏° ‚Üí Cooldown (20s) ‚Üí ‡∏Å‡∏•‡∏±‡∏ö HUB</div>
    <div class="mono" id="dbg"></div>
  </div>
</div>

<script>
(() => {
  'use strict';

  const QS = new URL(location.href).searchParams;

  const isMobileLike = ()=>{
    const ua = String(navigator.userAgent||'');
    const coarse = (typeof matchMedia === 'function' && matchMedia('(pointer:coarse)').matches);
    const uaMobile = /Android|iPhone|iPad|iPod/i.test(ua);
    return coarse || uaMobile;
  };

  // view: keep user-specified; else auto
  const viewRaw = (QS.get('view') || '').trim();
  const view = viewRaw ? String(viewRaw).toLowerCase() : (isMobileLike() ? 'mobile' : 'pc');

  // hub: decode-once (avoid double-encoding across passes)
  const hubDefault = './hub.html';
  let hub = QS.get('hub') || hubDefault;
  try { hub = decodeURIComponent(hub); } catch(_){}

  // durations
  const gateDur = Math.max(5, Math.min(60, Number(QS.get('dur')  || 20) || 20));
  const cdur    = Math.max(5, Math.min(60, Number(QS.get('cdur') || 20) || 20));

  // passthrough (deny these)
  const deny = new Set(['next','phase','dur','cdur','autonext']);
  const pass = new URLSearchParams();
  QS.forEach((v,k)=>{ if(!deny.has(k)) pass.set(k,v); });

  // only set view if not provided
  if(!viewRaw) pass.set('view', view);

  // RUN target
  const gameRun = new URL('./hydration-vr/hydration-vr.html', location.href);
  pass.forEach((v,k)=> gameRun.searchParams.set(k,v));
  gameRun.searchParams.set('hub', hub);
  gameRun.searchParams.set('gate', '1');
  gameRun.searchParams.set('cdur', String(cdur));

  // Warmup gate
  const gate = new URL('./warmup-gate.html', location.href);
  gate.searchParams.set('phase','warmup');
  gate.searchParams.set('dur', String(gateDur));
  gate.searchParams.set('hub', hub);
  gate.searchParams.set('next', gameRun.toString());
  gate.searchParams.set('autonext','1');

  const dbg = document.getElementById('dbg');
  if(dbg){
    dbg.textContent =
      'view(auto) = ' + view + '\n' +
      'warmup dur = ' + gateDur + 's\n' +
      'cooldown dur = ' + cdur + 's\n\n' +
      'gate => ' + gate.toString() + '\n\n' +
      'next(game) => ' + gameRun.toString();
  }

  location.replace(gate.toString());
})();
</script>
</body>
</html>