<!-- === /herohealth/hydration-vr.html ===
Hydration Quest VR ‚Äî PRODUCTION HTML (UPDATED) ‚Äî (NO SAFE INCLUDED HERE)
‚úÖ FIX: module path ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á + cache-bust param
‚úÖ FIX: DOM ids ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà hydration.safe.js ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
‚úÖ FX hooks: storm / storm-warn / edge flash (--fx) / warn amp (--warnamp)
‚úÖ Start overlay + End summary + VR button + Stop + Retry
‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö particles.js + cloud logger (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame (‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° VR ‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + Logger (optional but recommended) -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.74);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;

      --good:#22d3ee;
      --good2:#3b82f6;
      --bad:#ef4444;
      --warn:#f59e0b;
      --violet:#a78bfa;

      /* FX hooks (hydration.safe.js ‡∏à‡∏∞ set) */
      --fx: 0;       /* edge flash strength */
      --warnamp: 0;  /* warning pulse strength */

      /* safe-area */
      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 50% -10%, rgba(34,211,238,.12), rgba(2,6,23,0) 60%),
                  radial-gradient(900px 520px at 60% 10%, rgba(167,139,250,.10), rgba(2,6,23,0) 58%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", Arial;
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* ----- Edge FX ----- */
    .edgefx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:40;
      background:
        radial-gradient(900px 520px at 50% 40%,
          rgba(2,6,23,0) 55%,
          rgba(239,68,68, calc(.55 * var(--fx))) 100%);
      opacity: calc(.05 + .95 * var(--fx));
      mix-blend-mode: screen;
      transition: opacity .08s linear;
    }

    /* ----- Storm warning overlay ----- */
    .stormWarn{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:35;
      background:
        radial-gradient(1200px 700px at 50% 30%,
          rgba(245,158,11, calc(.22 * var(--warnamp))) 0%,
          rgba(2,6,23,0) 62%);
      opacity: calc(.05 + .95 * var(--warnamp));
      transition: opacity .08s linear;
    }

    body.storm{
      background:
        radial-gradient(1200px 700px at 50% 30%,
          rgba(239,68,68,.10), rgba(2,6,23,0) 60%),
        radial-gradient(900px 520px at 60% 10%,
          rgba(245,158,11,.10), rgba(2,6,23,0) 58%),
        var(--bg);
    }

    body.storm-warn .stormWarn{ opacity: calc(.12 + 1.10 * var(--warnamp)); }

    /* shake (soft) */
    body.fx-shake{
      animation: hhaShake 0.22s linear infinite;
    }
    @keyframes hhaShake{
      0%{ transform: translate3d(0,0,0) }
      25%{ transform: translate3d(0.8px,-0.6px,0) }
      50%{ transform: translate3d(-0.7px,0.7px,0) }
      75%{ transform: translate3d(0.6px,0.6px,0) }
      100%{ transform: translate3d(0,0,0) }
    }

    /* ----- layout ----- */
    .hud{
      position:fixed;
      left:calc(10px + var(--sal));
      right:calc(10px + var(--sar));
      top:calc(10px + var(--sat));
      z-index:20;
      display:flex;
      gap:10px;
      align-items:stretch;
    }

    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:16px;
      box-shadow: 0 16px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .stats{
      min-width: 220px;
      padding:10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .row b{ color:var(--text); font-weight:700; letter-spacing:.2px }

    .badge{
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(2,6,23,.35);
      color:var(--text);
    }

    .quest{
      flex:1;
      padding:10px 12px;
      min-width: 260px;
    }
    .quest .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
    }
    .quest .title span{
      font-weight:800;
      letter-spacing:.3px;
    }
    .quest .lines{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
      color:var(--muted);
    }
    .quest .lines div{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .mini{
      min-width: 280px;
      padding:10px 12px;
    }
    .mini .miniTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .mini .miniTop b{
      letter-spacing:.2px;
    }
    .mini .barWrap{
      background: rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.16);
      border-radius:999px;
      height:10px;
      overflow:hidden;
    }
    .mini .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(245,158,11,.9), rgba(239,68,68,.85));
    }
    .miniGrid{
      margin-top:8px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:6px 10px;
      font-size:12px;
      color:var(--muted);
    }
    .miniGrid .ok{
      color: #a7f3d0;
    }

    /* water pill */
    .water{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      min-width: 240px;
    }
    .pill{
      flex:1;
    }
    .pill .cap{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .pillBar{
      height:10px;
      border-radius:999px;
      background: rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.16);
      overflow:hidden;
    }
    #water-bar{
      height:100%;
      width:50%;
      background: linear-gradient(90deg, rgba(34,211,238,.9), rgba(59,130,246,.85));
      transition: width .08s linear;
    }
    #water-bar.red{
      background: linear-gradient(90deg, rgba(239,68,68,.92), rgba(245,158,11,.88));
    }

    .btnRow{
      position:fixed;
      left:calc(10px + var(--sal));
      right:calc(10px + var(--sar));
      bottom:calc(10px + var(--sab));
      z-index:22;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    .btns{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(148,163,184,.16);
      background: rgba(2,6,23,.55);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .btn.primary{
      background: linear-gradient(90deg, rgba(34,211,238,.95), rgba(59,130,246,.9));
      color:#04121f;
      border-color: rgba(34,211,238,.30);
    }
    .btn.danger{
      background: linear-gradient(90deg, rgba(239,68,68,.95), rgba(245,158,11,.9));
      color:#1a0707;
      border-color: rgba(239,68,68,.28);
    }
    .btn.secondary{
      background: rgba(15,23,42,.70);
    }

    /* ----- playfield ----- */
    #playfield{
      position:fixed;
      left:0; top:0; right:0; bottom:0;
      z-index:5;
      touch-action: none;
      will-change: transform;
    }
    #hvr-layer{
      position:absolute;
      inset:0;
      pointer-events:auto;
    }

    /* stamp */
    #hha-stamp{
      position:fixed;
      left:50%;
      top:45%;
      transform: translate(-50%,-50%) scale(.92);
      z-index:30;
      background: rgba(2,6,23,.78);
      border:1px solid rgba(148,163,184,.18);
      border-radius:20px;
      padding:14px 16px;
      box-shadow: 0 18px 70px rgba(0,0,0,.45);
      opacity:0;
      pointer-events:none;
      transition: opacity .12s ease, transform .12s ease;
      text-align:center;
      min-width: 220px;
    }
    #hha-stamp.show{
      opacity:1;
      transform: translate(-50%,-50%) scale(1);
    }
    #stamp-big{
      font-size:18px;
      font-weight:900;
      letter-spacing:.3px;
      margin-bottom:4px;
    }
    #stamp-small{
      font-size:12px;
      color:var(--muted);
    }

    /* coach */
    .coach{
      position:fixed;
      right:calc(10px + var(--sar));
      bottom:calc(72px + var(--sab));
      z-index:21;
      width:min(360px, calc(100vw - 20px));
      pointer-events:none;
    }
    .coach .card{
      padding:10px 12px;
    }
    #coach-text{
      font-weight:900;
      letter-spacing:.2px;
      margin-bottom:2px;
    }
    #coach-sub{
      font-size:12px;
      color:var(--muted);
    }

    /* start overlay */
    #start-overlay{
      position:fixed; inset:0;
      z-index:50;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background: radial-gradient(900px 520px at 50% 30%, rgba(34,211,238,.16), rgba(2,6,23,.86) 70%),
                  rgba(2,6,23,.78);
      backdrop-filter: blur(8px);
    }
    .startCard{
      width:min(520px, 92vw);
      border-radius:22px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.78);
      box-shadow: 0 22px 90px rgba(0,0,0,.55);
      padding:16px;
    }
    .startCard h1{
      margin:0 0 6px 0;
      font-size:18px;
      letter-spacing:.2px;
    }
    .startCard p{
      margin:0 0 12px 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .startCard .startBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    /* end summary */
    #hvr-end{
      position:fixed; inset:0;
      z-index:60;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(2,6,23,.78);
      backdrop-filter: blur(10px);
    }
    .endCard{
      width:min(560px, 92vw);
      border-radius:22px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.82);
      box-shadow: 0 22px 90px rgba(0,0,0,.55);
      padding:16px;
    }
    .endTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
      gap:10px;
      flex-wrap:wrap;
    }
    .endTop h2{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
    }
    .endGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .endItem{
      background: rgba(15,23,42,.65);
      border:1px solid rgba(148,163,184,.16);
      border-radius:16px;
      padding:10px 12px;
    }
    .endItem .k{
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .endItem .v{
      font-weight:900;
      font-size:18px;
    }

    /* A-Frame scene (optional) */
    a-scene{ position:fixed; inset:0; z-index:1; opacity:0; pointer-events:none; }
  </style>
</head>

<body>
  <!-- FX Layers -->
  <div class="stormWarn"></div>
  <div class="edgefx"></div>

  <!-- Optional A-Frame scene to enable enterVR() -->
  <a-scene embedded vr-mode-ui="enabled:false"></a-scene>

  <!-- Start Overlay -->
  <div id="start-overlay">
    <div class="startCard">
      <h1>Hydration Quest üíß</h1>
      <p>
        ‡πÄ‡∏õ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏° ‚Äú‡∏ô‡πâ‡∏≥‚Äù ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà <b>GREEN</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô Goal ‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡∏≠ <b>Storm mini</b> ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á ‡πÜ <br/>
        (‡∏õ‡∏∏‡πà‡∏° VR ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö WebXR)
      </p>
      <div class="startBtns">
        <button id="btn-start" class="btn primary" type="button">‚ñ∂ START</button>
        <button id="btn-vr" class="btn" type="button">ü•Ω Enter VR</button>
      </div>
      <p style="margin-top:10px;font-size:12px">
        ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô/‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î: ‡πÄ‡∏ä‡πá‡∏Ñ path ‡∏Ç‡∏≠‡∏á <code>hydration.safe.js</code> ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 404)
      </p>
    </div>
  </div>

  <!-- HUD -->
  <div class="hud">
    <div class="card stats">
      <div class="row"><span>TIME</span><b id="stat-time">70</b></div>
      <div class="row"><span>SCORE</span><b id="stat-score">0</b></div>
      <div class="row"><span>COMBO</span><b id="stat-combo">0</b></div>
      <div class="row"><span>MAX</span><b id="stat-combo-max">0</b></div>
      <div class="row"><span>MISS</span><b id="stat-miss">0</b></div>
      <div class="row"><span>GRADE</span><b id="stat-grade" class="badge">C</b></div>
    </div>

    <div class="card quest">
      <div class="title">
        <span>üéØ Quest</span>
        <span class="badge">Hydration</span>
      </div>
      <div class="lines">
        <div id="quest-line1">‚Äî</div>
        <div id="quest-line2">‚Äî</div>
        <div id="quest-line3">‚Äî</div>
        <div id="quest-line4">‚Äî</div>
      </div>
    </div>

    <div class="card water">
      <div class="pill">
        <div class="cap">
          <span>WATER</span>
          <b><span id="water-zone">GREEN</span> ‚Ä¢ <span id="water-pct">50%</span></b>
        </div>
        <div class="pillBar"><div id="water-bar"></div></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <div class="badge">üõ°Ô∏è <span id="shield-count">0</span></div>
        <div class="badge">üå™Ô∏è <span id="storm-left">0</span></div>
      </div>
    </div>

    <div class="card mini">
      <div class="miniTop">
        <b>üå™Ô∏è Storm mini</b>
        <span class="badge">in <span id="mini-storm-in">‚Äî</span>s</span>
      </div>

      <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-bottom:6px">
        <span>Pressure</span>
        <b style="color:var(--text)"><span id="mini-pressure-pct">0</span>%</b>
      </div>
      <div class="barWrap"><div id="mini-pressure-bar" class="bar"></div></div>

      <!-- checklist -->
      <div class="miniGrid" style="margin-top:10px">
        <div id="mini-c-storm">Storm active</div><div id="mini-v-storm">NO</div>
        <div id="mini-c-zone">Zone ‚â† GREEN</div><div id="mini-v-zone">GREEN</div>
        <div id="mini-c-pressure">Pressure ‚â• thr</div><div id="mini-v-pressure">0% / 0%</div>
        <div id="mini-c-end">End-window</div><div id="mini-v-end">in ~‚Äîs</div>
        <div id="mini-c-block">Blocks</div><div id="mini-v-block">0/0</div>
      </div>
    </div>
  </div>

  <!-- Coach -->
  <div class="coach">
    <div class="card">
      <div id="coach-text">‡πÅ‡∏ï‡∏∞ START ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>
      <div id="coach-sub">‡∏Ñ‡∏∏‡∏° GREEN ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≠ Storm mini!</div>
    </div>
  </div>

  <!-- Playfield -->
  <div id="playfield">
    <div id="hvr-layer"></div>
  </div>

  <!-- Stamp -->
  <div id="hha-stamp">
    <div id="stamp-big">‚Äî</div>
    <div id="stamp-small">‚Äî</div>
  </div>

  <!-- Bottom Buttons -->
  <div class="btnRow">
    <div class="btns">
      <button id="btn-stop" class="btn danger" type="button">‚èπ Stop</button>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <span class="badge">seed/diff/runMode ‡∏°‡∏≤‡∏à‡∏≤‡∏Å URL</span>
    </div>
  </div>

  <!-- End Summary -->
  <div id="hvr-end">
    <div class="endCard">
      <div class="endTop">
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <button id="btn-retry" class="btn primary" type="button">üîÅ Retry</button>
          <!-- Back to HUB ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ safe.js (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ hub param) -->
        </div>
      </div>

      <div class="endGrid">
        <div class="endItem">
          <div class="k">Score</div>
          <div class="v" id="end-score">0</div>
        </div>
        <div class="endItem">
          <div class="k">Grade</div>
          <div class="v" id="end-grade">C</div>
        </div>
        <div class="endItem">
          <div class="k">Combo Max</div>
          <div class="v" id="end-combo">0</div>
        </div>
        <div class="endItem">
          <div class="k">Miss</div>
          <div class="v" id="end-miss">0</div>
        </div>
        <div class="endItem">
          <div class="k">Goals</div>
          <div class="v" id="end-goals">0/0</div>
        </div>
        <div class="endItem">
          <div class="k">Minis</div>
          <div class="v" id="end-minis">0/0</div>
        </div>
      </div>

      <p style="margin:12px 2px 0;color:var(--muted);font-size:12px;line-height:1.45">
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô <code>localStorage:HHA_LAST_SUMMARY</code> ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á event <code>hha:end</code>
      </p>
    </div>
  </div>

  <!-- ‚úÖ IMPORTANT: module path ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å + ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏™‡πà v= ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô cache -->
  <script type="module" src="./hydration-vr/hydration.safe.js?v=20251227a"></script>
</body>
</html>