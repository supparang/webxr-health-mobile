<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest (Launcher)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --cyan:#22d3ee;
      --warn:#f59e0b;
      --radius:22px;
      --pill:999px;
      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:
      radial-gradient(circle at top left, rgba(34,197,94,.14), transparent 55%),
      radial-gradient(circle at bottom right, rgba(34,211,238,.10), transparent 55%),
      var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--text);
    }
    .wrap{
      min-height:100%;
      padding: calc(18px + var(--sat)) calc(16px + var(--sar)) calc(18px + var(--sab)) calc(16px + var(--sal));
      display:grid; place-items:center;
    }
    .card{
      width:min(880px, 100%);
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: 0 22px 90px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      padding: 18px;
      display:grid; gap:14px;
    }
    .top{ display:flex; justify-content:space-between; align-items:flex-start; gap:12px; }
    .title{ font-weight:900; letter-spacing:.2px; font-size: 20px; }
    .sub{ color:var(--muted); font-weight:700; font-size:13px; line-height:1.35; }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin-top:6px; }
    .chip{
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.55);
      font-weight:800; font-size:12px; color:var(--text);
    }
    .chip b{ color:var(--cyan); }
    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; }
    @media (max-width: 760px){ .grid{ grid-template-columns: 1fr; } }
    .panel{
      background: var(--panel2);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 14px;
      display:grid; gap:10px;
    }
    .panel h3{ margin:0; font-size:14px; letter-spacing:.2px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{
      appearance:none; border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.55);
      color:var(--text);
      border-radius: 16px;
      padding: 12px 14px;
      font-weight:900;
      cursor:pointer;
      flex: 1 1 160px;
      min-width: 160px;
      transition: transform .08s ease, border-color .12s ease, background .12s ease;
    }
    .btn:hover{ border-color: rgba(34,197,94,.35); }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
    .btn.cyan{ background: rgba(34,211,238,.14); border-color: rgba(34,211,238,.30); }
    .btn.warn{ background: rgba(245,158,11,.14); border-color: rgba(245,158,11,.28); }
    .mini{ font-size:12px; font-weight:800; color:var(--muted); line-height:1.35; }
    .linkbtn{
      appearance:none; border:none; background:transparent; color:var(--muted);
      font-weight:900; cursor:pointer; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
    }
    .linkbtn:hover{ color:var(--text); border-color: rgba(148,163,184,.28); }
    code{ font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:12px; }
    .hr{ height:1px; background: rgba(148,163,184,.16); margin:6px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <div class="title">Hydration Quest üíß (Launcher)</div>
          <div class="sub">
            root = launcher ‚Ä¢ folder = run<br/>
            Auto-detect + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î + ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å auto-run ‡πÑ‡∏î‡πâ
          </div>
          <div class="badges">
            <div class="chip">Auto: <b id="autoMode">-</b></div>
            <div class="chip">Last: <b id="lastMode">-</b></div>
            <div class="chip">Run: <b id="runMode">-</b></div>
            <div class="chip">Diff: <b id="diffMode">-</b></div>
            <div class="chip">Time: <b id="timeMode">-</b>s</div>
          </div>
        </div>
        <button class="linkbtn" id="btnGoHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>

      <div class="grid">
        <div class="panel">
          <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô</h3>
          <div class="row">
            <button class="btn primary" id="btnPC" type="button">üñ•Ô∏è PC</button>
            <button class="btn cyan" id="btnMobile" type="button">üì± Mobile</button>
            <button class="btn warn" id="btnCardboard" type="button">ü•Ω Cardboard</button>
          </div>

          <div class="hr"></div>

          <div class="row" style="justify-content:space-between">
            <div class="mini" id="autoRow" style="flex:1">
              ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <b id="cd">2.0</b>s ‚Üí <b id="autoMode2">-</b>
            </div>
            <button class="linkbtn" id="btnCancelAuto" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>

          <div class="mini" style="margin-top:4px">
            ‚Ä¢ Kids-friendly: <code>?kids=1</code><br/>
            ‚Ä¢ ‡∏ß‡∏¥‡∏à‡∏±‡∏¢: <code>?run=research&seed=...</code><br/>
            ‚Ä¢ ‡∏™‡πà‡∏á‡∏ä‡∏µ‡∏ï: <code>?log=https://script.google.com/macros/s/.../exec</code>
          </div>
        </div>

        <div class="panel">
          <h3>Run page (folder)</h3>
          <div class="mini">
            Run ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà:<br/>
            <code id="runPath">/herohealth/hydration-vr/hydration-vr.html</code>
          </div>
          <div class="hr"></div>
          <div class="mini">
            Cardboard ‡∏à‡∏∞‡∏™‡πà‡∏á <code>view=cvr&cardboard=1</code> ‡πÉ‡∏´‡πâ loader ‡πÄ‡∏õ‡∏¥‡∏î L/R layers ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  // ‚úÖ root launcher -> folder run
  const RUN_PAGE = './hydration-vr/hydration-vr.html';
  const LAST_KEY = 'HHA_LAST_VIEW_hydration';

  const qs = (k, def=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? def; }catch(_){ return def; } };

  function detectAuto(){
    const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints|0) > 0;
    const w = Math.max(1, window.innerWidth||1);
    const h = Math.max(1, window.innerHeight||1);
    const landscape = w >= h;

    if (!isTouch) return { view:'pc', cardboard:false, text:'PC' };
    if (landscape && w >= 740) return { view:'cvr', cardboard:false, text:'cVR (landscape)' };
    return { view:'mobile', cardboard:false, text:'Mobile' };
  }

  function readLast(){ try{ return localStorage.getItem(LAST_KEY) || ''; }catch(_){ return ''; } }
  function saveLast(v){ try{ localStorage.setItem(LAST_KEY, v); }catch(_){ } }

  function buildRunUrl(view, cardboard){
    const u = new URL(RUN_PAGE, location.href);
    const src = new URL(location.href);

    // pass-through params
    const pass = [
      'hub','run','runMode','diff','time','durationPlannedSec','seed','sessionId','studentKey',
      'studyId','conditionGroup','sessionOrder','blockLabel','siteCode',
      'projectTag','timestampIso','ts','log','kids','water'
    ];
    for (const k of pass){
      const v = src.searchParams.get(k);
      if (v !== null && v !== '') u.searchParams.set(k, v);
    }

    // enforce view
    if (view) u.searchParams.set('view', view);

    // cardboard flag (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö loader)
    if (cardboard) u.searchParams.set('cardboard', '1');
    else u.searchParams.delete('cardboard');

    // cache bust
    if (!u.searchParams.get('ts')) u.searchParams.set('ts', String(Date.now()));

    return u.toString();
  }

  function go(view, cardboard){
    saveLast(cardboard ? 'cardboard' : view);
    location.href = buildRunUrl(view, !!cardboard);
  }

  // UI fill
  const auto = detectAuto();
  const last = readLast();
  const explicitView = String(qs('view','')).toLowerCase();

  document.getElementById('autoMode').textContent = auto.text;
  document.getElementById('autoMode2').textContent = auto.text;
  document.getElementById('lastMode').textContent = last || '-';
  document.getElementById('runPath').textContent = '/herohealth/hydration-vr/hydration-vr.html';

  const run = String(qs('run', qs('runMode','play')) || 'play').toLowerCase();
  const diff = String(qs('diff','normal') || 'normal').toLowerCase();
  const time = String(qs('time', qs('durationPlannedSec','70')) || '70');

  document.getElementById('runMode').textContent = run;
  document.getElementById('diffMode').textContent = diff;
  document.getElementById('timeMode').textContent = time;

  // hub back
  document.getElementById('btnGoHub').addEventListener('click', ()=>{
    const hub = String(qs('hub','./hub.html'));
    location.href = hub;
  });

  // buttons
  document.getElementById('btnPC').addEventListener('click', ()=>go('pc', false));
  document.getElementById('btnMobile').addEventListener('click', ()=>go('mobile', false));
  document.getElementById('btnCardboard').addEventListener('click', ()=>go('cvr', true));

  // auto-run with cancel
  const cdEl = document.getElementById('cd');
  const autoRow = document.getElementById('autoRow');
  const btnCancel = document.getElementById('btnCancelAuto');

  let canceled = false;
  btnCancel.addEventListener('click', ()=>{
    canceled = true;
    autoRow.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Auto-run ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)';
    btnCancel.disabled = true;
    btnCancel.style.opacity = .55;
  });

  // If explicit view OR last mode exists => do not auto-run
  if (explicitView || last){
    autoRow.parentElement.remove();
  } else {
    let t = 2.0;
    const step = 0.1;
    const timer = setInterval(()=>{
      if (canceled){ clearInterval(timer); return; }
      t = Math.max(0, t - step);
      if (cdEl) cdEl.textContent = t.toFixed(1);
      if (t <= 0.001){
        clearInterval(timer);
        if (!canceled) go(auto.view, !!auto.cardboard);
      }
    }, Math.round(step*1000));
  }

})();
</script>
</body>
</html>