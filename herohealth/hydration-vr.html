<!-- === /herohealth/hydration-vr.html ===
Hydration VR Launcher ‚Äî PRODUCTION (Auto + Buttons + Cancel Auto-run)
- Auto-detect view (pc/mobile/cvr) + optional cardboard
- 3 big buttons: PC / Mobile / Cardboard
- Auto-run after 2.0s with Cancel
- Remember last choice (localStorage)
- Pass-through query params: hub, run, diff, time, seed, sessionId/studentKey, log, kids, etc.
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest (Launcher)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --cyan:#22d3ee;
      --warn:#f59e0b;
      --danger:#ef4444;
      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; }
    body{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
      overflow:hidden;
      background:
        radial-gradient(circle at 15% 10%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(circle at 85% 20%, rgba(34,197,94,.10), transparent 60%),
        radial-gradient(circle at 80% 88%, rgba(168,85,247,.08), transparent 55%),
        linear-gradient(180deg, #020617 0%, #01030a 100%);
    }

    .wrap{
      width:min(980px, 100%);
      display:grid;
      gap:14px;
    }

    .top{
      display:flex;
      gap:12px;
      align-items:stretch;
      flex-wrap:wrap;
    }

    .card{
      flex: 1 1 420px;
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 16px 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }

    .title{
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .badge{
      font-weight: 800;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: var(--pill);
      background: rgba(34,197,94,.14);
      border: 1px solid rgba(34,197,94,.22);
      color: rgba(229,231,235,.95);
      white-space:nowrap;
    }
    .muted{ color:var(--muted); font-weight:700; font-size: 13px; line-height: 1.35; }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 820px){
      .grid{ grid-template-columns: 1fr; }
      .card{ flex-basis: 100%; }
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.55);
      color: var(--text);
      border-radius: 18px;
      padding: 14px 14px;
      font-weight: 900;
      letter-spacing: .2px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-height: 58px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(34,211,238,.22); background: rgba(15,23,42,.72); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btn .left{
      display:flex; align-items:center; gap:10px;
    }
    .ico{
      width: 38px; height: 38px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(2,6,23,.55);
      border: 1px solid rgba(148,163,184,.18);
      font-size: 18px;
    }
    .bmain{ display:flex; flex-direction:column; gap:2px; }
    .bmain .h{ font-size: 15px; }
    .bmain .s{ font-size: 12px; color: var(--muted); font-weight: 700; }

    .tag{
      font-size: 12px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: var(--pill);
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.40);
      color: rgba(229,231,235,.92);
      white-space:nowrap;
    }
    .tag.ok{ border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.12); }
    .tag.warn{ border-color: rgba(245,158,11,.22); background: rgba(245,158,11,.10); }
    .tag.cyan{ border-color: rgba(34,211,238,.22); background: rgba(34,211,238,.10); }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px dashed rgba(148,163,184,.18);
      background: rgba(2,6,23,.38);
    }
    .mini{
      color: rgba(229,231,235,.92);
      font-weight: 800;
      font-size: 12.5px;
      line-height: 1.35;
    }
    .linkbtn{
      appearance:none;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.55);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .linkbtn:hover{ transform: translateY(-1px); background: rgba(15,23,42,.72); }
    .linkbtn:active{ transform: translateY(0px) scale(.99); }

    .foot{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      padding: 10px 2px 0;
    }
    .pill{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .pill .p{
      font-size: 12px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: var(--pill);
      border: 1px solid rgba(148,163,184,.16);
      background: rgba(2,6,23,.35);
      color: rgba(229,231,235,.92);
    }
    .p.kids{ border-color: rgba(34,197,94,.22); background: rgba(34,197,94,.10); }
    .p.research{ border-color: rgba(168,85,247,.22); background: rgba(168,85,247,.10); }
    .p.log{ border-color: rgba(34,211,238,.22); background: rgba(34,211,238,.10); }
    .p.miss{ border-color: rgba(245,158,11,.22); background: rgba(245,158,11,.10); }
    .small{ font-size: 12px; color: var(--muted); font-weight: 700; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="card">
        <div class="title">
          <div>Hydration Quest VR</div>
          <div class="badge" id="badgeMode">Auto</div>
        </div>
        <div class="muted" id="desc">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å PC / Mobile / Cardboard ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        </div>

        <div class="grid">
          <button class="btn" id="btnPC" type="button">
            <div class="left">
              <div class="ico">üñ•Ô∏è</div>
              <div class="bmain">
                <div class="h">‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô PC</div>
                <div class="s">‡πÄ‡∏°‡∏≤‡∏™‡πå/‡∏Ñ‡∏•‡∏¥‡∏Å ‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà</div>
              </div>
            </div>
            <div class="tag">view=pc</div>
          </button>

          <button class="btn" id="btnMobile" type="button">
            <div class="left">
              <div class="ico">üì±</div>
              <div class="bmain">
                <div class="h">‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô Mobile</div>
                <div class="s">‡πÅ‡∏ï‡∏∞/‡∏à‡∏¥‡πâ‡∏° ‚Ä¢ ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏ö‡∏≤‡∏¢</div>
              </div>
            </div>
            <div class="tag cyan">view=mobile</div>
          </button>

          <button class="btn" id="btnCB" type="button">
            <div class="left">
              <div class="ico">ü•Ω</div>
              <div class="bmain">
                <div class="h">Cardboard VR</div>
                <div class="s">crosshair ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ ‚Ä¢ split L/R</div>
              </div>
            </div>
            <div class="tag warn">cardboard=1</div>
          </button>
        </div>

        <div class="row" id="autoRowWrap">
          <div class="mini" id="autoRow" style="flex:1">
            ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <b id="cd">2.0</b>s ‚Üí <b id="autoMode2">-</b>
          </div>
          <button class="linkbtn" id="btnCancelAuto" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <div class="foot">
          <div class="pill" id="pillBar"></div>
          <button class="linkbtn" id="btnBackHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
        </div>
      </div>
    </div>

    <div class="small">
      ‡∏ó‡∏¥‡∏õ: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà <b>kids=1</b> ‚Ä¢ ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÉ‡∏™‡πà <b>run=research</b> (‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ deterministic ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
    </div>
  </div>

  <script>
    (function(){
      'use strict';

      const RUN_PATH = './hydration-vr/hydration-vr.html';
      const KEY_LAST = 'HHA_LAST_VIEW_hydration';

      const qs = (k, def=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? def; }catch(_){ return def; } };
      const setQS = (u, k, v)=>{ try{ if(v==null||v==='') u.searchParams.delete(k); else u.searchParams.set(k, v); }catch(_){ } };
      const isTrue = (v)=> String(v||'').toLowerCase()==='1' || String(v||'').toLowerCase()==='true';

      function detectAuto(){
        const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints|0) > 0;
        const w = Math.max(1, window.innerWidth||1);
        const h = Math.max(1, window.innerHeight||1);
        const landscape = w >= h;

        // heuristic
        if (!isTouch) return { view:'pc', cardboard:false, why:'desktop' };

        // If user likely holding landscape + wide enough => cvr
        if (landscape && w >= 740) return { view:'cvr', cardboard:false, why:'touch_landscape_wide' };

        return { view:'mobile', cardboard:false, why:'touch_mobile' };
      }

      function getLast(){
        try{ return localStorage.getItem(KEY_LAST) || ''; }catch(_){ return ''; }
      }
      function setLast(v){
        try{ localStorage.setItem(KEY_LAST, v); }catch(_){}
      }

      function passThrough(u){
        // carry these params if exist
        const keep = [
          'hub','run','runMode','diff','time','durationPlannedSec',
          'seed','ts','timestampIso','sessionId','studentKey','studyId','conditionGroup','sessionOrder','blockLabel',
          'log','projectTag','siteCode','schoolYear','semester',
          'kids'
        ];
        for (const k of keep){
          const v = qs(k,'');
          if (v !== '') setQS(u, k, v);
        }
      }

      function go(view, cardboard){
        const u = new URL(RUN_PATH, location.href);
        passThrough(u);

        // view + cardboard flag
        setQS(u, 'view', view || 'pc');
        if (cardboard) setQS(u, 'cardboard', '1');
        else u.searchParams.delete('cardboard');

        // ensure cache bust for safe quick testing
        if (!u.searchParams.get('ts')) u.searchParams.set('ts', String(Date.now()));

        // remember last
        setLast((cardboard ? 'cardboard' : (view||'pc')));

        location.href = u.toString();
      }

      // UI nodes
      const badgeMode = document.getElementById('badgeMode');
      const desc = document.getElementById('desc');
      const pillBar = document.getElementById('pillBar');

      const btnPC = document.getElementById('btnPC');
      const btnMobile = document.getElementById('btnMobile');
      const btnCB = document.getElementById('btnCB');

      const btnBackHub = document.getElementById('btnBackHub');

      const cdEl = document.getElementById('cd');
      const auto2 = document.getElementById('autoMode2');
      const autoRowWrap = document.getElementById('autoRowWrap');
      const autoRow = document.getElementById('autoRow');
      const btnCancel = document.getElementById('btnCancelAuto');

      // Params context
      const explicitView = String(qs('view','')).toLowerCase(); // if user opened launcher w/ view
      const kids = isTrue(qs('kids','0'));
      const run = String(qs('run', qs('runMode','play'))).toLowerCase();
      const log = String(qs('log','')||'').trim();

      // pills
      const pills = [];
      pills.push(`<span class="p">diff=${String(qs('diff','normal')||'normal')}</span>`);
      pills.push(`<span class="p miss">time=${String(qs('time', qs('durationPlannedSec','70'))||'70')}s</span>`);
      if (kids) pills.push(`<span class="p kids">kids=1</span>`);
      if (run === 'research') pills.push(`<span class="p research">research</span>`);
      if (log) pills.push(`<span class="p log">log=ON</span>`);
      pillBar.innerHTML = pills.join('');

      // hub
      btnBackHub.addEventListener('click', ()=>{
        const hub = String(qs('hub','./hub.html'));
        location.href = hub;
      });

      // resolve target mode
      const last = getLast();
      const auto = detectAuto();

      let chosen = null;

      // Priority:
      // 1) explicit view in URL (launcher) => respect but DO NOT auto-run
      // 2) last stored => respect and DO NOT auto-run
      // 3) auto-detect => show + auto-run with cancel
      if (explicitView){
        const v = (explicitView === 'cardboard') ? 'cvr' : explicitView;
        const cb = (explicitView === 'cardboard') || isTrue(qs('cardboard','0'));
        chosen = { view: v, cardboard: cb, why: 'explicit' };
      } else if (last){
        if (last === 'cardboard') chosen = { view: 'cvr', cardboard:true, why:'last' };
        else chosen = { view: last, cardboard:false, why:'last' };
      } else {
        chosen = { ...auto, why:'auto' };
      }

      const autoText =
        chosen.cardboard ? 'Cardboard VR' :
        (chosen.view==='pc' ? 'PC' : chosen.view==='cvr' ? 'cVR (Crosshair)' : 'Mobile');

      if (badgeMode){
        badgeMode.textContent = chosen.why === 'auto' ? 'Auto' : (chosen.why === 'last' ? 'Last' : 'Manual');
      }
      if (desc){
        desc.textContent =
          chosen.why === 'auto'
            ? '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ) ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢'
            : '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ)';
      }
      if (auto2) auto2.textContent = autoText;

      // buttons
      btnPC.addEventListener('click', ()=>go('pc', false));
      btnMobile.addEventListener('click', ()=>go('mobile', false));
      btnCB.addEventListener('click', ()=>go('cvr', true));

      // ---------- auto-enter with cancel ----------
      let canceled = false;
      btnCancel.addEventListener('click', ()=>{
        canceled = true;
        autoRow.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Auto-run ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)';
        btnCancel.disabled = true;
        btnCancel.style.opacity = .55;
      });

      // Auto-run only when: no explicit view AND no last
      if (!explicitView && !last){
        let t = 2.0;
        const step = 0.1;
        const timer = setInterval(()=>{
          if (canceled){ clearInterval(timer); return; }
          t = Math.max(0, t - step);
          if (cdEl) cdEl.textContent = t.toFixed(1);
          if (t <= 0.001){
            clearInterval(timer);
            if (!canceled) go(chosen.view, !!chosen.cardboard);
          }
        }, Math.round(step*1000));
      } else {
        // hide autorun strip
        try{ autoRowWrap.remove(); }catch(_){}
      }
    })();
  </script>
</body>
</html>