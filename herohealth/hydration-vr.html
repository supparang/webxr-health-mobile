<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.72);
      --panel2:rgba(15,23,42,.66);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#fb7185;
      --good:#34d399;
      --shadow: 0 18px 42px rgba(0,0,0,.50);
      --radius: 18px;
    }

    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",sans-serif;}
    *{ box-sizing:border-box; }

    /* ---- playfield ---- */
    #playfield{
      position:fixed;
      inset:0;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 30% 15%, rgba(34,197,94,.10), transparent 60%),
        radial-gradient(1000px 700px at 70% 20%, rgba(59,130,246,.10), transparent 60%),
        radial-gradient(900px 700px at 40% 80%, rgba(99,102,241,.06), transparent 60%),
        linear-gradient(180deg, rgba(2,6,23,1), rgba(2,6,23,.96));
      touch-action: manipulation;
      user-select:none;
      -webkit-user-select:none;
    }

    #hvr-layer{
      position:absolute;
      inset:0;
      pointer-events:none; /* targets ‡πÄ‡∏õ‡∏¥‡∏î pointer-events ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏ô mode-factory */
      z-index:20;
    }

    /* crosshair */
    #hvr-crosshair{
      position:fixed;
      left:50%; top:52%;
      transform:translate(-50%,-50%);
      width:22px; height:22px;
      border-radius:999px;
      opacity:.95;
      z-index:60;
      pointer-events:none;
      filter: drop-shadow(0 0 12px rgba(255,255,255,.10));
    }
    #hvr-crosshair:before{
      content:"";
      position:absolute; inset:0;
      border-radius:999px;
      border:2px solid rgba(255,255,255,.65);
      box-shadow: 0 0 0 6px rgba(34,197,94,.14);
    }
    #hvr-crosshair:after{
      content:"";
      position:absolute;
      left:50%; top:50%;
      width:5px; height:5px;
      transform:translate(-50%,-50%);
      border-radius:999px;
      background:rgba(255,255,255,.85);
    }

    /* ---- HUD layout ---- */
    #hud{
      position:fixed;
      inset:0;
      z-index:80;
      pointer-events:none;
      padding: max(10px, env(safe-area-inset-top)) 10px max(10px, env(safe-area-inset-bottom)) 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    #hha-water-header{
      pointer-events:none;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      opacity:.96;
    }
    .hha-water-bar{
      width:min(560px, 94vw);
      background:rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .hha-water-bar .row{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .hha-water-bar .sub{
      margin-top:6px;
      height:10px;
      border-radius:999px;
      background:rgba(148,163,184,.18);
      overflow:hidden;
    }
    .hha-water-bar .sub > i{
      display:block;
      height:100%;
      width:34%;
      background:linear-gradient(90deg, rgba(34,197,94,.95), rgba(34,197,94,.55));
      border-radius:999px;
    }

    .hha-main-row{
      pointer-events:none;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:start;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:12px 12px;
      min-height: 118px;
    }
    .card h3{
      margin:0 0 6px 0;
      font-size:12px;
      letter-spacing:.28em;
      text-transform:uppercase;
      color:rgba(148,163,184,.95);
    }
    .kv{ display:grid; grid-template-columns: 1fr auto; gap:6px 10px; font-weight:700; }
    .kv div{ font-size:13px; }
    .kv .muted{ color:var(--muted); font-weight:600; }

    /* Fever card (‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô exclude zone ‡∏î‡πâ‡∏ß‡∏¢) */
    .hha-fever-card{
      pointer-events:none;
      position:fixed;
      right:10px;
      bottom:calc(96px + env(safe-area-inset-bottom));
      width:min(220px, 46vw);
      background:rgba(2,6,23,.58);
      border:1px solid var(--stroke);
      border-radius: 16px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      z-index:90;
    }
    .hha-fever-card .row{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .hha-fever-card .bar{
      margin-top:8px;
      height:10px;
      border-radius:999px;
      background:rgba(148,163,184,.18);
      overflow:hidden;
    }
    .hha-fever-card .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(245,158,11,.95), rgba(244,63,94,.85));
      border-radius:999px;
      transition: width .18s ease;
    }

    .hha-bottom-row{
      pointer-events:none;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:auto;
    }
    #coach-card{
      min-height:84px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    #coach-face{
      width:56px; height:56px;
      border-radius:16px;
      background:rgba(148,163,184,.12);
      border:1px solid rgba(148,163,184,.18);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      font-size:28px;
    }
    #coach-text{
      font-weight:800;
      line-height:1.25;
    }
    #coach-sub{
      margin-top:2px;
      font-weight:600;
      color:rgba(148,163,184,.92);
      font-size:12px;
    }

    /* Controls */
    .controls{
      pointer-events:auto;
      display:flex;
      justify-content:center;
      gap:10px;
    }
    .btn{
      pointer-events:auto;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.62);
      color:var(--text);
      padding:12px 14px;
      border-radius:16px;
      font-weight:900;
      letter-spacing:.2px;
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      min-width:110px;
    }
    .btn:active{ transform: translateY(1px); }

    /* Start overlay */
    #start-overlay{
      position:fixed;
      inset:0;
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background:
        radial-gradient(1200px 900px at 50% 20%, rgba(34,197,94,.14), transparent 55%),
        linear-gradient(180deg, rgba(2,6,23,.92), rgba(2,6,23,.98));
      backdrop-filter: blur(8px);
    }
    .start-card{
      width:min(560px, 92vw);
      border-radius: 22px;
      border:1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.70);
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      padding:18px 16px;
    }
    .start-card h1{ margin:0 0 6px 0; font-size:20px; letter-spacing:.2px;}
    .start-card p{ margin:0 0 12px 0; color:rgba(148,163,184,.92); font-weight:650; line-height:1.35;}
    .start-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .btn-primary{
      border:1px solid rgba(34,197,94,.35);
      background: linear-gradient(180deg, rgba(34,197,94,.95), rgba(22,163,74,.92));
      color:#04110a;
    }
    .btn-ghost{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.46);
      color:rgba(229,231,235,.95);
    }

    /* Stamp */
    #hha-stamp{
      position:fixed;
      left:50%; top:50%;
      transform:translate(-50%,-50%) scale(.90) rotate(-8deg);
      z-index:9998;
      padding:14px 18px;
      border-radius:22px;
      background: rgba(2,6,23,.62);
      border: 2px solid rgba(229,231,235,.22);
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      display:none;
      pointer-events:none;
      text-align:center;
    }
    #hha-stamp .big{ font-weight:1000; font-size:26px; letter-spacing:.6px; }
    #hha-stamp .small{ margin-top:4px; font-weight:800; color:rgba(148,163,184,.95); }
    #hha-stamp.show{
      display:block;
      animation: stampPop .66s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes stampPop{
      0%{ opacity:0; transform:translate(-50%,-50%) scale(.72) rotate(-10deg); }
      50%{ opacity:1; transform:translate(-50%,-50%) scale(1.06) rotate(-7deg); }
      100%{ opacity:0; transform:translate(-50%,-58%) scale(.94) rotate(-7deg); }
    }

    /* End overlay placeholder */
    #hvr-end{
      position:fixed;
      inset:0;
      z-index:9997;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(2,6,23,.84);
      backdrop-filter: blur(10px);
    }
    #hvr-end .panel{
      width:min(620px, 94vw);
      border-radius: 22px;
      border:1px solid rgba(148,163,184,.22);
      background: rgba(2,6,23,.74);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding:16px 16px;
      color: var(--text);
    }
    #hvr-end .panel h2{ margin:0 0 10px 0; }
    #hvr-end .panel .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:8px 10px; font-weight:800; }
    #hvr-end .panel .grid div{ padding:10px 10px; border-radius:16px; border:1px solid rgba(148,163,184,.14); background: rgba(15,23,42,.46); }
    #hvr-end .panel .actions{ margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  </style>
</head>

<body>
  <div id="playfield" aria-label="Hydration Playfield">
    <div id="hvr-layer"></div>
    <div id="hvr-crosshair"></div>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div id="hha-water-header">
      <div class="hha-water-bar">
        <div class="row">
          <div style="display:flex; gap:10px; align-items:center;">
            <span style="font-size:18px;">üíß</span>
            <span>Water balance</span>
          </div>
          <div>
            <span id="water-zone" style="font-weight:1000;">LOW</span>
            <span style="opacity:.75;">&nbsp;</span>
            <span id="water-pct" style="font-weight:1000;">34%</span>
          </div>
        </div>
        <div class="sub"><i id="water-bar"></i></div>
      </div>
    </div>

    <div class="hha-main-row">
      <div class="card" id="hha-card-left">
        <h3>STATS</h3>
        <div class="kv">
          <div class="muted">SCORE</div><div id="stat-score">0</div>
          <div class="muted">COMBO</div><div id="stat-combo">0</div>
          <div class="muted">MAX</div><div id="stat-combo-max">0</div>
          <div class="muted">MISS</div><div id="stat-miss">0</div>
          <div class="muted">TIME</div><div id="stat-time">0</div>
          <div class="muted">GRADE</div><div id="stat-grade">C</div>
        </div>
      </div>

      <div class="card" id="hha-card-right">
        <h3>QUEST</h3>
        <div style="font-weight:900; margin-bottom:6px;">
          <span id="quest-title">Quest 1</span>
        </div>
        <div style="color:rgba(148,163,184,.95); font-weight:700; line-height:1.25;">
          <div id="quest-line1">Goal: ‡∏£‡∏±‡∏Å‡∏©‡∏≤ GREEN ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö üü¢</div>
          <div id="quest-line2" style="margin-top:4px;">‡∏™‡∏∞‡∏™‡∏° GREEN ‡∏£‡∏ß‡∏° 0/10</div>
          <div id="quest-line3" style="margin-top:8px; opacity:.9;">Goals done: 0 ¬∑ Minis done: 0</div>
          <div id="quest-line4" style="margin-top:6px; opacity:.85;">Progress to S (30%): 0%</div>
        </div>
      </div>
    </div>

    <div class="hha-fever-card">
      <div class="row">
        <div style="font-weight:1000;">üî• Fever</div>
        <div id="fever-pct" style="font-weight:1000;">0%</div>
      </div>
      <div class="bar"><i id="fever-bar"></i></div>
    </div>

    <div class="hha-bottom-row">
      <div class="card" id="coach-card">
        <div id="coach-face">ü•¶</div>
        <div>
          <div id="coach-text">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡∏î‡∏µ ‡πÜ ‡∏ô‡∏∞!</div>
          <div id="coach-sub">‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡πÅ‡∏ï‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á crosshair</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="btn-vr" type="button">VR</button>
        <button class="btn" id="btn-stop" type="button">STOP</button>
      </div>
    </div>
  </div>

  <!-- Stamp -->
  <div id="hha-stamp">
    <div class="big" id="stamp-big">GOAL!</div>
    <div class="small" id="stamp-small">+1</div>
  </div>

  <!-- End -->
  <div id="hvr-end">
    <div class="panel">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
      <div class="grid">
        <div>Score: <span id="end-score">0</span></div>
        <div>Grade: <span id="end-grade">C</span></div>
        <div>Combo Max: <span id="end-combo">0</span></div>
        <div>Miss: <span id="end-miss">0</span></div>
        <div>Goals: <span id="end-goals">0/0</span></div>
        <div>Minis: <span id="end-minis">0/0</span></div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" id="btn-retry" type="button">RETRY</button>
        <button class="btn btn-ghost" id="btn-backhub" type="button">BACK HUB</button>
      </div>
    </div>
  </div>

  <!-- Start overlay -->
  <div id="start-overlay">
    <div class="start-card">
      <h1>üíß Hydration Quest</h1>
      <p>‡πÄ‡∏Å‡πá‡∏ö ‚Äú‡∏ô‡πâ‡∏≥‡∏î‡∏µ‚Äù ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏• ‡∏£‡∏∞‡∏ß‡∏±‡∏á ‚Äú‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏´‡∏ß‡∏≤‡∏ô‚Äù ‚Äî ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ö‡∏ö VR-feel ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/VR</p>

      <div class="start-actions">
        <button class="btn btn-primary" id="btn-start" type="button">START</button>
        <button class="btn btn-ghost" id="btn-motion" type="button" style="display:none;">Allow Motion</button>
      </div>

      <p style="margin-top:12px; font-size:12px; opacity:.88;">
        Tip: ‡∏¢‡∏¥‡∏á crosshair ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ ‚Äú‡πÅ‡∏ï‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‚Äù (‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏°‡∏≤‡∏Å‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
      </p>
    </div>
  </div>

  <!-- ===== Panic error box (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) ===== -->
  <script>
  (function(){
    const box = document.createElement('pre');
    box.id = 'hha-panic';
    box.style.cssText = [
      'position:fixed','left:10px','right:10px','top:10px','z-index:999999',
      'background:rgba(0,0,0,.75)','color:#fff','padding:10px 12px',
      'border:1px solid rgba(255,255,255,.18)','border-radius:12px',
      'font:12px/1.35 ui-monospace,monospace','white-space:pre-wrap',
      'display:none','max-height:40vh','overflow:auto'
    ].join(';');
    document.addEventListener('DOMContentLoaded', ()=> document.body.appendChild(box));
    function show(msg){
      try{ box.style.display='block'; box.textContent='[HHA ERROR]\\n'+msg; }catch{}
    }
    window.addEventListener('error', (e)=> show((e && e.message) ? (e.message + '\\n' + (e.filename||'') + ':' + (e.lineno||'') + ':' + (e.colno||'')) : String(e)));
    window.addEventListener('unhandledrejection', (e)=> show(e && e.reason ? (e.reason.stack || e.reason.message || String(e.reason)) : 'unhandledrejection'));
  })();
  </script>

  <!-- ===== IIFE / non-module (defer) ===== -->
  <script src="./vr/particles.js" defer></script>
  <script src="./vr/hha-cloud-logger.js" defer></script>
  <script src="./vr/hha-hud.js" defer></script>
  <script src="./vr/hha-hud-quest.js" defer></script>
  <script src="./vr/ui-fever.js" defer></script>
  <script src="./vr/hha-vrlook.js" defer></script>
  <script src="./vr/hha-compat-input.js" defer></script>

  <!-- ===== module deps ===== -->
  <script type="module" src="./vr/ui-water.js"></script>
  <script type="module" src="./vr/mode-factory.js"></script>

  <!-- ‚úÖ MAIN (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô module ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
  <script type="module" src="./hydration-vr/hydration.safe.js"></script>
</body>
</html>