<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>Hydration VR ‚Äî Hero Health</title>
  <meta name="color-scheme" content="dark"/>

  <link rel="icon" href="./favicon.ico"/>

  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á + HUD ‡∏´‡∏•‡∏±‡∏Å -->
  <link rel="stylesheet" href="./css/goodjunk-vr.css"/>
  <!-- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ hydration-vr.css ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏π‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
  <link rel="stylesheet" href="./css/hydration-vr.css"/>
</head>
<body>

  <!-- ===== SCENE WRAP / LOADING ===== -->
  <div class="hha-scene-wrap">
    <div class="hha-loading-msg">
      üíß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏´‡∏°‡∏î Hydration VR...
    </div>
  </div>

  <!-- crosshair ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ -->
  <div class="hha-crosshair"></div>

  <!-- ‡∏õ‡∏∏‡πà‡∏° VR ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô (‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô GoodJunk) -->
  <button class="hha-vr-btn" id="hha-vr-btn">VR</button>

  <!-- ===== COACH BUBBLE ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠ ===== -->
  <!-- (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á DOM ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ coach-bubble.js) -->

  <!-- ===== SCRIPT ZONE ===== -->

  <!-- HUD ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå / ‡∏™‡∏Å‡∏≠‡∏£‡πå ‡∏Ø‡∏•‡∏Ø (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Good vs Junk VR) -->
  <script type="module" src="./vr/quest-hud-vr.js"></script>

  <!-- ‡πÇ‡∏Ñ‡πâ‡∏ä‡∏Å‡∏•‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á + auto-move + fade + bounce mission -->
  <script type="module" src="./vr/coach-bubble.js"></script>

  <!-- ‡πÇ‡∏´‡∏°‡∏î Hydration VR -->
  <script type="module">
    import { boot as bootHydration } from './hydration-vr/hydration.safe.js';

    // ‡∏≠‡πà‡∏≤‡∏ô URL param: ?diff=easy|normal|hard&time=60
    const url = new URL(window.location.href);
    let diff = (url.searchParams.get('diff') || 'normal').toLowerCase();
    if (!['easy','normal','hard'].includes(diff)) diff = 'normal';

    let dur = parseInt(url.searchParams.get('time'), 10);
    if (Number.isNaN(dur) || dur <= 0) dur = 60;
    if (dur < 20)  dur = 20;
    if (dur > 180) dur = 180;

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration (engine ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤, HUD, ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå ‡∏Ø‡∏•‡∏Ø ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á)
    bootHydration({
      difficulty: diff,
      duration:   dur
    }).then(inst => {
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î
      const wrap = document.querySelector('.hha-scene-wrap');
      if (wrap) wrap.style.display = 'none';

      // ‡∏Å‡∏±‡∏ô memory leak ‡∏ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
      window.addEventListener('beforeunload', () => {
        try {
          if (inst && typeof inst.destroy === 'function') {
            inst.destroy();
          }
        } catch (e) {
          console.warn('[HydrationVR] destroy error on unload', e);
        }
      });
    }).catch(err => {
      console.error('[HydrationVR] boot error', err);
      const msg = document.querySelector('.hha-loading-msg');
      if (msg) {
        msg.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration';
      }
    });
  </script>
</body>
</html>
