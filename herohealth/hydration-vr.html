<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Hero Health ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="light dark"/>

  <!-- A-Frame core ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏â‡∏≤‡∏Å VR ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ PC/Mobile/VR Headset) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    :root{
      color-scheme: light dark;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui,Segoe UI,Inter,Roboto,sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.22), transparent 55%),
        radial-gradient(circle at bottom right, rgba(52,211,153,0.26), transparent 55%),
        #020617;
      color:#e5e7eb;
    }
    .page{
      max-width:1040px;
      margin:16px auto 28px;
      padding:0 16px 32px;
    }
    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:14px;
    }
    .title-block h1{
      margin:0 0 4px;
      font-size:1.4rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .title-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(56,189,248,0.8);
      font-size:.72rem;
      color:#e0f2fe;
    }
    .title-block p{
      margin:4px 0 0;
      font-size:.8rem;
      opacity:.9;
    }

    .layout{
      display:grid;
      grid-template-columns:minmax(0,1.7fr) minmax(0,1.1fr);
      gap:16px;
    }
    @media (max-width:900px){
      .layout{
        grid-template-columns:minmax(0,1fr);
      }
    }

    /* VR shell + A-Frame scene */
    .vr-shell{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,0.9);
      box-shadow:0 22px 60px rgba(15,23,42,0.95);
      background:#020817;
      min-height:320px;
    }
    .vr-shell a-scene{
      width:100%;
      height:100%;
    }

    /* Panel ‡∏Ç‡∏ß‡∏≤: config + quest */
    .side-panel{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card{
      border-radius:16px;
      padding:10px 11px;
      background:rgba(15,23,42,0.94);
      border:1px solid rgba(30,64,175,0.7);
      box-shadow:0 16px 40px rgba(15,23,42,0.95);
    }
    .card h2{
      margin:0 0 6px;
      font-size:.9rem;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card p{
      margin:0 0 8px;
      font-size:.8rem;
      opacity:.9;
    }

    .config-grid{
      display:grid;
      grid-template-columns:minmax(0,1fr);
      gap:8px;
      font-size:.8rem;
    }
    .field label{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:2px;
    }
    .field small{
      opacity:.7;
      margin-left:4px;
    }
    select, input[type="range"]{
      width:100%;
      font:inherit;
    }
    select{
      background:#020617;
      color:#e5e7eb;
      border-radius:999px;
      border:1px solid rgba(51,65,85,0.9);
      padding:4px 9px;
      outline:none;
    }
    input[type="range"]{
      accent-color:#22c55e;
    }

    .btn-row{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .btn{
      border-radius:999px;
      border:1px solid transparent;
      padding:6px 12px;
      font-size:.82rem;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:linear-gradient(135deg,#22c55e,#4ade80);
      color:#022c22;
      box-shadow:0 12px 28px rgba(22,163,74,0.65);
    }
    .btn.secondary{
      background:transparent;
      border-color:rgba(148,163,184,0.7);
      color:#e5e7eb;
      box-shadow:none;
    }
    .btn[disabled]{
      opacity:.5;
      cursor:default;
      box-shadow:none;
    }

    .hint{
      margin-top:4px;
      font-size:.72rem;
      opacity:.8;
    }

    /* Quest panel */
    .quest-main{
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size:.8rem;
    }
    .quest-item{
      padding:6px 8px;
      border-radius:12px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(56,189,248,0.55);
    }
    .quest-item.mini{
      border-color:rgba(132,204,22,0.7);
    }
    .quest-item h3{
      margin:0 0 4px;
      font-size:.8rem;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .quest-bar{
      position:relative;
      width:100%;
      height:6px;
      border-radius:999px;
      background:#020617;
      overflow:hidden;
    }
    .quest-bar-inner{
      position:absolute;
      inset:0;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#38bdf8,#22c55e);
      transition:width .2s ease-out;
    }
    .quest-meta{
      margin-top:3px;
      display:flex;
      justify-content:space-between;
      font-size:.7rem;
      opacity:.85;
    }
    .quest-hint{
      margin-top:4px;
      font-size:.72rem;
      opacity:.85;
    }

    /* Overlay loading + result */
    .overlay-center{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      z-index:8;
    }
    .overlay-pill{
      padding:8px 14px;
      border-radius:999px;
      background:rgba(15,23,42,0.92);
      border:1px solid rgba(56,189,248,0.85);
      font-size:.8rem;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 16px 40px rgba(15,23,42,0.96);
    }
    .dot{
      width:6px;
      height:6px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 8px rgba(34,197,94,0.9);
    }

    .result-card{
      border-radius:16px;
      padding:8px 11px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(56,189,248,0.8);
      box-shadow:0 18px 46px rgba(15,23,42,0.97);
      font-size:.8rem;
    }
    .result-grid{
      display:grid;
      grid-template-columns:minmax(0,1fr) minmax(0,1fr);
      gap:6px 16px;
      margin-top:4px;
    }
    .result-grid div{
      display:flex;
      justify-content:space-between;
      gap:6px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 6px;
      border-radius:999px;
      font-size:.7rem;
      border:1px solid rgba(74,222,128,0.75);
      background:rgba(21,128,61,0.35);
    }

    /* === MODE SELECT OVERLAY === */
    .mode-overlay{
      position:fixed;
      inset:0;
      z-index:40;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.25), transparent 55%),
        rgba(15,23,42,0.96);
    }
    .mode-card{
      max-width:420px;
      width:100%;
      padding:16px 16px 14px;
      border-radius:22px;
      background:rgba(15,23,42,0.98);
      border:1px solid rgba(56,189,248,0.9);
      box-shadow:0 26px 80px rgba(15,23,42,0.98);
    }
    .mode-card-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      margin-bottom:10px;
    }
    .mode-card-head h2{
      margin:0;
      font-size:1rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .mode-card-head p{
      margin:2px 0 0;
      font-size:.78rem;
      opacity:.85;
    }
    .mode-close{
      border:none;
      background:transparent;
      color:#9ca3af;
      cursor:pointer;
      font-size:1rem;
      padding:2px 4px;
      border-radius:999px;
    }
    .mode-close:hover{
      background:rgba(31,41,55,0.9);
    }

    .mode-options{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:8px;
      margin-bottom:8px;
    }
    .mode-btn{
      border-radius:16px;
      padding:8px 6px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      cursor:pointer;
      font-size:.78rem;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      text-align:center;
    }
    .mode-btn span.big{
      font-size:1.1rem;
      font-weight:600;
    }
    .mode-btn span.sub{
      font-size:.7rem;
      opacity:.85;
    }
    .mode-btn[data-active="1"]{
      border-color:rgba(52,211,153,1);
      box-shadow:0 0 16px rgba(34,197,94,0.7);
      background:radial-gradient(circle at top,rgba(52,211,153,0.35),rgba(15,23,42,0.97));
    }

    .mode-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-top:4px;
      font-size:.75rem;
      opacity:.9;
    }
    .mode-footer .btn-main{
      border-radius:999px;
      padding:6px 12px;
      border:none;
      cursor:pointer;
      font-size:.82rem;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:linear-gradient(135deg,#22c55e,#4ade80);
      color:#022c22;
      box-shadow:0 16px 36px rgba(22,163,74,0.8);
    }
    @media (max-width:640px){
      .mode-card{
        margin:0 12px;
      }
      .mode-options{
        grid-template-columns:1fr;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="title-block">
      <h1>
        <span>üíß Hydration VR</span>
        <span class="title-pill">
          <span>Hero Health</span>
          <span>VR Nutrition ‚Äì ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡πâ‡∏≥‡∏™‡∏°‡∏î‡∏∏‡∏•</span>
        </span>
      </h1>
      <p>
        ‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å &quot;‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•&quot; ‡πÉ‡∏ä‡πâ emoji ‡πÄ‡∏õ‡πâ‡∏≤ + ‡πÄ‡∏Å‡∏à‡∏ô‡πâ‡∏≥ + Fever + Mission/Quest
        ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô PC, Mobile, ‡πÅ‡∏•‡∏∞ VR Headset (‡∏ú‡πà‡∏≤‡∏ô WebXR).
      </p>
    </div>
  </header>

  <!-- ===== MODE SELECT OVERLAY (‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å) ===== -->
  <div id="mode-overlay" class="mode-overlay">
    <div class="mode-card">
      <div class="mode-card-head">
        <div>
          <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î Hydration</h2>
          <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ô‡πÅ‡∏ú‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡πÑ‡∏î‡πâ</p>
        </div>
        <button id="mode-close" class="mode-close" title="‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î">
          ‚úï
        </button>
      </div>

      <div class="mode-options">
        <button class="mode-btn" id="mode-easy" data-diff="easy">
          <span>üòä</span>
          <span class="big">‡∏á‡πà‡∏≤‡∏¢</span>
          <span class="sub">‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏ä‡πâ‡∏≤ ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏î ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
        </button>
        <button class="mode-btn" id="mode-normal" data-diff="normal" data-active="1">
          <span>üí™</span>
          <span class="big">‡∏õ‡∏Å‡∏ï‡∏¥</span>
          <span class="sub">‡∏ö‡∏≤‡∏•‡∏≤‡∏ô‡∏ã‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</span>
        </button>
        <button class="mode-btn" id="mode-hard" data-diff="hard">
          <span>üî•</span>
          <span class="big">‡∏¢‡∏≤‡∏Å</span>
          <span class="sub">‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡πÄ‡∏£‡πá‡∏ß ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå‡πÄ‡∏Ç‡πâ‡∏° ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏™‡∏≤‡∏¢‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</span>
        </button>
      </div>

      <div class="mode-footer">
        <div>
          ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏ú‡∏á <strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</strong> ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥<br/>
          (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà <strong>‡∏õ‡∏Å‡∏ï‡∏¥</strong> ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
        </div>
        <button id="mode-start" class="btn-main">
          <span>‚ñ∂</span><span>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
        </button>
      </div>
    </div>
  </div>

  <main class="layout">
    <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏â‡∏≤‡∏Å VR + overlay ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ -->
    <section class="vr-shell">
      <!-- A-Frame scene ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (VR/360¬∞) -->
      <a-scene
        embedded
        vr-mode-ui="enabled: true"
        renderer="antialias: true"
      >
        <a-sky color="#020617"></a-sky>

        <!-- ‡πÅ‡∏™‡∏á‡∏≠‡πà‡∏≠‡∏ô ‡πÜ -->
        <a-entity light="type:ambient;intensity:0.65;color:#e5e7eb"></a-entity>
        <a-entity light="type:directional;intensity:0.7;color:#bfdbfe" position="1 1 0.5"></a-entity>

        <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
        <a-entity
          id="camRig"
          position="0 1.6 0"
          camera
          look-controls
          wasd-controls="acceleration:2"
        ></a-entity>
      </a-scene>

      <!-- overlay ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠: loading + result -->
      <div class="overlay-center">
        <div id="hydration-status" class="overlay-pill">
          <span class="dot" id="hydration-dot"></span>
          <span id="hydration-status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÇ‡∏´‡∏°‡∏î Hydration...</span>
        </div>
      </div>
    </section>

    <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô + Quest + ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <aside class="side-panel">
      <section class="card">
        <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
        <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î <strong>Start Hydration</strong> ‚Äî ‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡∏à‡∏∞‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏µ‡πÄ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥.</p>

        <div class="config-grid">
          <div class="field">
            <label>
              <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</span>
              <small id="diff-label">normal</small>
            </label>
            <select id="diff-select">
              <option value="easy">‡∏á‡πà‡∏≤‡∏¢ (‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å)</option>
              <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥</option>
              <option value="hard">‡∏¢‡∏≤‡∏Å (‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢)</option>
            </select>
          </div>

          <div class="field">
            <label>
              <span>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</span>
              <small><span id="dur-label">60</span>s</small>
            </label>
            <input id="dur-range" type="range" min="30" max="120" step="10" value="60"/>
          </div>
        </div>

        <div class="btn-row">
          <button id="btn-start" class="btn">
            <span>‚ñ∂</span> <span>Start Hydration</span>
          </button>
          <button id="btn-stop" class="btn secondary" disabled>
            <span>‚èπ</span> <span>Stop</span>
          </button>
        </div>
        <div class="hint">
          ‚Ä¢ PC: ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πâ‡∏≤<br/>
          ‚Ä¢ Mobile: ‡πÉ‡∏ä‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤ (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô/‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ)<br/>
          ‚Ä¢ VR Headset: ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô browser ‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° VR ‡∏Ç‡∏≠‡∏á A-Frame.
        </div>
      </section>

      <section class="card">
        <h2>üéØ Mission & Mini Quest</h2>
        <div class="quest-main" id="quest-panel">
          <div class="quest-item">
            <h3>
              <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå</span>
              <span>‚Äì</span>
            </h3>
            <div class="quest-bar">
              <div class="quest-bar-inner" style="width:0%"></div>
            </div>
            <div class="quest-meta">
              <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‚Äì</span>
              <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: 0/0</span>
            </div>
            <div class="quest-hint">
              ‡∏Å‡∏î Start ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration.
            </div>
          </div>
        </div>
      </section>

      <section class="card" id="result-wrap" style="display:none;">
        <div class="result-card" id="result-card">
          <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏ú‡πà‡∏≤‡∏ô JS -->
        </div>
      </section>
    </aside>
  </main>
</div>

<script type="module">
  import hydrationMode from './hydration.safe.js';

  const diffSel   = document.getElementById('diff-select');
  const diffLabel = document.getElementById('diff-label');
  const durRange  = document.getElementById('dur-range');
  const durLabel  = document.getElementById('dur-label');

  const btnStart  = document.getElementById('btn-start');
  const btnStop   = document.getElementById('btn-stop');

  const statusBox = document.getElementById('hydration-status');
  const statusDot = document.getElementById('hydration-dot');
  const statusTxt = document.getElementById('hydration-status-text');

  const questPanel = document.getElementById('quest-panel');
  const resultWrap = document.getElementById('result-wrap');
  const resultCard = document.getElementById('result-card');

  // Mode overlay
  const modeOverlay = document.getElementById('mode-overlay');
  const modeClose   = document.getElementById('mode-close');
  const modeStart   = document.getElementById('mode-start');
  const modeBtns    = document.querySelectorAll('.mode-btn');

  let selectedDiff = 'normal';

  let currentInst = null;
  let playing = false;

  function setStatus(text, mode='idle'){
    statusTxt.textContent = text;
    if (mode === 'playing'){
      statusBox.style.borderColor = 'rgba(34,197,94,0.9)';
      statusDot.style.background = '#22c55e';
      statusDot.style.boxShadow = '0 0 12px rgba(34,197,94,0.9)';
    }else if(mode === 'done'){
      statusBox.style.borderColor = 'rgba(56,189,248,0.9)';
      statusDot.style.background = '#38bdf8';
      statusDot.style.boxShadow = '0 0 12px rgba(56,189,248,0.9)';
    }else{
      statusBox.style.borderColor = 'rgba(56,189,248,0.8)';
      statusDot.style.background = '#22c55e';
      statusDot.style.boxShadow = '0 0 8px rgba(34,197,94,0.9)';
    }
  }

  // sync label
  diffSel.addEventListener('change', ()=>{
    diffLabel.textContent = diffSel.value;
  });
  durRange.addEventListener('input', ()=>{
    durLabel.textContent = durRange.value;
  });

  async function startGame(){
    if (playing) return;
    playing = true;
    resultWrap.style.display = 'none';
    resultCard.innerHTML = '';

    btnStart.disabled = true;
    btnStop.disabled  = false;
    setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Hydration mode...', 'playing');

    const diff = diffSel.value;
    const dur  = parseInt(durRange.value, 10) || 60;

    // stop inst ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    try{
      if (currentInst && typeof currentInst.stop === 'function'){
        currentInst.stop();
      }
    }catch(e){ console.warn(e); }

    try{
      currentInst = await hydrationMode.boot({
        difficulty: diff,
        duration: dur
      });
      setStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô Hydration (${diff}) ‚Äì ‡∏ï‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏ô‡πâ‡∏≥‡∏î‡∏µ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô!`, 'playing');
    }catch(err){
      console.error('Hydration boot error', err);
      setStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration', 'idle');
      playing = false;
      btnStart.disabled = false;
      btnStop.disabled  = true;
    }
  }

  function stopGame(){
    if (!playing) return;
    playing = false;
    try{
      if (currentInst && typeof currentInst.stop === 'function'){
        currentInst.stop();
      }
    }catch(e){ console.warn(e); }
    setStatus('‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏´‡∏°‡∏î Hydration ‡πÅ‡∏•‡πâ‡∏ß', 'idle');
    btnStart.disabled = false;
    btnStop.disabled  = true;
  }

  btnStart.addEventListener('click', startGame);
  btnStop.addEventListener('click', stopGame);

  // ===== Mode overlay logic =====
  function updateModeButtons(activeDiff){
    selectedDiff = activeDiff;
    modeBtns.forEach(btn=>{
      const d = btn.getAttribute('data-diff');
      btn.dataset.active = (d === activeDiff) ? '1' : '0';
    });
  }

  modeBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const d = btn.getAttribute('data-diff') || 'normal';
      updateModeButtons(d);

      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á panel ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤
      diffSel.value = d;
      diffLabel.textContent = d;

      // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏¥‡∏î ‡πÜ ‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≤‡∏á)
      if (d === 'easy')      durRange.value = 60;
      else if (d === 'normal') durRange.value = 60;
      else if (d === 'hard') durRange.value = 70;
      durLabel.textContent = durRange.value;
    });
  });

  modeClose.addEventListener('click', ()=>{
    modeOverlay.style.display = 'none';
    setStatus('‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏° Hydration ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Start');
  });

  modeStart.addEventListener('click', ()=>{
    // ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ panel ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢
    diffSel.value = selectedDiff;
    diffLabel.textContent = selectedDiff;
    modeOverlay.style.display = 'none';
    startGame();
  });

  // default active = normal
  updateModeButtons('normal');

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ú‡∏á Quest ‡∏à‡∏≤‡∏Å event quest:update
  window.addEventListener('quest:update', (e)=>{
    const d = e.detail || {};
    const goal = d.goal || null;
    const mini = d.mini || null;
    const goalsAll = d.goalsAll || [];
    const minisAll = d.minisAll || [];
    const hint  = d.hint || '';

    function renderItem(label, obj, isMini){
      if (!obj){
        return `
        <div class="quest-item ${isMini ? 'mini':''}">
          <h3><span>${label}</span><span>‚Äì</span></h3>
          <div class="quest-bar"><div class="quest-bar-inner" style="width:0%"></div></div>
          <div class="quest-meta">
            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‚Äì</span>
            <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: 0/0</span>
          </div>
        </div>`;
      }
      const target   = obj.target || 0;
      const progress = obj.progress || 0;
      const done     = obj.done;
      const pct      = target > 0 ? Math.min(100, (progress/target)*100) : 0;
      const flag     = done ? '‚úì' : `${Math.round(pct)}%`;
      return `
        <div class="quest-item ${isMini ? 'mini':''}">
          <h3>
            <span>${label}</span>
            <span>${flag}</span>
          </h3>
          <div class="quest-bar">
            <div class="quest-bar-inner" style="width:${pct}%;"></div>
          </div>
          <div class="quest-meta">
            <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${obj.label}</span>
            <span>${progress}/${target}</span>
          </div>
        </div>`;
    }

    questPanel.innerHTML = `
      ${renderItem('‚≠ê Goal', goal, false)}
      ${renderItem('üéØ Mini quest', mini, true)}
      <div class="quest-hint">
        ${hint ? ('üí¨ ' + hint) : ''}
      </div>
      <div class="quest-hint" style="margin-top:2px;opacity:.7;">
        Goals ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${goalsAll.length} | Minis: ${minisAll.length}
      </div>
    `;
  });

  // ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å Hydration (hha:end)
  window.addEventListener('hha:end', (e)=>{
    const d = e.detail || {};
    if (d.mode !== 'Hydration') return;

    playing = false;
    btnStart.disabled = false;
    btnStop.disabled  = true;
    setStatus('‡∏à‡∏ö‡πÇ‡∏´‡∏°‡∏î Hydration ‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏π‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤', 'done');

    const {
      score = 0,
      misses = 0,
      comboMax = 0,
      duration = 0,
      goalCleared = false,
      goalsCleared = 0,
      goalsTotal = 0,
      questsCleared = 0,
      questsTotal = 0,
      greenTick = 0,
      waterStart = 50,
      waterEnd = 50,
      waterZoneEnd = 'GREEN',
      difficulty = 'normal'
    } = d;

    const badge = goalCleared
      ? `<span class="badge">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô Goals ‡∏´‡∏•‡∏±‡∏Å</span>`
      : `<span class="badge" style="border-color:rgba(248,113,113,0.8);background:rgba(127,29,29,0.45);">üß™ ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>`;

    resultCard.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
        <div>
          <div style="font-size:.78rem;opacity:.8;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÇ‡∏´‡∏°‡∏î Hydration</div>
          <div style="font-size:.9rem;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <strong>${score}</strong></div>
        </div>
        ${badge}
      </div>
      <div class="result-grid">
        <div><span>‡πÇ‡∏´‡∏°‡∏î</span><span>${difficulty}</span></div>
        <div><span>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô</span><span>${duration}s</span></div>
        <div><span>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span><span>${comboMax}</span></div>
        <div><span>‡∏û‡∏•‡∏≤‡∏î (Bad)</span><span>${misses}</span></div>
        <div><span>Goals ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span><span>${goalsCleared}/${goalsTotal}</span></div>
        <div><span>Mini quests</span><span>${questsCleared}/${questsTotal}</span></div>
        <div><span>‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô GREEN</span><span>${greenTick}s</span></div>
        <div><span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span><span>${waterStart}%</span></div>
        <div><span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</span><span>${waterEnd}%</span></div>
        <div><span>‡πÇ‡∏ã‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</span><span>${waterZoneEnd}</span></div>
      </div>
    `;
    resultWrap.style.display = 'block';
  });

  // initial label
  diffLabel.textContent = diffSel.value;
  durLabel.textContent = durRange.value;
  setStatus('‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏° Hydration ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Start');
</script>
</body>
</html>