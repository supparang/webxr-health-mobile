<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth â€” HydrationVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />
</head>
<body>
<script>
(() => {
  'use strict';

  const RUN_URL  = './hydration-vr/hydration-vr.html';
  const HUB_URL  = './hub.html';
  const GATE_URL = './warmup-gate.html';

  function qs(){ try{ return new URL(location.href).searchParams; }catch(_){ return new URLSearchParams(); } }
  const QS = qs();
  const q = (k, def='') => (QS.get(k) ?? def);

  if(q('wg','') === '1'){
    const deny = new Set(['wg']);
    const u = new URL(RUN_URL, location.href);
    QS.forEach((v,k)=>{ if(!deny.has(k)) u.searchParams.set(k,v); });
    location.replace(u.toString());
    return;
  }

  const gate = new URL(GATE_URL, location.href);
  gate.searchParams.set('phase', 'warmup');
  gate.searchParams.set('game', 'hydration');
  gate.searchParams.set('dur', String(Math.max(5, Math.min(60, Number(q('dur','20')||20)))));
  gate.searchParams.set('hub', new URL(HUB_URL, location.href).toString());

  const next = new URL(RUN_URL, location.href);
  const deny2 = new Set(['phase','game','dur','cdur','next','hub','wg']);
  QS.forEach((v,k)=>{ if(!deny2.has(k)) next.searchParams.set(k, v); });
  gate.searchParams.set('next', next.toString());

  location.replace(gate.toString());
})();
</script>
</body>
</html>
