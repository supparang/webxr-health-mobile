<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- A-Frame (optional; helps VR button feel/compat) -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Global FX + Cloud Logger (IIFE) -->
  <script src="../vr/particles.js" defer></script>
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --good:#22c55e;
      --bad:#fb7185;
      --accent:#38bdf8;
      --warn:#f59e0b;

      --safeTop: env(safe-area-inset-top);
      --safeBottom: env(safe-area-inset-bottom);
      --safeLeft: env(safe-area-inset-left);
      --safeRight: env(safe-area-inset-right);

      --shake: 0px;
      --edgeGlow: 0;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:radial-gradient(1200px 900px at 50% 20%, rgba(56,189,248,.10), transparent 60%), var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif; }
    body{ overflow:hidden; }

    /* layout */
    .app{
      position:fixed; inset:0;
      display:flex; flex-direction:column;
      padding: calc(10px + var(--safeTop)) calc(10px + var(--safeRight)) calc(10px + var(--safeBottom)) calc(10px + var(--safeLeft));
      gap:10px;
      transform: translate3d(calc(var(--shake)),0,0);
    }

    .topRow{ display:flex; gap:10px; align-items:stretch; }
    .card{
      background: linear-gradient(180deg, rgba(15,23,42,.80), rgba(2,6,23,.78));
      border:1px solid var(--stroke);
      border-radius:16px;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .card .hd{
      padding:10px 12px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(148,163,184,.12);
      background: rgba(2,6,23,.35);
    }
    .card .bd{ padding:10px 12px; }

    /* left / right HUD */
    #hha-card-left{ width: 42%; min-width: 250px; }
    #hha-card-right{ flex:1; min-width: 260px; }

    .kv{ display:grid; grid-template-columns: 1fr auto; gap:6px 10px; font-size:13px; color:var(--muted); }
    .kv b{ color:var(--text); font-weight:800; letter-spacing:.2px; }
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.35);
      font-size:12px; color:var(--muted);
      white-space:nowrap;
    }
    .big{
      font-size:22px; font-weight:900; letter-spacing:.2px; color:var(--text);
    }
    .muted{ color:var(--muted); }

    /* water header (auto-excluded by mode-factory) */
    #hha-water-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(2,6,23,.55);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .waterLeft{ display:flex; align-items:center; gap:10px; }
    .waterTitle{ font-weight:900; letter-spacing:.2px; }
    .waterZone{ font-size:12px; color:var(--muted); }

    .barWrap{
      position:relative;
      width: 44vw; max-width: 520px; min-width: 220px;
      height: 12px; border-radius:999px;
      background: rgba(148,163,184,.10);
      border:1px solid rgba(148,163,184,.14);
      overflow:hidden;
    }
    .barFill{
      position:absolute; left:0; top:0; bottom:0;
      width: 50%;
      background: linear-gradient(90deg, rgba(34,197,94,.85), rgba(56,189,248,.75));
      box-shadow: 0 0 16px rgba(56,189,248,.22);
    }
    .barMark{
      position:absolute; top:-4px; bottom:-4px; width:2px;
      background: rgba(245,158,11,.65);
      box-shadow: 0 0 12px rgba(245,158,11,.25);
    }

    /* playfield */
    #playfield{
      position:relative;
      flex:1;
      border-radius:22px;
      border:1px solid rgba(148,163,184,.14);
      overflow:hidden;
      background:
        radial-gradient(900px 680px at 50% 40%, rgba(2,6,23,.00), rgba(2,6,23,.55)),
        radial-gradient(1100px 850px at 50% 20%, rgba(56,189,248,.10), transparent 55%),
        radial-gradient(900px 700px at 18% 72%, rgba(34,197,94,.10), transparent 55%),
        radial-gradient(900px 700px at 82% 78%, rgba(244,63,94,.08), transparent 55%);
      box-shadow: inset 0 0 0 1px rgba(148,163,184,.06);
      transform: translate3d(var(--pfX,0px), var(--pfY,0px), 0) rotateX(var(--pfRX,0deg)) rotateY(var(--pfRY,0deg));
      will-change: transform;
    }
    #hydr-layer{ position:absolute; inset:0; }
    #atk-layer{ position:absolute; inset:0; pointer-events:none; }

    /* target base */
    .hvr-target{
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .hvr-target .hvr-wiggle{
      animation: floaty 2.3s ease-in-out infinite;
      transform: translate3d(0,0,0);
      will-change: transform;
    }
    @keyframes floaty{
      0%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(0,-6px,0) scale(1.01); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    /* crosshair */
    #hvr-crosshair{
      position:fixed;
      left:50%; top:52%;
      transform: translate(-50%,-50%);
      width: 34px; height:34px;
      border-radius:999px;
      border: 2px solid rgba(56,189,248,.40);
      box-shadow: 0 0 22px rgba(56,189,248,.14);
      pointer-events:none;
      z-index: 9990;
    }
    #hvr-crosshair::before,#hvr-crosshair::after{
      content:"";
      position:absolute; left:50%; top:50%;
      transform: translate(-50%,-50%);
      background: rgba(56,189,248,.35);
      border-radius:999px;
    }
    #hvr-crosshair::before{ width: 2px; height: 20px; }
    #hvr-crosshair::after{ width: 20px; height: 2px; }

    /* bottom row (coach) */
    .bottomRow{
      display:flex; gap:10px; align-items:stretch;
      pointer-events:auto;
    }
    .coachCard{ flex:1; display:flex; gap:10px; align-items:center; padding:10px 12px; }
    .coachFace{
      width:44px; height:44px; border-radius:14px;
      background: rgba(15,23,42,.65);
      border:1px solid rgba(148,163,184,.18);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .coachFace img{ width:100%; height:100%; object-fit:contain; image-rendering:auto; }
    .coachText{ flex:1; }
    .coachLine1{ font-weight:900; }
    .coachLine2{ font-size:12px; color:var(--muted); margin-top:2px; }

    /* start overlay */
    #startOverlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
      background: radial-gradient(900px 700px at 50% 35%, rgba(2,6,23,.35), rgba(2,6,23,.86));
      backdrop-filter: blur(6px);
    }
    .startCard{
      width:min(560px, 92vw);
      border-radius:22px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.78);
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
      padding:16px;
    }
    .startTitle{ font-size:20px; font-weight:950; }
    .startDesc{ margin-top:6px; color:var(--muted); font-size:13px; line-height:1.5; }
    .btnRow{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    .btn{
      border:none; cursor:pointer;
      border-radius:14px;
      padding:10px 14px;
      font-weight:900;
      color: #041019;
      background: linear-gradient(90deg, rgba(56,189,248,.95), rgba(34,197,94,.92));
      box-shadow: 0 12px 30px rgba(56,189,248,.18);
    }
    .btn.ghost{
      color: var(--text);
      background: rgba(15,23,42,.55);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow:none;
    }

    /* end overlay */
    #hvr-end{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      z-index: 9999;
      background: radial-gradient(900px 700px at 50% 35%, rgba(2,6,23,.30), rgba(2,6,23,.88));
      backdrop-filter: blur(7px);
    }
    #hvr-end.show{ display:flex; }

    .endCard{
      width:min(680px, 94vw);
      border-radius:24px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.80);
      box-shadow: 0 30px 110px rgba(0,0,0,.62);
      overflow:hidden;
      position:relative;
    }
    .endTop{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(148,163,184,.12);
      background: rgba(2,6,23,.42);
    }
    .endTop .ttl{ font-weight:950; letter-spacing:.2px; }
    .endBody{ padding:14px 16px; display:grid; grid-template-columns: 1.1fr .9fr; gap:12px; }
    .endStat{
      border-radius:18px;
      border:1px solid rgba(148,163,184,.14);
      background: rgba(15,23,42,.45);
      padding:12px;
    }
    .endBig{
      font-size:40px;
      font-weight:1000;
      letter-spacing:.4px;
      line-height:1;
    }
    .endMeta{ margin-top:6px; color:var(--muted); font-size:12px; }
    .endGrid{ margin-top:10px; display:grid; grid-template-columns: 1fr 1fr; gap:8px; font-size:13px; color:var(--muted); }
    .endGrid b{ color:var(--text); font-weight:950; }

    /* stamp */
    .stamp{
      position:absolute;
      right:14px; top:62px;
      width:150px; height:150px;
      border-radius:999px;
      border: 5px solid rgba(56,189,248,.62);
      box-shadow: 0 0 0 5px rgba(34,197,94,.18), 0 18px 60px rgba(56,189,248,.18);
      background: radial-gradient(circle at 30% 25%, rgba(56,189,248,.12), rgba(2,6,23,.55));
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      transform: rotate(-12deg) scale(.86);
      opacity:0;
      filter: saturate(1.05);
      pointer-events:none;
    }
    .stamp .g{
      font-size:34px; font-weight:1100; letter-spacing:.6px;
    }
    .stamp .sub{
      font-size:11px; color:var(--muted); margin-top:2px;
    }
    .stamp.ink{
      animation: stampIn .42s cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes stampIn{
      0%{ transform: rotate(-16deg) scale(1.35); opacity:0; filter: blur(3px) saturate(1.4); }
      65%{ transform: rotate(-12deg) scale(.92); opacity:1; filter: blur(0px) saturate(1.05); }
      100%{ transform: rotate(-12deg) scale(.90); opacity:1; }
    }

    /* edge glow when storm/laser */
    #playfield::after{
      content:"";
      position:absolute; inset:0;
      border-radius:22px;
      pointer-events:none;
      box-shadow: 0 0 0 1px rgba(148,163,184,.04),
                  0 0 24px rgba(56,189,248, calc(var(--edgeGlow) * .22)),
                  0 0 30px rgba(244,63,94,  calc(var(--edgeGlow) * .18));
      transition: box-shadow .18s ease;
    }
  </style>
</head>

<body>
  <!-- Optional A-Frame scene (kept minimal) -->
  <a-scene embedded vr-mode-ui="enabled: true" style="position:fixed; inset:0; pointer-events:none; opacity:0;">
    <a-entity></a-entity>
  </a-scene>

  <div class="app" id="appRoot">
    <!-- WATER HEADER -->
    <div id="hha-water-header">
      <div class="waterLeft">
        <div class="waterTitle">üíß Hydration Quest</div>
        <div class="waterZone" id="waterZoneText">ZONE: BALANCED</div>
      </div>
      <div class="barWrap" aria-label="water gauge">
        <div class="barFill" id="waterBarFill"></div>
        <div class="barMark" style="left:35%"></div>
        <div class="barMark" style="left:65%"></div>
      </div>
      <div class="pill" id="clockPill">‚è±Ô∏è <b id="clockText">60</b>s</div>
    </div>

    <!-- TOP HUD -->
    <div class="topRow">
      <div class="card" id="hha-card-left">
        <div class="hd">
          <span class="pill">üèÜ <b id="scoreText" class="big">0</b></span>
          <span class="pill">üî• Fever <b id="feverText">0%</b></span>
        </div>
        <div class="bd">
          <div class="kv">
            <span>Combo</span> <b id="comboText">0</b>
            <span>Max Combo</span> <b id="comboMaxText">0</b>
            <span>Miss</span> <b id="missText">0</b>
            <span>Shield</span> <b id="shieldText">0</b>
            <span>Accuracy</span> <b id="accText">‚Äî</b>
          </div>
        </div>
      </div>

      <div class="card" id="hha-card-right">
        <div class="hd">
          <span class="pill">üéØ Goal: <b id="goalTitle">‚Äî</b></span>
          <span class="pill">üß© Mini: <b id="miniTitle">‚Äî</b></span>
        </div>
        <div class="bd">
          <div class="kv">
            <span>Goal Progress</span> <b id="goalProg">0/0</b>
            <span>Mini Progress</span> <b id="miniProg">0/0</b>
            <span>Grade (live)</span> <b id="liveGrade">‚Äî</b>
            <span>Mode</span> <b id="modeText">play</b>
            <span>Diff</span> <b id="diffText">normal</b>
          </div>
        </div>
      </div>
    </div>

    <!-- PLAYFIELD -->
    <div id="playfield">
      <div id="hydr-layer"></div>
      <div id="atk-layer"></div>
    </div>

    <!-- COACH -->
    <div class="bottomRow card coachCard">
      <div class="coachFace">
        <img id="coachImg" src="../img/coach-neutral.png" alt="coach" />
      </div>
      <div class="coachText">
        <div class="coachLine1" id="coachLine1">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Å‡∏±‡∏ô!</div>
        <div class="coachLine2" id="coachLine2">‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤ üíß ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏ö‡πÄ‡∏•‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ!</div>
      </div>
      <div class="pill">üéÆ Tap = ‡∏¢‡∏¥‡∏á / VR-feel = ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á+‡∏•‡∏≤‡∏Å</div>
    </div>
  </div>

  <!-- CROSSHAIR -->
  <div id="hvr-crosshair" aria-hidden="true"></div>

  <!-- START OVERLAY -->
  <div id="startOverlay">
    <div class="startCard">
      <div class="startTitle">üíß Hydration Quest ‚Äî PLAY</div>
      <div class="startDesc">
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏ô‡πâ‡∏≥ ‚Äú‡∏î‡∏µ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br/>
        ‚Ä¢ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏´‡∏ß‡∏≤‡∏ô/‡∏Ç‡∏¢‡∏∞ ‡πÅ‡∏•‡∏∞ ‚Äú‡πÄ‡∏•‡πÄ‡∏ã‡∏≠‡∏£‡πå‚Äù (‡∏°‡∏µ Fake-Out + Gap ‡∏Ç‡∏¢‡∏±‡∏ö!)<br/>
        ‚Ä¢ ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏õ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡∏à‡∏≠ (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß) + ‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      </div>
      <div class="btnRow">
        <button class="btn" id="btnStart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <button class="btn ghost" id="btnMotion">‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Motion (iOS)</button>
        <button class="btn ghost" id="btnSkip">‡∏Ç‡πâ‡∏≤‡∏°</button>
      </div>
      <div class="startDesc" style="margin-top:10px;">
        Tip: ‡πÉ‡∏™‡πà‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô <span class="muted">?diff=hard&time=90&run=play</span>
      </div>
    </div>
  </div>

  <!-- END OVERLAY -->
  <div id="hvr-end" class="hvr-end" aria-hidden="true">
    <div class="endCard">
      <div class="endTop">
        <div class="ttl">üéâ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• Hydration</div>
        <div class="pill">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö</div>
      </div>

      <div class="stamp" id="endStamp">
        <div class="g" id="endGrade">A</div>
        <div class="sub" id="endStampSub">HERO HEALTH</div>
      </div>

      <div class="endBody">
        <div class="endStat">
          <div class="muted">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
          <div class="endBig" id="endScore">0</div>
          <div class="endMeta" id="endMeta">‚Äî</div>

          <div class="endGrid">
            <span>Accuracy</span> <b id="endAcc">‚Äî</b>
            <span>Combo Max</span> <b id="endComboMax">0</b>
            <span>Miss</span> <b id="endMiss">0</b>
            <span>Goals / Minis</span> <b id="endGM">0/0 ‚Ä¢ 0/0</b>
          </div>
        </div>

        <div class="endStat">
          <div class="muted">‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå</div>
          <div style="margin-top:8px; font-size:13px; color:var(--muted); line-height:1.55;" id="endTips">
            ‚Äî
          </div>

          <div class="btnRow" style="margin-top:12px;">
            <button class="btn" id="btnRestart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
            <button class="btn ghost" id="btnCloseEnd">‡∏õ‡∏¥‡∏î</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GAME (module) -->
  <script type="module" src="./hydration.safe.js"></script>
</body>
</html>