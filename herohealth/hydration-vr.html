<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Hydration VR ‚Äî Hero Health</title>
  <meta name="color-scheme" content="dark"/>

  <link rel="icon" href="./favicon.ico"/>

  <!-- ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Good vs Junk VR -->
  <link rel="stylesheet" href="./css/goodjunk-vr.css"/>
  <!-- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Hydration -->
  <link rel="stylesheet" href="./css/hydration-vr.css"/>
</head>
<body>

  <!-- ===== SCENE WRAP / LOADING ===== -->
  <div class="hha-scene-wrap">
    <div class="hha-loading-msg">
      üíß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏´‡∏°‡∏î Hydration VR...
    </div>
  </div>

  <!-- crosshair ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö GoodJunk) -->
  <div class="hha-crosshair"></div>

  <!-- ‡∏õ‡∏∏‡πà‡∏° VR ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á GoodJunk VR) -->
  <button class="hha-vr-btn" id="hha-vr-btn">VR</button>

  <!-- HUD ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå / ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / ‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô GoodJunk VR) -->
  <script type="module" src="./vr/quest-hud-vr.js"></script>

  <!-- ===== MAIN SCRIPT: BOOT HYDRATION ENGINE ===== -->
  <script type="module">
    const msgEl  = document.querySelector('.hha-loading-msg');
    const wrapEl = document.querySelector('.hha-scene-wrap');

    async function startHydration() {
      try {
        if (msgEl) msgEl.textContent = 'üíß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î engine ‡πÇ‡∏´‡∏°‡∏î Hydration...';

        // üîç debug: ‡∏•‡∏≠‡∏á import ‡πÅ‡∏ö‡∏ö dynamic ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô error ‡∏ä‡∏±‡∏î ‡πÜ
        const mod = await import('./hydration-vr/hydration.safe.js');

        if (!mod || typeof mod.boot !== 'function') {
          throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô boot ‡πÉ‡∏ô hydration.safe.js');
        }

        if (msgEl) msgEl.textContent = 'üíß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration...';

        // ‡∏≠‡πà‡∏≤‡∏ô diff / time ‡∏à‡∏≤‡∏Å URL ‡πÄ‡∏ä‡πà‡∏ô hydration-vr.html?diff=easy&time=60
        const url = new URL(window.location.href);
        let diff = (url.searchParams.get('diff') || 'normal').toLowerCase();
        if (!['easy', 'normal', 'hard'].includes(diff)) diff = 'normal';

        let dur = parseInt(url.searchParams.get('time'), 10);
        if (Number.isNaN(dur) || dur <= 0) dur = 60;
        if (dur < 20)  dur = 20;
        if (dur > 180) dur = 180;

        const inst = await mod.boot({
          difficulty: diff,
          duration:   dur
        });

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Loading ‡πÄ‡∏°‡∏∑‡πà‡∏≠ boot ‡πÄ‡∏™‡∏£‡πá‡∏à
        if (wrapEl) wrapEl.style.display = 'none';

        // ‡∏Å‡∏±‡∏ô memory leak
        window.addEventListener('beforeunload', () => {
          try {
            inst && typeof inst.destroy === 'function' && inst.destroy();
          } catch (e) {
            console.warn('[HydrationVR] destroy on unload error', e);
          }
        });

      } catch (err) {
        console.error('[HydrationVR] boot error', err);
        if (msgEl) {
          msgEl.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (err.message || err);
        }
      }
    }

    // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ error ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    window.addEventListener('error', (e) => {
      console.error('[HydrationVR] window error', e.error || e.message);
      if (msgEl && wrapEl && wrapEl.style.display !== 'none') {
        msgEl.textContent = 'Error: ' + (e.error?.message || e.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏');
      }
    });

    startHydration();
  </script>
</body>
</html>