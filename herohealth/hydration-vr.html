<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
  <title>Hydration VR ‚Äî Hero Health</title>
  <meta name="color-scheme" content="dark"/>

  <link rel="icon" href="./favicon.ico"/>

  <!-- ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Good vs Junk VR -->
  <link rel="stylesheet" href="./css/goodjunk-vr.css"/>

  <!-- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hydration (inline, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°) -->
  <style>
    :root{
      color-scheme: dark;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      padding:0;
      overflow:hidden;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.20), transparent 55%),
        #020617;
      color:#e5e7eb;
    }

    /* ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° */
    .hha-scene-wrap{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at top,#0f172a,#020617 65%);
      z-index:40;
    }
    .hha-loading-msg{
      padding:14px 18px;
      border-radius:999px;
      background:rgba(15,23,42,.95);
      box-shadow:0 0 30px rgba(0,0,0,.6);
      font-size:14px;
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* crosshair ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á goodjunk-vr.css ‡∏ï‡πà‡∏≠ ‡πÅ‡∏ï‡πà‡∏Å‡∏±‡∏ô‡πÑ‡∏ß‡πâ */
    .hha-crosshair{
      position:fixed;
      left:50%;
      top:50%;
      width:22px;
      height:22px;
      margin-left:-11px;
      margin-top:-11px;
      border-radius:999px;
      border:2px solid rgba(248,250,252,0.9);
      box-shadow:0 0 10px rgba(15,23,42,.8);
      z-index:20;
      pointer-events:none;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° VR ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô GoodJunk) */
    .hha-vr-btn{
      position:fixed;
      right:12px;
      bottom:14px;
      z-index:30;
      padding:6px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.8);
      background:rgba(15,23,42,.92);
      color:#e5e7eb;
      font-size:13px;
      cursor:pointer;
      box-shadow:0 10px 25px rgba(0,0,0,.65);
    }
    .hha-vr-btn:hover{
      background:rgba(30,64,175,.95);
    }

    /* ‡πÉ‡∏´‡πâ HUD / ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏à‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß mobile-first */
    @media (max-width:767px){
      .hha-hud-topright,
      .hha-quest-panel{
        transform:scale(.9);
        transform-origin:top right;
      }
    }
  </style>
</head>
<body>

  <!-- ===== SCENE WRAP / LOADING ===== -->
  <div class="hha-scene-wrap">
    <div class="hha-loading-msg">
      üíß <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏´‡∏°‡∏î Hydration VR...</span>
    </div>
  </div>

  <!-- ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ -->
  <div class="hha-crosshair"></div>

  <!-- ‡∏õ‡∏∏‡πà‡∏° VR (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö A-Frame / WebXR ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô scene ‡πÅ‡∏•‡πâ‡∏ß) -->
  <button class="hha-vr-btn" id="hha-vr-btn">VR</button>

  <!-- ===== SCRIPT ZONE ===== -->

  <!-- HUD ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå + ‡∏™‡∏Å‡∏≠‡∏£‡πå + goal / mini quest (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Good vs Junk VR) -->
  <script type="module" src="./vr/quest-hud-vr.js"></script>

  <!-- Bubble ‡πÇ‡∏Ñ‡πâ‡∏ä‡∏Å‡∏•‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠ (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏´‡∏°‡∏î) -->
  <script type="module" src="./vr/coach-bubble.js"></script>

  <!-- ‡πÇ‡∏´‡∏°‡∏î Hydration VR (‡∏ï‡∏±‡∏ß engine ‡∏´‡∏•‡∏±‡∏Å) -->
  <script type="module">
    import { boot as bootHydration } from './hydration-vr/hydration.safe.js';

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL: ?diff=easy|normal|hard&time=60
    const url = new URL(window.location.href);

    let diff = (url.searchParams.get('diff') || 'normal').toLowerCase();
    if (!['easy','normal','hard'].includes(diff)) diff = 'normal';

    let dur = parseInt(url.searchParams.get('time'), 10);
    if (Number.isNaN(dur) || dur <= 0) dur = 60;
    if (dur < 20)  dur = 20;
    if (dur > 180) dur = 180;

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration
    bootHydration({
      difficulty: diff,
      duration:   dur
    }).then(inst => {
      // ‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
      const wrap = document.querySelector('.hha-scene-wrap');
      if (wrap) wrap.style.display = 'none';

      // ‡∏Å‡∏±‡∏ô memory leak ‡∏ï‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
      window.addEventListener('beforeunload', () => {
        try {
          if (inst && typeof inst.destroy === 'function') {
            inst.destroy();
          }
        } catch (e) {
          console.warn('[HydrationVR] destroy error on unload', e);
        }
      });
    }).catch(err => {
      console.error('[HydrationVR] boot error', err);
      const msg = document.querySelector('.hha-loading-msg span');
      if (msg) {
        msg.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Hydration';
      }
    });
  </script>
</body>
</html>
