<!-- === /herohealth/hydration-vr.html ===
Hydration Quest VR LAUNCHER ‚Äî AUTO (NO override if ?view= exists)
‚úÖ Auto-detect: pc / mobile / cardboard / cvr
‚úÖ Pass-through: hub/run/diff/time/seed/studyId/phase/conditionGroup/log/kids/style/...
‚úÖ Redirect -> ./hydration-vr/hydration-vr.html
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration Quest (Auto)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{ color-scheme: dark; }
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background:#020617; color:#e5e7eb; font:600 16px/1.35 system-ui;
    }
    .card{
      width:min(560px, 92vw);
      background:rgba(2,6,23,.72);
      border:1px solid rgba(148,163,184,.18);
      border-radius:22px;
      padding:18px 16px;
      box-shadow:0 30px 110px rgba(0,0,0,.55);
    }
    .t{ font-size:18px; font-weight:900; margin:0 0 6px; }
    .s{ color:#94a3b8; font-weight:700; margin:0 0 14px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .pill{
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(15,23,42,.50);
      font-size:13px; font-weight:800; color:#e5e7eb;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="t">üíß Hydration Quest</div>
    <div class="s" id="msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‚Ä¶</div>
    <div class="row">
      <div class="pill" id="pView">view: ‚Ä¶</div>
      <div class="pill" id="pDiff">diff: ‚Ä¶</div>
      <div class="pill" id="pTime">time: ‚Ä¶</div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const qs = (k, d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };

  function setTxt(id, v){ const el=document.getElementById(id); if(el) el.textContent=String(v); }

  function hasViewParam(){
    try{
      const u = new URL(location.href);
      const v = (u.searchParams.get('view')||'').trim();
      return !!v;
    }catch(_){ return false; }
  }

  function isMobile(){
    const ua = navigator.userAgent || '';
    const touch = ('ontouchstart' in window) || (navigator.maxTouchPoints>0);
    return /Android|iPhone|iPad|iPod/i.test(ua) || touch;
  }

  function detectView(){
    // ‚úÖ respect explicit view
    const forced = (qs('view','')||'').toLowerCase();
    if (forced) return forced;

    // prefer cvr if explicitly passed via view-cvr class not possible here; allow query use only.
    // detect cardboard-ish: mobile + landscape + screen width approx
    const m = isMobile();
    const w = Math.min(screen.width||0, screen.height||0);
    const landscape = (window.matchMedia && matchMedia('(orientation: landscape)').matches) || (innerWidth>innerHeight);
    const likelyCardboard = m && landscape && w >= 360;

    // if WebXR + mobile + landscape -> cardboard
    const hasXR = !!(navigator.xr && navigator.xr.isSessionSupported);
    if (hasXR && likelyCardboard) return 'cardboard';

    // mobile default
    if (m) return 'mobile';

    // desktop default
    return 'pc';
  }

  function passthroughRedirect(){
    const diff = qs('diff','normal');
    const time = qs('time','70');

    let view = detectView();
    setTxt('pView', 'view: ' + view);
    setTxt('pDiff', 'diff: ' + diff);
    setTxt('pTime', 'time: ' + time);

    // build redirect URL
    const u = new URL(location.href);
    const out = new URL('./hydration-vr/hydration-vr.html', u);

    // copy params
    u.searchParams.forEach((v,k)=> out.searchParams.set(k,v));

    // ‚úÖ do NOT override view if user provided
    if (!hasViewParam()) out.searchParams.set('view', view);

    // default run
    if (!out.searchParams.get('run')) out.searchParams.set('run','play');

    // keep hub default if missing
    if (!out.searchParams.get('hub')) out.searchParams.set('hub', './hub.html');

    // stamp seed if missing
    if (!out.searchParams.get('seed')) out.searchParams.set('seed', String(Date.now()));

    // go
    setTxt('msg', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‚Ä¶');
    location.replace(out.toString());
  }

  // Let UI paint once
  setTimeout(passthroughRedirect, 40);

})();
</script>
</body>
</html>