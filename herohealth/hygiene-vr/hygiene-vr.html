<!-- === /herohealth/hygiene-vr/hygiene-vr.html ===
HygieneVR RUN ‚Äî PRODUCTION (HHA Standard)
PATCH v20260210d
‚úÖ Views: pc/mobile/vr/cvr (via body class)
‚úÖ Uses: ../vr/vr-ui.js (Enter VR / Exit / Recenter + crosshair + hha:shoot)
‚úÖ FX: ../vr/particles.js
‚úÖ Quiz bank: ./hygiene-quiz-bank.js -> window.HHA_HYGIENE_QUIZ_BANK
‚úÖ Boot: hygiene-vr.boot.js (module) + anti-stall overlay
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî HygieneVR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- CSS -->
  <link rel="stylesheet" href="./hygiene-vr.css?v=20260210c" />

  <!-- Universal VR UI (defer) -->
  <script src="../vr/vr-ui.js" defer></script>

  <!-- FX (defer) -->
  <script src="../vr/particles.js" defer></script>

  <!-- AI packs (optional) -->
  <script src="../vr/hha-ai-coach.js" defer></script>
  <script src="../vr/hha-difficulty-director.js" defer></script>
  <script src="../vr/hha-badges.js" defer></script>

  <!-- Quiz bank (‚úÖ correct filename) -->
  <script src="./hygiene-quiz-bank.js" defer></script>

  <!-- Boot (module) -->
  <script type="module" src="./hygiene-vr.boot.js?v=20260210d"></script>

  <style>
    /* anti-stall overlay (‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡πÄ‡∏Å‡∏° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏£‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å boot) */
    .hw-stall{
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      padding: 16px;
      background: rgba(2,6,23,.70);
      z-index: 120;
      backdrop-filter: blur(10px);
    }
    .hw-stall .card{
      width: min(720px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.74);
      box-shadow: 0 24px 90px rgba(0,0,0,.55);
      padding: 14px;
      color: rgba(229,231,235,.96);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    .hw-stall .title{ font-weight: 950; font-size: 16px; }
    .hw-stall .sub{ margin-top: 8px; color: rgba(148,163,184,.95); font-size: 13px; line-height: 1.35; }
    .hw-stall .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .hw-stall .btn{
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.70);
      color: rgba(229,231,235,.95);
      padding: 10px 12px;
      font-weight: 950;
      cursor: pointer;
    }
    .hw-stall .btn.primary{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.28); }
    .hw-stall pre{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.45);
      max-height: min(40vh, 360px);
      overflow: auto;
      font-size: 12px;
      color: rgba(229,231,235,.92);
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>

<body class="view-pc">
  <div id="gameRoot" class="hw-root">
    <div class="hw-stage" id="stage" aria-label="HygieneVR stage"></div>

    <!-- HUD -->
    <div class="hw-hud">
      <div class="hw-top">
        <div class="hw-title">üßº Handwash Survival</div>
        <div class="hw-sub" id="hudSub">ready‚Ä¶</div>

        <div class="hw-row">
          <div class="hw-pill" id="pillStep">STEP 1/7 ü´ß ‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠</div>
          <div class="hw-pill" id="pillHits">HITS 0/6</div>
          <div class="hw-pill" id="pillCombo">COMBO 0</div>
          <div class="hw-pill bad" id="pillMiss">MISS 0 / 3</div>
        </div>

        <div class="hw-row">
          <div class="hw-pill warn" id="pillRisk">RISK Incomplete 0% ‚Ä¢ Unsafe 0%</div>
          <div class="hw-pill" id="pillTime">TIME 70</div>
          <div class="hw-pill cyan" id="pillQuest">QUEST ‚Äî</div>
          <button class="hw-pill btn" id="btnPause" type="button">‚è∏ Pause</button>
          <button class="hw-pill btn" id="btnBack" type="button">‚Ü© HUB</button>
        </div>

        <!-- Quiz box -->
        <div class="hw-quiz" id="quizBox" style="display:none">
          <div class="hw-quiz-q" id="quizQ">QUIZ</div>
          <div class="hw-quiz-sub" id="quizSub">‚Äî</div>
        </div>
      </div>

      <div class="hw-banner" id="banner" aria-live="polite"></div>
    </div>

    <!-- Start Overlay -->
    <div class="hw-overlay" id="startOverlay">
      <div class="hw-card">
        <div class="hw-card-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠ üßº</div>
        <div class="hw-card-sub">
          ‡πÇ‡∏´‡∏°‡∏î <b>Survival</b> ‚Äî ‡∏ó‡∏≥‡∏ï‡∏≤‡∏° <b>7 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</b> ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å ‚Ä¢ ‡∏´‡∏•‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ ü¶† ‚Ä¢ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î<br>
          <b>‡∏Ñ‡∏≥‡∏ó‡πà‡∏≠‡∏á:</b> ‚Äú‡∏ù‡πà‡∏≤-‡∏´‡∏•‡∏±‡∏á-‡∏ã‡∏≠‡∏Å-‡∏Ç‡πâ‡∏≠-‡πÇ‡∏õ‡πâ‡∏á-‡πÄ‡∏•‡πá‡∏ö-‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‚Äù<br>
          ‡∏¢‡∏¥‡∏á/‡πÅ‡∏ï‡∏∞ ‚Äú‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        </div>
        <div class="hw-card-row">
          <button class="hw-cta" id="btnStart" type="button">‚ñ∂ Start</button>
          <button class="hw-ghost" id="btnRestart" type="button">‚Üª Reset</button>
        </div>
        <div class="hw-card-sub" style="margin-top:10px">
          Mode: <span id="labMode">play</span> ‚Ä¢ Diff: <span id="labDiff">normal</span> ‚Ä¢ View: <span id="labView">pc</span>
        </div>
      </div>
    </div>

    <!-- End Overlay -->
    <div class="hw-overlay" id="endOverlay" style="display:none">
      <div class="hw-card">
        <div class="hw-card-title" id="endTitle">‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‚úÖ</div>
        <div class="hw-card-sub" id="endSub">‚Äî</div>
        <pre class="hw-pre" id="endJson"></pre>
        <div class="hw-card-row">
          <button class="hw-cta" id="btnPlayAgain" type="button">‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
          <button class="hw-ghost" id="btnCopyJson" type="button">üìã Copy Summary</button>
          <button class="hw-ghost" id="btnBack2" type="button">‚Ü© ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Anti-stall Overlay -->
  <div class="hw-stall" id="stallOverlay" aria-live="polite">
    <div class="card">
      <div class="title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠ üßº (‡πÄ‡∏Å‡∏°‡∏Ñ‡πâ‡∏≤‡∏á/‡∏™‡∏∞‡∏î‡∏∏‡∏î)</div>
      <div class="sub">
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏î <b>Reload ‡πÄ‡∏Å‡∏°</b> (‡∏°‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å memory/JS error/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏á)<br>
        ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Console ‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏î‡∏π error ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡πà‡∏á‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
      </div>
      <div class="row">
        <button class="btn primary" id="btnReload" type="button">üîÑ Reload ‡πÄ‡∏Å‡∏°</button>
        <button class="btn" id="btnCopyErr" type="button">üìã Copy error</button>
        <button class="btn" id="btnCloseStall" type="button">‚úñ ‡∏õ‡∏¥‡∏î</button>
      </div>
      <pre id="stallErr">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‚Ä¶</pre>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const qs = (k,d=null)=>{ try{return new URL(location.href).searchParams.get(k) ?? d;}catch{return d;} };

  function setViewClass(){
    const view = (qs('view','pc')||'pc').toLowerCase();
    document.body.classList.remove('view-pc','view-mobile','view-vr','view-cvr');
    document.body.classList.add(
      view==='mobile' ? 'view-mobile' :
      (view==='vr' ? 'view-vr' :
      (view==='cvr' ? 'view-cvr' : 'view-pc'))
    );
    const lab = document.getElementById('labView');
    if(lab) lab.textContent = view;
  }
  setViewClass();

  const labMode = document.getElementById('labMode');
  const labDiff = document.getElementById('labDiff');
  if(labMode) labMode.textContent = (qs('run','play')||'play');
  if(labDiff) labDiff.textContent = (qs('diff','normal')||'normal');

  // Anti-stall UI helpers (boot ‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ id ‡∏ô‡∏µ‡πâ)
  const stall = document.getElementById('stallOverlay');
  const errBox = document.getElementById('stallErr');

  document.getElementById('btnReload')?.addEventListener('click', ()=>location.reload(), {passive:true});
  document.getElementById('btnCloseStall')?.addEventListener('click', ()=>{ if(stall) stall.style.display='none'; }, {passive:true});
  document.getElementById('btnCopyErr')?.addEventListener('click', ()=>{
    const t = errBox?.textContent || '';
    navigator.clipboard?.writeText(t).catch(()=>{});
  }, {passive:true});

  // global hooks for boot
  window.HHA_STALL = {
    show(msg){
      try{
        if(errBox) errBox.textContent = String(msg||'');
        if(stall) stall.style.display = 'grid';
      }catch(_){}
    },
    hide(){
      try{ if(stall) stall.style.display='none'; }catch(_){}
    },
    set(msg){
      try{ if(errBox) errBox.textContent = String(msg||''); }catch(_){}
    }
  };
})();
</script>
</body>
</html>