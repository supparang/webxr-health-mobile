<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="light dark"/>
  <link rel="icon" href="../favicon.ico" type="image/x-icon"/>

  <link rel="stylesheet" href="./hydration-vr.css"/>

  <!-- Universal VR UI -->
  <script>
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏π‡∏ô lockPx ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å query ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    window.HHA_VRUI_CONFIG = { lockPx: 28, cooldownMs: 90 };
  </script>
  <script src="../vr/vr-ui.js"></script>
</head>

<body class="view-pc">
  <!-- ===== START OVERLAY ===== -->
  <div id="startOverlay" class="startOverlay" aria-hidden="false">
    <div class="startCard">
      <div class="startTitle">üíß Hydration VR</div>
      <div class="startSub">
        ‡∏¢‡∏¥‡∏á üíß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà GREEN
        ‚Ä¢ ‡πÄ‡∏Ç‡πâ‡∏≤ STORM ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ Mini: LOW/HIGH + BLOCK ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡πâ‡∏≤‡∏¢
      </div>

      <div class="startRow">
        <button id="btnStart" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <button id="btnBackHub" class="btn">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>

      <div class="startHint">
        Tip: ‡πÇ‡∏´‡∏°‡∏î <b>cVR</b> ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (tap-to-shoot)
      </div>
    </div>
  </div>

  <!-- ===== HUD TOP ===== -->
  <div id="hudTop" class="hud-top">
    <div class="statBox">
      <div class="label">SCORE</div>
      <div class="val" id="stat-score">0</div>
    </div>
    <div class="statBox">
      <div class="label">COMBO</div>
      <div class="val" id="stat-combo">0</div>
    </div>
    <div class="statBox">
      <div class="label">TIME</div>
      <div class="val" id="stat-time">0</div>
    </div>
    <div class="statBox">
      <div class="label">MISS</div>
      <div class="val" id="stat-miss">0</div>
    </div>
  </div>

  <!-- ===== PLAYFIELDS (loader will harden these too) ===== -->
  <div id="playfield">
    <div id="hydration-layer"></div>
  </div>

  <div id="cbPlayfield" aria-hidden="true">
    <div class="cbHalf left"><div id="hydration-layerL"></div></div>
    <div class="cbHalf right"><div id="hydration-layerR"></div></div>
  </div>

  <!-- ===== HUD BOTTOM ===== -->
  <div id="hudBottom" class="hud-bottom">
    <div id="questPanel" class="quest-panel hud-card">
      <div class="title">
        <span>üéØ Quest</span>
        <button id="btnQuestToggle" type="button">‡∏û‡∏±‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢</button>
      </div>
      <div id="questLines" class="quest-lines">
        <div id="quest-line1">‚Äî</div>
        <div id="quest-line2">‚Äî</div>
        <div id="quest-line3">‚Äî</div>
        <div id="quest-line4">‚Äî</div>
        <div class="muted" style="margin-top:6px;">
          STORM: <span id="storm-left">0</span>s ‚Ä¢ üõ°Ô∏è <span id="shield-count">0</span> ‚Ä¢ GRADE <span id="stat-grade">C</span>
        </div>
      </div>
    </div>

    <div id="waterPanel" class="water-panel hud-card">
      <div class="waterRow">
        <div class="t">üíß Water</div>
        <div style="display:flex;gap:10px;align-items:baseline;">
          <div class="p"><span id="water-pct">50</span>%</div>
          <div class="badge" id="water-zone">GREEN</div>
        </div>
      </div>
      <div class="barWrap"><div class="bar" id="water-bar" style="width:50%"></div></div>
      <div class="hint">GREEN = ‡∏™‡∏°‡∏î‡∏∏‡∏• ‚Ä¢ LOW/HIGH ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏≥ Mini ‡πÅ‡∏ï‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏î‡∏ô BAD</div>
    </div>
  </div>

  <!-- ===== RESULT OVERLAY ===== -->
  <div id="resultBackdrop" class="resultBackdrop" hidden>
    <div class="resultCard">
      <div class="resultTitle">üèÅ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>

      <div class="resultGrid">
        <div class="kv"><div class="k">Score</div><div class="v" id="rScore">0</div></div>
        <div class="kv"><div class="k">Grade</div><div class="v" id="rGrade">C</div></div>
        <div class="kv"><div class="k">Accuracy</div><div class="v" id="rAcc">0%</div></div>
        <div class="kv"><div class="k">ComboMax</div><div class="v" id="rComboMax">0</div></div>
        <div class="kv"><div class="k">Miss</div><div class="v" id="rMiss">0</div></div>
        <div class="kv"><div class="k">Goals</div><div class="v" id="rGoals">0/1</div></div>
        <div class="kv"><div class="k">Mini</div><div class="v" id="rMinis">0/0</div></div>
        <div class="kv"><div class="k">GreenHold</div><div class="v" id="rGreen">0s</div></div>
        <div class="kv"><div class="k">StormCycles</div><div class="v" id="rStormCycles">0</div></div>
        <div class="kv"><div class="k">StormOK</div><div class="v" id="rStormOk">0</div></div>
        <div class="kv"><div class="k">StormRate</div><div class="v" id="rStormRate">0%</div></div>
        <div class="kv"><div class="k">Tier</div><div class="v" id="rTier">‚Äî</div></div>
      </div>

      <pre class="tips" id="rTips"></pre>
      <div class="next" id="rNext"></div>

      <div class="resultRow">
        <button class="btn primary" id="btnRetry">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn" id="btnCloseSummary">‡∏õ‡∏¥‡∏î‡∏™‡∏£‡∏∏‡∏õ</button>
        <button class="btn" id="btnCopyJSON">Copy JSON</button>
        <button class="btn" id="btnDownloadCSV">Download CSV</button>
        <button class="btn btnBackHub">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>
    </div>
  </div>

  <!-- ===== Boot: UI controls + start event ===== -->
  <script>
  (function(){
    const qs = (k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };
    const hub = String(qs('hub','../hub.html'));

    const btnBackHub = document.getElementById('btnBackHub');
    btnBackHub?.addEventListener('click', ()=> location.href = hub);

    const ov = document.getElementById('startOverlay');
    const btnStart = document.getElementById('btnStart');

    function startGame(){
      if (ov) ov.style.display = 'none';
      try{ window.dispatchEvent(new CustomEvent('hha:start')); }catch(_){}
    }
    btnStart?.addEventListener('click', startGame);

    // Tap anywhere to start (mobile-friendly)
    ov?.addEventListener('pointerdown', (e)=>{ e.preventDefault(); startGame(); }, {passive:false});

    // Quest collapse toggle
    const btnQuestToggle = document.getElementById('btnQuestToggle');
    btnQuestToggle?.addEventListener('click', ()=>{
      document.body.classList.toggle('hud-collapsed');
    });
  })();
  </script>

  <!-- ===== Loader (imports safe.js) ===== -->
  <script type="module" src="./hydration-vr.loader.js"></script>
</body>
</html>