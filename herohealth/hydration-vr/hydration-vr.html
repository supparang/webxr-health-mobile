<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <link rel="stylesheet" href="./hydration-vr.css" />

  <!-- VR UI (Enter VR/Exit/Recenter + crosshair + hha:shoot) -->
  <!-- ‡∏ñ‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ vr-ui.js ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ ./vr-ui.js ‡πÑ‡∏î‡πâ -->
  <script src="../vr/vr-ui.js"></script>
</head>
<body class="view-pc">
  <!-- ===== Playfield (PC/Mobile/cVR) ===== -->
  <main id="playfield" aria-label="playfield">
    <!-- targets mount here -->
    <div id="hydration-layer" class="layer" aria-hidden="true"></div>
  </main>

  <!-- ===== Cardboard Playfield (split) ===== -->
  <main id="cbPlayfield" aria-label="cardboard playfield" hidden>
    <section class="cb-eye cb-left" aria-label="left eye">
      <div id="hydration-layerL" class="layer" aria-hidden="true"></div>
    </section>
    <section class="cb-eye cb-right" aria-label="right eye">
      <div id="hydration-layerR" class="layer" aria-hidden="true"></div>
    </section>
  </main>

  <!-- ===== HUD TOP (stats) ===== -->
  <section id="hudTop" class="hud-top" aria-label="hud top">
    <div class="hud-card statBox">
      <div class="label">SCORE</div>
      <div class="val" id="stat-score">0</div>
    </div>
    <div class="hud-card statBox">
      <div class="label">COMBO</div>
      <div class="val" id="stat-combo">0</div>
    </div>
    <div class="hud-card statBox">
      <div class="label">MISS</div>
      <div class="val" id="stat-miss">0</div>
    </div>
    <div class="hud-card statBox">
      <div class="label">TIME</div>
      <div class="val" id="stat-time">0</div>
    </div>

    <div class="hud-card statBox gradeBox" id="gradeBox">
      <div class="label">GRADE</div>
      <div class="val" id="stat-grade">C</div>
    </div>
  </section>

  <!-- ===== HUD BOTTOM (quest + water) ===== -->
  <section id="hudBottom" class="hud-bottom" aria-label="hud bottom">
    <div id="questPanel" class="hud-card quest-panel">
      <div class="title">
        <span>‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</span>
        <button id="btnQuestToggle" type="button" aria-label="toggle quest">‚§¢ ‡∏û‡∏±‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢</button>
      </div>
      <div id="questLines" class="quest-lines">
        <div id="quest-line1">Stage 1/3: ‚Ä¶</div>
        <div id="quest-line2">‚Ä¶</div>
        <div id="quest-line3">‚Ä¶</div>
        <div id="quest-line4">‚Ä¶</div>
      </div>
    </div>

    <div id="waterPanel" class="hud-card water-panel">
      <div class="waterRow">
        <div class="t">üíß Water Balance</div>
        <div class="p"><span id="water-pct">50</span>%</div>
      </div>
      <div class="waterRow" style="margin-top:4px; opacity:.92;">
        <div>Zone</div>
        <div id="water-zone" style="font-weight:900;">GREEN</div>
      </div>
      <div class="barWrap" aria-hidden="true">
        <div class="bar" id="water-bar" style="width:50%"></div>
      </div>

      <div class="miniRow">
        <div>üõ°Ô∏è</div>
        <div id="shield-count">0</div>
        <div style="margin-left:8px;">üåÄ STORM</div>
        <div id="storm-left">0</div>
        <div>s</div>
      </div>
    </div>
  </section>

  <!-- ===== Start Overlay ===== -->
  <div id="startOverlay" class="overlay" role="dialog" aria-label="start overlay">
    <div class="overlay-card">
      <div class="kicker">Hydration Quest</div>
      <div class="title">Stage 1‚Äì3 ‚Ä¢ Storm Mini ‚Ä¢ Boss Block</div>
      <div class="desc">
        ‚Ä¢ ‡∏¢‡∏¥‡∏á üíß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà GREEN (‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏ß‡∏•‡∏≤)\n
        ‚Ä¢ Storm: ‡∏ï‡πâ‡∏≠‡∏á LOW/HIGH + ‡∏™‡∏∞‡∏™‡∏° pressure + BLOCK ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡πâ‡∏≤‡∏¢\n
        ‚Ä¢ Boss Window: BLOCK üå©Ô∏è ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
      </div>
      <div class="row">
        <button id="btnStart" class="btn primary" type="button">‚ñ∂Ô∏è START</button>
        <button id="btnBackHubTop" class="btn" type="button">üè† HUB</button>
      </div>
      <div class="tiny">Tip: cVR ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (crosshair) ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
    </div>
  </div>

  <!-- ===== Result / Summary Overlay ===== -->
  <div id="resultBackdrop" class="result" hidden>
    <div class="result-card">
      <div class="r-head">
        <div>
          <div class="r-kicker">RESULT</div>
          <div class="r-title">Hydration Quest Summary</div>
        </div>
        <button id="btnCloseSummary" class="btn small" type="button">‚úï</button>
      </div>

      <div class="r-grid">
        <div class="r-box">
          <div class="r-lab">Score</div><div class="r-val" id="rScore">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Grade</div><div class="r-val" id="rGrade">C</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Accuracy</div><div class="r-val" id="rAcc">0%</div>
        </div>
        <div class="r-box">
          <div class="r-lab">ComboMax</div><div class="r-val" id="rComboMax">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Miss</div><div class="r-val" id="rMiss">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Goals</div><div class="r-val" id="rGoals">0/1</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Minis</div><div class="r-val" id="rMinis">0/0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">GREEN Hold</div><div class="r-val" id="rGreen">0s</div>
        </div>
        <div class="r-box">
          <div class="r-lab">StreakMax</div><div class="r-val" id="rStreak">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Storm Cycles</div><div class="r-val" id="rStormCycles">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Storm OK</div><div class="r-val" id="rStormOk">0</div>
        </div>
        <div class="r-box">
          <div class="r-lab">Storm Rate</div><div class="r-val" id="rStormRate">0%</div>
        </div>
      </div>

      <div class="r-notes">
        <div class="r-lab">Tips</div>
        <pre id="rTips" class="r-pre">‚Äî</pre>
        <div class="r-lab" style="margin-top:10px;">Next</div>
        <div id="rNext" class="r-next">‚Äî</div>
        <div id="rTier" class="r-tier">Tier: ‚Äî</div>
      </div>

      <div class="r-actions">
        <button id="btnRetry" class="btn primary" type="button">üîÅ Retry</button>
        <button class="btn btnBackHub" type="button">üè† Back HUB</button>
        <button id="btnCopyJSON" class="btn" type="button">üìã Copy JSON</button>
        <button id="btnDownloadCSV" class="btn" type="button">‚¨áÔ∏è CSV</button>
      </div>
    </div>
  </div>

  <!-- ===== local UI wiring ===== -->
  <script>
  (function(){
    const qs = (k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };
    const hub = String(qs('hub','../hub.html'));

    // HUB buttons
    const hubBtns = [document.getElementById('btnBackHubTop')].filter(Boolean);
    document.querySelectorAll('.btnBackHub').forEach(b=>hubBtns.push(b));
    hubBtns.forEach(btn=>{
      btn.addEventListener('click', ()=> location.href = hub);
    });

    // Quest collapse
    const tgl = document.getElementById('btnQuestToggle');
    tgl?.addEventListener('click', ()=>{
      document.body.classList.toggle('hud-collapsed');
    });

    // Start overlay
    const ov = document.getElementById('startOverlay');
    const btnStart = document.getElementById('btnStart');
    function startGame(){
      try{ ov?.classList.add('hide'); }catch(_){}
      try{ window.dispatchEvent(new CustomEvent('hha:start')); }catch(_){}
    }
    btnStart?.addEventListener('click', startGame);
    ov?.addEventListener('click', (e)=>{
      // allow click outside card to start too (mobile-friendly)
      if (e.target === ov) startGame();
    });

    // Ensure correct playfield for cardboard
    function syncCardboard(){
      const isCb = document.body.classList.contains('cardboard');
      const pf = document.getElementById('playfield');
      const cb = document.getElementById('cbPlayfield');
      if (cb) cb.hidden = !isCb;
      if (pf) pf.hidden = isCb;
    }
    // loader sets body class early, but do once more after DOM ready
    setTimeout(syncCardboard, 40);
    window.addEventListener('DOMContentLoaded', syncCardboard);
  })();
  </script>

  <!-- ===== Loader: sets view classes + layers mapping + imports hydration.safe.js ===== -->
  <script src="./hydration-vr.loader.js"></script>
</body>
</html>