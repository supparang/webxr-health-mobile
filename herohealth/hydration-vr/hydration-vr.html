<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Hydration VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <!-- External CSS (PRODUCTION) -->
  <link rel="stylesheet" href="./hydration-vr.css" />

  <!-- Global FX + optional logger -->
  <script src="../vr/particles.js" defer></script>
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <!-- Universal VR UI (Enter VR / Exit / Recenter + crosshair shoot hha:shoot)
       ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå -->
  <!-- <script src="../vr/vr-ui.js" defer></script> -->
</head>

<body class="view-pc">
  <div id="app">
    <!-- PLAYFIELD (PC/Mobile/cVR) -->
    <div id="playfield">
      <div id="hydration-layer"></div>
    </div>

    <!-- PLAYFIELD (Cardboard split) -->
    <div id="cbPlayfield" style="display:none;">
      <div id="hydration-layerL"></div>
      <div id="hydration-layerR"></div>
    </div>

    <!-- Crosshair overlay (for cVR) -->
    <div class="crosshair" id="cvrCrosshair" aria-hidden="true" style="display:none;"></div>

    <!-- HUD -->
    <div class="hud" aria-hidden="false">
      <!-- LEFT: Stats -->
      <div class="panel">
        <div class="statsRow">
          <span class="pill accent">Score <b id="stat-score">0</b></span>
          <span class="pill cyan">Combo <b id="stat-combo">0</b></span>
          <span class="pill warn">Time <b id="stat-time">0</b></span>
          <span class="pill bad">Miss <b id="stat-miss">0</b></span>
          <span class="pill">Grade <b id="stat-grade">C</b></span>
        </div>
      </div>

      <!-- RIGHT: Quest + Mini + Water -->
      <div class="panel">
        <div class="questLines">
          <div class="line1" id="quest-line1">Stage 1/3 ...</div>
          <div class="line2" id="quest-line2">‚Äî</div>
          <div class="line3 muted" id="quest-line3">‚Äî</div>
          <div class="line4 muted" id="quest-line4">‚Äî</div>
        </div>

        <div class="miniRow">
          <span class="pill warn">Storm <b id="storm-left">0</b></span>
          <span class="pill cyan">Shield <b id="shield-count">0</b></span>
          <!-- OPTIONAL: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ó‡∏≥ Boost ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï safe.js ‡πÉ‡∏™‡πà id ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ -->
          <span class="pill violet" style="border-color: rgba(168,85,247,.22);">Boost <b id="boost-count">0</b></span>
        </div>

        <div class="waterBox">
          <div class="waterTrack"><div id="water-bar"></div></div>
          <div class="waterMeta">
            <span>Zone <b id="water-zone">GREEN</b></span>
            <span><b id="water-pct">50</b>%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- START OVERLAY -->
    <div id="startOverlay">
      <div class="startCard">
        <h1>üíß HeroHealth ‚Äî Hydration VR</h1>
        <p>
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:
‚Ä¢ PC: ‡πÄ‡∏°‡∏≤‡∏™‡πå/‡∏Ñ‡∏•‡∏¥‡∏Å
‚Ä¢ Mobile: ‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
‚Ä¢ VR Cardboard (Split): ‡∏à‡∏≠‡πÅ‡∏¢‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‚Äì‡∏Ç‡∏ß‡∏≤ (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Cardboard)
‚Ä¢ cVR: Crosshair ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ + ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á (strict ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠)
        </p>

        <div class="resultActions" style="margin-top:12px;">
          <button class="btn" id="btnPC">üñ•Ô∏è PC</button>
          <button class="btn" id="btnMobile">üì± Mobile</button>
          <button class="btn primary" id="btnCardboard">üï∂Ô∏è VR Cardboard (Split)</button>
          <button class="btn" id="btnCVR" style="border-color: rgba(34,211,238,.22);">üéØ cVR (Crosshair)</button>
          <button class="btn warn btnBackHub">üè† Back HUB</button>
        </div>

        <p style="margin-top:12px; font-size:12px; line-height:1.4; color:rgba(229,231,235,.88);">
‡∏ó‡∏¥‡∏õ‡∏ú‡πà‡∏≤‡∏ô Stage:
Stage1) ‡∏Ñ‡∏∏‡∏° GREEN ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏∞‡∏™‡∏°)
Stage2) ‡∏ú‡πà‡∏≤‡∏ô Storm Mini ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏û‡∏≤‡∏¢‡∏∏: ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡πÑ‡∏°‡πà GREEN (LOW/HIGH) + BLOCK ‡∏ä‡πà‡∏ß‡∏á End Window ‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏î‡∏ô BAD ‡∏ï‡∏≠‡∏ô‡∏û‡∏≤‡∏¢‡∏∏
Stage3) ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå BOSS: ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏û‡∏≤‡∏¢‡∏∏ (Boss Window) ‡∏à‡∏∞‡∏°‡∏µ üå©Ô∏è ‡πÇ‡∏ú‡∏•‡πà‡∏ñ‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‚Äî ‡πÉ‡∏ä‡πâ üõ°Ô∏è BLOCK ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
        </p>
      </div>
    </div>

    <!-- END SUMMARY -->
    <div id="resultBackdrop" hidden>
      <div class="resultCard">
        <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
          <div>
            <div style="font-weight:900; font-size:16px;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</div>
            <div style="color:rgba(148,163,184,.95); font-size:12px; margin-top:4px;">
              (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage: HHA_LAST_SUMMARY)
            </div>
          </div>
          <div class="resultActions" style="margin:0;">
            <button class="btn" id="btnRetry">üîÅ Retry</button>
            <button class="btn warn btnBackHub">üè† Back HUB</button>
            <button class="btn" id="btnCloseSummary">‚úñ Close</button>
          </div>
        </div>

        <div class="resultGrid" style="margin-top:12px;">
          <div class="box">
            <h3>Performance</h3>
            <div class="val"><span id="rScore">0</span> pts</div>
            <div style="margin-top:6px; color:rgba(229,231,235,.90); font-size:13px;">
              Grade: <b id="rGrade">C</b> ‚Ä¢ Acc: <b id="rAcc">0%</b> ‚Ä¢ ComboMax: <b id="rComboMax">0</b> ‚Ä¢ Miss: <b id="rMiss">0</b>
            </div>
            <div style="margin-top:6px; color:rgba(229,231,235,.90); font-size:13px;">
              Goals: <b id="rGoals">0/1</b> ‚Ä¢ Minis: <b id="rMinis">0/0</b>
            </div>
          </div>

          <div class="box">
            <h3>Stage Stats</h3>
            <div style="font-size:13px; line-height:1.6; color:rgba(229,231,235,.92);">
              GREEN Hold: <b id="rGreen">0s</b><br/>
              Streak Max: <b id="rStreak">0</b><br/>
              Storm Cycles: <b id="rStormCycles">0</b><br/>
              Storm Success: <b id="rStormOk">0</b><br/>
              Storm Rate: <b id="rStormRate">0%</b><br/>
              <span id="rTier">Tier:</span>
            </div>
          </div>
        </div>

        <div class="box" style="margin-top:10px;">
          <h3>Tips / Next</h3>
          <pre id="rTips" style="margin:0;">‚Äî</pre>
          <div style="margin-top:10px; color:rgba(229,231,235,.92);">
            Next: <b id="rNext">‚Äî</b>
          </div>

          <div class="resultActions" style="margin-top:12px;">
            <button class="btn" id="btnCopyJSON">üìã Copy JSON</button>
            <button class="btn" id="btnDownloadCSV">‚¨áÔ∏è Download CSV</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View select + fullscreen helper -->
  <script>
  (function(){
    const qs=(k,d=null)=>{ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } };
    const hub = String(qs('hub','../hub.html'));

    document.querySelectorAll('.btnBackHub').forEach(btn=>{
      btn.addEventListener('click', ()=> location.href = hub);
    });

    async function enterFull(){
      try{
        const el = document.documentElement;
        if (!document.fullscreenElement && el.requestFullscreen) await el.requestFullscreen({navigationUI:'hide'});
      }catch(_){}
      try{
        if (screen.orientation && screen.orientation.lock) await screen.orientation.lock('landscape');
      }catch(_){}
    }

    function applyView(view){
      const b=document.body;
      b.classList.remove('view-pc','view-mobile','cardboard','view-cvr');

      const pf=document.getElementById('playfield');
      const cb=document.getElementById('cbPlayfield');
      const cross=document.getElementById('cvrCrosshair');

      if (view==='mobile'){
        b.classList.add('view-mobile');
        if (pf) pf.style.display='';
        if (cb) cb.style.display='none';
        if (cross) cross.style.display='none';
      } else if (view==='cardboard'){
        b.classList.add('cardboard');
        if (pf) pf.style.display='none';
        if (cb) cb.style.display='';
        if (cross) cross.style.display='none';
      } else if (view==='cvr'){
        b.classList.add('view-cvr');
        if (pf) pf.style.display='';
        if (cb) cb.style.display='none';
        if (cross) cross.style.display='';
      } else {
        b.classList.add('view-pc');
        if (pf) pf.style.display='';
        if (cb) cb.style.display='none';
        if (cross) cross.style.display='none';
      }

      // cVR: ‡∏õ‡∏¥‡∏î pointer events ‡∏ö‡∏ô layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (safe.js ‡∏ü‡∏±‡∏á hha:shoot)
      const layer=document.getElementById('hydration-layer');
      if (layer){
        layer.style.pointerEvents = (view==='cvr') ? 'none' : 'auto';
      }
    }

    async function go(view){
      if (view === 'cardboard' || view === 'cvr'){
        await enterFull();
      }
      const u = new URL(location.href);
      u.searchParams.set('view', view);
      if (!u.searchParams.get('ts')) u.searchParams.set('ts', String(Date.now()));
      location.href = u.toString();
    }

    document.getElementById('btnPC')?.addEventListener('click', ()=>go('pc'));
    document.getElementById('btnMobile')?.addEventListener('click', ()=>go('mobile'));
    document.getElementById('btnCardboard')?.addEventListener('click', ()=>go('cardboard'));
    document.getElementById('btnCVR')?.addEventListener('click', ()=>go('cvr'));

    // If already has view=..., hide overlay + start
    const view = String(qs('view','')).toLowerCase();
    if (view){
      document.getElementById('startOverlay')?.classList.add('hide');
      applyView(view);
      window.dispatchEvent(new CustomEvent('hha:start'));
    } else {
      // default pre-view for nice layout
      applyView('pc');
    }
  })();
  </script>

  <!-- Loader (imports hydration.safe.js) -->
  <script src="./hydration-vr.loader.js"></script>
</body>
</html>