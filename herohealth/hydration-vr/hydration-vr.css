/* === PATCH: HydrationVR HUD Responsive (Mobile-first, no-block playfield) === */
/* Goals:
   ✅ Mobile: HUD ไม่บัง gameplay (ย่อ/พับได้)
   ✅ Quest panel เลื่อนเป็นแถบล่าง (compact) + พับได้
   ✅ Water panel ไม่ลอยซ้อน และไม่กินจอ
   ✅ Safe-area รองรับ notch/homebar
*/

:root{
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  --hud-gap: 10px;
  --hud-pad: 12px;
  --hud-radius: 18px;
  --hud-bg: rgba(2,6,23,.55);
  --hud-stroke: rgba(148,163,184,.18);
  --hud-shadow: 0 18px 70px rgba(0,0,0,.35);

  --hud-maxw: 560px;
  --hud-side: clamp(260px, 30vw, 360px);

  /* Mobile compaction */
  --mob-topH: 64px;     /* แถบ stats บน */
  --mob-bottomH: 118px; /* แถบ quest+water ล่าง */
}

/* ถ้ามี wrapper HUD หลักอยู่แล้ว ใช้ได้เลย
   ถ้า id/class ไม่ตรง ไม่เป็นไร—คุณค่อย map ให้ตรงในไฟล์ของคุณ */
.hha-card,
.hud-card,
#hud .card,
#hud .panel{
  border-radius: var(--hud-radius);
  border:1px solid var(--hud-stroke);
  background: var(--hud-bg);
  box-shadow: var(--hud-shadow);
  backdrop-filter: blur(10px);
}

/* -------- Playfield priority -------- */
#playfield, #cbPlayfield{
  position: relative;
  width: 100%;
  height: 100%;
  touch-action: manipulation;
  overflow: hidden;
}

/* -------- Desktop default: keep your current layout (don't break) -------- */
/* เราจะ “เพิ่ม” กฎเฉพาะ Mobile เท่านั้น */
@media (max-width: 560px){

  /* ให้พื้นที่เล่นเต็มจอจริง ๆ */
  body{
    padding-top: var(--sat);
    padding-bottom: var(--sab);
  }

  /* ซ่อนสิ่งที่กินพื้นที่เกินจำเป็น (ถ้ามี) */
  .desktop-only{ display:none !important; }

  /* ---------- TOP STATS BAR (compact) ---------- */
  #hudTop,
  #hud-top,
  .hud-top{
    position: fixed;
    left: calc(10px + var(--sal));
    right: calc(10px + var(--sar));
    top: calc(10px + var(--sat));
    z-index: 70;
    height: var(--mob-topH);
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr; /* Score/Combo/Time/Miss */
    gap: 8px;
    pointer-events: none; /* ไม่ให้บังการยิง */
  }

  /* บล็อกสถิติแต่ละอัน (ถ้าใช้ class เดิมของคุณอยู่แล้วไม่เป็นไร) */
  .stat-pill, .hud-pill, .statBox{
    height: var(--mob-topH);
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding: 10px 12px;
    gap: 10px;
    pointer-events: none;
  }
  .stat-pill .label, .hud-pill .label, .statBox .label{
    font-size: 12px;
    opacity: .78;
    font-weight: 700;
  }
  .stat-pill .val, .hud-pill .val, .statBox .val{
    font-size: 18px;
    font-weight: 900;
    letter-spacing: .2px;
  }

  /* ให้ Grade อยู่ในแถบเดียวกัน (ถ้าของคุณเป็นกล่องแยก) */
  #gradeBox, .gradeBox{ display:none !important; }
  #stat-grade{ font-weight: 900; }

  /* ---------- BOTTOM QUEST+WATER BAR (compact) ---------- */
  #hudBottom,
  #hud-bottom,
  .hud-bottom{
    position: fixed;
    left: calc(10px + var(--sal));
    right: calc(10px + var(--sar));
    bottom: calc(10px + var(--sab));
    z-index: 70;
    display: grid;
    grid-template-columns: 1.2fr .8fr; /* quest | water */
    gap: 10px;
    pointer-events: auto; /* allow toggle tap */
  }

  /* Quest compact */
  #questPanel, .quest-panel{
    min-height: var(--mob-bottomH);
    max-height: 38vh;
    overflow: hidden;
    padding: 10px 12px;
  }
  #questPanel .title, .quest-panel .title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 8px;
    font-weight: 900;
    font-size: 14px;
    margin-bottom: 6px;
  }
  #questLines, .quest-lines{
    font-size: 12px;
    line-height: 1.35;
    opacity: .96;
  }
  #questLines .muted, .quest-lines .muted{ opacity:.72; }

  /* Water compact */
  #waterPanel, .water-panel{
    min-height: var(--mob-bottomH);
    padding: 10px 12px;
  }
  #waterPanel .waterRow, .water-panel .waterRow{
    display:flex;
    justify-content:space-between;
    align-items:baseline;
    gap: 8px;
  }
  #waterPanel .waterRow .t{ font-weight:900; font-size:14px; }
  #waterPanel .waterRow .p{ font-weight:900; font-size:18px; }
  #waterPanel .barWrap, .water-panel .barWrap{
    margin-top: 8px;
    height: 10px;
    border-radius: 999px;
    overflow: hidden;
    border: 1px solid rgba(148,163,184,.14);
    background: rgba(148,163,184,.16);
  }
  #waterPanel #water-bar, .water-panel #water-bar{ height:100%; border-radius:999px; }

  /* ---------- COLLAPSE MODE: one-tap hide quest details ---------- */
  body.hud-collapsed #questPanel,
  body.hud-collapsed .quest-panel{
    max-height: 62px;
  }
  body.hud-collapsed #questLines,
  body.hud-collapsed .quest-lines{
    display:none !important;
  }

  /* ปุ่ม toggle (เล็ก, แตะง่าย) */
  #btnQuestToggle{
    pointer-events: auto;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    height: 34px;
    padding: 0 10px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,.18);
    background: rgba(15,23,42,.55);
    color: rgba(226,232,240,.95);
    font-weight: 900;
    font-size: 12px;
    gap: 6px;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }
}

/* -------- cVR/Cardboard: HUD clicks shouldn't block shots -------- */
body.view-cvr #hudTop,
body.view-cvr #hud-top,
body.view-cvr .hud-top{
  pointer-events:none !important;
}
body.view-cvr #hudBottom,
body.view-cvr #hud-bottom,
body.view-cvr .hud-bottom{
  pointer-events:auto; /* เฉพาะปุ่ม toggle/back */
}

/* ถ้ามี water panel ของหน้าเกมอยู่แล้ว ให้ “ประกาศ” ว่านี่คือของหน้า */
#waterPanel, .water-panel{
  /* marker for ui-water.js pageAlreadyHasWaterPanel() */
}