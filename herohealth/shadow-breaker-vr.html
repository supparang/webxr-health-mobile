<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Shadow Breaker (Launcher)</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg:#020617; --panel:rgba(2,6,23,.72); --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8; --accent:#a78bfa;
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 20% 20%, rgba(167,139,250,.16), transparent 55%),
        radial-gradient(1000px 650px at 80% 30%, rgba(34,211,238,.10), transparent 60%),
        linear-gradient(180deg, #020617, #0b1226);
      padding: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .card{
      width:min(680px, 92vw);
      background: rgba(2,6,23,.72);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .row{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .title{ margin:0; font-size:18px; letter-spacing:.2px; }
    .sub{ margin:6px 0 0 0; color:var(--muted); font-size:13px; line-height:1.45; }
    .pillrow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
    }
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn.primary{
      border-color: rgba(167,139,250,.35);
      background: rgba(167,139,250,.12);
    }
    .muted{ color: var(--muted); font-size:12px; margin-top:10px; }
    code{ color:#c7d2fe; }
  </style>
</head>

<body>
  <div class="card">
    <div class="row">
      <div>
        <h1 class="title">ü•ä Shadow Breaker ‚Äî Launcher</h1>
        <p class="sub">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‚Ä¶ (‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á <code>hub=</code> ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö Hub ‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠)</p>
      </div>
      <div class="pill" id="viewPill">view: ‚Äî</div>
    </div>

    <div class="pillrow" id="pillrow"></div>

    <div class="btnrow">
      <div class="btn primary" id="btnGo">‚ñ∂Ô∏è Tap-to-Start</div>
      <div class="btn" id="btnCopy">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</div>
      <div class="btn" id="btnBack">üè´ ‡∏Å‡∏•‡∏±‡∏ö Hub</div>
    </div>

    <div class="muted" id="hint">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏Å‡∏î <b>Tap-to-Start</b> (‡∏ö‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å redirect ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</div>
  </div>

<script>
(function(){
  'use strict';

  // Target run page (outside /herohealth)
  const TARGET = '../fitness/shadow-breaker.html';

  const $ = (s)=>document.querySelector(s);

  function hubUrl(){
    return location.href.split('#')[0];
  }

  function parseQS(){
    try { return new URL(hubUrl()).searchParams; }
    catch { return new URLSearchParams(); }
  }

  function detectView(){
    const q = parseQS();
    const v = (q.get('view') || '').toLowerCase();
    if (v) return v; // do not override

    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua) || (Math.min(screen.width, screen.height) <= 480);
    return isMobile ? 'mobile' : 'pc';
  }

  function buildTargetUrl(){
    const base = new URL(TARGET, location.href);
    const cur = parseQS();

    // pass-through all params (EXCEPT hub=) as-is
    for (const [k,v] of cur.entries()){
      if (k === 'hub') continue;
      base.searchParams.set(k, v);
    }

    // set view only if missing
    if (!cur.has('view') || String(cur.get('view')||'').trim() === ''){
      base.searchParams.set('view', detectView());
    }

    // always set hub back to this hub page (canonical)
    base.searchParams.set('hub', hubUrl());

    return base.toString();
  }

  function renderPills(url){
    const u = new URL(url);
    const pills = [];
    const keep = ['pid','run','diff','time','seed','studyId','phase','conditionGroup','log','view'];
    keep.forEach(k=>{
      const v = u.searchParams.get(k);
      if (v && String(v).trim() !== '') pills.push(`${k}: ${v}`);
    });

    $('#viewPill').textContent = 'view: ' + (u.searchParams.get('view') || detectView() || '‚Äî');

    const row = $('#pillrow');
    row.innerHTML = pills.length
      ? pills.slice(0, 14).map(t=>`<span class="pill">${t.replace(/</g,'&lt;')}</span>`).join('')
      : `<span class="pill">params: none</span>`;
  }

  const finalUrl = buildTargetUrl();
  renderPills(finalUrl);

  $('#btnGo').addEventListener('click', ()=> location.href = finalUrl);
  $('#btnCopy').addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(finalUrl); $('#hint').textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ'; }
    catch { $('#hint').textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå'; }
  });
  $('#btnBack').addEventListener('click', ()=>{
    const back = new URL('./hub.html', location.href);
    const cur = parseQS();
    for (const [k,v] of cur.entries()){
      if (k === 'hub') continue;
      back.searchParams.set(k, v);
    }
    location.href = back.toString();
  });

  // auto redirect (with tiny delay to allow UI paint)
  setTimeout(()=> { try { location.replace(finalUrl); } catch { location.href = finalUrl; } }, 120);

})();
</script>
</body>
</html>
