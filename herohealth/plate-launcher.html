<!-- ======================================================
  /herohealth/plate-launcher.html
  Balanced Plate VR ‚Äî LAUNCHER (A1)
  ‚úÖ Auto-detect view, but NEVER override if ?view= exists
  ‚úÖ Redirect -> ./plate/plate-vr.html
  ‚úÖ Pass-through all query params
====================================================== -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî PlateVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    html,body{
      margin:0; width:100%; height:100%;
      background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, "Noto Sans Thai", Segoe UI, Roboto, sans-serif;
      overflow:hidden;
    }
    .wrap{
      position:fixed; inset:0;
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      display:grid; place-items:center;
      background:
        radial-gradient(circle at 12% 10%, rgba(34,211,238,.10), transparent 40%),
        radial-gradient(circle at 88% 20%, rgba(167,139,250,.08), transparent 42%),
        radial-gradient(circle at 50% 92%, rgba(34,197,94,.10), transparent 48%),
        linear-gradient(180deg, rgba(2,6,23,.98), rgba(2,6,23,1));
    }
    .card{
      width:min(780px, 100%);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:22px;
      padding:16px;
      box-shadow: 0 26px 90px rgba(0,0,0,.42);
      backdrop-filter: blur(10px);
    }
    .title{
      font-weight:1200;
      font-size:18px;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .muted{ color:var(--muted); font-weight:900; font-size:13px; line-height:1.35; margin-top:8px; }
    .row{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:10px 14px;
      font-weight:1000;
      font-size:12px;
      cursor:pointer;
      color: rgba(229,231,235,.95);
      background: rgba(2,6,23,.70);
      border:1px solid rgba(148,163,184,.22);
      box-shadow: 0 16px 40px rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .btn.primary{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }
    .dbg{
      margin-top:10px;
      font-weight:900;
      font-size:12px;
      color: rgba(148,163,184,.95);
      word-break: break-all;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title">üçΩÔ∏è Balanced Plate VR <span style="opacity:.7">‚Äî Launcher</span></div>
      <div class="muted" id="msg">
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‚Ä¶
        <br/>* ‡∏ñ‡πâ‡∏≤ URL ‡∏°‡∏µ <b>?view=...</b> ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà override
      </div>

      <div class="row">
        <button class="btn primary" id="btnGo" type="button">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚ñ∂</button>
        <button class="btn" id="btnCopy" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå üîó</button>
      </div>

      <div class="dbg" id="dbg"></div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const qs = (k, def=null)=>{
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  };

  function isTouch(){
    return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
  }

  function isProbablyMobile(){
    const ua = navigator.userAgent || '';
    if (/Android|iPhone|iPad|iPod/i.test(ua)) return true;
    if (isTouch() && (innerWidth < 920)) return true;
    return false;
  }

  function getAutoView(){
    // IMPORTANT: do NOT override if caller already set ?view=
    const forced = (qs('view','') || '').toLowerCase();
    if (forced) return forced;

    // if user used Cardboard viewer link pattern sometimes:
    const hint = (qs('cvr','') || '').toLowerCase();
    if (hint === '1' || hint === 'true') return 'cvr';

    return isProbablyMobile() ? 'mobile' : 'pc';
  }

  function safeSetLS(k,v){
    try{ localStorage.setItem(k, String(v)); }catch(_){}
  }
  function safeGetLS(k){
    try{ return localStorage.getItem(k); }catch(_){ return null; }
  }

  // optional: remember last view if not forced by url
  const REMEMBER_LAST_VIEW = true;

  function buildTargetUrl(){
    const base = new URL('./plate/plate-vr.html', location.href);

    // copy all query params as-is
    const src = new URL(location.href);
    src.searchParams.forEach((v,k)=> base.searchParams.set(k, v));

    // decide view
    const hasView = src.searchParams.has('view') && String(src.searchParams.get('view')||'').length>0;
    let view = getAutoView();

    // if remember last view and no forced view, use it
    if(REMEMBER_LAST_VIEW && !hasView){
      const last = (safeGetLS('HHA_PLATE_LAST_VIEW') || '').toLowerCase();
      if(last) view = last;
    }

    // only set view if not already provided (NO OVERRIDE)
    if(!hasView) base.searchParams.set('view', view);

    // store last view (only when not forced)
    if(REMEMBER_LAST_VIEW && !hasView){
      safeSetLS('HHA_PLATE_LAST_VIEW', view);
    }

    // if seed missing -> set deterministic default
    if(!base.searchParams.get('seed')){
      base.searchParams.set('seed', String(Date.now()));
    }

    // if time missing -> default 90
    if(!base.searchParams.get('time')){
      base.searchParams.set('time', '90');
    }

    return base.toString();
  }

  const dbg = document.getElementById('dbg');
  const btnGo = document.getElementById('btnGo');
  const btnCopy = document.getElementById('btnCopy');

  const target = buildTargetUrl();
  if(dbg) dbg.textContent = '‚û°Ô∏è ' + target;

  function go(){
    location.replace(target);
  }

  btnGo?.addEventListener('click', go, {passive:true});

  btnCopy?.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(target);
      if(dbg) dbg.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß: ' + target;
    }catch(_){
      if(dbg) dbg.textContent = '‚ö†Ô∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö URL ‡πÑ‡∏î‡πâ\n' + target;
    }
  }, {passive:true});

  // auto redirect (fast)
  setTimeout(go, 250);

})();
</script>
</body>
</html>