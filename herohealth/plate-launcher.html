<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî PlateVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;

      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --violet:#a78bfa;

      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{
      margin:0; height:100%; width:100%;
      overflow:hidden;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"Noto Sans Thai","Segoe UI",Roboto,sans-serif;
    }

    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 12% 10%, rgba(34,211,238,.12), transparent 40%),
        radial-gradient(circle at 88% 20%, rgba(167,139,250,.10), transparent 42%),
        radial-gradient(circle at 50% 92%, rgba(34,197,94,.10), transparent 48%),
        linear-gradient(180deg, rgba(2,6,23,.98), rgba(2,6,23,1));
      pointer-events:none;
    }

    .wrap{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
    }

    .card{
      width:min(980px, 100%);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow: 0 26px 90px rgba(0,0,0,.42);
      padding:16px;
      backdrop-filter: blur(10px);
    }

    .top{
      display:flex;
      gap:12px;
      justify-content:space-between;
      flex-wrap:wrap;
      align-items:flex-start;
    }

    .title{
      font-weight:1200;
      font-size:18px;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      color:var(--muted);
      font-weight:900;
      line-height:1.35;
      font-size:13px;
      max-width:720px;
    }

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px;
      border-radius:var(--pill);
      border:1px solid rgba(148,163,184,.18);
      background:rgba(15,23,42,.58);
      font-weight:1000;
      font-size:12px;
      white-space:nowrap;
    }

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    .panel{
      background:var(--panel2);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
    }

    .k{ font-weight:1100; font-size:12px; color:rgba(229,231,235,.92); }
    .v{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }

    .btnRow{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:11px 14px;
      background:rgba(2,6,23,.72);
      border:1px solid rgba(148,163,184,.20);
      color:rgba(229,231,235,.95);
      font: 1000 12px/1 system-ui,-apple-system,"Noto Sans Thai","Segoe UI",Roboto,sans-serif;
      box-shadow: 0 16px 40px rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background:rgba(34,197,94,.14); border-color:rgba(34,197,94,.32); }
    .btn.warn{ background:rgba(245,158,11,.14); border-color:rgba(245,158,11,.32); }
    .btn.ghost{ background:rgba(15,23,42,.40); }

    .muted{ color:var(--muted); font-weight:900; }

    .note{
      margin-top:10px;
      color:rgba(148,163,184,.95);
      font-weight:900;
      font-size:12px;
      line-height:1.35;
    }

    code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      color: rgba(229,231,235,.95);
      background: rgba(2,6,23,.55);
      border: 1px solid rgba(148,163,184,.14);
      border-radius: 12px;
      padding: 2px 8px;
    }

    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="bg"></div>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <div class="title">üçΩÔ∏è Balanced Plate VR ‚Äî Launcher</div>
          <div class="sub">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ <b>‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</b> ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π)
            <br/>
            <span class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô Cardboard ‡πÉ‡∏´‡πâ‡∏Å‡∏î ENTER VR ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end">
          <span class="pill">üß≠ View: <b id="uiView">‚Äî</b></span>
          <span class="pill">üéÆ Mode: <b id="uiRun">‚Äî</b></span>
          <span class="pill">‚öôÔ∏è Diff: <b id="uiDiff">‚Äî</b></span>
          <span class="pill">‚è±Ô∏è Time: <b id="uiTime">‚Äî</b>s</span>
        </div>
      </div>

      <div class="grid">
        <div class="panel">
          <div class="k">‚úÖ ‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà</div>
          <div class="v">
            <span class="pill">‚ñ∂ <b id="uiNext">plate-vr.html</b></span>
            <span class="pill">üîë Seed <b id="uiSeed">‚Äî</b></span>
          </div>

          <div class="note">
            ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á: <code id="uiUrl">‚Äî</code>
          </div>

          <div class="btnRow">
            <button class="btn primary" id="btnGo" type="button">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
            <button class="btn warn" id="btnGoStudy" type="button" title="Study/Research = Seeded + Adaptive OFF">üìö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î Study</button>
            <button class="btn ghost" id="btnCopy" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå üîó</button>
          </div>

          <div class="note" id="uiDbg">‚Äî</div>
        </div>

        <div class="panel">
          <div class="k">üí° Tips</div>
          <div class="note">
            ‚Ä¢ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ / ‡∏ñ‡πâ‡∏≤ <b>view=cvr</b> ‡∏à‡∏∞‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair (‡∏ú‡πà‡∏≤‡∏ô <b>vr-ui.js</b>)<br/>
            ‚Ä¢ Cardboard: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î <b>üï∂ ENTER VR</b> (‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô HUD)<br/>
            ‚Ä¢ Play: Adaptive ON ‚Ä¢ Study: Seeded & Adaptive OFF
          </div>

          <div class="btnRow" style="margin-top:12px">
            <button class="btn" id="btnBackHub" type="button">üè† ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
            <button class="btn ghost" id="btnReload" type="button">‚Üª Refresh Detect</button>
          </div>

          <div class="note" style="margin-top:10px">
            Query ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: <code>hub</code> <code>run</code> <code>diff</code> <code>time</code> <code>seed</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const URLX = new URL(location.href);

      const qs = (k, d=null)=>{ try{ return URLX.searchParams.get(k) ?? d; }catch(e){ return d; } };
      const clamp = (v,a,b)=>{ v=Number(v)||0; return v<a?a:(v>b?b:v); };

      const hub = qs('hub','');
      const runRaw = String(qs('run', qs('runMode','play')) || 'play').toLowerCase();
      const diff = String(qs('diff','normal')).toLowerCase();
      const time = clamp(qs('time', 90), 20, 9999);

      const isStudy = (runRaw === 'study' || runRaw === 'research');
      const runMode = isStudy ? 'study' : 'play';

      // seed: if provided keep; otherwise deterministic for study, random for play
      const seedParam = qs('seed', null);
      const DEFAULT_STUDY_SEED = 13579;
      const seed =
        (seedParam != null)
          ? (Number(seedParam)||DEFAULT_STUDY_SEED)
          : (isStudy ? DEFAULT_STUDY_SEED : (Date.now() ^ (Math.random()*1e9)));

      // --- Auto detect view (NO manual override UI) ---
      function isMobileUA(){
        const ua = navigator.userAgent || '';
        return /Android|iPhone|iPad|iPod/i.test(ua);
      }
      function isStandaloneLike(){
        // PWA / fullscreen-ish signals
        const mq = (q)=>{ try{ return window.matchMedia && window.matchMedia(q).matches; }catch(e){ return false; } };
        const nav = navigator || {};
        return !!(mq('(display-mode: standalone)') || mq('(display-mode: fullscreen)') || nav.standalone);
      }
      function isWebXRCapable(){
        // best effort: if WebXR exists, assume can enter VR on compatible device/browser
        return !!(navigator.xr);
      }

      function detectView(){
        // Rules:
        // - Desktop -> pc
        // - Mobile -> mobile by default
        // - Mobile + (standalone/fullscreen-ish) + WebXR present -> prefer cvr
        if(!isMobileUA()) return 'pc';
        if(isWebXRCapable() && isStandaloneLike()) return 'cvr';
        return 'mobile';
      }

      const view = detectView();

      // build target url
      const target = new URL('./plate-vr.html', location.href);
      if(hub) target.searchParams.set('hub', hub);
      target.searchParams.set('run', runMode);
      target.searchParams.set('diff', diff);
      target.searchParams.set('time', String(time));
      target.searchParams.set('seed', String(seed));
      target.searchParams.set('view', view);

      // UI bind
      const setText = (id, txt)=>{
        const el = document.getElementById(id);
        if(el) el.textContent = String(txt);
      };
      setText('uiView', view);
      setText('uiRun', runMode);
      setText('uiDiff', diff);
      setText('uiTime', time);
      setText('uiSeed', seed);
      setText('uiUrl', target.toString());

      const dbg = document.getElementById('uiDbg');
      if(dbg){
        const ua = navigator.userAgent || '';
        dbg.textContent =
          'Detect: ' + view +
          ' ‚Ä¢ WebXR: ' + (isWebXRCapable() ? 'yes' : 'no') +
          ' ‚Ä¢ Standalone: ' + (isStandaloneLike() ? 'yes' : 'no') +
          ' ‚Ä¢ UA: ' + ua.slice(0, 64) + (ua.length>64?'‚Ä¶':'');
      }

      // actions
      document.getElementById('btnGo')?.addEventListener('click', ()=>{
        location.href = target.toString();
      }, {passive:true});

      document.getElementById('btnGoStudy')?.addEventListener('click', ()=>{
        const u = new URL(target.toString());
        u.searchParams.set('run', 'study');
        // if no seedParam originally, enforce deterministic seed for study
        if(seedParam == null) u.searchParams.set('seed', String(DEFAULT_STUDY_SEED));
        location.href = u.toString();
      }, {passive:true});

      document.getElementById('btnCopy')?.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(target.toString());
          if(dbg) dbg.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß';
        }catch(e){
          if(dbg) dbg.textContent = '‚ö†Ô∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î URL ‡πÑ‡∏î‡πâ';
        }
      }, {passive:true});

      document.getElementById('btnBackHub')?.addEventListener('click', ()=>{
        if(hub){
          location.href = hub;
        }else{
          location.href = './hub.html';
        }
      }, {passive:true});

      document.getElementById('btnReload')?.addEventListener('click', ()=>{
        location.reload();
      }, {passive:true});
    })();
  </script>
</body>
</html>