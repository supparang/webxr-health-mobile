<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Balanced Plate VR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --violet:#a78bfa;

      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{
      margin:0; width:100%; height:100%;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Noto Sans Thai", Segoe UI, Roboto, sans-serif;
    }
    body{
      overflow:auto;
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      background:
        radial-gradient(circle at 12% 10%, rgba(34,211,238,.12), transparent 42%),
        radial-gradient(circle at 88% 18%, rgba(167,139,250,.11), transparent 45%),
        radial-gradient(circle at 50% 92%, rgba(34,197,94,.10), transparent 52%),
        linear-gradient(180deg, rgba(2,6,23,.98), rgba(2,6,23,1));
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
    }

    .hero{
      display:flex;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      align-items:flex-start;
      margin-bottom: 12px;
    }
    .title{
      font-weight: 1200;
      font-size: 22px;
      letter-spacing: .2px;
    }
    .sub{
      margin-top:6px;
      color: var(--muted);
      font-weight: 900;
      line-height: 1.4;
      font-size: 13px;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:7px 12px;
      border-radius: var(--pill);
      border:1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.55);
      backdrop-filter: blur(10px);
      font-weight: 1000;
      font-size: 12px;
      white-space: nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:12px;
      margin-top: 12px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 22px 80px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }

    .h{
      font-weight: 1100;
      font-size: 13px;
      color: rgba(229,231,235,.95);
    }
    .row{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    label{
      font-weight: 1000;
      font-size: 12px;
      color: rgba(229,231,235,.92);
    }
    select, input{
      appearance:none;
      border:1px solid rgba(148,163,184,.20);
      background: rgba(15,23,42,.55);
      color: rgba(229,231,235,.95);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 1000;
      font-size: 12px;
      outline:none;
      min-width: 160px;
    }
    input[type="number"]{ min-width: 120px; }

    .btnbar{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:none;
      border-radius: var(--pill);
      padding: 12px 14px;
      background: rgba(2,6,23,.65);
      border:1px solid rgba(148,163,184,.22);
      color: rgba(229,231,235,.95);
      font: 1100 12px/1 system-ui, -apple-system, "Noto Sans Thai", Segoe UI, Roboto, sans-serif;
      box-shadow: 0 18px 50px rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: rgba(34,197,94,.14);
      border-color: rgba(34,197,94,.32);
    }
    .btn.cyan{
      background: rgba(34,211,238,.12);
      border-color: rgba(34,211,238,.30);
    }
    .btn.warn{
      background: rgba(245,158,11,.14);
      border-color: rgba(245,158,11,.30);
    }
    .btn.bad{
      background: rgba(239,68,68,.12);
      border-color: rgba(239,68,68,.28);
    }

    .note{
      margin-top: 10px;
      color: rgba(148,163,184,.95);
      font-weight: 900;
      font-size: 12px;
      line-height: 1.45;
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: rgba(148,163,184,.95);
      background: rgba(15,23,42,.35);
      border: 1px solid rgba(148,163,184,.14);
      padding: 10px 12px;
      border-radius: 16px;
      overflow:auto;
      white-space: pre-wrap;
      word-break: break-word;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <div class="title">üçΩÔ∏è Balanced Plate VR ‚Äî Launcher</div>
        <div class="sub">
          ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ ‚Äú‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‚Äù ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß ‡πÜ <br/>
          Play = Adaptive ON ‚Ä¢ Study = Seeded & Adaptive OFF (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏à‡∏±‡∏¢)
        </div>
      </div>
      <div class="row">
        <span class="pill">üß≠ Run: <b id="pRun">‚Äî</b></span>
        <span class="pill">‚öô Diff: <b id="pDiff">‚Äî</b></span>
        <span class="pill">‚è± Time: <b id="pTime">‚Äî</b>s</span>
        <span class="pill">üëÄ View: <b id="pView">‚Äî</b></span>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: SETTINGS -->
      <div class="card">
        <div class="h">‚öô ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>

        <div class="row">
          <label for="runSel">Run mode</label>
          <select id="runSel">
            <option value="play">play (Adaptive ON)</option>
            <option value="study">study (Seeded & Adaptive OFF)</option>
          </select>

          <label for="diffSel">Difficulty</label>
          <select id="diffSel">
            <option value="easy">easy</option>
            <option value="normal" selected>normal</option>
            <option value="hard">hard</option>
          </select>
        </div>

        <div class="row">
          <label for="timeSel">Time (sec)</label>
          <input id="timeSel" type="number" min="20" max="9999" step="5" value="90" />

          <label for="seedSel">Seed</label>
          <input id="seedSel" type="number" step="1" placeholder="(auto)" />
        </div>

        <div class="row">
          <label for="viewSel">View</label>
          <select id="viewSel">
            <option value="auto" selected>auto (‡πÑ‡∏°‡πà override ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ view ‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå)</option>
            <option value="pc">pc</option>
            <option value="mobile">mobile</option>
            <option value="vr">vr</option>
            <option value="cvr">cvr (Cardboard ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair)</option>
          </select>
        </div>

        <div class="btnbar">
          <button class="btn primary" id="btnGoPlay" type="button">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Play)</button>
          <button class="btn warn" id="btnGoStudy" type="button">üß™ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Study)</button>
          <button class="btn cyan" id="btnGoCVR" type="button">üì¶ Cardboard (cVR)</button>
          <button class="btn" id="btnGoVR" type="button">üï∂ Enter VR</button>
        </div>

        <div class="btnbar">
          <button class="btn" id="btnCopy" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå üîó</button>
          <button class="btn bad" id="btnReset" type="button">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ (Reset)</button>
          <button class="btn" id="btnBackHub" type="button">‡∏Å‡∏•‡∏±‡∏ö HUB üè†</button>
        </div>

        <div class="note">
          üí° Tip: ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Cardboard ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ <b>view=cvr</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair (vr-ui.js) <br/>
          üí° Study: ‡πÉ‡∏™‡πà seed ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ (deterministic)
        </div>
      </div>

      <!-- RIGHT: PREVIEW -->
      <div class="card">
        <div class="h">üîé Preview link</div>
        <div class="mono" id="preview">‚Äî</div>
        <div class="note" id="msg">‚Äî</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const LS = 'HHA_PLATE_LAUNCHER_PREFS';

      const runSel  = document.getElementById('runSel');
      const diffSel = document.getElementById('diffSel');
      const timeSel = document.getElementById('timeSel');
      const seedSel = document.getElementById('seedSel');
      const viewSel = document.getElementById('viewSel');

      const pRun  = document.getElementById('pRun');
      const pDiff = document.getElementById('pDiff');
      const pTime = document.getElementById('pTime');
      const pView = document.getElementById('pView');

      const preview = document.getElementById('preview');
      const msg = document.getElementById('msg');

      const btnGoPlay  = document.getElementById('btnGoPlay');
      const btnGoStudy = document.getElementById('btnGoStudy');
      const btnGoCVR   = document.getElementById('btnGoCVR');
      const btnGoVR    = document.getElementById('btnGoVR');

      const btnCopy = document.getElementById('btnCopy');
      const btnReset = document.getElementById('btnReset');
      const btnBackHub = document.getElementById('btnBackHub');

      function clamp(v, a, b){
        v = Number(v)||0;
        return v<a?a:(v>b?b:v);
      }

      function loadPrefs(){
        try{
          const s = localStorage.getItem(LS);
          if(!s) return null;
          return JSON.parse(s);
        }catch(e){ return null; }
      }
      function savePrefs(obj){
        try{ localStorage.setItem(LS, JSON.stringify(obj)); }catch(e){}
      }

      function hubFromUrl(){
        try{
          const u = new URL(location.href);
          return u.searchParams.get('hub') || '';
        }catch(e){ return ''; }
      }

      function autoView(){
        const ua = navigator.userAgent || '';
        const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
        return isMobile ? 'mobile' : 'pc';
      }

      function makeRunUrl(override){
        const base = new URL('./plate-vr.html', location.href);
        const hub = hubFromUrl();
        if(hub) base.searchParams.set('hub', hub);

        const run = (override && override.run) ? override.run : (runSel.value || 'play');
        const diff = (override && override.diff) ? override.diff : (diffSel.value || 'normal');
        const time = (override && override.time) ? override.time : clamp(timeSel.value || 90, 20, 9999);

        base.searchParams.set('run', run);
        base.searchParams.set('diff', diff);
        base.searchParams.set('time', String(time));

        // view policy: do not override if "auto"
        let view = (override && override.view) ? override.view : (viewSel.value || 'auto');
        if(view === 'auto'){
          // if user already has view in current URL, keep it out; otherwise set auto-detected
          try{
            const cur = new URL(location.href);
            const curV = (cur.searchParams.get('view')||'').toLowerCase();
            if(curV){
              // do nothing (no override)
            }else{
              base.searchParams.set('view', autoView());
            }
          }catch(e){
            base.searchParams.set('view', autoView());
          }
        }else{
          base.searchParams.set('view', view);
        }

        // seed:
        // - study default: if empty -> 13579
        // - play default: if empty -> omit (plate.safe.js will randomize)
        const seedRaw = String(seedSel.value || '').trim();
        if(seedRaw){
          base.searchParams.set('seed', seedRaw);
        }else{
          if(run === 'study'){
            base.searchParams.set('seed', '13579');
          }else{
            base.searchParams.delete('seed');
          }
        }

        return base;
      }

      function updatePreview(){
        const u = makeRunUrl();
        preview.textContent = u.toString();

        const run = runSel.value;
        const diff = diffSel.value;
        const time = clamp(timeSel.value || 90, 20, 9999);
        const view = (viewSel.value === 'auto') ? '(auto)' : viewSel.value;

        pRun.textContent = run;
        pDiff.textContent = diff;
        pTime.textContent = String(time);
        pView.textContent = viewSel.value === 'auto' ? autoView() + ' (auto)' : view;

        msg.textContent =
          (run === 'study')
            ? 'Study: seed ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‚Ä¢ Adaptive OFF'
            : 'Play: Adaptive ON ‚Ä¢ seed ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
      }

      function persist(){
        savePrefs({
          run: runSel.value,
          diff: diffSel.value,
          time: clamp(timeSel.value || 90, 20, 9999),
          seed: String(seedSel.value || '').trim(),
          view: viewSel.value
        });
      }

      function restore(){
        const p = loadPrefs();
        if(!p) return;
        if(p.run) runSel.value = p.run;
        if(p.diff) diffSel.value = p.diff;
        if(p.time) timeSel.value = p.time;
        if(typeof p.seed === 'string') seedSel.value = p.seed;
        if(p.view) viewSel.value = p.view;
      }

      function go(override){
        persist();
        const u = makeRunUrl(override);
        location.href = u.toString();
      }

      // events
      [runSel, diffSel, timeSel, seedSel, viewSel].forEach(el=>{
        el?.addEventListener('input', ()=>{ updatePreview(); }, {passive:true});
        el?.addEventListener('change', ()=>{ updatePreview(); }, {passive:true});
      });

      btnGoPlay?.addEventListener('click', ()=>{
        runSel.value = 'play';
        updatePreview();
        go({ run:'play' });
      }, {passive:true});

      btnGoStudy?.addEventListener('click', ()=>{
        runSel.value = 'study';
        updatePreview();
        go({ run:'study' });
      }, {passive:true});

      btnGoCVR?.addEventListener('click', ()=>{
        // Cardboard strict crosshair
        viewSel.value = 'cvr';
        updatePreview();
        go({ view:'cvr' });
      }, {passive:true});

      btnGoVR?.addEventListener('click', ()=>{
        // enter vr mode, but keep view=vr to help CSS (and user expectation)
        viewSel.value = 'vr';
        updatePreview();
        go({ view:'vr' });
      }, {passive:true});

      btnCopy?.addEventListener('click', async ()=>{
        try{
          const u = makeRunUrl().toString();
          await navigator.clipboard.writeText(u);
          msg.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß';
        }catch(e){
          msg.textContent = '‚ö†Ô∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Preview ‡πÑ‡∏î‡πâ';
        }
      }, {passive:true});

      btnReset?.addEventListener('click', ()=>{
        try{ localStorage.removeItem(LS); }catch(e){}
        runSel.value = 'play';
        diffSel.value = 'normal';
        timeSel.value = 90;
        seedSel.value = '';
        viewSel.value = 'auto';
        updatePreview();
        msg.textContent = 'üßπ Reset ‡πÅ‡∏•‡πâ‡∏ß';
      }, {passive:true});

      btnBackHub?.addEventListener('click', ()=>{
        const hub = hubFromUrl();
        if(hub) location.href = hub;
        else location.href = './hub.html';
      }, {passive:true});

      // init
      restore();
      updatePreview();
    })();
  </script>
</body>
</html>