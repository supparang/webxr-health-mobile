<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî PlateVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --cyan:#22d3ee;
      --violet:#a78bfa;
      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{
      margin:0; width:100%; height:100%;
      background: radial-gradient(circle at 15% 10%, rgba(34,211,238,.12), transparent 40%),
                  radial-gradient(circle at 85% 20%, rgba(167,139,250,.10), transparent 42%),
                  radial-gradient(circle at 50% 92%, rgba(34,197,94,.10), transparent 48%),
                  linear-gradient(180deg, rgba(2,6,23,.98), rgba(2,6,23,1));
      color:var(--text);
      font-family: system-ui,-apple-system,"Noto Sans Thai",Segoe UI,Roboto,sans-serif;
      overflow:hidden;
    }
    .wrap{
      position:fixed; inset:0;
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      display:grid;
      place-items:center;
    }
    .card{
      width:min(980px,100%);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: 0 26px 90px rgba(0,0,0,.42);
      backdrop-filter: blur(12px);
    }
    .row{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    h1{
      margin:0;
      font-size:18px;
      font-weight:1200;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      color:var(--muted);
      font-weight:900;
      font-size:13px;
      line-height:1.35;
    }
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    .panel{
      background:var(--panel2);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
      box-shadow: 0 16px 50px rgba(0,0,0,.25);
    }
    .t{
      font-weight:1100;
      font-size:12px;
      color:rgba(229,231,235,.92);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:var(--pill);
      border:1px solid var(--stroke);
      background:rgba(2,6,23,.40);
      font-weight:1000;
      font-size:12px;
      white-space:nowrap;
    }
    .chips{
      margin-top:10px;
      display:flex; flex-wrap:wrap; gap:10px;
    }
    select,input{
      appearance:none;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(2,6,23,.35);
      color:rgba(229,231,235,.95);
      border-radius:12px;
      padding:10px 10px;
      font-weight:900;
      font-size:13px;
      outline:none;
    }
    .form{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .form .full{ grid-column: 1 / -1; }
    .btns{
      margin-top:14px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    button{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:11px 14px;
      background:rgba(2,6,23,.60);
      border:1px solid rgba(148,163,184,.22);
      color:rgba(229,231,235,.95);
      font: 1000 13px/1 system-ui,-apple-system,"Noto Sans Thai",Segoe UI,Roboto,sans-serif;
      box-shadow: 0 16px 40px rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }
    button.primary{
      background:rgba(34,197,94,.18);
      border-color:rgba(34,197,94,.35);
    }
    button.warn{
      background:rgba(245,158,11,.18);
      border-color:rgba(245,158,11,.35);
    }
    button.cvr{
      background:rgba(34,211,238,.16);
      border-color:rgba(34,211,238,.32);
    }
    button:active{ transform: translateY(1px); }

    .miniNote{
      margin-top:10px;
      color:var(--muted);
      font-weight:900;
      font-size:12px;
      line-height:1.35;
    }

    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      .form{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div>
          <h1>üçΩÔ∏è Balanced Plate VR ‚Äî Launcher</h1>
          <div class="sub">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å/‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ<br/>
            Play = Adaptive ON ‚Ä¢ Research/Study = Seeded & Adaptive OFF
          </div>
        </div>
        <div class="chips">
          <span class="pill" id="pillView">üëÄ view: auto</span>
          <span class="pill" id="pillHub">üè† hub: ‚Äî</span>
        </div>
      </div>

      <div class="grid">
        <div class="panel">
          <div class="t">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏ô</div>

          <div class="form">
            <label>
              <div class="t">‡πÇ‡∏´‡∏°‡∏î (run)</div>
              <select id="selRun">
                <option value="play">play</option>
                <option value="study">study</option>
                <option value="research">research</option>
                <option value="practice">practice</option>
              </select>
            </label>

            <label>
              <div class="t">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (diff)</div>
              <select id="selDiff">
                <option value="easy">easy</option>
                <option value="normal" selected>normal</option>
                <option value="hard">hard</option>
              </select>
            </label>

            <label>
              <div class="t">‡πÄ‡∏ß‡∏•‡∏≤ (sec)</div>
              <input id="inpTime" type="number" inputmode="numeric" min="10" max="999" value="90" />
            </label>

            <label>
              <div class="t">seed</div>
              <input id="inpSeed" type="number" inputmode="numeric" value="" placeholder="auto" />
            </label>

            <label class="full">
              <div class="t">‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (optional passthrough)</div>
              <input id="inpStudy" type="text" placeholder="studyId / phase / conditionGroup / studentKey ... (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å URL ‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠)" />
            </label>
          </div>

          <div class="btns">
            <button class="primary" id="btnGo">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Auto view)</button>
            <button class="cvr" id="btnGoCVR">üï∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ö‡∏ö Cardboard (view=cvr)</button>
            <button class="warn" id="btnCopy">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
          </div>

          <div class="miniNote" id="dbg">‚Äî</div>
        </div>

        <div class="panel">
          <div class="t">üß≠ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡πá‡∏ß ‡πÜ</div>
          <div class="miniNote">
            ‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å HUB ‡∏à‡∏∞‡∏™‡πà‡∏á <b>hub=...</b> ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢<br/>
            ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á: <b>?view=pc|mobile|vr|cvr</b><br/>
            ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà: ‡πÉ‡∏ä‡πâ <b>run=study</b> ‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å <b>seed</b><br/>
            ‚Ä¢ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà: <b>/herohealth/plate/plate-vr.html</b>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    (function(){
      const LS_KEY = 'HHA_PLATE_LAUNCHER_V1';

      const qs = (k, def=null)=>{
        try { return new URL(location.href).searchParams.get(k) ?? def; }
        catch { return def; }
      };

      function isMobile(){
        const ua = navigator.userAgent || '';
        const touch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
        return /Android|iPhone|iPad|iPod/i.test(ua) || (touch && innerWidth < 920);
      }

      function getViewAuto(){
        const forced = (qs('view','')||'').toLowerCase();
        if(forced) return forced;
        return isMobile() ? 'mobile' : 'pc';
      }

      // UI refs
      const selRun = document.getElementById('selRun');
      const selDiff = document.getElementById('selDiff');
      const inpTime = document.getElementById('inpTime');
      const inpSeed = document.getElementById('inpSeed');
      const inpStudy = document.getElementById('inpStudy');

      const pillView = document.getElementById('pillView');
      const pillHub = document.getElementById('pillHub');
      const dbg = document.getElementById('dbg');

      const btnGo = document.getElementById('btnGo');
      const btnGoCVR = document.getElementById('btnGoCVR');
      const btnCopy = document.getElementById('btnCopy');

      const hub = qs('hub','') || '';
      if(pillHub) pillHub.textContent = 'üè† hub: ' + (hub ? 'yes' : '‚Äî');

      function loadSaved(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          if(!raw) return;
          const s = JSON.parse(raw);
          if(s.run) selRun.value = s.run;
          if(s.diff) selDiff.value = s.diff;
          if(s.time) inpTime.value = String(s.time);
          if(s.seed) inpSeed.value = String(s.seed);
        }catch(_){}
      }

      function saveNow(){
        try{
          localStorage.setItem(LS_KEY, JSON.stringify({
            run: selRun.value,
            diff: selDiff.value,
            time: Number(inpTime.value)||90,
            seed: inpSeed.value ? Number(inpSeed.value) : ''
          }));
        }catch(_){}
      }

      function collectPassthroughParams(u){
        // ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚Äú‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‚Äù ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á launcher
        const keep = [
          'hub','log','studyId','phase','conditionGroup','sessionOrder',
          'blockLabel','siteCode','schoolCode','schoolName','gradeLevel','studentKey'
        ];
        keep.forEach(k=>{
          const v = qs(k,'');
          if(v) u.searchParams.set(k, v);
        });
      }

      function buildUrl(viewOverride){
        const u = new URL('./plate-vr.html', location.href);
        u.searchParams.set('run', (selRun.value||'play').toLowerCase());
        u.searchParams.set('diff', (selDiff.value||'normal').toLowerCase());

        const t = Math.max(10, Math.min(999, Number(inpTime.value)||90));
        u.searchParams.set('time', String(t));

        const seed = inpSeed.value ? Number(inpSeed.value) : Date.now();
        u.searchParams.set('seed', String(seed));

        if(hub) u.searchParams.set('hub', hub);

        // view:
        const v = (viewOverride || '').toLowerCase() || getViewAuto();
        // ‡πÅ‡∏ï‡πà ‚Äú‡∏´‡πâ‡∏≤‡∏° override‚Äù ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ view ‡∏°‡∏≤‡∏Å‡∏±‡∏ö URL ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        const existing = (qs('view','')||'').toLowerCase();
        if(existing) u.searchParams.set('view', existing);
        else u.searchParams.set('view', v);

        collectPassthroughParams(u);

        return u.toString();
      }

      function refreshPills(){
        if(pillView) pillView.textContent = 'üëÄ view: ' + getViewAuto();
        if(dbg) dbg.textContent = 'URL: ' + location.href;
      }

      // seed default
      if(!inpSeed.value) inpSeed.value = '';

      loadSaved();
      refreshPills();

      [selRun, selDiff, inpTime, inpSeed].forEach(el=>{
        el?.addEventListener('change', saveNow, {passive:true});
        el?.addEventListener('input', saveNow, {passive:true});
      });

      btnGo?.addEventListener('click', ()=>{
        const url = buildUrl('');
        location.href = url;
      });

      btnGoCVR?.addEventListener('click', ()=>{
        const url = buildUrl('cvr');
        location.href = url;
      });

      btnCopy?.addEventListener('click', async ()=>{
        const url = buildUrl('');
        try{
          await navigator.clipboard.writeText(url);
          if(dbg) dbg.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß';
        }catch(e){
          if(dbg) dbg.textContent = '‚ö†Ô∏è ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö URL';
        }
      });

      // show suggested research params (read-only hint)
      const p = new URL(location.href).searchParams;
      const keys = ['studyId','phase','conditionGroup','sessionOrder','blockLabel','siteCode','schoolCode','schoolName','gradeLevel','studentKey'];
      const list = [];
      keys.forEach(k=>{
        const v = p.get(k);
        if(v) list.push(`${k}=${v}`);
      });
      if(inpStudy) inpStudy.value = list.join(' ‚Ä¢ ');
    })();
  </script>
</body>
</html>