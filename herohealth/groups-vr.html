<!-- === /herohealth/groups-vr.html ===
GroupsVR LAUNCHER — ROOT (Difficulty + Time)
✅ Select: Easy(60) / Normal(90) / Hard(120)
✅ Pass-through params: hub, log, run, seed, pid, studyId, phase, conditionGroup, style, view, etc.
✅ Does NOT force view override (keeps existing ?view= if user already passed it)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GroupsVR (Launcher)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(2,6,23,.72);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; width:100%; height:100%; background:var(--bg); color:var(--text);
      font-family: system-ui,-apple-system,"Noto Sans Thai","Segoe UI",Roboto,sans-serif; }
    body{ overflow:hidden; }
    .wrap{
      min-height:100vh;
      padding: calc(var(--sat) + 18px) calc(var(--sar) + 14px) calc(var(--sab) + 18px) calc(var(--sal) + 14px);
      display:flex; align-items:center; justify-content:center;
    }
    .card{
      width:min(820px, 100%);
      background: rgba(2,6,23,.78);
      border:1px solid rgba(148,163,184,.18);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.42);
      backdrop-filter: blur(12px);
    }
    .head{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
      padding: 6px 6px 10px;
    }
    .title{
      font-weight: 1200;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sub{
      margin-top: 6px;
      font-weight: 900;
      font-size: 13px;
      color: rgba(229,231,235,.84);
      line-height:1.35;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(148,163,184,.18);
      border-radius: var(--pill);
      padding: 7px 10px;
      background: rgba(15,23,42,.55);
      font-weight: 1000;
      font-size: 12px;
      color: rgba(229,231,235,.90);
      white-space:nowrap;
    }
    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr; } }

    .btn{
      appearance:none;
      width:100%;
      border-radius: 18px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.62);
      color: var(--text);
      padding: 14px 14px;
      cursor:pointer;
      text-align:left;
      box-shadow: 0 14px 44px rgba(0,0,0,.30);
      transition: transform .08s ease, border-color .12s ease;
    }
    .btn:active{ transform: translateY(1px); }
    .btn .bTitle{ font-weight: 1200; font-size: 16px; }
    .btn .bTime{ margin-top: 6px; font-weight: 1100; font-size: 13px; color: rgba(229,231,235,.88); }
    .btn .bHint{ margin-top: 8px; font-weight: 900; font-size: 12px; color: rgba(148,163,184,.95); line-height:1.3; }

    .easy{ border-color: rgba(34,197,94,.30); }
    .normal{ border-color: rgba(34,211,238,.26); }
    .hard{ border-color: rgba(245,158,11,.30); }

    .foot{
      margin-top: 12px;
      padding: 10px 6px 0;
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between;
      border-top: 1px solid rgba(148,163,184,.12);
    }
    .muted{ color: rgba(148,163,184,.95); font-weight:900; font-size:12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div>
          <div class="title">Food Groups VR — เลือกระดับ</div>
          <div class="sub">เลือก “ง่าย / ปกติ / ยาก” ระบบจะตั้งเวลาอัตโนมัติ และส่งไปหน้าเล่นจริง</div>
        </div>
        <div class="pill" id="ctxPill">ctx: …</div>
      </div>

      <div class="grid">
        <button class="btn easy" data-diff="easy" data-time="60">
          <div class="bTitle">ง่าย (Easy)</div>
          <div class="bTime">เวลาเล่น: 60 วินาที</div>
          <div class="bHint">เหมาะเริ่มต้น / เด็ก ป.5 / เน้นยิงติด & เข้าใจหมู่</div>
        </button>

        <button class="btn normal" data-diff="normal" data-time="90">
          <div class="bTitle">ปกติ (Normal)</div>
          <div class="bTime">เวลาเล่น: 90 วินาที</div>
          <div class="bHint">ค่าแนะนำหลัก / KPI: Miss ≤ 20 (ดีมากถ้า ≤ 15)</div>
        </button>

        <button class="btn hard" data-diff="hard" data-time="120">
          <div class="bTitle">ยาก (Hard)</div>
          <div class="bTime">เวลาเล่น: 120 วินาที</div>
          <div class="bHint">ท้าทายขึ้น / เป้าเยอะขึ้น / ต้องคุมคอมโบให้ยาว</div>
        </button>
      </div>

      <div class="foot">
        <div class="muted">Tip: ถ้าเล่นบนมือถือ แนะนำใช้ Normal ก่อน (90s) แล้วค่อย Hard</div>
        <div class="pill" id="paramPill">params: …</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      'use strict';

      function getQ(){
        try{ return new URL(location.href).searchParams; }catch(_){ return new URLSearchParams(); }
      }

      // Build redirect url to run page, preserving all params.
      function buildRunUrl(diff, timeSec){
        const q = getQ();
        const runUrl = new URL('./vr-groups/groups-vr.html', location.href);

        // pass-through all existing params
        q.forEach((v,k)=> runUrl.searchParams.set(k, v));

        // set diff/time explicitly (launcher controls gameplay)
        runUrl.searchParams.set('diff', diff);
        runUrl.searchParams.set('time', String(timeSec));

        // default run mode if not present
        if(!runUrl.searchParams.get('run')) runUrl.searchParams.set('run', 'play');

        // IMPORTANT: do NOT override view if user already passed it.
        // (we keep whatever exists; if none, run html can auto-set view-mobile by UA or helper)
        return runUrl.toString();
      }

      function prettyParams(){
        const q = getQ();
        const diff = q.get('diff') || '(auto)';
        const time = q.get('time') || '(auto)';
        const run  = q.get('run')  || 'play';
        const view = q.get('view') || '(auto)';
        const seed = q.get('seed') || '(auto)';
        return { diff, time, run, view, seed };
      }

      const ctx = prettyParams();
      const ctxPill = document.getElementById('ctxPill');
      const paramPill = document.getElementById('paramPill');
      if(ctxPill) ctxPill.textContent = `run:${ctx.run} view:${ctx.view}`;
      if(paramPill) paramPill.textContent = `diff:${ctx.diff} time:${ctx.time} seed:${ctx.seed}`;

      document.querySelectorAll('button[data-diff]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const diff = btn.getAttribute('data-diff') || 'normal';
          const time = Number(btn.getAttribute('data-time') || '90') || 90;
          location.href = buildRunUrl(diff, time);
        }, { passive:true });
      });

    })();
  </script>
</body>
</html>