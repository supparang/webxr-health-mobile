<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover"
  />
  <title>Hero Health ‚Äî Food Groups VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- CSS layout (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô GoodJunk) -->
  <link rel="stylesheet" href="./css/groups-vr.css" />
</head>
<body>
  <!-- ===== A-Frame Scene (‡∏â‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á VR) ===== -->
  <a-scene
    vr-mode-ui="enabled: true"
    renderer="antialias: true; colorManagement: true"
    background="color: #020617"
  >
    <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á + cursor ‡πÄ‡∏•‡πá‡∏á (‡πÉ‡∏ä‡πâ rayOrigin: mouse ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á PC/Mobile) -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera wasd-controls-enabled="false">
        <a-entity
          id="cursor"
          cursor="fuse: false; rayOrigin: mouse"
          raycaster="objects: [data-hha-tgt]"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.016"
          material="shader: flat; color: #ffffff"
          position="0 0 -0.9"
        ></a-entity>
      </a-camera>
    </a-entity>

    <!-- ‡πÅ‡∏™‡∏á + ‡∏û‡∏∑‡πâ‡∏ô -->
    <a-entity
      light="type: hemisphere; color: #ffffff; groundColor: #4b5563; intensity: 0.9"
    ></a-entity>
    <a-entity
      light="type: directional; intensity: 0.7"
      position="1 2 0.5"
    ></a-entity>
    <a-plane
      position="0 0 0"
      rotation="-90 0 0"
      width="16"
      height="16"
      material="color: #020617;"
    ></a-plane>

    <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏°: A-Frame component food-groups-game ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <a-entity id="fg-root" food-groups-game></a-entity>
  </a-scene>

  <!-- ===== HUD ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô GoodJunk ===== -->
  <div class="hud-root">
    <div class="hud-top">
      <!-- ‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô: ‡πÇ‡∏´‡∏°‡∏î + ‡πÄ‡∏ß‡∏•‡∏≤ + ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + Miss -->
      <div class="hud-card">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
          "
        >
          <div>
            <div class="hud-main-title">Hero Health ‚Ä¢ Nutrition VR</div>
            <div class="hud-main-mode">Food Groups</div>
          </div>
          <div class="hud-pill">
            <span id="hud-diff-label">NORMAL</span>
            <span>‚Ä¢</span>
            <span id="hud-time-label">60s</span>
          </div>
        </div>

        <div class="hud-metrics">
          <div class="metric">
            <div class="metric-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
            <div class="metric-value accent" id="hud-score">0</div>
          </div>
          <div class="metric">
            <div class="metric-label">‡∏û‡∏•‡∏≤‡∏î</div>
            <div class="metric-value" id="hud-miss">0</div>
            <div class="metric-sub">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
          </div>
        </div>
      </div>

      <!-- ‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô: Goal + Mini quest -->
      <div class="fg-quest-panel">
        <div class="fg-quest-title">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>

        <div class="fg-quest-row">
          <span class="fg-quest-label">GOAL</span>
          <span class="fg-quest-main" id="hud-goal-main">
            -
          </span>
          <span class="fg-quest-progress" id="hud-goal-progress">
            0 / -
          </span>
        </div>

        <div class="fg-quest-row">
          <span class="fg-quest-label">MINI QUEST</span>
          <span class="fg-quest-main" id="hud-mini-main">
            -
          </span>
          <span class="fg-quest-progress" id="hud-mini-progress">
            0 / -
          </span>
        </div>
      </div>
    </div>

    <!-- ‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á: ‡πÇ‡∏Ñ‡πâ‡∏ä‡∏û‡∏π‡∏î -->
    <div class="hud-bottom">
      <div class="coach-bubble" id="coach-bubble">
        <span class="coach-avatar">ü•¶</span>
        <span class="coach-label">‡πÇ‡∏Ñ‡πâ‡∏ä‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</span>
        <span id="coach-text">‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏∞!</span>
      </div>
    </div>
  </div>

  <!-- ‡∏ä‡∏±‡πâ‡∏ô DOM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤ emoji -->
  <div id="fg-layer"></div>

  <!-- ===== ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏° (‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠) ===== -->
  <div class="result-overlay" id="fg-result">
    <div class="result-card">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• ‚Ä¢ Food Groups VR</h2>
      <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <strong id="fg-res-score">0</strong></p>
      <p>‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <strong id="fg-res-quest">0 / 2</strong></p>
      <p>Goal: <span id="fg-res-goal">-</span></p>
      <p>Mini quest: <span id="fg-res-mini">-</span></p>
      <hr />
      <button id="fg-btn-retry">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
      <button
        id="fg-btn-hub"
        style="margin-left:8px;background:linear-gradient(90deg,#38bdf8,#22c55e);"
      >
        ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Hub
      </button>
    </div>
  </div>

  <!-- ===== ‡∏£‡∏∞‡∏ö‡∏ö Fever + FX ===== -->
  <!-- Fever gauge + ‡πÑ‡∏ü‡∏ó‡πà‡∏ß‡∏°‡∏à‡∏≠ (ES module + ‡∏ú‡∏π‡∏Å global FeverUI) -->
  <script type="module" src="./vr/ui-fever.js"></script>
  <!-- FX ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏î‡πâ‡∏á / ‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏ï‡∏Å (IIFE + global HHA_PARTICLES) -->
  <script type="module" src="./vr/particles.js"></script>

  <!-- ===== ‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Food Groups ===== -->
  <script src="./vr-groups/emoji-image.js"></script>
  <script src="./vr-groups/difficulty.js"></script>
  <script src="./vr-groups/logger-cloud.js"></script>
  <!-- GameEngine ‡πÉ‡∏ä‡πâ AFRAME.registerComponent + FeverUI + HHA_PARTICLES -->
  <script type="module" src="./vr-groups/GameEngine.js"></script>

  <!-- ===== HTML-side glue: HUD + Coach + Summary + Hub ===== -->
  <script>
    (function () {
      // helper ‡∏≠‡πà‡∏≤‡∏ô query string
      function getParam(name, fallback) {
        const url = new URL(window.location.href);
        const v = url.searchParams.get(name);
        return v !== null && v !== '' ? v : fallback;
      }

      const diffParam = String(getParam('diff', 'normal')).toLowerCase();
      let timeParam = parseInt(getParam('time', '60'), 10);
      if (isNaN(timeParam) || timeParam <= 0) timeParam = 60;
      if (timeParam < 20) timeParam = 20;
      if (timeParam > 180) timeParam = 180;

      const elScore       = document.getElementById('hud-score');
      const elDiff        = document.getElementById('hud-diff-label');
      const elTime        = document.getElementById('hud-time-label');
      const elCoach       = document.getElementById('coach-bubble');
      const elCoachText   = document.getElementById('coach-text');
      const elCoachAvatar = document.querySelector('.coach-avatar');

      const resOverlay = document.getElementById('fg-result');
      const resScore   = document.getElementById('fg-res-score');
      const resQuest   = document.getElementById('fg-res-quest');
      const resGoal    = document.getElementById('fg-res-goal');
      const resMini    = document.getElementById('fg-res-mini');
      const btnRetry   = document.getElementById('fg-btn-retry');
      const btnHub     = document.getElementById('fg-btn-hub');

      elDiff.textContent   = diffParam.toUpperCase();
      elTime.textContent   = timeParam + 's';
      elScore.textContent  = '0';

      // ----- coach helper (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö mood: good / bad / hype) -----
      function setCoach(text, mood) {
        if (!text) return;
        elCoachText.textContent = text;
        elCoach.classList.add('show');

        // reset mood class
        elCoach.classList.remove('coach-good', 'coach-bad', 'coach-hype');
        if (elCoachAvatar) {
          elCoachAvatar.classList.remove(
            'coach-avatar-good',
            'coach-avatar-bad',
            'coach-avatar-hype'
          );
        }

        if (mood && ['good', 'bad', 'hype'].includes(mood)) {
          elCoach.classList.add('coach-' + mood);
          if (elCoachAvatar) {
            elCoachAvatar.classList.add('coach-avatar-' + mood);
          }
        }
      }

      // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏°‡∏π‡πà‡πÅ‡∏ö‡∏ö step-by-step ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö
      function getGroupIntroLines(diff) {
        switch (diff) {
          case 'easy':
            return [
              '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1 ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 2 ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ üçö + üçó',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1 ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏ß ‡πÅ‡∏õ‡πâ‡∏á ‡∏ò‡∏±‡∏ç‡∏û‡∏∑‡∏ä ‡πÉ‡∏´‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏ß‡∏¢ ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á ‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 2 ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏•‡∏∞‡∏ñ‡∏±‡πà‡∏ß ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏Å‡πà ‡∏õ‡∏•‡∏≤ ‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ ‡∏ñ‡∏±‡πà‡∏ß‡∏ï‡πà‡∏≤‡∏á ‡πÜ',
              '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ‡∏à‡∏≤‡∏Å‡∏™‡∏≠‡∏á‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞‡πÉ‡∏´‡πâ‡∏î‡∏µ ‡πÜ ‡∏ô‡∏∞'
            ];
          case 'hard':
            return [
              '‡πÇ‡∏´‡∏°‡∏î‡∏¢‡∏≤‡∏Å‡πÄ‡∏ô‡πâ‡∏ô‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏°‡∏π‡πà ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô ‡∏ú‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡πÑ‡∏°‡πâ üí™',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 2: ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∂‡∏Å‡∏´‡∏£‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏•‡∏≤ ‡πÑ‡∏Å‡πà ‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏°‡∏•‡πá‡∏î‡πÅ‡∏´‡πâ‡∏á',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 3: ‡∏ú‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô ‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏ ‡πÅ‡∏•‡∏∞‡πÉ‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 4: ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏™‡∏î‡∏à‡∏∞‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',
              '‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏π‡πà‡∏î‡∏µ ‡πÜ ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢ ‡πÜ ‡∏ô‡∏∞'
            ];
          default: // normal
            return [
              '‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÄ‡∏ô‡πâ‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1‚Äì3 ‡∏Ñ‡∏∑‡∏≠ ‡∏Ç‡πâ‡∏≤‡∏ß ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô ‡πÅ‡∏•‡∏∞‡∏ú‡∏±‡∏Å üçöüçóü•¶',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 2: ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∂‡∏Å‡∏´‡∏£‡∏≠',
              '‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 3: ‡∏ú‡∏±‡∏Å‡∏°‡∏µ‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô ‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏ ‡πÅ‡∏•‡∏∞‡πÉ‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á',
              '‡πÄ‡∏õ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ ‡πÜ ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å ‡πÜ'
            ];
        }
      }

      // ----- Pre-game intro + countdown -----
      function runIntroAndCountdown(scene) {
        const lines = getGroupIntroLines(diffParam);
        let t = 400; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢

        // intro ‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
        lines.forEach((msg) => {
          setTimeout(() => {
            setCoach(msg, 'good');
          }, t);
          t += 2600; // ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
        });

        // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 3-2-1-Go
        setTimeout(() => setCoach('‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ô‡∏∞... 3', 'hype'), t);
        t += 700;
        setTimeout(() => setCoach('2', 'hype'), t);
        t += 700;
        setTimeout(() => setCoach('1', 'hype'), t);
        t += 700;
        setTimeout(
          () =>
            setCoach(
              'Go! ‡πÄ‡∏•‡πá‡∏á‡∏´‡∏°‡∏π‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤! üí•',
              'hype'
            ),
          t
        );

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏•‡∏±‡∏á Go ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
        t += 500;
        setTimeout(() => {
          console.log('[GroupsVR] intro finished ‚Üí emit fg-start');
          scene.emit('fg-start', { diff: diffParam, duration: timeParam });
        }, t);
      }

      const scene = document.querySelector('a-scene');

      // ‡∏£‡∏±‡∏ö event ‡∏à‡∏≤‡∏Å GameEngine ‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ + ‡∏õ‡∏∏‡πà‡∏°
      scene.addEventListener('fg-game-over', function (e) {
        const d = e.detail || {};
        resScore.textContent = d.score != null ? d.score : 0;

        if (d.questsCleared != null) {
          const total = d.questsTotal != null ? d.questsTotal : 2;
          resQuest.textContent = d.questsCleared + ' / ' + total;
        } else {
          resQuest.textContent = '- / -';
        }

        resGoal.textContent = d.goal || '-';
        resMini.textContent = d.miniQuest || '-';

        resOverlay.classList.add('show');
      });

      // ‡πÉ‡∏´‡πâ GameEngine ‡∏™‡πà‡∏á event ‡∏°‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏û‡∏π‡∏î + mood ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏ä‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏°
      window.addEventListener('fg-coach', function (e) {
        const msg  = e.detail && e.detail.text;
        const mood = e.detail && e.detail.mood; // 'good' | 'bad' | 'hype'
        if (msg) setCoach(msg, mood);
      });

      // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° diff/time ‡πÄ‡∏î‡∏¥‡∏°
      if (btnRetry) {
        btnRetry.addEventListener('click', function () {
          const url = new URL(window.location.href);
          url.searchParams.set('diff', diffParam);
          url.searchParams.set('time', String(timeParam));
          window.location.href = url.toString();
        });
      }

      // ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö Hub
      if (btnHub) {
        btnHub.addEventListener('click', function () {
          window.location.href = './hub.html';
        });
      }

      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ scene ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí ‡πÇ‡∏Ñ‡πâ‡∏ä‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏°‡∏π‡πà + ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
      scene.addEventListener('loaded', function () {
        console.log('[GroupsVR] scene loaded ‚Üí run intro + countdown');
        runIntroAndCountdown(scene);
      });
    })();
  </script>
</body>
</html>
