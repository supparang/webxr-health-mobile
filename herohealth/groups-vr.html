<!-- === /herohealth/groups-vr.html ===
GroupsVR Launcher ‚Äî PRODUCTION (Auto-detect + Tap-to-start)
‚úÖ Detect view without overriding explicit ?view=
‚úÖ Tap-to-start for mobile/cVR
‚úÖ Redirect to run page: ./vr-groups/groups-vr.html
‚úÖ Pass-through params: run/diff/style/time/seed/ai/practice/hub/log + extras
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GroupsVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --violet:#a78bfa;
      --radius:22px;
      --pill:999px;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{
      width:100%; height:100%;
      margin:0; padding:0;
      overflow:hidden;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at top left, rgba(34,211,238,.14), transparent 55%),
        radial-gradient(circle at bottom right, rgba(167,139,250,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
    }
    .card{
      width:min(720px, 100%);
      border-radius: 26px;
      background: rgba(2,6,23,.78);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 26px 80px rgba(0,0,0,.55);
      padding: 18px;
      backdrop-filter: blur(10px);
    }
    .top{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
    }
    .title{
      font-weight:1000;
      letter-spacing:.2px;
      font-size:20px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: var(--pill);
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.55);
      color: var(--muted);
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .sub{
      margin-top:8px;
      color: var(--muted);
      font-weight:800;
      font-size:13px;
      line-height:1.35;
    }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .stat{
      border-radius: 18px;
      background: rgba(15,23,42,.62);
      border: 1px solid rgba(148,163,184,.14);
      padding: 12px;
    }
    .k{ font-weight:900; font-size:12px; color:var(--muted); }
    .v{ margin-top:4px; font-weight:1000; font-size:16px; color:var(--text); }

    .row{
      display:flex; gap:10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .btn{
      flex: 1 1 180px;
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(15,23,42,.65);
      color: var(--text);
      font-weight:1000;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }
    .btn-ghost{
      background: rgba(2,6,23,.45);
    }
    .hint{
      margin-top: 10px;
      font-size:12px;
      color: var(--muted);
      font-weight:800;
    }

    /* Tap gate overlay (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile/cVR) */
    .tapGate{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(2,6,23,.72);
      backdrop-filter: blur(10px);
      z-index: 999;
    }
    .tapGate.hidden{ display:none; }
    .tapPanel{
      width:min(560px, 100%);
      border-radius: 26px;
      background: rgba(2,6,23,.86);
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 26px 90px rgba(0,0,0,.60);
      padding: 16px;
    }
    .tapTitle{
      font-weight:1000;
      font-size:20px;
    }
    .tapSub{
      margin-top:6px;
      font-weight:850;
      color: var(--muted);
      line-height:1.35;
      font-size:13px;
    }
    .tapBtn{
      margin-top: 12px;
      width:100%;
      border-radius: 18px;
      border: 1px solid rgba(34,197,94,.35);
      background: rgba(34,197,94,.20);
      color: var(--text);
      font-weight:1000;
      padding: 12px 14px;
      cursor:pointer;
    }
    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="title">üçö Food Groups VR</div>
        <div class="badge">AUTO-DETECT ‚Ä¢ Tap-to-start</div>
      </div>

      <div class="sub">
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ<br/>
        (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á <code>?view=...</code> ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏õ override)
      </div>

      <div class="grid">
        <div class="stat"><div class="k">Detected view</div><div id="vView" class="v">‚Äî</div></div>
        <div class="stat"><div class="k">Run / Diff</div><div id="vRun" class="v">‚Äî</div></div>
        <div class="stat"><div class="k">Time / Seed</div><div id="vTime" class="v">‚Äî</div></div>
        <div class="stat"><div class="k">AI</div><div id="vAI" class="v">‚Äî</div></div>
      </div>

      <div class="row">
        <button id="btnGo" class="btn btn-primary" type="button">‚ñ∂Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</button>
        <button id="btnCopy" class="btn" type="button">üìã Copy URL (Run)</button>
      </div>

      <div class="row">
        <button id="btnHub" class="btn btn-ghost" type="button">üè† ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>

      <div class="hint">
        Tip: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏≠‡∏á ‡πÉ‡∏™‡πà <code>?view=pc</code>, <code>?view=mobile</code>, <code>?view=cvr</code> ‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
      </div>
    </div>
  </div>

  <!-- Tap gate -->
  <div id="tapGate" class="tapGate hidden">
    <div class="tapPanel">
      <div class="tapTitle">üü¢ Tap-to-start</div>
      <div class="tapSub">
        ‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ browser ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏™‡∏µ‡∏¢‡∏á/‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠/‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÄ‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      </div>
      <button id="tapGo" class="tapBtn" type="button">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢</button>
      <div class="tapSub" style="margin-top:10px;">
        Cardboard (cVR): ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏î RECENTER ‡∏ó‡∏µ‡πà vr-ui.js ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const DOC = document;
  const WIN = window;
  const $ = (id)=>DOC.getElementById(id);

  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }
  function clamp(v,a,b){ v = Number(v)||0; return v<a?a:(v>b?b:v); }

  function isTouch(){
    return ('ontouchstart' in WIN) || ((navigator.maxTouchPoints|0) > 0);
  }

  function detectViewNoOverride(){
    const explicit = String(qs('view','')||'').toLowerCase().trim();
    if (explicit) return explicit;

    const touch = isTouch();
    const w = Math.max(1, WIN.innerWidth||1);
    const h = Math.max(1, WIN.innerHeight||1);
    const landscape = w >= h;

    if (touch){
      if (landscape && w >= 740) return 'cvr';
      return 'mobile';
    }
    return 'pc';
  }

  function needsTapGate(view){
    if (isTouch()) return true;
    if (String(view||'') === 'cvr') return true;
    return false;
  }

  function buildRunUrl(){
    const runPage = new URL('./vr-groups/groups-vr.html', location.href);

    // Required core params (defaults)
    const view = String(detectViewNoOverride()||'mobile').toLowerCase();
    const run  = String(qs('run','play')||'play').toLowerCase();
    const diff = String(qs('diff','easy')||'easy').toLowerCase();
    const style= String(qs('style','feel')||'feel').toLowerCase();
    const time = clamp(qs('time',90), 30, 180);
    const seed = String(qs('seed', Date.now()) || Date.now());
    const ai   = String(qs('ai','0')||'0');
    const practice = String(qs('practice','1')||'1'); // default ‡πÄ‡∏õ‡∏¥‡∏î practice ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö cVR

    runPage.searchParams.set('view', view);
    runPage.searchParams.set('run',  run);
    runPage.searchParams.set('diff', diff);
    runPage.searchParams.set('style',style);
    runPage.searchParams.set('time', String(time));
    runPage.searchParams.set('seed', seed);
    runPage.searchParams.set('ai', ai);
    runPage.searchParams.set('practice', practice);

    // passthrough important
    const hub = String(qs('hub','')||'');
    if (hub) runPage.searchParams.set('hub', hub);

    const log = String(qs('log','')||'');
    if (log) runPage.searchParams.set('log', log);

    // passthrough everything else (do not overwrite existing)
    const sp = new URL(location.href).searchParams;
    sp.forEach((v,k)=>{
      if (runPage.searchParams.has(k)) return;
      runPage.searchParams.set(k, v);
    });

    return runPage;
  }

  async function copyText(text){
    try { await navigator.clipboard.writeText(String(text||'')); return true; }
    catch {
      try{
        const ta = DOC.createElement('textarea');
        ta.value = String(text||'');
        DOC.body.appendChild(ta);
        ta.select();
        DOC.execCommand('copy');
        ta.remove();
        return true;
      }catch{ return false; }
    }
  }

  function showTapGate(){
    $('tapGate').classList.remove('hidden');
  }
  function hideTapGate(){
    $('tapGate').classList.add('hidden');
  }

  function go(){
    const u = buildRunUrl();
    location.href = u.toString();
  }

  // Render status
  (function render(){
    const view = detectViewNoOverride();
    $('vView').textContent = view.toUpperCase();
    $('vRun').textContent  = (String(qs('run','play')||'play').toUpperCase()) + ' / ' + String(qs('diff','easy')||'easy').toUpperCase();
    $('vTime').textContent = String(qs('time',90)||90) + 's / seed ' + String(qs('seed','auto')||'auto');
    $('vAI').textContent   = (String(qs('ai','0')||'0')==='1' ? 'ON' : 'OFF');
    const hub = String(qs('hub','')||'');
    $('btnHub').style.display = hub ? 'inline-flex' : 'none';
  })();

  // Buttons
  $('btnGo').addEventListener('click', ()=>{
    const view = detectViewNoOverride();
    if (needsTapGate(view)){
      showTapGate();
      return;
    }
    go();
  }, {passive:true});

  $('tapGo').addEventListener('click', ()=>{
    hideTapGate();
    go();
  }, {passive:true});

  $('tapGate').addEventListener('click', (e)=>{
    const id = (e && e.target && e.target.id) ? e.target.id : '';
    if (id === 'tapGo') return;
    hideTapGate();
    go();
  }, {passive:true});

  $('btnCopy').addEventListener('click', async ()=>{
    const u = buildRunUrl().toString();
    const ok = await copyText(u);
    alert(ok ? '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏´‡∏ô‡πâ‡∏≤ Run ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ' : 'Copy ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  });

  $('btnHub').addEventListener('click', ()=>{
    const hub = String(qs('hub','')||'');
    if (!hub){ alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå hub=...'); return; }
    location.href = hub;
  });

  // Auto enter (optional): ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡∏¢‚Äù ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á ?auto=1
  (function autoStart(){
    const auto = String(qs('auto','0')||'0').toLowerCase();
    if (!(auto==='1' || auto==='true')) return;

    const view = detectViewNoOverride();
    if (needsTapGate(view)){
      showTapGate();
      return;
    }
    go();
  })();

})();
</script>

</body>
</html>