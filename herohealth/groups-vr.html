<!-- === /herohealth/groups-vr.html ===
GroupsVR LAUNCHER — ROOT (Auto Detect)
✅ Redirect -> ./vr-groups/groups.html
✅ Auto-detect view ONLY if ?view is not provided
✅ Pass-through hub/run/diff/time/seed/style/practice/ai/log/...
-->

<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — GroupsVR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{ color-scheme:dark; --bg:#020617; --panel:rgba(2,6,23,.72); --stroke:rgba(148,163,184,.18); --text:#e5e7eb; --muted:#94a3b8; }
    html,body{ margin:0; height:100%; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,"Segoe UI",sans-serif; }
    .wrap{ min-height:100%; display:grid; place-items:center; padding:18px; }
    .card{ width:min(640px,100%); background:var(--panel); border:1px solid var(--stroke); border-radius:22px; padding:16px 14px; box-shadow:0 18px 44px rgba(0,0,0,.35); }
    .t{ font-weight:900; font-size:18px; }
    .s{ margin-top:8px; color:var(--muted); font-size:13px; line-height:1.5; }
    .bar{ margin-top:12px; height:10px; border-radius:999px; background:rgba(148,163,184,.12); overflow:hidden; }
    .fill{ height:100%; width:0%; background:rgba(34,197,94,.9); transition:width .2s ease; }
    .mono{ margin-top:10px; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:12px; color:rgba(229,231,235,.85); word-break:break-all; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="t">กำลังเข้าเกม Food Groups VR…</div>
      <div class="s" id="sub">กำลังตรวจอุปกรณ์และตั้งค่าโหมดมุมมองอัตโนมัติ</div>
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="mono" id="dbg"></div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const $ = (id)=>DOC.getElementById(id);

  function qsAll(){
    try{ return new URL(location.href).searchParams; }catch{ return new URLSearchParams(); }
  }
  function hasParam(k){
    try{ return new URL(location.href).searchParams.has(k); }catch{ return false; }
  }
  function setFill(p){ try{ $('fill').style.width = Math.max(0,Math.min(100,p|0))+'%'; }catch{} }

  // ✅ view auto-detect (ONLY when ?view is not provided)
  function detectView(){
    const ua = (navigator.userAgent||'').toLowerCase();
    const isMobile = /android|iphone|ipad|ipod|mobile/.test(ua) || (Math.min(screen.width, screen.height) <= 820);

    // Heuristic for cardboard/cVR: user likely opens from mobile + wants VR; allow forcing by deviceorientation availability
    const hasDO = ('DeviceOrientationEvent' in window);
    const hasXR = !!(navigator.xr);

    // Default choices:
    // - Desktop: pc
    // - Mobile: mobile
    // - If user later presses ENTER VR, vr-ui.js will handle XR; view param mainly adjusts DOM layout / crosshair rules.
    // - If you want strict cardboard aiming: set view=cvr manually (we won't override).
    if (!isMobile) return 'pc';

    // If XR exists and user is on mobile, still keep mobile layout by default (safer).
    // Encourage cVR only when explicitly provided.
    return 'mobile';
  }

  // Build redirect
  const sp = qsAll();
  const runUrl = new URL('./vr-groups/groups.html', location.href);

  // Pass-through all params
  sp.forEach((v,k)=> runUrl.searchParams.set(k,v));

  // Add view if missing
  if (!hasParam('view')){
    runUrl.searchParams.set('view', detectView());
  }

  // Friendly default seed if missing
  if (!runUrl.searchParams.get('seed')){
    runUrl.searchParams.set('seed', String(Date.now()));
  }

  setFill(35);
  $('sub').textContent = 'กำลังพาเข้าเกม…';
  $('dbg').textContent = runUrl.toString();
  setFill(80);

  // Redirect now
  location.replace(runUrl.toString());
})();
</script>
</body>
</html>