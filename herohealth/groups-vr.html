<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth â€” Food Groups VR (Launcher)</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- Shared CSS -->
  <link rel="stylesheet" href="./vr-groups/groups-vr.css" />
</head>

<body class="view-mobile">

  <div class="overlay">
    <div class="panel">
      <div class="title">ğŸ¥— Food Groups VR</div>
      <div class="sub">
        à¹€à¸¥à¸·à¸­à¸à¹‚à¸«à¸¡à¸”à¹€à¸¥à¹ˆà¸™à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡ PC / Mobile / VR Cardboard<br/>
        <span class="hint">VR Cardboard:</span> à¹€à¸›à¹‰à¸²à¸ˆà¸° â€œà¸ˆà¸´à¹‰à¸¡à¹„à¸¡à¹ˆà¹„à¸”à¹‰â€ (pointer-events à¸›à¸´à¸”) â†’ à¸¢à¸´à¸‡à¸ˆà¸²à¸ <b>crosshair à¸à¸¥à¸²à¸‡à¸ˆà¸­</b> à¹à¸¥à¹‰à¸§à¹à¸•à¸°à¸ˆà¸­à¹€à¸à¸·à¹ˆà¸­à¸¢à¸´à¸‡
      </div>

      <div class="hr"></div>

      <div class="grid2">
        <div class="kv">
          <div class="k">View</div>
          <div class="v" id="viewChips">
            <button class="chip chip-on" data-view="mobile">ğŸ“± Mobile</button>
            <button class="chip" data-view="pc">ğŸ–¥ï¸ PC</button>
            <button class="chip" data-view="cvr">ğŸ•¶ï¸ VR Cardboard</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">Run Mode</div>
          <div class="v" id="runChips">
            <button class="chip chip-on" data-run="play">ğŸ® Play (Adaptive)</button>
            <button class="chip" data-run="research">ğŸ§ª Research (Deterministic)</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">Difficulty</div>
          <div class="v" id="diffChips">
            <button class="chip" data-diff="easy">ğŸ™‚ Easy</button>
            <button class="chip chip-on" data-diff="normal">ğŸ˜¼ Normal</button>
            <button class="chip" data-diff="hard">ğŸ”¥ Hard</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">Style</div>
          <div class="v" id="styleChips">
            <button class="chip" data-style="feel">ğŸµ Feel</button>
            <button class="chip chip-on" data-style="mix">âš¡ Mix</button>
            <button class="chip" data-style="hard">ğŸ§¨ Hard</button>
          </div>
        </div>

        <div class="kv">
          <div class="k">Time (sec)</div>
          <div class="v">
            <input id="timeInput" class="input" type="number" min="30" max="180" value="90" />
            <span class="hint">30â€“180</span>
          </div>
        </div>

        <div class="kv">
          <div class="k">Seed</div>
          <div class="v">
            <input id="seedInput" class="input" type="text" placeholder="auto" />
            <button id="btnRandSeed" class="btn btn-ghost" type="button">ğŸ² Random</button>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <button id="btnPlay" class="btn btn-strong" type="button">ğŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸¥à¹ˆà¸™</button>
        <button id="btnPlayVR" class="btn" type="button">ğŸ•¶ï¸ à¹€à¸‚à¹‰à¸²à¹à¸šà¸š VR Cardboard</button>
        <button id="btnCopyLink" class="btn btn-ghost" type="button">ğŸ”— Copy Link</button>
      </div>

      <div class="row row2">
        <div class="note">
          âœ… à¸–à¹‰à¸²à¹€à¸¥à¸·à¸­à¸ VR Cardboard à¹à¸¥à¹‰à¸§ â€œà¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸¸à¹ˆà¸¡ Enter VRâ€ à¹ƒà¸«à¹‰à¸”à¸¹à¸—à¸µà¹ˆà¸«à¸™à¹‰à¸²à¹€à¸à¸¡ (Run) â€” à¸›à¸¸à¹ˆà¸¡à¸ˆà¸°à¸¡à¸²à¸ˆà¸²à¸ <b>../vr/vr-ui.js</b><br/>
          âœ… Research mode à¸ˆà¸°à¸„à¸¸à¸¡à¸„à¸§à¸²à¸¡à¸¢à¸²à¸à¹à¸šà¸š â€œseeded/deterministicâ€
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const $ = (id)=>document.getElementById(id);

  const state = {
    view: 'mobile',
    run: 'play',
    diff: 'normal',
    style: 'mix',
    time: 90,
    seed: ''
  };

  function setOn(groupId, attr, value){
    const box = $(groupId);
    [...box.querySelectorAll('.chip')].forEach(b=>{
      b.classList.toggle('chip-on', b.getAttribute(attr) === value);
    });
  }

  function bindChips(groupId, attr, key){
    const box = $(groupId);
    box.addEventListener('click', (e)=>{
      const btn = e.target.closest('.chip');
      if (!btn) return;
      const v = btn.getAttribute(attr);
      if (!v) return;
      state[key] = v;
      setOn(groupId, attr, v);
    });
  }

  bindChips('viewChips','data-view','view');
  bindChips('runChips','data-run','run');
  bindChips('diffChips','data-diff','diff');
  bindChips('styleChips','data-style','style');

  $('timeInput').addEventListener('input', ()=>{
    const v = Number($('timeInput').value||90);
    state.time = Math.max(30, Math.min(180, isFinite(v)?v:90));
  });

  $('btnRandSeed').addEventListener('click', ()=>{
    const s = String(Date.now()) + '-' + Math.floor(Math.random()*1e6);
    $('seedInput').value = s;
  });

  function buildUrl(forceView){
    const time = Math.max(30, Math.min(180, Number($('timeInput').value||90)));
    const seed = String($('seedInput').value||'').trim() || String(Date.now());
    const view = forceView || state.view;

    const u = new URL(location.href);
    // run page
    u.pathname = u.pathname.replace(/\/groups-vr\.html?$/,'/vr-groups/groups.html');

    u.searchParams.set('view', view);
    u.searchParams.set('run', state.run);
    u.searchParams.set('diff', state.diff);
    u.searchParams.set('style', state.style);
    u.searchParams.set('time', String(time));
    u.searchParams.set('seed', seed);

    // passthrough hub if launcher was called with hub=
    const hub = new URL(location.href).searchParams.get('hub');
    if (hub) u.searchParams.set('hub', hub);

    u.searchParams.set('autostart', '1');
    return u.toString();
  }

  async function copyText(text){
    try { await navigator.clipboard.writeText(text); return true; }
    catch {
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        return true;
      }catch{ return false; }
    }
  }

  $('btnPlay').addEventListener('click', ()=>{
    location.href = buildUrl();
  });

  $('btnPlayVR').addEventListener('click', ()=>{
    location.href = buildUrl('cvr');
  });

  $('btnCopyLink').addEventListener('click', async ()=>{
    const ok = await copyText(buildUrl());
    alert(ok ? 'Copy link à¹à¸¥à¹‰à¸§ âœ…' : 'Copy à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
  });

})();
</script>
</body>
</html>