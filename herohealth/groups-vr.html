<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GroupsVR Launcher</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <!-- Reuse Groups CSS -->
  <link rel="stylesheet" href="./vr-groups/groups-vr.css" />
</head>

<body class="view-pc">

  <div class="overlay" id="launchOverlay">
    <div class="panel">
      <div class="title">ü•ó Food Groups VR ‚Äî Launcher</div>
      <div class="sub">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô: <b>PC</b> / <b>Mobile</b> / <b>VR Cardboard</b><br/>
        (Cardboard ‡∏à‡∏∞‡πÉ‡∏ä‡πâ <b>‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair</b> + <b>‡πÅ‡∏ï‡∏∞‡∏à‡∏≠</b> ‡∏ú‡πà‡∏≤‡∏ô vr-ui.js)
      </div>

      <div class="hr"></div>

      <div class="grid2 kv">
        <div>
          <div class="k">VIEW (‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)</div>
          <div class="v">
            <button class="chip" id="chipViewPc" type="button">üñ•Ô∏è PC</button>
            <button class="chip" id="chipViewMobile" type="button">üì± Mobile</button>
            <button class="chip" id="chipViewCvr" type="button">ü•Ω Cardboard</button>
            <span class="hint" id="autoHint"></span>
          </div>
        </div>

        <div>
          <div class="k">RUN MODE</div>
          <div class="v">
            <button class="chip" id="chipRunPlay" type="button">üéÆ Play (Adaptive)</button>
            <button class="chip" id="chipRunResearch" type="button">üß™ Research (Deterministic)</button>
          </div>
        </div>

        <div>
          <div class="k">DIFFICULTY</div>
          <div class="v">
            <button class="chip" id="chipDiffEasy" type="button">Easy</button>
            <button class="chip" id="chipDiffNormal" type="button">Normal</button>
            <button class="chip" id="chipDiffHard" type="button">Hard</button>
          </div>
        </div>

        <div>
          <div class="k">STYLE</div>
          <div class="v">
            <button class="chip" id="chipStyleMix" type="button">Mix</button>
            <button class="chip" id="chipStyleFeel" type="button">Feel</button>
            <button class="chip" id="chipStyleHard" type="button">Hard</button>
          </div>
        </div>

        <div>
          <div class="k">TIME (sec)</div>
          <div class="v">
            <input id="inpTime" class="input" type="number" min="30" max="180" step="5" value="90" />
            <span class="hint">30‚Äì180</span>
          </div>
        </div>

        <div>
          <div class="k">SEED (‡∏ß‡∏¥‡∏à‡∏±‡∏¢)</div>
          <div class="v">
            <input id="inpSeed" class="input" type="text" value="" placeholder="auto" />
            <button class="chip" id="btnGenSeed" type="button">üé≤ gen</button>
          </div>
        </div>

        <div style="grid-column:1/-1">
          <div class="k">LOG URL (optional)</div>
          <div class="v">
            <input id="inpLog" class="input" style="width:min(520px,100%)" type="text"
                   placeholder="‡πÉ‡∏™‡πà Apps Script / Logger URL (optional) ‡πÄ‡∏ä‡πà‡∏ô https://script.google.com/macros/s/.../exec" />
          </div>
          <div class="note" style="margin-top:8px">
            ‡∏ñ‡πâ‡∏≤‡πÉ‡∏™‡πà log url ‚Üí run ‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° POST JSON ‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏° + flush ‡∏ï‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö/‡∏Å‡∏î‡∏Å‡∏•‡∏±‡∏ö
          </div>
        </div>

        <div style="grid-column:1/-1">
          <div class="k">HUB (optional)</div>
          <div class="v">
            <input id="inpHub" class="input" style="width:min(520px,100%)" type="text"
                   placeholder="‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏•‡∏±‡∏ö HUB ‡πÄ‡∏ä‡πà‡∏ô ./hub.html ‡∏´‡∏£‡∏∑‡∏≠ https://.../hub.html" />
            <button class="chip" id="btnUseHubParam" type="button">‚Ü©Ô∏é ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å ?hub=</button>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <button class="btn btn-strong" id="btnPlay" type="button">‚ñ∂Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô</button>
        <button class="btn" id="btnCopyLink" type="button">üîó Copy Link</button>
        <button class="btn btn-ghost" id="btnReset" type="button">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>

      <div class="note" style="margin-top:12px">
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: Cardboard ‡πÉ‡∏ä‡πâ Chrome + HTTPS ‡πÅ‡∏•‡∏∞‡∏Å‡∏î ‚ÄúEnter VR‚Äù ‡∏ö‡∏ô UI ‡πÉ‡∏ô run (vr-ui.js)
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const $ = (id)=>DOC.getElementById(id);

  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }
  function clamp(v,a,b){ v = Number(v)||0; return v<a?a:(v>b?b:v); }

  async function copyText(text){
    try { await navigator.clipboard.writeText(String(text||'')); return true; }
    catch {
      try{
        const ta = DOC.createElement('textarea');
        ta.value = String(text||'');
        DOC.body.appendChild(ta);
        ta.select();
        DOC.execCommand('copy');
        ta.remove();
        return true;
      }catch{ return false; }
    }
  }

  // ---- defaults + autodetect ----
  function autoView(){
    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua) || (navigator.maxTouchPoints>1 && innerWidth<900);
    return isMobile ? 'mobile' : 'pc';
  }

  const state = {
    view: 'pc',
    run: 'play',
    diff: 'normal',
    style:'mix'
  };

  function chipOn(el, on){
    if (!el) return;
    el.classList.toggle('chip-on', !!on);
  }

  function render(){
    chipOn($('chipViewPc'), state.view==='pc');
    chipOn($('chipViewMobile'), state.view==='mobile');
    chipOn($('chipViewCvr'), state.view==='cvr');

    chipOn($('chipRunPlay'), state.run==='play');
    chipOn($('chipRunResearch'), state.run==='research');

    chipOn($('chipDiffEasy'), state.diff==='easy');
    chipOn($('chipDiffNormal'), state.diff==='normal');
    chipOn($('chipDiffHard'), state.diff==='hard');

    chipOn($('chipStyleMix'), state.style==='mix');
    chipOn($('chipStyleFeel'), state.style==='feel');
    chipOn($('chipStyleHard'), state.style==='hard');
  }

  function buildRunUrl(){
    const u = new URL('./vr-groups/groups.html', location.href);

    u.searchParams.set('view', state.view);
    u.searchParams.set('run', state.run);
    u.searchParams.set('diff', state.diff);
    u.searchParams.set('style', state.style);

    const time = clamp($('inpTime').value, 30, 180);
    u.searchParams.set('time', String(time|0));

    const seed = String($('inpSeed').value||'').trim();
    if (seed) u.searchParams.set('seed', seed);

    const log = String($('inpLog').value||'').trim();
    if (log) u.searchParams.set('log', log);

    const hub = String($('inpHub').value||'').trim();
    if (hub) u.searchParams.set('hub', hub);

    // ‡πÉ‡∏´‡πâ run ‡πÇ‡∏ä‡∏ß‡πå start overlay ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á user gesture (‡∏î‡∏µ‡∏ï‡πà‡∏≠ audio + vr)
    u.searchParams.set('start', '1');
    return u.toString();
  }

  // ---- bind chips ----
  $('chipViewPc').onclick = ()=>{ state.view='pc'; render(); };
  $('chipViewMobile').onclick = ()=>{ state.view='mobile'; render(); };
  $('chipViewCvr').onclick = ()=>{ state.view='cvr'; render(); };

  $('chipRunPlay').onclick = ()=>{ state.run='play'; render(); };
  $('chipRunResearch').onclick = ()=>{ state.run='research'; render(); };

  $('chipDiffEasy').onclick = ()=>{ state.diff='easy'; render(); };
  $('chipDiffNormal').onclick = ()=>{ state.diff='normal'; render(); };
  $('chipDiffHard').onclick = ()=>{ state.diff='hard'; render(); };

  $('chipStyleMix').onclick = ()=>{ state.style='mix'; render(); };
  $('chipStyleFeel').onclick = ()=>{ state.style='feel'; render(); };
  $('chipStyleHard').onclick = ()=>{ state.style='hard'; render(); };

  $('btnGenSeed').onclick = ()=>{
    $('inpSeed').value = String(Date.now());
  };

  $('btnUseHubParam').onclick = ()=>{
    const hub = String(qs('hub','')||'').trim();
    if (hub) $('inpHub').value = hub;
  };

  $('btnPlay').onclick = ()=>{ location.href = buildRunUrl(); };

  $('btnCopyLink').onclick = async ()=>{
    const ok = await copyText(buildRunUrl());
    alert(ok ? '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ' : 'Copy ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  };

  $('btnReset').onclick = ()=>{
    state.view='pc'; state.run='play'; state.diff='normal'; state.style='mix';
    $('inpTime').value = '90';
    $('inpSeed').value = '';
    $('inpLog').value = '';
    $('inpHub').value = '';
    render();
  };

  // init: prefer url params if present
  const v = String(qs('view','')||'').toLowerCase();
  state.view = (v==='pc'||v==='mobile'||v==='cvr') ? v : autoView();

  const run = String(qs('run','')||'').toLowerCase();
  state.run = (run==='research') ? 'research' : 'play';

  const diff = String(qs('diff','')||'').toLowerCase();
  state.diff = (diff==='easy'||diff==='hard'||diff==='normal') ? diff : 'normal';

  const style= String(qs('style','')||'').toLowerCase();
  state.style = (style==='mix'||style==='feel'||style==='hard') ? style : 'mix';

  const t = qs('time','');
  if (t!=null && t!=='') $('inpTime').value = String(clamp(t,30,180)|0);

  const seed = String(qs('seed','')||'').trim();
  if (seed) $('inpSeed').value = seed;

  const log = String(qs('log','')||'').trim();
  if (log) $('inpLog').value = log;

  const hub = String(qs('hub','')||'').trim();
  if (hub) $('inpHub').value = hub;

  $('autoHint').textContent = ` (auto: ${autoView()})`;
  render();
})();
</script>
</body>
</html>