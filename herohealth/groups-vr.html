<!-- === /herohealth/groups-vr.html ===
GroupsVR Launcher ‚Äî PRODUCTION
‚úÖ Auto-detect view (pc/mobile/cvr) BUT never override explicit ?view=
‚úÖ Tap-to-start gate (mobile) to unlock audio/fullscreen policies
‚úÖ Redirect to RUN: ./vr-groups/groups-vr.html with merged params
‚úÖ Keeps hub/log + passes through research ctx params
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GroupsVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.86);
      --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.20);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --radius:22px;
      --pill:999px;
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{
      width:100%; height:100%;
      margin:0; padding:0;
      overflow:hidden;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at top left, rgba(34,211,238,.14), transparent 55%),
        radial-gradient(circle at bottom right, rgba(167,139,250,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    .wrap{
      position:fixed;
      inset:0;
      padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(16px + var(--sab)) calc(16px + var(--sal));
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width:min(720px, 96vw);
      border: 1px solid var(--stroke);
      border-radius: calc(var(--radius) + 6px);
      background: var(--panel);
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .head{
      padding:18px 18px 14px;
      border-bottom: 1px solid rgba(148,163,184,.12);
      background: linear-gradient(180deg, rgba(15,23,42,.35), rgba(2,6,23,0));
    }

    .title{
      font-weight:1000;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      color:var(--muted);
      font-weight:800;
      font-size:13px;
      line-height:1.35;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      padding:16px 18px 18px;
    }

    .panel{
      border:1px solid rgba(148,163,184,.14);
      background: rgba(15,23,42,.55);
      border-radius: var(--radius);
      padding:14px;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: var(--pill);
      border: 1px solid rgba(148,163,184,.16);
      background: rgba(2,6,23,.55);
      font-weight:900;
      font-size:13px;
      color:var(--text);
    }
    .pill span{ color: var(--muted); font-weight:900; font-size:12px; }

    .btnRow{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      flex:1 1 auto;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.50);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }

    .btnStrong{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.18);
    }
    .btnWarn{
      border-color: rgba(245,158,11,.35);
      background: rgba(245,158,11,.14);
    }

    .note{
      margin-top:10px;
      color: var(--muted);
      font-weight:800;
      font-size:12px;
      line-height:1.35;
    }

    .mini{
      font-size:12px;
      color: var(--muted);
      font-weight:800;
      margin-top:10px;
      opacity:.95;
    }

    /* Tap overlay */
    .tap{
      position:fixed;
      inset:0;
      z-index:9999;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(2,6,23,.82);
      backdrop-filter: blur(10px);
    }
    .tap.on{ display:flex; }
    .tapBox{
      width:min(560px, 96vw);
      border-radius: 26px;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.88);
      box-shadow: 0 24px 80px rgba(0,0,0,.60);
      padding: 16px;
    }
    .tapTitle{ font-weight:1000; font-size:20px; }
    .tapSub{ margin-top:8px; color:var(--muted); font-weight:800; font-size:13px; line-height:1.35; }
    .tapBtns{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }

    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="title">ü•¶ HeroHealth ‚Äî Food Groups VR</div>
        <div class="sub">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà override ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏™‡πà <b>?view=</b> ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß)
        </div>
      </div>

      <div class="grid">
        <div class="panel">
          <div class="row" id="chips"></div>

          <div class="btnRow">
            <button class="btn btnStrong" id="btnGo" type="button">‚ñ∂Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</button>
            <button class="btn btnWarn" id="btnCVR" type="button">üï∂Ô∏è ‡πÇ‡∏´‡∏°‡∏î Cardboard (cVR)</button>
            <button class="btn" id="btnMobile" type="button">üì± ‡πÇ‡∏´‡∏°‡∏î Mobile</button>
            <button class="btn" id="btnPC" type="button">üñ•Ô∏è ‡πÇ‡∏´‡∏°‡∏î PC</button>
          </div>

          <div class="note">
            * ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ cVR: ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏î <b>ENTER VR</b> ‡πÅ‡∏•‡∏∞ <b>RECENTER</b> (‡∏°‡∏≤‡∏à‡∏≤‡∏Å vr-ui.js)
          </div>

          <div class="mini" id="autoLine">Auto: ‚Äî</div>
        </div>

        <div class="panel">
          <div style="font-weight:1000; font-size:14px;">‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</div>
          <div class="mini" id="paramPreview">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tap-to-start overlay -->
  <div class="tap" id="tap">
    <div class="tapBox">
      <div class="tapTitle">üëÜ Tap-to-start</div>
      <div class="tapSub">
        ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡πÅ‡∏ï‡∏∞ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á/‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°
      </div>
      <div class="tapBtns">
        <button class="btn btnStrong" id="tapGo" type="button">‚úÖ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
        <button class="btn" id="tapSkip" type="button">‚è≠Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°</button>
      </div>
      <div class="note" style="margin-top:10px;">
        ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Tap-to-start: ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å PC ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const WIN = window;

  const $ = (id)=>DOC.getElementById(id);
  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }

  function isTouch(){
    return ('ontouchstart' in WIN) || (navigator.maxTouchPoints|0) > 0;
  }

  function detectViewNoOverride(){
    const explicit = String(qs('view','')).toLowerCase();
    if (explicit) return explicit;

    const touch = isTouch();
    const w = Math.max(1, WIN.innerWidth||1);
    const h = Math.max(1, WIN.innerHeight||1);
    const landscape = w >= h;

    // conservative: default mobile on touch, pc otherwise
    if (touch){
      // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å auto ‡πÑ‡∏õ cvr ‡πÄ‡∏°‡∏∑‡πà‡∏≠ landscape ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ:
      // if (landscape && w >= 860) return 'cvr';
      return 'mobile';
    }
    return 'pc';
  }

  function clamp(v,a,b){ v = Number(v)||0; return v<a?a:(v>b?b:v); }

  function buildRunUrl(view){
    const runUrl = new URL('./vr-groups/groups-vr.html', location.href);

    // carry all params, but never override existing view
    const sp = new URL(location.href).searchParams;
    sp.forEach((v,k)=>{
      if (k === 'view') return;
      runUrl.searchParams.set(k, v);
    });

    const explicit = String(qs('view',''));
    if (explicit){
      runUrl.searchParams.set('view', explicit);
    } else {
      runUrl.searchParams.set('view', view);
    }

    if (!runUrl.searchParams.get('run'))  runUrl.searchParams.set('run', 'play');
    if (!runUrl.searchParams.get('diff')) runUrl.searchParams.set('diff', 'normal');
    if (!runUrl.searchParams.get('time')) runUrl.searchParams.set('time', '90');
    if (!runUrl.searchParams.get('seed')) runUrl.searchParams.set('seed', String(Date.now()));
    return runUrl;
  }

  async function tryFullscreen(){
    try{
      const el = DOC.documentElement;
      if (el.requestFullscreen && !DOC.fullscreenElement) await el.requestFullscreen();
    }catch(_){}
  }

  function renderChips(view){
    const chips = $('chips');
    chips.innerHTML = '';

    function add(label, val){
      const el = DOC.createElement('div');
      el.className = 'pill';
      el.innerHTML = `<span>${label}</span>${val}`;
      chips.appendChild(el);
    }

    add('VIEW', view);
    add('RUN', String(qs('run','play')).toUpperCase());
    add('DIFF', String(qs('diff','normal')).toUpperCase());
    add('TIME', String(qs('time','90')) + 's');
    add('AI', String(qs('ai','0')));
    add('SEED', String(qs('seed','auto')).slice(0, 10) + '‚Ä¶');
  }

  function renderPreview(runUrl){
    const pv = $('paramPreview');
    const sp = runUrl.searchParams;
    const keys = [];
    sp.forEach((v,k)=> keys.push([k,v]));
    keys.sort((a,b)=>a[0].localeCompare(b[0]));
    pv.textContent = keys.map(([k,v])=>`${k}=${v}`).join('  ‚Ä¢  ');
  }

  function showTap(on){
    $('tap').classList.toggle('on', !!on);
  }

  async function go(view, needTap){
    const runUrl = buildRunUrl(view);
    renderPreview(runUrl);

    if (needTap){
      showTap(true);

      const onGo = async ()=>{
        showTap(false);
        await tryFullscreen();
        location.href = runUrl.toString();
      };
      const onSkip = ()=>{
        showTap(false);
        location.href = runUrl.toString();
      };

      $('tapGo').onclick = onGo;
      $('tapSkip').onclick = onSkip;
      $('tap').onclick = (e)=>{
        if (e.target && e.target.id === 'tap') onGo();
      };
      return;
    }

    location.href = runUrl.toString();
  }

  function init(){
    const viewAuto = detectViewNoOverride();
    renderChips(viewAuto);

    const runUrl = buildRunUrl(viewAuto);
    renderPreview(runUrl);

    $('autoLine').textContent = `Auto: ${viewAuto}  ‚Ä¢  touch=${isTouch() ? 'yes' : 'no'}  ‚Ä¢  explicitView=${String(qs('view','')||'')||'‚Äî'}`;

    $('btnGo').onclick = ()=> go(viewAuto, isTouch());
    $('btnCVR').onclick = ()=> go('cvr', isTouch());
    $('btnMobile').onclick = ()=> go('mobile', isTouch());
    $('btnPC').onclick = ()=> go('pc', false);

    // Auto enter on desktop, but leave touch to user tap
    if (!isTouch()){
      go(viewAuto, false);
    }
  }

  if (DOC.readyState === 'loading'){
    DOC.addEventListener('DOMContentLoaded', init, { once:true });
  } else {
    init();
  }
})();
</script>
</body>
</html>