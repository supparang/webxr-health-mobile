<!-- === /herohealth/groups-vr.html ===
GroupsVR LAUNCHER ‚Äî ROOT (Production)
‚úÖ Auto-detect view: pc / mobile / vr / cvr
‚úÖ DO NOT override if ?view= already exists
‚úÖ Pass-through: hub/run/diff/time/seed/style/studyId/conditionGroup/log/practice/ai
‚úÖ Remembers last view (localStorage) if no explicit ?view=
‚úÖ Clear entry buttons (PC/Mobile/VR/Cardboard) BUT auto redirect by default
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî GroupsVR Launcher</title>
  <meta name="color-scheme" content="dark"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    :root{
      --bg:#020617; --panel:rgba(2,6,23,.78); --panel2:rgba(15,23,42,.72);
      --stroke:rgba(148,163,184,.18); --text:#e5e7eb; --muted:#94a3b8;
      --accent:#22c55e; --warn:#f59e0b; --radius:22px; --pill:999px;
      --sat: env(safe-area-inset-top, 0px); --sab: env(safe-area-inset-bottom, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; height:100%; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,"Segoe UI",sans-serif; }
    .wrap{ min-height:100%; display:flex; align-items:center; justify-content:center; padding: calc(var(--sat) + 18px) 14px calc(var(--sab) + 18px); }
    .card{
      width:min(760px, 100%);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: 0 18px 44px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .sub{ margin-top:6px; color:rgba(229,231,235,.86); font-size:13px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:var(--pill);
      border:1px solid rgba(148,163,184,.18);
      background:rgba(2,6,23,.55);
      font-weight:900; font-size:12px;
    }
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (min-width: 780px){ .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
    button{
      width:100%;
      border-radius:18px;
      padding:12px 12px;
      border:1px solid rgba(148,163,184,.20);
      background:rgba(15,23,42,.68);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
    }
    button.primary{ background:rgba(34,197,94,.18); border-color:rgba(34,197,94,.35); }
    button.warn{ background:rgba(245,158,11,.16); border-color:rgba(245,158,11,.35); }
    .note{ margin-top:10px; color:var(--muted); font-size:12px; }
    .small{ font-size:12px; color:rgba(229,231,235,.78); }
    .hr{ height:1px; background:rgba(148,163,184,.12); margin:14px 0; border-radius:999px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ü•¶ HeroHealth ‚Äî Food Groups VR</h1>
      <div class="sub">Auto detect ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏≠‡∏á (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)</div>

      <div class="row">
        <span class="pill">üéÆ run: <span id="vRun">play</span></span>
        <span class="pill">‚öôÔ∏è diff: <span id="vDiff">normal</span></span>
        <span class="pill">‚è±Ô∏è time: <span id="vTime">90</span>s</span>
        <span class="pill">ü™™ view: <span id="vView">auto</span></span>
        <span class="pill">üß† ai: <span id="vAI">off</span></span>
      </div>

      <div class="hr"></div>

      <div class="grid">
        <button id="btnAuto" class="primary" type="button">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Auto)</button>
        <button id="btnPC" type="button">üñ•Ô∏è PC</button>
        <button id="btnMobile" type="button">üì± Mobile</button>
        <button id="btnVR" class="warn" type="button">ü•Ω VR / Cardboard</button>
      </div>

      <div class="note">
        ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ <b>?view=</b> ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞ <b>‡πÑ‡∏°‡πà override</b><br/>
        ‚Ä¢ Cardboard (cVR): ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ <b>?practice=15</b> (‡∏´‡∏£‡∏∑‡∏≠ practice=1) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ù‡∏∂‡∏Å 15 ‡∏ß‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏£‡∏¥‡∏á<br/>
        <span class="small">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <code>?run=play&diff=normal&time=90&ai=1&practice=15</code></span>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';
  const DOC = document;
  const LS_VIEW = 'HHA_GROUPS_LAST_VIEW';

  function qs(k, def=null){
    try { return new URL(location.href).searchParams.get(k) ?? def; }
    catch { return def; }
  }

  function setText(id, v){
    const el = DOC.getElementById(id);
    if (el) el.textContent = String(v ?? '');
  }

  function isLikelyMobile(){
    const ua = navigator.userAgent || '';
    return /Android|iPhone|iPad|iPod/i.test(ua);
  }

  function isLikelyCardboard(){
    // heuristic: mobile + wide viewport OR explicit fullscreen/pointer coarse
    const coarse = matchMedia && matchMedia('(pointer: coarse)').matches;
    return isLikelyMobile() && coarse;
  }

  function detectView(){
    // ‚úÖ if explicit ?view= exists, do not override
    const v = String(qs('view','')||'').toLowerCase();
    if (v) return v;

    // ‚úÖ else read remembered
    try{
      const saved = String(localStorage.getItem(LS_VIEW)||'').toLowerCase();
      if (saved) return saved;
    }catch{}

    // ‚úÖ heuristic
    if (isLikelyCardboard()) return 'cvr';
    if (isLikelyMobile()) return 'mobile';
    return 'pc';
  }

  function buildRunUrl(viewOverride){
    const runPath = './vr-groups/groups-vr.html';
    const u = new URL(runPath, location.href);

    const sp = new URL(location.href).searchParams;

    // pass-through every param
    sp.forEach((v,k)=> u.searchParams.set(k,v));

    // decide view
    const explicit = String(sp.get('view')||'').toLowerCase();
    const view = explicit ? explicit : (viewOverride || detectView());

    if (!explicit) u.searchParams.set('view', view);

    // remember
    try{ localStorage.setItem(LS_VIEW, view); }catch{}

    return u.toString();
  }

  // HUD
  setText('vRun',  String(qs('run','play')||'play'));
  setText('vDiff', String(qs('diff','normal')||'normal'));
  setText('vTime', String(qs('time','90')||'90'));
  const a = String(qs('ai','0')||'0');
  setText('vAI', (a==='1'||a==='true') ? 'on' : 'off');

  const view = detectView();
  setText('vView', view);

  function go(view){
    location.href = buildRunUrl(view);
  }

  DOC.getElementById('btnAuto').addEventListener('click', ()=> go(null));
  DOC.getElementById('btnPC').addEventListener('click', ()=> go('pc'));
  DOC.getElementById('btnMobile').addEventListener('click', ()=> go('mobile'));
  DOC.getElementById('btnVR').addEventListener('click', ()=> go('cvr'));

  // ‚úÖ auto redirect quickly (unless user explicitly wants to stay: ?stay=1)
  const stay = String(qs('stay','0')||'0');
  if (!(stay==='1' || stay==='true')){
    setTimeout(()=> go(null), 350);
  }
})();
</script>
</body>
</html>