<!-- === C: /herohealth/groups-vr.html ===
GroupsVR Smart Launcher ‚Äî PRODUCTION
‚úÖ Big buttons: PC / Mobile / Cardboard(cVR)
‚úÖ Remembers last selection (localStorage)
‚úÖ Quick Start (last used)
‚úÖ Pass-through hub/log + research ctx params
‚úÖ Locks: run=research => ai=0 always
‚úÖ Sends to: ./vr-groups/groups-vr.html
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî GroupsVR Launcher</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --panel:rgba(2,6,23,.78);
      --panel2:rgba(15,23,42,.70);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --cyan:#22d3ee;
      --violet:#a78bfa;

      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);

      --radius:22px;
      --pill:999px;
      --soft: 0 10px 28px rgba(0,0,0,.30);
      --glow: 0 18px 42px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    html,body{
      width:100%; height:100%;
      margin:0; padding:0;
      overflow:auto;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at top left, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(167,139,250,.10), transparent 55%),
        var(--bg);
      color: var(--text);
    }

    .wrap{
      min-height:100%;
      padding: calc(18px + var(--sat)) calc(16px + var(--sar)) calc(18px + var(--sab)) calc(16px + var(--sal));
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width:min(860px, 100%);
      border-radius: 28px;
      background: rgba(2,6,23,.68);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 28px 80px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      padding: 16px;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 8px 8px 2px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title{
      font-size: 22px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .sub{
      font-size: 13px;
      font-weight: 800;
      color: var(--muted);
      line-height:1.3;
    }

    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }
    .chip{
      padding: 8px 10px;
      border-radius: var(--pill);
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.55);
      color: var(--text);
      font-weight: 950;
      font-size: 12px;
      box-shadow: var(--soft);
      user-select:none;
    }
    .chip b{ color: rgba(34,197,94,.95); }

    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
    }

    .panel{
      border-radius: var(--radius);
      background: rgba(15,23,42,.50);
      border: 1px solid rgba(148,163,184,.14);
      box-shadow: var(--soft);
      padding: 12px;
    }

    .panel h3{
      margin:0;
      font-size: 14px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .panel .hint{
      margin-top:6px;
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      line-height:1.35;
    }

    .btnGrid{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .btnBig{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding: 14px 12px;
      border-radius: 22px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.55);
      color: var(--text);
      box-shadow: var(--soft);
      cursor:pointer;
      text-align:left;
      user-select:none;
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .btnBig:active{ transform: translateY(1px); }
    .btnBig .k{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      font-weight: 1000;
      font-size: 14px;
    }
    .btnBig .d{
      font-weight: 850;
      font-size: 12px;
      color: var(--muted);
      line-height:1.25;
    }
    .btnBig.selected{
      border-color: rgba(34,197,94,.38);
      box-shadow: 0 0 0 2px rgba(34,197,94,.12), var(--soft);
    }

    .formRow{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size:12px;
      font-weight: 950;
      color: var(--muted);
    }
    select, input{
      height: 42px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(2,6,23,.55);
      color: var(--text);
      padding: 0 12px;
      font-weight: 900;
      outline: none;
    }
    input[type="number"]{ appearance:textfield; }

    .actions{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      flex:1 1 220px;
      height: 46px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.62);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
      box-shadow: var(--soft);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .btnStrong{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }
    .btnGhost{
      background: rgba(2,6,23,.38);
    }
    .btn:active{ transform: translateY(1px); }

    .side .miniPanel{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .kv{
      padding: 12px;
      border-radius: 18px;
      background: rgba(2,6,23,.55);
      border: 1px solid rgba(148,163,184,.14);
      box-shadow: var(--soft);
    }
    .kv .k{
      font-size: 12px;
      font-weight: 950;
      color: var(--muted);
    }
    .kv .v{
      margin-top: 4px;
      font-size: 14px;
      font-weight: 1000;
      color: var(--text);
      word-break: break-word;
    }

    .note{
      margin-top: 10px;
      padding: 12px;
      border-radius: 18px;
      background: rgba(2,6,23,.45);
      border: 1px solid rgba(148,163,184,.12);
      color: var(--muted);
      font-weight: 850;
      font-size: 12px;
      line-height:1.35;
    }

    .warn{
      color: rgba(245,158,11,.95);
      font-weight: 950;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      .btnGrid{ grid-template-columns: 1fr; }
      .btn{ flex: 1 1 auto; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="brand">
          <div class="title">ü•ó HeroHealth ‚Äî Food Groups VR</div>
          <div class="sub">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏Å‡∏î START<br/>
            <span class="warn">Research</span> ‡∏à‡∏∞‡∏•‡πá‡∏≠‡∏Å AI ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ï‡∏£‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á
          </div>
        </div>
        <div class="chips">
          <div class="chip">Run: <b id="chipRun">play</b></div>
          <div class="chip">View: <b id="chipView">mobile</b></div>
          <div class="chip">Diff: <b id="chipDiff">easy</b></div>
          <div class="chip">Time: <b id="chipTime">90</b>s</div>
        </div>
      </div>

      <div class="grid">
        <div class="main">
          <div class="panel">
            <h3>1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
            <div class="hint">‡πÄ‡∏î‡πá‡∏Å ‡∏õ.5: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà <b>Mobile</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>PC</b> ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ <b>Cardboard (cVR)</b></div>

            <div class="btnGrid" id="viewButtons">
              <button class="btnBig" type="button" data-view="pc">
                <div class="k">üñ•Ô∏è PC <span>‚Üí view=pc</span></div>
                <div class="d">‡πÄ‡∏°‡∏≤‡∏™‡πå/‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà ‚Ä¢ ‡πÄ‡∏õ‡πâ‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≠‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</div>
              </button>

              <button class="btnBig" type="button" data-view="mobile">
                <div class="k">üì± Mobile <span>‚Üí view=mobile</span></div>
                <div class="d">‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏î‡πâ ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏£‡πá‡∏ß ‚Ä¢ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å</div>
              </button>

              <button class="btnBig" type="button" data-view="cvr">
                <div class="k">üï∂Ô∏è Cardboard (cVR) <span>‚Üí view=cvr</span></div>
                <div class="d">‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair (‡πÅ‡∏ï‡∏∞‡∏à‡∏≠) ‚Ä¢ ‡∏°‡∏µ Calibration/Practice ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°</div>
              </button>
            </div>

            <div class="formRow">
              <div class="field">
                <label for="runMode">2) ‡πÇ‡∏´‡∏°‡∏î (run)</label>
                <select id="runMode">
                  <option value="play">PLAY (‡πÄ‡∏•‡πà‡∏ô)</option>
                  <option value="research">RESEARCH (‡∏ß‡∏¥‡∏à‡∏±‡∏¢)</option>
                </select>
              </div>

              <div class="field">
                <label for="diff">3) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (diff)</label>
                <select id="diff">
                  <option value="easy">Easy</option>
                  <option value="normal">Normal</option>
                  <option value="hard">Hard</option>
                </select>
              </div>

              <div class="field">
                <label for="style">4) ‡∏™‡πÑ‡∏ï‡∏•‡πå (style)</label>
                <select id="style">
                  <option value="feel">feel</option>
                  <option value="mix">mix</option>
                </select>
              </div>

              <div class="field">
                <label for="timeSec">5) ‡πÄ‡∏ß‡∏•‡∏≤ (time ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                <input id="timeSec" type="number" inputmode="numeric" min="30" max="180" step="5" value="90"/>
              </div>

              <div class="field">
                <label for="ai">6) AI (ai) ‚Äî ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡πà‡∏ô</label>
                <select id="ai">
                  <option value="0">OFF</option>
                  <option value="1">ON</option>
                </select>
              </div>

              <div class="field">
                <label for="practice">7) Practice (practice) ‚Äî ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ cVR</label>
                <select id="practice">
                  <option value="0">0s</option>
                  <option value="1">15s (recommended)</option>
                  <option value="10">10s</option>
                  <option value="20">20s</option>
                </select>
              </div>
            </div>

            <div class="actions">
              <button id="btnStart" class="btn btnStrong" type="button">üöÄ START ‡πÄ‡∏Å‡∏°</button>
              <button id="btnQuick" class="btn" type="button">‚ö° Quick Start (‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</button>
              <button id="btnReset" class="btn btnGhost" type="button">üßπ Reset</button>
            </div>

            <div class="note">
              ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>Cardboard (cVR)</b> ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡∏°‡∏µ <b>Calibration</b> ‡πÅ‡∏•‡∏∞ <b>Practice</b> ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á (‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ run)<br/>
              ‚Ä¢ ‡πÇ‡∏´‡∏°‡∏î <span class="warn">Research</span> ‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö <b>ai=0</b> ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô studyId/condition ‡∏Ø‡∏•‡∏Ø) ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
            </div>
          </div>
        </div>

        <div class="side">
          <div class="panel side miniPanel">
            <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°</h3>

            <div class="kv">
              <div class="k">Run URL (preview)</div>
              <div class="v" id="previewUrl">‚Äî</div>
            </div>

            <div class="kv">
              <div class="k">hub / log (‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å URL ‡∏ô‡∏µ‡πâ)</div>
              <div class="v" id="hubLog">‚Äî</div>
            </div>

            <div class="kv">
              <div class="k">Pass-through params</div>
              <div class="v" id="passThrough">‚Äî</div>
            </div>

            <div class="kv">
              <div class="k">Tips</div>
              <div class="v">
                ‚Ä¢ Miss ‡πÄ‡∏¢‡∏≠‡∏∞‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‚Üí ‡∏°‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å HUD ‡∏ö‡∏±‡∏á / ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏î‡∏ô HUD / ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏ô‡∏±‡∏ö Miss ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‚Äù<br/>
                ‚Ä¢ cVR ‚Üí ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å crosshair ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÅ‡∏ï‡∏∞‡∏à‡∏≠ = hha:shoot)
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const LS_KEY = 'HHA_GROUPS_LAUNCHER_LAST';

  const $ = (id)=>document.getElementById(id);

  function qs(k, def=null){
    try{ return new URL(location.href).searchParams.get(k) ?? def; }
    catch{ return def; }
  }

  function clamp(v,a,b){
    v = Number(v); if (!isFinite(v)) v = a;
    return v < a ? a : (v > b ? b : v);
  }

  function loadLast(){
    try{
      return JSON.parse(localStorage.getItem(LS_KEY) || 'null');
    }catch(_){
      return null;
    }
  }

  function saveLast(obj){
    try{ localStorage.setItem(LS_KEY, JSON.stringify(obj)); }catch(_){}
  }

  function detectDefaultView(){
    // best-effort: phone => mobile, desktop => pc
    const ua = navigator.userAgent || '';
    const isMobile = /Android|iPhone|iPad|iPod|Mobile/i.test(ua);
    return isMobile ? 'mobile' : 'pc';
  }

  const state = {
    view: 'mobile',
    run: 'play',
    diff: 'easy',
    style:'feel',
    time: 90,
    ai: '0',
    practice: '1'
  };

  function applyStateToUI(){
    // view buttons
    document.querySelectorAll('#viewButtons .btnBig').forEach(btn=>{
      const v = btn.getAttribute('data-view');
      btn.classList.toggle('selected', v === state.view);
    });

    $('runMode').value = state.run;
    $('diff').value = state.diff;
    $('style').value = state.style;
    $('timeSec').value = String(state.time);
    $('ai').value = String(state.ai);
    $('practice').value = String(state.practice);

    $('chipRun').textContent  = state.run;
    $('chipView').textContent = state.view;
    $('chipDiff').textContent = state.diff;
    $('chipTime').textContent = String(state.time);

    updatePreview();
  }

  function collectFromUI(){
    state.run   = $('runMode').value;
    state.diff  = $('diff').value;
    state.style = $('style').value;
    state.time  = clamp($('timeSec').value, 30, 180) | 0;
    state.ai    = $('ai').value;
    state.practice = $('practice').value;

    // research lock
    if (state.run === 'research') state.ai = '0';

    applyStateToUI();
  }

  function buildRunUrl(customView){
    const view = (customView || state.view || 'mobile');

    const runUrl = new URL('./vr-groups/groups-vr.html', location.href);
    runUrl.searchParams.set('view', view);
    runUrl.searchParams.set('run', state.run);
    runUrl.searchParams.set('diff', state.diff);
    runUrl.searchParams.set('style', state.style);
    runUrl.searchParams.set('time', String(state.time));

    // deterministic seed if not provided from upstream
    const seedUp = qs('seed', null);
    runUrl.searchParams.set('seed', String(seedUp ?? Date.now()));

    // AI + practice
    runUrl.searchParams.set('ai', String(state.run === 'research' ? '0' : state.ai));
    runUrl.searchParams.set('practice', String(view === 'cvr' ? state.practice : '0'));

    // pass hub/log if present
    const hub = qs('hub','');
    const log = qs('log','');
    if (hub) runUrl.searchParams.set('hub', hub);
    if (log) runUrl.searchParams.set('log', log);

    // pass-through other params (research context, ids, etc.)
    const sp = new URL(location.href).searchParams;
    const reserved = new Set(['view','run','diff','style','time','seed','ai','practice','hub','log']);
    const passthrough = [];
    sp.forEach((v,k)=>{
      if (reserved.has(k)) return;
      runUrl.searchParams.set(k, v);
      passthrough.push(k);
    });

    return { url: runUrl.toString(), passthroughKeys: passthrough };
  }

  function updatePreview(){
    const { url, passthroughKeys } = buildRunUrl();
    $('previewUrl').textContent = url;

    const hub = qs('hub','');
    const log = qs('log','');
    $('hubLog').textContent = (hub || log) ? (`hub=${hub || '‚Äî'}\nlog=${log || '‚Äî'}`) : '‚Äî';

    $('passThrough').textContent = passthroughKeys.length ? passthroughKeys.join(', ') : '‚Äî';
  }

  function startGame(viewOverride=null){
    collectFromUI();

    // store last
    saveLast({
      view: state.view,
      run: state.run,
      diff: state.diff,
      style: state.style,
      time: state.time,
      ai: state.ai,
      practice: state.practice
    });

    const { url } = buildRunUrl(viewOverride);
    location.href = url;
  }

  // --- Wire view buttons ---
  document.querySelectorAll('#viewButtons .btnBig').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const v = btn.getAttribute('data-view');
      state.view = v;
      applyStateToUI();
    });
  });

  // --- Inputs ---
  ['runMode','diff','style','timeSec','ai','practice'].forEach(id=>{
    $(id).addEventListener('change', collectFromUI);
    $(id).addEventListener('input', collectFromUI);
  });

  // --- Buttons ---
  $('btnStart').addEventListener('click', ()=> startGame(null));
  $('btnQuick').addEventListener('click', ()=>{
    const last = loadLast();
    if (!last){
      // fallback: start with current defaults
      startGame(null);
      return;
    }
    // apply last then start
    Object.assign(state, last);
    // research lock safety
    if (state.run === 'research') state.ai = '0';
    applyStateToUI();
    startGame(null);
  });

  $('btnReset').addEventListener('click', ()=>{
    try{ localStorage.removeItem(LS_KEY); }catch(_){}
    state.view = detectDefaultView();
    state.run = 'play';
    state.diff = 'easy';
    state.style = 'feel';
    state.time = 90;
    state.ai = '0';
    state.practice = '1';
    applyStateToUI();
  });

  // --- Init ---
  (function init(){
    const last = loadLast();
    if (last){
      Object.assign(state, last);
      if (state.run === 'research') state.ai = '0';
    }else{
      state.view = qs('view', detectDefaultView());
      state.run  = qs('run', 'play');
      state.diff = qs('diff','easy');
      state.style= qs('style','feel');
      state.time = clamp(qs('time',90), 30, 180) | 0;
      state.ai   = String(qs('ai','0'));
      state.practice = String(qs('practice','1'));
      if (state.run === 'research') state.ai = '0';
    }

    applyStateToUI();
  })();

})();
</script>
</body>
</html>