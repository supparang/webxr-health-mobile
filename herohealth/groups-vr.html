<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hero Health ‚Äî Food Groups VR</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon">

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    :root {
      color-scheme: dark;
      --bg-main:#020617;
      --panel:#020617;
      --panel-soft:#0b1120;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,0.18);
      --danger:#f97373;
      --text-main:#e5e7eb;
      --text-soft:#9ca3af;
      --radius-lg:18px;
      --radius-pill:999px;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617 55%, #000 100%);
      color: var(--text-main);
    }

    .hh-shell {
      min-height:100vh;
      display:flex;
      flex-direction:column;
      padding:12px;
      gap:10px;
    }

    header.hh-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 14px;
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.4));
      backdrop-filter: blur(18px);
      border:1px solid rgba(148,163,184,0.35);
    }
    .hh-title-main {
      font-size:16px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .hh-title-main span.emoji {
      font-size:20px;
    }
    .hh-title-sub {
      font-size:11px;
      color:var(--text-soft);
    }

    .hh-main {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .hud-layer {
      position:relative;
      z-index:10;
      pointer-events:none;
    }

    .hud-top {
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-bottom:8px;
    }
    .hud-block {
      flex:1;
      padding:6px 10px;
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg, #020617, #020617);
      border:1px solid rgba(148,163,184,0.5);
      font-size:11px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .hud-block strong {
      font-size:13px;
    }

    .hud-fever-wrap {
      width:100%;
      height:8px;
      border-radius:var(--radius-pill);
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(148,163,184,0.5);
      overflow:hidden;
    }
    .hud-fever-bar {
      width:0%;
      height:100%;
      background:linear-gradient(90deg, #22c55e, #a3e635);
      box-shadow:0 0 12px rgba(34,197,94,0.7);
      transition:width .15s ease-out;
    }

    .hud-quest {
      margin-top:8px;
      padding:8px 10px;
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg, #020617, #020617);
      border:1px solid rgba(148,163,184,0.5);
      font-size:11px;
    }
    .hud-quest-label {
      margin-bottom:6px;
      color:var(--text-soft);
    }
    .hud-quest-label strong {
      color:var(--text-main);
    }
    .hud-quest-progress {
      width:100%;
      height:6px;
      border-radius:var(--radius-pill);
      background:rgba(15,23,42,0.85);
      overflow:hidden;
    }
    .hud-quest-progress-fill {
      width:0%;
      height:100%;
      background:linear-gradient(90deg,#22c55e,#4ade80);
      transition:width .15s ease-out;
    }

    .coach-bubble {
      margin-top:8px;
      display:flex;
      align-items:flex-start;
      gap:8px;
      font-size:11px;
    }
    .coach-avatar {
      width:28px;
      height:28px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 20%, #fef3c7, #facc15);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      box-shadow:0 0 0 2px rgba(234,179,8,0.5);
    }
    .coach-text {
      padding:6px 9px;
      border-radius:var(--radius-lg);
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      color:var(--text-soft);
    }

    .scene-wrap {
      position:relative;
      margin-top:8px;
      border-radius:var(--radius-lg);
      overflow:hidden;
      border:1px solid rgba(30,64,175,0.9);
      box-shadow:0 18px 40px rgba(15,23,42,0.9);
      background:#000;
      min-height:320px;
    }

    a-scene {
      width:100%;
      height:100%;
    }

    .fx-layer {
      pointer-events:none;
      position:fixed;
      inset:0;
      z-index:50;
    }
    .fx-score {
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%, -50%);
      font-size:26px;
      font-weight:700;
      opacity:0;
      animation:fx-score-pop 0.55s ease-out forwards;
      text-shadow:0 0 10px rgba(0,0,0,0.8);
    }
    .fx-score.good  { color:#4ade80; }
    .fx-score.miss  { color:#f97373; }
    .fx-score.quest { color:#fbbf24; }

    @keyframes fx-score-pop {
      0%   { transform:translate(-50%, -10px) scale(0.6); opacity:0; }
      20%  { transform:translate(-50%, -18px) scale(1);   opacity:1; }
      100% { transform:translate(-50%, -42px) scale(1.05); opacity:0; }
    }

    .overlay-finish {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(0,0,0,0.96));
      color:#e5e7eb;
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity .35s ease-out;
    }
    .overlay-finish.active {
      opacity:1;
      pointer-events:auto;
    }
    .overlay-card {
      width:100%;
      max-width:360px;
      padding:16px 18px;
      border-radius:24px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.7);
      box-shadow:0 20px 50px rgba(0,0,0,0.7);
      font-size:12px;
    }
    .overlay-card h2 {
      margin:0 0 6px;
      font-size:16px;
    }
    .overlay-card p {
      margin:2px 0;
      color:var(--text-soft);
    }
    .overlay-grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:6px;
      margin-top:8px;
      font-size:11px;
    }
    .overlay-grid div {
      padding:6px 8px;
      border-radius:14px;
      background:#020617;
      border:1px solid rgba(148,163,184,0.5);
    }
    .overlay-btn-row {
      margin-top:10px;
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }
    .overlay-btn {
      font-size:11px;
      border-radius:var(--radius-pill);
      border:none;
      padding:6px 10px;
      cursor:pointer;
    }
    .overlay-btn-primary {
      background:linear-gradient(135deg,#22c55e,#4ade80);
      color:#020617;
      font-weight:600;
    }
    .overlay-btn-ghost {
      background:transparent;
      color:var(--text-soft);
      border:1px solid rgba(148,163,184,0.6);
    }

    @media (min-width: 900px) {
      .hh-shell { padding:16px 18px; max-width:900px; margin:0 auto; }
    }
  </style>
</head>
<body>
<div class="hh-shell">
  <header class="hh-header">
    <div>
      <div class="hh-title-main">
        <span class="emoji">ü•ó</span>
        <span>Hero Health ‚Äî Food Groups VR</span>
      </div>
      <div class="hh-title-sub">
        ‡∏ï‡∏µ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 5 ‡∏´‡∏°‡∏π‡πà + Mini Quest + Fever Gauge
      </div>
    </div>
    <div style="font-size:11px;color:var(--text-soft);">
      diff=<span id="hh-diff-label">normal</span>
    </div>
  </header>

  <main class="hh-main">
    <!-- HUD & Coach -->
    <section class="hud-layer">
      <div class="hud-top">
        <div class="hud-block">
          <span>‚è± ‡πÄ‡∏ß‡∏•‡∏≤</span>
          <strong><span data-groupsvr-time>70s</span></strong>
        </div>
        <div class="hud-block">
          <span>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
          <strong><span data-groupsvr-score>0</span></strong>
        </div>
      </div>

      <div class="hud-fever-wrap">
        <div class="hud-fever-bar" data-groupsvr-fever></div>
      </div>

      <div class="hud-quest">
        <div class="hud-quest-label" data-groupsvr-quest>
          Mini Quest 1/5: ‡∏ï‡∏µ‡∏ú‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 5 ‡∏ä‡∏¥‡πâ‡∏ô (0/5)
        </div>
        <div class="hud-quest-progress">
          <div class="hud-quest-progress-fill" data-groupsvr-quest-bar></div>
        </div>
      </div>

      <div class="coach-bubble">
        <div class="coach-avatar">üëß</div>
        <div class="coach-text" id="groupsvr-coach">
          ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏•‡πà‡∏≤‡∏´‡∏°‡∏π‡πà‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 5 ‡∏´‡∏°‡∏π‡πà‡∏Å‡∏±‡∏ô‡∏ô‡∏∞! ‡∏ï‡∏µ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ó‡∏≥ Mini Quest ‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏≠‡∏±‡∏ô üí™
        </div>
      </div>
    </section>

    <!-- A-Frame Scene -->
    <section class="scene-wrap">
      <a-scene
        renderer="alpha:true;antialias:true"
        vr-mode-ui="enabled: true"
        embedded
        background="color: #020617">

        <!-- Camera + Cursor (mouse / touch / VR) -->
        <a-entity id="rig">
          <a-entity id="camera" camera wasd-controls look-controls="pointerLockEnabled: false" position="0 1.6 0">
            <a-entity id="cursor"
              cursor="fuse: false; rayOrigin: mouse"
              raycaster="objects: .hh-target"
              position="0 0 -1"
              geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
              material="shader: flat; opacity: 0.85">
            </a-entity>
          </a-entity>
        </a-entity>

        <!-- Simple lights -->
        <a-entity light="type: directional; color: #ffffff; intensity: 0.9" position="0 2 1"></a-entity>
        <a-entity light="type: ambient; color: #666"></a-entity>

        <!-- Panel behind target -->
        <a-plane position="0 1.6 -2.5"
                 rotation="-5 0 0"
                 width="2.8"
                 height="1.6"
                 color="#020617"
                 material="opacity: 0.85"></a-plane>

        <!-- Floor -->
        <a-entity geometry="primitive: circle; radius: 6"
                  rotation="-90 0 0"
                  material="color: #020617">
        </a-entity>
      </a-scene>

      <!-- Summary overlay -->
      <div class="overlay-finish" id="groupsvr-finish">
        <div class="overlay-card">
          <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• Food Groups VR</h2>
          <p id="groupsvr-finish-main">‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ü•≥</p>

          <div class="overlay-grid">
            <div>
              <div>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
              <strong id="groupsvr-fin-score">0</strong>
            </div>
            <div>
              <div>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å / ‡∏û‡∏•‡∏≤‡∏î</div>
              <strong><span id="groupsvr-fin-hits">0</span> / <span id="groupsvr-fin-miss">0</span></strong>
            </div>
            <div>
              <div>ü•ó ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏µ‡πÇ‡∏î‡∏ô (1-5)</div>
              <strong id="groupsvr-fin-groups">-</strong>
            </div>
            <div>
              <div>üß© Mini Quest</div>
              <strong id="groupsvr-fin-quests">-</strong>
            </div>
          </div>

          <div class="overlay-btn-row">
            <button class="overlay-btn overlay-btn-ghost" onclick="window.history.back()">‡∏Å‡∏•‡∏±‡∏ö Hub</button>
            <button class="overlay-btn overlay-btn-primary" onclick="window.location.reload()">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- FX layer -->
<div class="fx-layer" id="groupsvr-fx"></div>

<!-- Difficulty & Game Engine -->
<script src="./vr-groups/difficulty.foodgroups.js"></script>
<script src="./vr-groups/GameEngine.js"></script>

<script>
  // ‡πÅ‡∏™‡∏î‡∏á diff ‡∏à‡∏≤‡∏Å URL ‡πÉ‡∏ô header
  (function () {
    try {
      const url = new URL(window.location.href);
      const diff = (url.searchParams.get('diff') || 'normal').toLowerCase();
      const el = document.getElementById('hh-diff-label');
      if (el) el.textContent = diff;
    } catch (e) {
      // ignore
    }
  })();
</script>
</body>
</html>
