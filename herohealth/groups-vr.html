<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth — Groups VR (Launcher)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="./favicon.ico" type="image/x-icon" />
  <style>
    :root{ color-scheme:dark; }
    body{
      margin:0; height:100vh; display:grid; place-items:center;
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:#020617; color:#e5e7eb;
    }
    .card{
      width:min(520px,92vw);
      background:rgba(15,23,42,.65);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px;
      padding:18px;
      box-shadow:0 18px 60px rgba(0,0,0,.45);
    }
    .t{ font-weight:900; font-size:18px; margin:0 0 6px 0; }
    .s{ opacity:.85; margin:0 0 12px 0; line-height:1.35; }
    .row{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .pill{
      padding:6px 10px; border-radius:999px;
      background:rgba(2,6,23,.65);
      border:1px solid rgba(148,163,184,.18);
      font-weight:800; font-size:12px;
    }
    .btn{
      margin-top:14px; width:100%;
      border-radius:14px; border:0;
      padding:12px 14px; font-weight:900;
      background:#22c55e; color:#04110a;
    }
    .ghost{
      background:transparent; color:#e5e7eb;
      border:1px solid rgba(148,163,184,.22);
      margin-top:10px;
    }
  </style>
</head>
<body>
  <div class="card">
    <p class="t">กำลังเปิด Food Groups VR…</p>
    <p class="s">Launcher จะพาไปยังตัวเกมในโฟลเดอร์ <b>/vr-groups/</b></p>

    <div class="row" id="pills"></div>

    <button class="btn" id="go">เข้าเกม</button>
    <button class="btn ghost" id="back">กลับ HUB</button>
  </div>

<script>
(function(){
  'use strict';
  const sp = new URLSearchParams(location.search);

  // default params
  const diff = (sp.get('diff') || 'normal').toLowerCase();
  const time = Math.max(30, Math.min(180, parseInt(sp.get('time') || '90', 10) || 90));
  const run  = (sp.get('run') || sp.get('runMode') || 'play').toLowerCase();

  const hub  = sp.get('hub') || './hub.html';

  // seed fallback: use sessionId/studentKey + ts for deterministic research
  const sid  = sp.get('sessionId') || sp.get('studentKey') || '';
  const ts   = sp.get('ts') || String(Date.now());
  if (!sp.get('seed')) sp.set('seed', sid ? (sid + '|' + ts) : ts);

  // normalize
  sp.set('diff', (['easy','normal','hard'].includes(diff) ? diff : 'normal'));
  sp.set('time', String(time));
  sp.set('run', (run === 'research' ? 'research' : 'play'));
  sp.set('ts', ts);
  sp.set('hub', hub);

  // show pills
  const pills = document.getElementById('pills');
  const mk = (k,v)=>{
    const d = document.createElement('div');
    d.className = 'pill';
    d.textContent = `${k}: ${v}`;
    pills.appendChild(d);
  };
  mk('DIFF', sp.get('diff'));
  mk('TIME', sp.get('time')+'s');
  mk('MODE', sp.get('run'));
  mk('SEED', sp.get('seed').slice(0,24) + (sp.get('seed').length>24?'…':''));

  const target = './vr-groups/groups-vr.html?' + sp.toString();

  document.getElementById('go').onclick = ()=> location.href = target;
  document.getElementById('back').onclick = ()=>{
    try{
      const u = new URL(hub, location.href);
      u.searchParams.set('ts', String(Date.now()));
      location.href = u.toString();
    }catch{
      location.href = hub;
    }
  };

  // auto forward if requested
  if ((new URLSearchParams(location.search)).get('autostart') === '1') {
    location.href = target;
  }
})();
</script>
</body>
</html>