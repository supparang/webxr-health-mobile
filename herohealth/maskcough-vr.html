<!-- === /herohealth/maskcough-vr.html ===
Mask&Cough VR LAUNCHER — ROOT (HHA Standard)
✅ Redirects to ./vr-maskcough/maskcough-vr.html
✅ Auto-detect view (pc/mobile/vr/cvr) ONLY if ?view= missing
✅ Pass-through hub/run/diff/time/seed/mode/log/studyId/phase/conditionGroup/pid
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth — Mask & Cough (Launcher)</title>
  <meta name="color-scheme" content="dark light"/>
  <meta name="theme-color" content="#020617"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    html,body{height:100%;margin:0;background:#020617;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:22px}
    .card{width:min(820px,100%);border:1px solid rgba(148,163,184,.18);border-radius:18px;background:rgba(2,6,23,.72);padding:18px}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(148,163,184,.18);border-radius:999px;padding:6px 10px;color:#cbd5e1;background:rgba(15,23,42,.45);font-size:12px}
    h1{margin:12px 0 6px;font-size:22px}
    p{margin:0;color:#94a3b8;line-height:1.45}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{appearance:none;border:1px solid rgba(148,163,184,.18);background:rgba(15,23,42,.55);color:#e5e7eb;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .muted{opacity:.85;font-size:12px;margin-top:10px}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;color:#cbd5e1}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <span class="pill">HeroHealth · Hygiene · Mask & Cough</span>
      <h1>กำลังเข้าสู่เกม…</h1>
      <p>ระบบกำลังตรวจอุปกรณ์และเลือกโหมด <b>pc/mobile/vr/cvr</b> อัตโนมัติ (ถ้า URL มี <code>?view=</code> จะไม่ยุ่ง)</p>
      <div class="row">
        <button class="btn" id="go">Tap to start</button>
      </div>
      <div class="muted" id="dbg"></div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  function getQS(){
    try{ return new URL(location.href).searchParams; }
    catch{ return new URLSearchParams(); }
  }
  const QS = getQS();
  const dbg = document.getElementById('dbg');

  const passthroughKeys = [
    'hub','run','diff','time','seed','mode','log',
    'studyId','phase','conditionGroup','pid','studentKey','reason'
  ];

  function isMobile(){
    const ua = navigator.userAgent || '';
    const coarse = matchMedia && matchMedia('(pointer: coarse)').matches;
    return /Android|iPhone|iPad|iPod/i.test(ua) || coarse;
  }

  async function detectView(){
    // IMPORTANT: do not override if view exists
    const existing = (QS.get('view')||'').toLowerCase();
    if(existing) return existing;

    // cVR hint params (only if view missing)
    const cvrHint = (QS.get('cvr')==='1' || QS.get('cardboard')==='1' || (QS.get('viewer')||'').toLowerCase()==='cardboard');
    if(isMobile() && cvrHint) return 'cvr';

    // WebXR check
    try{
      if(navigator.xr && navigator.xr.isSessionSupported){
        const ok = await navigator.xr.isSessionSupported('immersive-vr');
        if(ok) return 'vr';
      }
    }catch(_){}

    return isMobile() ? 'mobile' : 'pc';
  }

  function buildTargetUrl(view){
    const base = './vr-maskcough/maskcough-vr.html';
    const u = new URL(base, location.href);

    // pass-through
    for(const k of passthroughKeys){
      const v = QS.get(k);
      if(v!=null && v!=='') u.searchParams.set(k, v);
    }

    // set detected view only if view missing
    if(!(QS.get('view')||'')) u.searchParams.set('view', view);

    // If caller didn't pass hub, set default hub fallback (root hub)
    if(!u.searchParams.get('hub')){
      u.searchParams.set('hub', new URL('./hub.html', location.href).toString());
    }

    return u.toString();
  }

  async function go(){
    const view = await detectView();
    const url = buildTargetUrl(view);
    if(dbg) dbg.innerHTML = `view=<code>${view}</code> → <code>${url.replace(location.origin,'')}</code>`;
    location.replace(url);
  }

  document.getElementById('go').addEventListener('click', go, {passive:true});

  // Auto-go quickly (still keeps a tap button visible)
  setTimeout(()=>{ go(); }, 30);
})();
</script>
</body>
</html>