<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Mask & Cough (Launcher)</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="./favicon.ico" />
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.70); --panel2:rgba(15,23,42,.62);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;
      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; --cyan:#22d3ee; --violet:#a78bfa;
      --radius:22px; --shadow:0 18px 60px rgba(0,0,0,.45);
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial;
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(1000px 600px at 85% 20%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 520px at 55% 90%, rgba(167,139,250,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      overflow:auto;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:980px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }
    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .head{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--stroke);
      background: rgba(2,6,23,.35);
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .title{
      margin:0;
      font-size: clamp(20px, 2.1vw, 28px);
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .sub{
      margin:6px 0 0 0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.45;
      max-width: 78ch;
      font-weight: 800;
    }
    .pillrow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .pill{
      background: rgba(2,6,23,.55);
      border:1px solid var(--stroke);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(8px);
      white-space:nowrap;
      user-select:none;
    }
    .pill b{ color:var(--text); font-weight:1000; }

    .body{ padding: 14px; display:grid; grid-template-columns: 1.1fr .9fr; gap:12px; }
    @media (max-width: 860px){ .body{ grid-template-columns:1fr; } }

    .panel{
      border:1px solid var(--stroke);
      border-radius: 18px;
      background: rgba(2,6,23,.35);
      padding: 12px;
    }
    .h3{ margin:0 0 8px 0; font-size:14px; font-weight:1000; }
    .txt{ margin:0; color:rgba(229,231,235,.82); font-size:13px; line-height:1.5; font-weight: 800; }

    .grid{
      margin-top:10px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 560px){ .grid{ grid-template-columns:1fr; } }

    .btn{
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.42);
      padding: 12px 12px;
      border-radius: 16px;
      color: var(--text);
      cursor:pointer;
      user-select:none;
      font-weight: 1000;
      font-size: 13px;
      display:flex; align-items:center; justify-content:center; gap:8px;
      transition: transform .12s ease, opacity .12s ease, border-color .12s ease, background .12s ease;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.12); }
    .btn.cyan{ border-color: rgba(34,211,238,.28); background: rgba(34,211,238,.10); }
    .btn.warn{ border-color: rgba(245,158,11,.28); background: rgba(245,158,11,.10); }
    .btn.ghost{ color: var(--muted); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    .field{
      flex:1 1 180px;
      display:flex; gap:8px; align-items:center;
      border:1px solid var(--stroke);
      background: rgba(2,6,23,.30);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .field label{ color:var(--muted); font-size:12px; font-weight:900; }
    .field input, .field select{
      width: 100%;
      background: transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:13px;
      font-weight:1000;
    }
    .hint{ margin-top:10px; color:var(--muted); font-size:12px; line-height:1.45; font-weight:800; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + var(--sab));
      transform: translateX(-50%);
      background: rgba(2,6,23,.85);
      border:1px solid rgba(148,163,184,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      z-index: 9999;
      max-width: 92vw;
      font-size: 13px;
      font-weight: 900;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>

<body>
  <div class="wrap">
    <section class="card">
      <div class="head">
        <div>
          <h1 class="title">üò∑ü§ß Mask & Cough ‚Äî Launcher</h1>
          <p class="sub">
            ‡πÄ‡∏Å‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Analyze C4): ‡∏≠‡πà‡∏≤‡∏ô ‚ÄúRisk Zones + Telegraph + Threat‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏¢‡∏¥‡∏á/‡πÅ‡∏ï‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
          </p>
        </div>
        <div class="pillrow" id="pillrow"></div>
      </div>

      <div class="body">
        <div class="panel">
          <div class="h3">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏£‡πá‡∏ß</div>

          <div class="row">
            <div class="field">
              <label>run</label>
              <select id="fRun">
                <option value="play">play</option>
                <option value="study">study</option>
                <option value="research">research</option>
              </select>
            </div>

            <div class="field">
              <label>diff</label>
              <select id="fDiff">
                <option value="easy">easy</option>
                <option value="normal" selected>normal</option>
                <option value="hard">hard</option>
              </select>
            </div>

            <div class="field">
              <label>time</label>
              <input id="fTime" inputmode="numeric" value="80" />
            </div>

            <div class="field">
              <label>view</label>
              <select id="fView">
                <option value="">auto</option>
                <option value="pc">pc</option>
                <option value="mobile">mobile</option>
                <option value="cvr">cvr</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>pid</label>
              <input id="fPid" value="anon" />
            </div>

            <div class="field">
              <label>seed</label>
              <input id="fSeed" inputmode="numeric" placeholder="auto" />
            </div>
          </div>

          <div class="row">
            <div class="field" style="flex:1 1 100%;">
              <label>log</label>
              <input id="fLog" placeholder="(optional) endpoint for NDJSON" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>studyId</label>
              <input id="fStudyId" placeholder="(optional)" />
            </div>
            <div class="field">
              <label>phase</label>
              <input id="fPhase" placeholder="(optional)" />
            </div>
            <div class="field">
              <label>conditionGroup</label>
              <input id="fCond" placeholder="(optional)" />
            </div>
          </div>

          <div class="grid">
            <button class="btn primary" id="btnPlay">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Run)</button>
            <button class="btn cyan" id="btnQuickPlay">‚ö° Quick Play (normal/80)</button>
            <button class="btn warn" id="btnNewSeed">üé≤ New seed</button>
            <button class="btn ghost" id="btnBackHub">üè∞ ‡∏Å‡∏•‡∏±‡∏ö HUB</button>
          </div>

          <div class="hint">
            * Launcher ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á <b>/herohealth/vr-maskcough/maskcough.html</b> ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏° <b>hub=</b> ‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥<br/>
            * ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: study/research = deterministic + ‡∏õ‡∏¥‡∏î adaptive (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô engine ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)
          </div>
        </div>

        <div class="panel">
          <div class="h3">üìç Route / Debug</div>
          <p class="txt" style="margin-bottom:10px;">
            Run file (folder): <b>/herohealth/vr-maskcough/maskcough.html</b><br/>
            Root launcher: <b>/herohealth/maskcough-vr.html</b>
          </p>

          <div class="grid">
            <a class="btn" id="btnOpenRun" href="./vr-maskcough/maskcough.html">üîó ‡πÄ‡∏õ‡∏¥‡∏î Run ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</a>
            <button class="btn" id="btnCopyUrl" type="button">üìã Copy URL</button>
          </div>

          <p class="hint">
            ‡∏ñ‡πâ‡∏≤ CSS ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤ run file ‡∏≠‡πâ‡∏≤‡∏á CSS ‡∏ñ‡∏π‡∏Å path (‡πÄ‡∏ä‡πà‡∏ô <b>./maskcough.css</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>./css/maskcough.css</b>)<br/>
            ‡πÅ‡∏•‡∏∞‡∏î‡∏π 404 ‡πÉ‡∏ô Console/Network
          </p>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  function pageUrl(){ return location.href.split('#')[0]; }
  function qs(){ try{ return new URL(pageUrl()).searchParams; }catch{ return new URLSearchParams(); } }
  const QS = qs();

  const PASS_KEYS = ['pid','run','mode','diff','time','seed','studyId','phase','conditionGroup','log','view'];

  function clampInt(v, a, b){
    v = parseInt(String(v||''), 10);
    if(!Number.isFinite(v)) v = a;
    return Math.max(a, Math.min(b, v));
  }
  function nowSeed(){ return String(Date.now()); }

  // toast
  const toastEl = document.getElementById('toast');
  let toastTimer=null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    toastTimer = setTimeout(()=> toastEl.classList.remove('show'), 1400);
  }

  // auto view detect
  function viewAuto(){
    const ua = navigator.userAgent || '';
    const coarse = (window.matchMedia && window.matchMedia('(pointer:coarse)').matches);
    const mobile = /Android|iPhone|iPad|iPod/i.test(ua) || coarse;
    return mobile ? 'mobile' : 'pc';
  }

  // read defaults from QS
  const fRun = document.getElementById('fRun');
  const fDiff = document.getElementById('fDiff');
  const fTime = document.getElementById('fTime');
  const fPid = document.getElementById('fPid');
  const fSeed = document.getElementById('fSeed');
  const fView = document.getElementById('fView');
  const fLog = document.getElementById('fLog');
  const fStudyId = document.getElementById('fStudyId');
  const fPhase = document.getElementById('fPhase');
  const fCond = document.getElementById('fCond');

  function setIf(el, v){
    if(!el) return;
    if(el.tagName === 'SELECT'){
      for(const opt of el.options){
        if(opt.value === v){ el.value = v; return; }
      }
    }
    el.value = v;
  }

  // hydrate form from QS
  setIf(fRun,  (QS.get('run') || QS.get('mode') || 'play').toLowerCase());
  setIf(fDiff, (QS.get('diff') || 'normal').toLowerCase());
  setIf(fTime, String(clampInt(QS.get('time') || '80', 20, 300)));
  setIf(fPid,  (QS.get('pid') || 'anon'));
  setIf(fSeed, (QS.get('seed') || ''));
  setIf(fView, (QS.get('view') || ''));
  setIf(fLog,  (QS.get('log') || ''));
  setIf(fStudyId, (QS.get('studyId') || ''));
  setIf(fPhase, (QS.get('phase') || ''));
  setIf(fCond, (QS.get('conditionGroup') || ''));

  // pills
  function renderPills(){
    const pills = [
      ['pid', fPid.value],
      ['run', fRun.value],
      ['diff', fDiff.value],
      ['time', fTime.value],
      ['seed', fSeed.value || '(auto)'],
      ['view', fView.value || '(auto)'],
      ['log', fLog.value ? 'yes' : '‚Äî'],
    ];
    const el = document.getElementById('pillrow');
    el.innerHTML = pills
      .map(([k,v]) => `<span class="pill"><b>${k}</b>: ${String(v).replace(/</g,'&lt;')}</span>`)
      .join('');
  }
  renderPills();

  // build hub url (prefer incoming hub param; else self -> hub.html)
  function buildHubUrl(){
    const hubIncoming = (QS.get('hub') || '').trim();
    if(hubIncoming) return hubIncoming;

    // if opened from hub, use referrer when plausible
    try{
      const ref = document.referrer || '';
      if(ref.includes('/herohealth/hub.html')) return ref;
    }catch(_){}

    try{
      const u = new URL('./hub.html', location.href);
      return u.toString();
    }catch(_){
      return './hub.html';
    }
  }

  function buildRunUrl(){
    const runPath = './vr-maskcough/maskcough.html';
    const u = new URL(runPath, location.href);
    const sp = u.searchParams;

    // core params
    const pid = (fPid.value || 'anon').trim() || 'anon';
    const run = (fRun.value || 'play').trim().toLowerCase();
    const diff = (fDiff.value || 'normal').trim().toLowerCase();
    const time = clampInt(fTime.value || 80, 20, 300);
    const seed = (String(fSeed.value || '').trim() || nowSeed());
    const view = (String(fView.value || '').trim().toLowerCase()) || '';

    sp.set('pid', pid);
    sp.set('run', run);
    sp.set('diff', diff);
    sp.set('time', String(time));
    sp.set('seed', seed);

    if(view) sp.set('view', view);

    // optional
    const log = (String(fLog.value || '').trim());
    if(log) sp.set('log', log);

    const studyId = (String(fStudyId.value || '').trim());
    const phase = (String(fPhase.value || '').trim());
    const cond = (String(fCond.value || '').trim());

    if(studyId) sp.set('studyId', studyId);
    if(phase) sp.set('phase', phase);
    if(cond) sp.set('conditionGroup', cond);

    // hub passthrough
    sp.set('hub', buildHubUrl());

    return u.toString();
  }

  // buttons
  document.getElementById('btnNewSeed').addEventListener('click', ()=>{
    fSeed.value = nowSeed();
    renderPills();
    toast('New seed ‚úÖ');
  });

  document.getElementById('btnQuickPlay').addEventListener('click', ()=>{
    fRun.value = 'play';
    fDiff.value = 'normal';
    fTime.value = '80';
    if(!fView.value) fView.value = viewAuto();
    fSeed.value = nowSeed();
    renderPills();
    location.href = buildRunUrl();
  });

  document.getElementById('btnPlay').addEventListener('click', ()=>{
    if(!fView.value) fView.value = viewAuto();
    if(!String(fSeed.value||'').trim()) fSeed.value = nowSeed();
    renderPills();
    location.href = buildRunUrl();
  });

  document.getElementById('btnBackHub').addEventListener('click', ()=>{
    location.href = buildHubUrl();
  });

  // open run direct with passthrough
  const btnOpenRun = document.getElementById('btnOpenRun');
  btnOpenRun.addEventListener('click', (e)=>{
    e.preventDefault();
    if(!fView.value) fView.value = viewAuto();
    if(!String(fSeed.value||'').trim()) fSeed.value = nowSeed();
    renderPills();
    location.href = buildRunUrl();
  });

  // copy url
  document.getElementById('btnCopyUrl').addEventListener('click', async ()=>{
    try{
      const url = buildRunUrl();
      await navigator.clipboard.writeText(url);
      toast('Copy URL ‚úÖ');
    }catch(_){
      toast('Copy ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (browser)');
    }
  });

  // keep pills live
  ['change','input'].forEach(evt=>{
    document.querySelectorAll('input,select').forEach(el=>{
      el.addEventListener(evt, renderPills, {passive:true});
    });
  });

})();
</script>

</body>
</html>