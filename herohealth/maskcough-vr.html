<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>HeroHealth ‚Äî MaskCough (Launcher)</title>
  <meta name="color-scheme" content="dark light"/>
  <link rel="icon" href="./favicon.ico"/>
  <style>
    :root{
      --bg1:#020617; --bg2:#0b1226;
      --panel:rgba(2,6,23,.70);
      --panel2:rgba(15,23,42,.55);
      --stroke:rgba(148,163,184,.18);
      --text:#e5e7eb; --muted:#94a3b8;
      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --cyan:#22d3ee; --violet:#a78bfa;
      --r:22px;
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial;
      background:
        radial-gradient(1100px 680px at 12% 12%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 560px at 86% 18%, rgba(167,139,250,.10), transparent 55%),
        radial-gradient(860px 520px at 54% 92%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal));
      overflow:auto;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
    .top{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-start}
    .title{margin:0;font-weight:1000;letter-spacing:.2px;font-size: clamp(22px, 2.3vw, 30px)}
    .sub{margin:6px 0 0 0;color:var(--muted);font-weight:800;font-size:13px;line-height:1.4;max-width:75ch}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .pill{border:1px solid var(--stroke);background:rgba(2,6,23,.45);padding:8px 10px;border-radius:999px;font-size:12px;color:var(--muted);font-weight:900}
    .pill b{color:var(--text)}
    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(2,6,23,.78), rgba(2,6,23,.46));
      border-radius:var(--r);
      box-shadow:0 18px 60px rgba(0,0,0,.40);
      padding:14px;
    }
    .grid{display:grid;grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px}
    @media (max-width: 820px){ .grid{grid-template-columns:1fr} }
    label{display:block;font-size:12px;color:rgba(229,231,235,.78);font-weight:900;margin:0 0 6px 2px}
    input,select{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.45);
      color:var(--text);
      padding:11px 12px;
      font-weight:900;
      outline:none;
    }
    .row{display:grid;grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px}
    @media (max-width: 820px){ .row{grid-template-columns:1fr} }

    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;justify-content:center;
      padding:11px 12px;border-radius:16px;border:1px solid var(--stroke);
      background:rgba(2,6,23,.42);color:var(--text);
      font-weight:1000;font-size:13px;cursor:pointer;user-select:none
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.14)}
    .btn.cyan{border-color: rgba(34,211,238,.25); background: rgba(34,211,238,.12)}
    .btn.ghost{color:var(--muted)}
    .hint{margin-top:8px;color:rgba(229,231,235,.76);font-size:12px;font-weight:800;line-height:1.35}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .toast{
      position:fixed;left:50%;bottom:calc(16px + var(--sab));
      transform:translateX(-50%);
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.84);color:var(--text);
      font-weight:950;font-size:13px;box-shadow:0 14px 44px rgba(0,0,0,.35);
      opacity:0;transition:opacity .18s ease;pointer-events:none;z-index:9999;
      max-width:92vw;
    }
    .toast.show{opacity:1}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1 class="title">üò∑ü§ß MaskCough ‚Äî Launcher</h1>
      <p class="sub">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å/‡πÄ‡∏ß‡∏•‡∏≤/‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô ‚Ä¢ ‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏õ run page ‡πÅ‡∏ö‡∏ö HHA Standard</p>
    </div>
    <div class="pillrow" id="pillrow"></div>
  </div>

  <section class="card">
    <div class="grid">
      <div>
        <label>Participant ID (pid)</label>
        <input id="pid" placeholder="anon"/>
      </div>

      <div class="row">
        <div>
          <label>Mode (run)</label>
          <select id="run">
            <option value="play">play (AI ON)</option>
            <option value="study">study (deterministic / AI OFF)</option>
          </select>
        </div>
        <div>
          <label>Difficulty (diff)</label>
          <select id="diff">
            <option value="easy">easy</option>
            <option value="normal" selected>normal</option>
            <option value="hard">hard</option>
          </select>
        </div>
        <div>
          <label>Time (sec)</label>
          <input id="time" type="number" min="20" max="300" step="5" value="60"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>View</label>
          <select id="view">
            <option value="pc">pc</option>
            <option value="mobile">mobile</option>
            <option value="cvr">cvr (Cardboard)</option>
          </select>
        </div>
        <div>
          <label>Seed</label>
          <input id="seed" placeholder="(auto)"/>
        </div>
        <div>
          <label>Log endpoint</label>
          <input id="log" placeholder="https://... (optional)"/>
        </div>
      </div>

      <div>
        <label>Research context (optional)</label>
        <div class="row">
          <input id="studyId" placeholder="studyId"/>
          <input id="phase" placeholder="phase (pre/post/followup)"/>
          <input id="conditionGroup" placeholder="conditionGroup"/>
        </div>
        <div class="hint">
          * ‡πÇ‡∏´‡∏°‡∏î <b>study</b> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î <span class="mono">seed</span> ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠ fair/controlled
        </div>
      </div>
    </div>

    <div class="btnrow">
      <button class="btn primary" id="btnPlay" type="button">‚ñ∂ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô (Run)</button>
      <button class="btn cyan" id="btnCvr" type="button">üéØ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ö‡∏ö cVR</button>
      <a class="btn ghost" id="btnBackHub" href="./hub.html">üè∞ ‡∏Å‡∏•‡∏±‡∏ö HUB</a>
    </div>

    <div class="hint">
      Run page: <span class="mono">/herohealth/vr-maskcough/maskcough.html</span><br/>
      Gate: set <span class="mono">HHA_ZONE_DONE::hygiene::YYYY-MM-DD</span> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏Å‡∏°
    </div>
  </section>
</div>

<div class="toast" id="toast"></div>

<script>
(function(){
  'use strict';

  const LS = 'HHA_LAST_LAUNCH::maskcough';

  function pageUrl(){ return location.href.split('#')[0]; }
  function qs(k,d=''){ try{ return new URL(pageUrl()).searchParams.get(k) ?? d; }catch(_){ return d; } }
  function clamp(v,min,max){ v=Number(v); if(!Number.isFinite(v)) v=min; return Math.max(min, Math.min(max, v)); }
  function nowSeed(){ return String(Date.now()); }

  function toast(msg){
    const el=document.getElementById('toast');
    el.textContent=msg;
    el.classList.add('show');
    clearTimeout(toast._t);
    toast._t=setTimeout(()=>el.classList.remove('show'), 1100);
  }

  // ---- load defaults from URL or last launch
  let last=null;
  try{ last = JSON.parse(localStorage.getItem(LS)||'null'); }catch(_){}

  const P = {
    pid:  (qs('pid','') || last?.pid || 'anon').trim(),
    run:  String(qs('run', qs('mode','') ) || last?.run || 'play').toLowerCase(),
    diff: String(qs('diff','') || last?.diff || 'normal').toLowerCase(),
    time: clamp(qs('time', last?.time ?? '60'), 20, 300),
    seed: String(qs('seed','') || last?.seed || ''),
    view: String(qs('view','') || last?.view || ''),
    log:  String(qs('log','') || last?.log || ''),
    studyId: String(qs('studyId','') || last?.studyId || ''),
    phase: String(qs('phase','') || last?.phase || ''),
    conditionGroup: String(qs('conditionGroup','') || last?.conditionGroup || ''),
    hub: String(qs('hub','') || './hub.html')
  };

  // set UI
  const $ = (id)=>document.getElementById(id);
  $('pid').value = P.pid;
  $('run').value = (P.run==='study'?'study':'play');
  $('diff').value = (['easy','normal','hard'].includes(P.diff)?P.diff:'normal');
  $('time').value = String(P.time);
  $('seed').value = P.seed;
  $('view').value = (P.view==='mobile'||P.view==='cvr'||P.view==='pc') ? P.view : 'pc';
  $('log').value = P.log;
  $('studyId').value = P.studyId;
  $('phase').value = P.phase;
  $('conditionGroup').value = P.conditionGroup;

  // pill row
  const pillrow=$('pillrow');
  pillrow.innerHTML = [
    ['pid', P.pid],
    ['run', $('run').value],
    ['diff', $('diff').value],
    ['time', $('time').value+'s'],
    ['view', $('view').value],
    ['seed', (P.seed||'(auto)')]
  ].map(([k,v])=>`<span class="pill"><b>${k}</b>: ${String(v).replace(/</g,'&lt;')}</span>`).join('');

  // build hub url (keep ctx)
  function buildHubUrl(){
    try{
      const u = new URL(P.hub || './hub.html', location.href);
      const sp = u.searchParams;
      sp.set('pid', $('pid').value.trim()||'anon');
      sp.set('run', $('run').value);
      sp.set('diff', $('diff').value);
      sp.set('time', String(clamp($('time').value,20,300)));
      sp.set('seed', $('seed').value.trim()||nowSeed());
      sp.set('view', $('view').value);
      const lg = $('log').value.trim();
      if(lg) sp.set('log', lg); else sp.delete('log');
      const sid=$('studyId').value.trim(); if(sid) sp.set('studyId', sid); else sp.delete('studyId');
      const ph=$('phase').value.trim(); if(ph) sp.set('phase', ph); else sp.delete('phase');
      const cg=$('conditionGroup').value.trim(); if(cg) sp.set('conditionGroup', cg); else sp.delete('conditionGroup');
      return u.toString();
    }catch(_){
      return './hub.html';
    }
  }
  $('btnBackHub').href = buildHubUrl();

  function saveLast(x){
    try{ localStorage.setItem(LS, JSON.stringify(x)); }catch(_){}
  }

  function buildRunUrl(forceView){
    const pid = $('pid').value.trim()||'anon';
    const run = $('run').value;
    const diff= $('diff').value;
    const time= String(clamp($('time').value,20,300));
    const seed= $('seed').value.trim()||nowSeed();
    const view= forceView || $('view').value;
    const log = $('log').value.trim();

    const sid=$('studyId').value.trim();
    const ph=$('phase').value.trim();
    const cg=$('conditionGroup').value.trim();

    const u = new URL('./vr-maskcough/maskcough.html', location.href);
    const sp = u.searchParams;

    sp.set('hub', buildHubUrl());
    sp.set('pid', pid);
    sp.set('run', run);
    sp.set('diff', diff);
    sp.set('time', time);
    sp.set('seed', seed);
    sp.set('view', view);

    if(log) sp.set('log', log); else sp.delete('log');
    if(sid) sp.set('studyId', sid); else sp.delete('studyId');
    if(ph) sp.set('phase', ph); else sp.delete('phase');
    if(cg) sp.set('conditionGroup', cg); else sp.delete('conditionGroup');

    saveLast({pid, run, diff, time:Number(time), seed, view, log, studyId:sid, phase:ph, conditionGroup:cg, hub:P.hub});
    return u.toString();
  }

  $('btnPlay').addEventListener('click', ()=>{
    const url = buildRunUrl();
    toast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‚Ä¶');
    location.href = url;
  }, {passive:true});

  $('btnCvr').addEventListener('click', ()=>{
    const url = buildRunUrl('cvr');
    toast('‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î cVR‚Ä¶');
    location.href = url;
  }, {passive:true});

})();
</script>
</body>
</html>