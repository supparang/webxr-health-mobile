<!-- === /herohealth/vr-groups/groups-vr.html ===
GroupsVR RUN ‚Äî PRODUCTION (PC/Mobile/cVR)
‚úÖ CSS: ./groups-vr.css
‚úÖ A-Frame minimal scene (Enter VR reliability)
‚úÖ Universal VR UI: ../vr/vr-ui.js (EnterVR/Exit/Recenter + crosshair + hha:shoot)
‚úÖ Optional FX: ../vr/particles.js
‚úÖ Optional Cloud Logger: ../vr/hha-cloud-logger.js
‚úÖ Engine: ./groups.safe.js
‚úÖ Boot: ./groups-vr.boot.js
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HeroHealth ‚Äî Food Groups VR</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />

  <link rel="stylesheet" href="./groups-vr.css" />

  <!-- A-Frame: minimal scene for WebXR Enter VR reliability -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Universal VR UI: Enter VR/Exit/Recenter + crosshair + tap-to-shoot -->
  <script src="../vr/vr-ui.js" defer></script>

  <!-- Optional FX layer -->
  <script src="../vr/particles.js" defer></script>

  <!-- Optional cloud logger (flush-hardened) -->
  <script src="../vr/hha-cloud-logger.js" defer></script>

  <!-- Engine (IIFE) -->
  <script src="./groups.safe.js" defer></script>

  <!-- Boot (auto-detect + tap-to-start + binds) -->
  <script src="./groups-vr.boot.js" defer></script>
</head>

<body class="view-mobile">

  <!-- XR Scene (behind DOM) -->
  <a-scene class="xr-scene" embedded vr-mode-ui="enabled: false">
    <a-entity position="0 1.6 0"></a-entity>
    <a-sky color="#020617"></a-sky>
  </a-scene>

  <!-- PLAY LAYER: targets spawn here -->
  <div id="playLayer" class="playLayer" aria-label="play-layer"></div>

  <!-- HUD -->
  <div class="hud" aria-label="hud">
    <div class="hudLeft">
      <div class="pill"><div class="lbl">TIME</div><div id="vTime" class="val">--</div></div>
      <div class="pill"><div class="lbl">SCORE</div><div id="vScore" class="val">0</div></div>
    </div>
    <div class="hudRight">
      <div class="pill"><div class="lbl">COMBO</div><div id="vCombo" class="val">0</div></div>
      <div class="pill"><div class="lbl">MISS</div><div id="vMiss" class="val">0</div></div>
      <div class="pill"><div class="lbl">RANK</div><div id="vRank" class="val">C</div></div>
      <div class="pill"><div class="lbl">ACC</div><div id="vAcc" class="val">0%</div></div>
      <div class="pill"><div class="lbl">MODE</div><div id="vMode" class="val">PLAY</div></div>
    </div>
  </div>

  <!-- QUEST (Goal + Mini) -->
  <div class="questTop" aria-label="quest">
    <div class="questCard">
      <div class="qTitle">
        <div id="goalTitle">üéØ GOAL</div>
        <div id="goalCount" class="tag">0/0</div>
      </div>
      <div class="bar"><div id="goalFill" class="fill"></div></div>
      <div id="goalSub" class="qSub">‚Äî</div>
    </div>

    <div class="questCard">
      <div class="qTitle">
        <div id="miniTitle">‚ö° MINI</div>
        <div id="miniTime" class="tag">‚Äî</div>
      </div>
      <div class="bar"><div id="miniFill" class="fill"></div></div>
      <div id="miniSub" class="qSub">‚Äî</div>
    </div>
  </div>

  <!-- POWER -->
  <div class="powerWrap" aria-label="power">
    <div class="powerCard">
      <div class="pHead">POWER (‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏°‡∏π‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°)</div>
      <div class="powerBar bar"><div id="pFill" class="fill"></div></div>
      <div class="pFoot">‡∏™‡∏∞‡∏™‡∏°: <span id="pCur">0</span>/<span id="pThr">8</span></div>
    </div>
  </div>

  <!-- COACH -->
  <div class="coachWrap" aria-label="coach">
    <div class="coachCard">
      <img id="coachImg" class="coachImg" src="../img/coach-neutral.png" alt="coach"/>
      <div class="coachBubble">
        <div class="coachName">HeroHealth Coach</div>
        <div id="coachText" class="coachText">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- End overlay -->
  <div id="endOverlay" class="overlay hidden" aria-label="end">
    <div class="panel">
      <div class="title">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>
      <div class="sub">‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / Rank / Miss ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö HUB ‡πÑ‡∏î‡πâ</div>

      <div class="grid2">
        <div class="stat"><div class="k">SCORE</div><div id="endScore" class="v">0</div></div>
        <div class="stat"><div class="k">RANK</div><div id="endRank" class="v">C</div></div>
        <div class="stat"><div class="k">MISS</div><div id="endMiss" class="v">0</div></div>
        <div class="stat"><div class="k">ACC</div><div id="endAcc" class="v">0%</div></div>
      </div>

      <div class="row">
        <button id="btnReplay" class="btn btn-strong">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button id="btnBackHub" class="btn btn-ghost">‡∏Å‡∏•‡∏±‡∏ö HUB</button>
      </div>

      <div class="note">* ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢/‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° log schema</div>
    </div>
  </div>

  <script>
    (function(){
      const qs = (k,def=null)=>{ try{return new URL(location.href).searchParams.get(k)??def;}catch{return def;} };
      const hub = qs('hub','');
      const ov = document.getElementById('endOverlay');
      const btnReplay = document.getElementById('btnReplay');
      const btnBack = document.getElementById('btnBackHub');

      window.addEventListener('hha:end', (ev)=>{
        const d = ev.detail||{};
        if (!ov) return;

        document.getElementById('endScore').textContent = String(d.scoreFinal??0);
        document.getElementById('endRank').textContent  = String(d.grade??'C');
        document.getElementById('endMiss').textContent  = String(d.misses??0);
        document.getElementById('endAcc').textContent   = String((d.accuracyGoodPct??0)+'%');

        ov.classList.remove('hidden');
      });

      if (btnReplay) btnReplay.addEventListener('click', ()=> location.reload());
      if (btnBack) btnBack.addEventListener('click', ()=>{
        if (hub) location.href = hub; else history.back();
      });
    })();
  </script>
</body>
</html>