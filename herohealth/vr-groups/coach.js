// vr-groups/coach.js
(function (ns) {
  'use strict';

  const GROUP_TIPS = {
    1: [
      '‡∏´‡∏°‡∏π‡πà 1 üçö ‡πÉ‡∏´‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏Ç‡πâ‡∏≤‡∏ß-‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏∞!',
      '‡∏Ç‡πâ‡∏≤‡∏ß-‡πÅ‡∏õ‡πâ‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏Ñ‡∏¥‡∏î ‡πÅ‡∏£‡∏á‡∏ß‡∏¥‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏Å‡∏¥‡∏ô‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ ‡πÜ ‡∏à‡∏∞‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ üòâ'
    ],
    2: [
      '‡∏´‡∏°‡∏π‡πà 2 üçó ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠-‡∏ñ‡∏±‡πà‡∏ß ‡∏ä‡πà‡∏ß‡∏¢‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡∏°‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏Æ‡∏µ‡πÇ‡∏£‡πà!',
      '‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏°‡∏∑‡πâ‡∏≠ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á üí™'
    ],
    3: [
      '‡∏´‡∏°‡∏π‡πà 3 ü•õ ‡∏ô‡∏° ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÇ‡∏•‡∏î‡πÄ‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢!',
      '‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏ß ‡πÉ‡∏™‡πà‡πÉ‡∏à‡∏ü‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏ô‡∏∞ ü¶¥'
    ],
    4: [
      '‡∏´‡∏°‡∏π‡πà 4 ü•¶ ‡∏ú‡∏±‡∏Å ‡∏°‡∏µ‡πÉ‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏î‡∏µ ‡∏ó‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å üòä',
      '‡∏à‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏±‡∏Å‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡πÜ ‡∏î‡πâ‡∏ß‡∏¢ ‡∏à‡∏∞‡∏Ñ‡∏£‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°!'
    ],
    5: [
      '‡∏´‡∏°‡∏π‡πà 5 üçå ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏ï‡∏¥‡∏°‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô ‡πÅ‡∏ó‡∏ô‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å üéÅ',
      '‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏°‡∏ñ‡∏∏‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ã‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏î‡∏π‡πÑ‡∏´‡∏°? üçé'
    ]
  };

  function pickTipForGroup(groupId) {
    const arr = GROUP_TIPS[groupId];
    if (!arr || !arr.length) return null;
    const idx = Math.floor(Math.random() * arr.length);
    return arr[idx];
  }

  const Coach = {
    say(text) {
      if (ns.foodGroupsUI && ns.foodGroupsUI.setQuest) {
        ns.foodGroupsUI.setQuest(text);
      }
    },

    sayQuest(quest, progress) {
      if (!quest) {
        this.say('‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß üéâ ‡πÄ‡∏•‡πá‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!');
        return;
      }
      const txt = `‡∏´‡∏°‡∏π‡πà ${quest.groupId} ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ${quest.targetCount} ‡∏ä‡∏¥‡πâ‡∏ô `
        + `(‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ${progress}/${quest.targetCount})`;
      this.say(txt);
    },

    sayTipForGroup(groupId) {
      const tip = pickTipForGroup(groupId);
      if (tip) {
        this.say(tip);
      }
    },

    sayStart() {
      this.say('‡∏ü‡∏±‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏ä ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡πá‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏´‡∏°‡∏π‡πà‡πÄ‡∏•‡∏¢! üí•');
    },

    sayFinish() {
      this.say('‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß üéâ');
    },

    /**
     * ctx: { current, progress, justFinished, finished }
     */
    onQuestChange(ctx) {
      if (ctx.justFinished && ctx.finished) {
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÅ‡∏™‡∏î‡∏á tip ‡∏î‡πâ‡∏≤‡∏ô‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£
        this.sayTipForGroup(ctx.finished.groupId);
      } else {
        this.sayQuest(ctx.current, ctx.progress || 0);
      }
    }
  };

  ns.foodGroupsCoach = Coach;
})(window.GAME_MODULES || (window.GAME_MODULES = {}));
