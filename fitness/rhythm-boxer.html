<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Rhythm Boxer ‚Äî VR Fitness</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="color-scheme" content="dark">
  <!-- ‡πÉ‡∏ä‡πâ path ‡πÅ‡∏ö‡∏ö relative ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô /fitness -->
  <link rel="stylesheet" href="css/rhythm-boxer.css">
</head>
<body>
<div id="rb-wrap" class="rb-wrap">

  <!-- ====== MENU VIEW ====== -->
  <section id="rb-view-menu" class="rb-view rb-view-menu">
    <header class="rb-header">
      <h1 class="rb-title">
        Rhythm Boxer <span class="rb-title-emoji">üéµü•ä</span>
      </h1>
      <p className="rb-subtitle">‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° VR Fitness</p>
    </header>

    <div class="rb-card rb-card-menu">
      <div class="rb-field-group">
        <div class="rb-field-label">‡πÇ‡∏´‡∏°‡∏î</div>
        <label class="rb-radio">
          <input type="radio" name="mode" value="normal" checked>
          <span>Normal</span>
        </label>
        <label class="rb-radio">
          <input type="radio" name="mode" value="research">
          <span>Research</span>
        </label>
      </div>

      <div class="rb-field-group">
        <label class="rb-field-label" for="rb-track">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á</label>
        <select id="rb-track" class="rb-select">
          <option value="t1">Warm-up Groove (Easy)</option>
          <option value="t2">Punch Rush (Normal)</option>
          <option value="t3">Ultra Beat Combo (Hard)</option>
          <option value="research">Research Track 120</option>
        </select>
      </div>

      <div class="rb-menu-actions">
        <button id="rb-btn-start" class="rb-btn rb-btn-primary">
          ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô ‚ñ∂
        </button>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö Hub ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà -->
        <button id="rb-btn-hub" class="rb-btn rb-btn-secondary">
          ‡∏Å‡∏•‡∏±‡∏ö Hub
        </button>
      </div>
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Research) -->
    <div id="rb-research-fields" class="rb-card rb-card-research hidden">
      <div class="rb-field-group">
        <label class="rb-field-label" for="rb-participant">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (ID)</label>
        <input id="rb-participant" class="rb-input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô P001">
      </div>
      <div class="rb-field-group">
        <label class="rb-field-label" for="rb-group">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á / ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</label>
        <input id="rb-group" class="rb-input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô G1 ‡∏´‡∏£‡∏∑‡∏≠ Control">
      </div>
      <div class="rb-field-group">
        <label class="rb-field-label" for="rb-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</label>
        <textarea id="rb-note" class="rb-input rb-input-multiline" rows="2"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2 ‡∏´‡∏•‡∏±‡∏á Warm-up"></textarea>
      </div>
      <p class="rb-help-text">
        * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢
      </p>
    </div>
  </section>

  <!-- ====== PLAY VIEW ====== -->
  <section id="rb-view-play" class="rb-view rb-view-play hidden">
    <!-- HUD ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏™‡∏∏‡∏î -->
    <div class="rb-hud">
      <div class="rb-hud-col">
        <div>Mode: <span id="rb-hud-mode">Normal</span></div>
        <div>Track: <span id="rb-hud-track">Warm-up Groove</span></div>
        <div>‡πÄ‡∏ß‡∏•‡∏≤: <span id="rb-hud-time">0.0</span>s</div>
      </div>
      <div class="rb-hud-col">
        <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="rb-hud-score">0</span></div>
        <div>Combo: <span id="rb-hud-combo">0</span></div>
        <div>Acc: <span id="rb-hud-acc">0.0%</span></div>
      </div>
      <div class="rb-hud-col rb-hud-col-small">
        <div>P/Gd/G/Ms</div>
        <div><span id="rb-hud-perfect">0</span> /
             <span id="rb-hud-great">0</span> /
             <span id="rb-hud-good">0</span> /
             <span id="rb-hud-miss">0</span></div>
      </div>
    </div>

    <!-- Progress bar -->
    <div class="rb-progress-wrap">
      <div class="rb-progress-bar">
        <div id="rb-progress-fill" class="rb-progress-fill"></div>
      </div>
      <div id="rb-progress-text" class="rb-progress-text">0%</div>
    </div>

    <!-- ‡∏™‡∏ô‡∏≤‡∏° 5 ‡πÄ‡∏•‡∏ô -->
    <div id="rb-lanes" class="rb-lanes">
      <div class="rb-lane" data-lane="0"></div>
      <div class="rb-lane" data-lane="1"></div>
      <div class="rb-lane" data-lane="2"></div>
      <div class="rb-lane" data-lane="3"></div>
      <div class="rb-lane" data-lane="4"></div>
    </div>

    <!-- feedback ‡πÉ‡∏ï‡πâ‡πÄ‡∏•‡∏ô -->
    <div id="rb-feedback" class="rb-feedback">
      ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà lane ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏û‡∏•‡∏á üéµ
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ -->
    <div class="rb-play-actions">
      <button id="rb-btn-stop" class="rb-btn rb-btn-secondary">
        ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
      </button>
    </div>

    <!-- ‡πÅ‡∏ñ‡∏ö FEVER -->
    <div class="rb-fever-wrap">
      <div class="rb-fever-label">
        FEVER: <span id="rb-fever-status">FEVER</span>
      </div>
      <div class="rb-fever-bar">
        <div id="rb-fever-fill" class="rb-fever-fill"></div>
      </div>
    </div>

    <!-- panel ‡πÅ‡∏à‡πâ‡∏á browser ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
    <div id="rb-audio-gate" class="rb-audio-gate hidden">
      <div class="rb-audio-gate-inner">
        <p id="rb-audio-gate-msg">
          ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡∏∞ "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á
        </p>
        <button id="rb-audio-gate-btn" class="rb-btn rb-btn-primary">
          ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        </button>
      </div>
    </div>

    <!-- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á -->
    <audio id="rb-audio" preload="auto"></audio>
  </section>

  <!-- ====== RESULT VIEW ====== -->
  <section id="rb-view-result" class="rb-view rb-view-result hidden">
    <div class="rb-card rb-card-result">
      <h2 class="rb-result-title">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>

      <div class="rb-result-grid">
        <div>
          <div>‡πÇ‡∏´‡∏°‡∏î: <span id="rb-res-mode">Normal</span></div>
          <div>‡πÄ‡∏û‡∏•‡∏á: <span id="rb-res-track">Warm-up Groove</span></div>
          <div>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏à‡∏ö‡πÄ‡∏Å‡∏°: <span id="rb-res-endreason">‡∏à‡∏ö‡πÄ‡∏û‡∏•‡∏á</span></div>
          <div>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: <span id="rb-res-participant">-</span></div>
        </div>
        <div>
          <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="rb-res-score">0</span></div>
          <div>Max Combo: <span id="rb-res-maxcombo">0</span></div>
          <div>‡πÇ‡∏ô‡πâ‡∏ï‡∏£‡∏ß‡∏°: <span id="rb-res-totalnotes">0</span></div>
          <div>P/Gd/G/Ms:
            <span id="rb-res-detail-hit">0 / 0 / 0 / 0</span>
          </div>
        </div>
        <div>
          <div>Accuracy: <span id="rb-res-acc">0.0 %</span></div>
          <div>Offset ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: <span id="rb-res-offset-avg">-</span></div>
          <div>Offset SD: <span id="rb-res-offset-std">-</span></div>
          <div>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô: <span id="rb-res-duration">0.0 s</span></div>
        </div>
        <div>
          <div>Rank: <span id="rb-res-rank">C</span></div>
          <p id="rb-res-quality-note" class="rb-quality-note hidden"></p>
        </div>
      </div>

      <div class="rb-result-actions">
        <button id="rb-btn-again" class="rb-btn rb-btn-primary">
          ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        </button>
        <button id="rb-btn-back-menu" class="rb-btn rb-btn-secondary">
          ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á
        </button>
      </div>

      <div class="rb-result-actions rb-result-actions-secondary">
        <button id="rb-btn-dl-events" class="rb-btn rb-btn-ghost">
          ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Event CSV
        </button>
        <button id="rb-btn-dl-sessions" class="rb-btn rb-btn-ghost">
          ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Session CSV
        </button>
      </div>
    </div>
  </section>

  <!-- ====== RESEARCH OVERLAY (‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏û‡∏•‡∏á) ====== -->
  <div id="rb-overlay-research" class="rb-overlay hidden">
    <div class="rb-overlay-box">
      <p id="rb-overlay-message">
        ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏à‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡πà‡∏∞
      </p>
      <button id="rb-overlay-continue" class="rb-btn rb-btn-primary">
        ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
      </button>
    </div>
  </div>

</div> <!-- /rb-wrap -->

<!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° -->
<script src="js/rhythm-engine.js" defer></script>

<!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö Hub -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hubBtn = document.getElementById('rb-btn-hub');
    if (!hubBtn) return;

    hubBtn.addEventListener('click', () => {
      const params = new URLSearchParams(location.search);
      const hub = params.get('hub');

      // 1) ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏° ?hub=... ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡πâ‡∏ô
      if (hub) {
        location.href = hub;
        return;
      }

      // 2) ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ referrer ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà rhythm-boxer ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
      if (document.referrer && !document.referrer.includes('rhythm-boxer')) {
        location.href = document.referrer;
        return;
      }

      // 3) ‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå: ‡∏Å‡∏•‡∏±‡∏ö Hub ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå /fitness
      location.href = 'index.html';
    });
  });
</script>
</body>
</html>