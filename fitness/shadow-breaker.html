<!-- === /fitness/shadow-breaker.html ===
Shadow Breaker (DOM) ‚Äî RUN GAME (latest run shell)
‚úÖ Menu / Play / Result views
‚úÖ IDs aligned with engine.js (current patches)
‚úÖ Meta toggle + Fever button placeholders
‚úÖ Back HUB passthrough support (engine reads ?hub=)
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Shadow Breaker</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="./css/shadow-breaker.css?v=20260225-run" />
</head>
<body>
  <div id="sb-wrap" class="sb-wrap">

    <!-- Header -->
    <header class="sb-header">
      <div class="sb-header-left">
        <div class="sb-kicker">VR Fitness ‚Ä¢ Shadow Breaker</div>
        <h1 class="sb-title">Shadow Breaker</h1>
        <div class="sb-sub">‡∏ä‡∏Å/‡πÅ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô ‚Ä¢ Boss phases ‚Ä¢ Fever ‚Ä¢ Research-ready</div>
      </div>

      <div class="sb-header-right">
        <div class="sb-tip">Tip: ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î AI ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ <code>?ai=1</code></div>
        <div class="sb-links">
          <a class="sb-link" id="sb-link-hub" href="./../herohealth/hub.html">‚Üê Back HUB</a>
        </div>
      </div>
    </header>

    <main class="sb-main">

      <!-- =========================
           MENU VIEW
      ========================== -->
      <section id="sb-view-menu" class="sb-view sb-panel is-active" aria-label="Menu view">
        <div class="sb-mode-row" role="tablist" aria-label="Mode">
          <button id="sb-btn-play" class="sb-mode-btn is-active" type="button">üéÆ Play</button>
          <button id="sb-btn-research" class="sb-mode-btn" type="button">üß™ Research</button>
        </div>

        <div class="sb-mode-desc" id="sb-mode-desc">
          Play: ‡∏™‡∏ô‡∏∏‡∏Å/‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ ‚Ä¢ Research: ‡∏•‡πá‡∏≠‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (AI ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏°‡∏≠)
        </div>

        <form class="sb-form" onsubmit="return false;">
          <div class="sb-field">
            <div class="sb-label">Participant ID (pid)</div>
            <input id="sb-input-pid" class="sb-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô P-XXXX" />
          </div>

          <div class="sb-field">
            <div class="sb-label">Difficulty (diff)</div>
            <select id="sb-input-diff" class="sb-input">
              <option value="easy">easy</option>
              <option value="normal" selected>normal</option>
              <option value="hard">hard</option>
            </select>
          </div>

          <div class="sb-field">
            <div class="sb-label">Time (seconds)</div>
            <input id="sb-input-time" class="sb-input" type="number" min="20" max="240" value="70" />
          </div>

          <div class="sb-actions">
            <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: engine patch ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ä‡πâ btnPlay/btnResearch start ‡∏ï‡∏£‡∏á ‡πÜ -->
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö flow ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ form start -->
            <button id="sb-btn-start" class="sb-btn sb-btn-primary" type="button">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
            <button id="sb-btn-howto" class="sb-btn sb-btn-ghost" type="button">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
          </div>

          <div id="sb-howto" class="sb-howto" aria-live="polite">
            <ul>
              <li>‡πÅ‡∏ï‡∏∞/‡∏ä‡∏Å‡πÄ‡∏õ‡πâ‡∏≤ üéØ ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</li>
              <li>‡πÄ‡∏õ‡πâ‡∏≤‡∏•‡πà‡∏≠ üëÄ ‡∏ï‡∏µ‡πÇ‡∏î‡∏ô‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÅ‡∏ï‡∏Å</li>
              <li>‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î üí£ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Shield ‡∏à‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ</li>
              <li>‡πÄ‡∏Å‡πá‡∏ö Shield üõ°Ô∏è / Heal ü©π ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î</li>
              <li>Boss face üëä ‡πÇ‡∏ú‡∏•‡πà‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ö‡∏≠‡∏™‡∏ï‡πà‡∏≥ ‡∏ï‡∏µ‡πÇ‡∏î‡∏ô‡πÅ‡∏£‡∏á‡∏Å‡∏ß‡πà‡∏≤</li>
              <li>Fever READY ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚ö° FEVER ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
            </ul>
          </div>

          <div class="sb-mini-note">
            <div>
              <b>Query params</b> ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
              <code>pid</code>, <code>diff</code>, <code>time</code>,
              <code>mode</code>/<code>run</code>, <code>hub</code>, <code>ai</code>
            </div>
          </div>
        </form>
      </section>

      <!-- =========================
           PLAY VIEW
      ========================== -->
      <section id="sb-view-play" class="sb-view sb-play" aria-label="Play view">

        <!-- HUD top -->
        <div class="sb-hud">
          <div class="sb-hud-left">
            <div class="sb-stat"><span class="k">Time</span> <span class="v" id="sb-text-time">0.0 s</span></div>
            <div class="sb-stat"><span class="k">Score</span> <span class="v" id="sb-text-score">0</span></div>
            <div class="sb-stat"><span class="k">Combo</span> <span class="v" id="sb-text-combo">0</span></div>
            <div class="sb-stat"><span class="k">Miss</span> <span class="v" id="sb-text-miss">0</span></div>
          </div>

          <div class="sb-hud-center">
            <div class="sb-boss-name" id="sb-current-boss-name">Boss</div>
          </div>

          <div class="sb-hud-right">
            <label class="sb-toggle" title="Pause">
              <input id="sb-btn-pause" type="checkbox" />
              Pause
            </label>
            <button id="sb-btn-back-menu" class="sb-btn sb-btn-ghost" type="button">‚üµ Menu</button>
          </div>
        </div>

        <!-- HP bars top -->
        <div class="sb-bars sb-bars-top">
          <div class="sb-bar">
            <div class="sb-bar-label">YOU</div>
            <div class="sb-bar-track"><div id="sb-hp-you-top" class="sb-bar-fill"></div></div>
          </div>
          <div class="sb-bar">
            <div class="sb-bar-label">BOSS</div>
            <div class="sb-bar-track"><div id="sb-hp-boss-top" class="sb-bar-fill boss"></div></div>
          </div>
        </div>

        <!-- Stage -->
        <div class="sb-stage" id="sb-stage">
          <!-- center message -->
          <div class="sb-center-msg">
            <div id="sb-msg-main" class="sb-msg-main">Ready</div>
          </div>

          <!-- target layer -->
          <div id="sb-target-layer" class="sb-target-layer" aria-label="target layer"></div>

          <!-- Boss meta card -->
          <aside id="sb-meta" class="sb-meta" aria-label="boss meta">
            <div class="sb-meta-rowtop">
              <div class="sb-meta-emoji" id="sb-meta-emoji">üéØ</div>
              <button id="sb-btn-meta" class="sb-meta-toggle" type="button" aria-expanded="true">‚ñæ</button>
            </div>

            <div class="sb-meta-body" id="sb-meta-body">
              <div class="sb-meta-name" id="sb-meta-name">Boss</div>
              <div class="sb-meta-desc" id="sb-meta-desc">desc</div>

              <div class="sb-meta-row">
                <span>Phase</span><b id="sb-boss-phase-label">1</b>
              </div>
              <div class="sb-meta-row">
                <span>Shield</span><b id="sb-boss-shield-label">0</b>
              </div>
            </div>
          </aside>
        </div>

        <!-- Bottom HUD -->
        <div class="sb-bars sb-bars-bottom">
          <div class="sb-fever">
            <div class="sb-fever-head">
              <div><span class="k">FEVER</span> <span id="sb-label-fever" class="v">0%</span></div>
              <button id="sb-btn-fever" class="sb-fever-btn" type="button" title="Use Fever">‚ö° FEVER</button>
            </div>
            <div class="sb-fever-track"><div id="sb-fever-bar" class="sb-fever-fill"></div></div>
            <div class="sb-fever-hint" id="sb-fever-hint">READY ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î FEVER ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏π‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
          </div>

          <div class="sb-bars-compact">
            <div class="sb-row">
              <span class="k">Phase</span> <b id="sb-text-phase" class="v">1</b>
            </div>
            <div class="sb-row">
              <span class="k">Shield</span> <b id="sb-text-shield" class="v">0</b>
            </div>

            <div class="sb-bar">
              <div class="sb-bar-label">YOU</div>
              <div class="sb-bar-track"><div id="sb-hp-you-bottom" class="sb-bar-fill"></div></div>
            </div>
            <div class="sb-bar">
              <div class="sb-bar-label">BOSS</div>
              <div class="sb-bar-track"><div id="sb-hp-boss-bottom" class="sb-bar-fill boss"></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           RESULT VIEW
      ========================== -->
      <section id="sb-view-result" class="sb-view sb-panel" aria-label="Result view">
        <h2 class="sb-result-title">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>

        <div class="sb-result-grid">
          <div class="sb-result-card"><div class="k">Time</div><div class="v" id="sb-res-time">0</div></div>
          <div class="sb-result-card"><div class="k">Score</div><div class="v" id="sb-res-score">0</div></div>
          <div class="sb-result-card"><div class="k">Max Combo</div><div class="v" id="sb-res-max-combo">0</div></div>
          <div class="sb-result-card"><div class="k">Miss</div><div class="v" id="sb-res-miss">0</div></div>
          <div class="sb-result-card"><div class="k">Phase</div><div class="v" id="sb-res-phase">0</div></div>
          <div class="sb-result-card"><div class="k">Boss Cleared</div><div class="v" id="sb-res-boss-cleared">0</div></div>
          <div class="sb-result-card"><div class="k">Accuracy</div><div class="v" id="sb-res-acc">0</div></div>
          <div class="sb-result-card"><div class="k">Grade</div><div class="v" id="sb-res-grade">C</div></div>
        </div>

        <div class="sb-result-actions">
          <button id="sb-btn-result-retry" class="sb-btn sb-btn-primary" type="button">‚Üª ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
          <button id="sb-btn-result-menu" class="sb-btn" type="button">‚ò∞ ‡πÄ‡∏°‡∏ô‡∏π</button>
          <button id="sb-btn-download-events" class="sb-btn sb-btn-ghost" type="button">‚¨á Events CSV</button>
          <button id="sb-btn-download-session" class="sb-btn sb-btn-ghost" type="button">‚¨á Session CSV</button>
        </div>
      </section>

    </main>
  </div>

  <script>
    // --- Lightweight UI-only helpers (safe even if engine doesn't use them) ---
    (function(){
      const qs = new URL(location.href).searchParams;
      const hub = qs.get('hub');
      const linkHub = document.getElementById('sb-link-hub');
      if (hub && linkHub) linkHub.href = hub;

      // Prefill menu inputs from query (engine may ignore menu fields in some patch versions)
      const pidEl  = document.getElementById('sb-input-pid');
      const diffEl = document.getElementById('sb-input-diff');
      const timeEl = document.getElementById('sb-input-time');
      if (pidEl && qs.get('pid')) pidEl.value = qs.get('pid');
      if (diffEl && qs.get('diff')) diffEl.value = qs.get('diff');
      if (timeEl && qs.get('time')) timeEl.value = qs.get('time');

      // Meta collapse button (pure UI)
      const btnMeta = document.getElementById('sb-btn-meta');
      const meta = document.getElementById('sb-meta');
      if (btnMeta && meta){
        btnMeta.addEventListener('click', ()=>{
          const collapsed = meta.classList.toggle('is-collapsed');
          btnMeta.setAttribute('aria-expanded', String(!collapsed));
          btnMeta.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
        });
      }

      // Optional: menu "Start" button bridges to current engine buttons
      const btnStart = document.getElementById('sb-btn-start');
      const btnPlay = document.getElementById('sb-btn-play');
      const btnResearch = document.getElementById('sb-btn-research');
      let mode = (qs.get('mode') || qs.get('run') || 'play').toLowerCase();

      if (btnPlay && btnResearch){
        btnPlay.addEventListener('click', ()=>{
          mode = 'play';
          btnPlay.classList.add('is-active');
          btnResearch.classList.remove('is-active');
          const d = document.getElementById('sb-mode-desc');
          if (d) d.textContent = 'Play: ‡∏™‡∏ô‡∏∏‡∏Å/‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ ‚Ä¢ Research: ‡∏•‡πá‡∏≠‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (AI ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏°‡∏≠)';
        });

        btnResearch.addEventListener('click', ()=>{
          mode = 'research';
          btnResearch.classList.add('is-active');
          btnPlay.classList.remove('is-active');
          const d = document.getElementById('sb-mode-desc');
          if (d) d.textContent = 'Research: ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (AI ‡∏õ‡∏¥‡∏î) ‚Ä¢ ‡∏•‡πá‡∏≠‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ';
        });
      }

      if (btnStart){
        btnStart.addEventListener('click', ()=>{
          // Engine patches ‡∏ö‡∏≤‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô bind ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡∏±‡∏ö btnPlay/btnResearch ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
          // ‡πÄ‡∏•‡∏¢‡∏¢‡∏¥‡∏á click ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          if (mode === 'research') btnResearch?.click();
          else btnPlay?.click();
        });
      }
    })();
  </script>

  <!-- Engine -->
  <script type="module" src="./js/engine.js?v=20260225-run"></script>
</body>
</html>