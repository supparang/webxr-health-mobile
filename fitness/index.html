<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>VR Fitness ‚Äî Shadow Breaker (DOM Engine)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      color-scheme: light dark;
      --bg: #020617;
      --card: rgba(15,23,42,0.9);
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.16);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.2), transparent 55%),
        var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }
    main {
      width: 100%;
      max-width: 960px;
      padding: 16px;
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.5);
      border: 1px solid rgba(148,163,184,0.3);
    }
    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h1 span.icon {
      font-size: 1.8rem;
    }
    .subtitle {
      margin-bottom: 16px;
      color: #9ca3af;
      font-size: 0.95rem;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 4px 0 12px;
    }
    button {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 8px 14px;
      font: inherit;
      cursor: pointer;
      background: rgba(15,23,42,0.9);
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background .15s, transform .12s, box-shadow .12s;
    }
    button.primary {
      border-color: var(--accent);
      background: linear-gradient(135deg, #22c55e, #a3e635);
      color: #022c22;
      box-shadow: 0 10px 28px rgba(34,197,94,0.4);
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(15,23,42,0.5);
    }
    button:active {
      transform: translateY(0);
      box-shadow: none;
    }
    .pill {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.75rem;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.6);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .pill span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 12px;
    }
    .col {
      flex: 1 1 220px;
    }
    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #9ca3af;
    }
    input, select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
      color: var(--text);
      font: inherit;
    }
    input::placeholder {
      color: #6b7280;
    }
    .help {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 4px;
    }
    .hidden { display: none !important; }

    /* Play view */
    #view-play {
      margin-top: 12px;
    }
    .play-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .play-top .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      font-size: 0.8rem;
      color: #e5e7eb;
      background: rgba(15,23,42,0.8);
    }
    .timer {
      font-weight: 600;
      letter-spacing: 0.04em;
    }
    .play-area {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.65);
      background:
        radial-gradient(circle at top, rgba(15,118,110,0.24), transparent 55%),
        radial-gradient(circle at bottom, rgba(37, 99, 235,0.3), transparent 60%),
        #020617;
      overflow: hidden;
      touch-action: manipulation;
    }
    #target-layer {
      position: absolute;
      inset: 0;
    }
    .target {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fef9c3, #eab308);
      box-shadow: 0 10px 24px rgba(234,179,8,0.65);
      border: 3px solid rgba(249,250,251,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #0b1120;
      cursor: pointer;
      transform: translate(-50%, -50%) scale(1);
      transition: transform 0.12s ease-out, opacity 0.12s ease-out;
    }
    .target.decoy {
      background: radial-gradient(circle at 30% 30%, #fecaca, #ef4444);
      box-shadow: 0 10px 26px rgba(239,68,68,0.7);
    }
    .target.spawn {
      transform: translate(-50%, -50%) scale(0.3);
      animation: pop-in 0.12s forwards;
    }
    .target.hit {
      animation: hit-burst 0.22s forwards;
    }
    .target.miss {
      opacity: 0.4;
    }
    @keyframes pop-in {
      to { transform: translate(-50%, -50%) scale(1); }
    }
    @keyframes hit-burst {
      to { transform: translate(-50%, -50%) scale(1.4); opacity: 0; }
    }

    .banner {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .banner strong {
      color: #fde68a;
    }

    /* Result view */
    #view-result .summary {
      margin-top: 10px;
      font-size: 0.9rem;
    }
    #view-result table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 0.85rem;
    }
    #view-result th, #view-result td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      text-align: left;
    }
    #view-result th {
      font-weight: 600;
      color: #e5e7eb;
    }
    #view-result td.label {
      color: #9ca3af;
      width: 40%;
    }

    @media (max-width: 640px) {
      .card { padding: 14px; }
      h1 { font-size: 1.35rem; }
      .play-area { border-radius: 14px; }
      .target { width: 56px; height: 56px; }
    }
  </style>
</head>
<body>
  <main>
    <section class="card" id="view-menu">
      <h1><span class="icon">ü•ä</span>VR Fitness ‚Äî Shadow Breaker</h1>
      <div class="subtitle">
        ‡∏ä‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ / ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏∏‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
      </div>

      <div class="pill">
        <span class="dot"></span>
        <span>DOM Engine ‚Ä¢ Single Page ‚Ä¢ CSV Export</span>
      </div>

      <h2 style="margin-top:16px;font-size:1rem;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
      <div class="btn-row">
        <button class="primary" data-action="start-research">
          <span>‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢</span> <span>üìä</span>
        </button>
        <button data-action="start-normal">
          <span>‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</span> <span>üéÆ</span>
        </button>
      </div>

      <div class="row" style="margin-top:16px;">
        <div class="col">
          <label for="difficulty">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</label>
          <select id="difficulty">
            <option value="easy">‡∏á‡πà‡∏≤‡∏¢ ‚Äî ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
            <option value="normal" selected>‡∏õ‡∏Å‡∏ï‡∏¥ ‚Äî ‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ</option>
            <option value="hard">‡∏¢‡∏≤‡∏Å ‚Äî ‡∏ù‡∏∂‡∏Å reaction ‡∏´‡∏ô‡∏±‡∏Å</option>
          </select>
          <div class="help">
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ / ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß / ‡πÄ‡∏õ‡πâ‡∏≤‡∏•‡∏ß‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö
          </div>
        </div>
      </div>
    </section>

    <section class="card hidden" id="view-research-form">
      <h1><span class="icon">üìã</span>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢</h1>
      <div class="subtitle">
        ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV
      </div>

      <div class="row">
        <div class="col">
          <label for="research-id">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (Participant ID)</label>
          <input id="research-id" placeholder="‡πÄ‡∏ä‡πà‡∏ô P001-01" />
        </div>
        <div class="col">
          <label for="research-group">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á / ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</label>
          <input id="research-group" placeholder="‡πÄ‡∏ä‡πà‡∏ô Experimental / Control" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <div class="col">
          <label for="research-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input id="research-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô Pre-test / Post-test" />
        </div>
      </div>

      <div class="btn-row" style="margin-top:16px;">
        <button class="primary" data-action="research-begin-play">
          ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô Shadow Breaker ‚ñ∂
        </button>
        <button data-action="back-to-menu">
          ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π
        </button>
      </div>
    </section>

    <section class="card hidden" id="view-play">
      <div class="play-top">
        <div class="stats">
          <div class="tag">Mode: <span id="stat-mode">-</span></div>
          <div class="tag">Diff: <span id="stat-diff">-</span></div>
          <div class="tag">Score: <span id="stat-score">0</span></div>
          <div class="tag">Combo: <span id="stat-combo">0</span></div>
          <div class="tag">Miss: <span id="stat-miss">0</span></div>
        </div>
        <div class="timer">‚è± <span id="stat-time">60.0</span>s</div>
      </div>

      <div class="play-area">
        <div id="target-layer"></div>
      </div>

      <div class="banner">
        <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô:</strong> ‡πÅ‡∏ï‡∏∞ / ‡∏ä‡∏Å ‡πÄ‡∏õ‡πâ‡∏≤‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡∏´‡∏±‡∏Å‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö)
      </div>

      <div class="btn-row" style="margin-top:12px;">
        <button data-action="stop-early">‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</button>
      </div>
    </section>

    <section class="card hidden" id="view-result">
      <h1><span class="icon">‚úÖ</span>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πà‡∏ô</h1>
      <div class="subtitle">
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô CSV ‡πÅ‡∏•‡πâ‡∏ß (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î logger ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô finish ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î)
      </div>

      <div class="summary">
        <table>
          <tbody>
            <tr><td class="label">‡πÇ‡∏´‡∏°‡∏î</td><td id="res-mode">-</td></tr>
            <tr><td class="label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</td><td id="res-diff">-</td></tr>
            <tr><td class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</td><td id="res-score">0</td></tr>
            <tr><td class="label">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</td><td id="res-maxcombo">0</td></tr>
            <tr><td class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏û‡∏•‡∏≤‡∏î</td><td id="res-miss">0</td></tr>
            <tr><td class="label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</td><td id="res-participant">-</td></tr>
          </tbody>
        </table>
      </div>

      <div class="btn-row" style="margin-top:14px;">
        <button class="primary" data-action="download-csv">
          ‚¨á ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
        </button>
        <button data-action="play-again">
          ‚ñ∂ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°)
        </button>
        <button data-action="back-to-menu">
          ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
        </button>
      </div>
    </section>
  </main>

  <script type="module" src="./js/main.js"></script>
</body>
</html>
