:root{
  color-scheme: light dark;
  --bg:#020617;
  --card:rgba(15,23,42,0.96);
  --text:#e5e7eb;
  --accent:#22c55e;
  --accent-soft:rgba(34,197,94,0.16);
  --border:rgba(148,163,184,0.6);
}

/* ===== RESET / LAYOUT ===== */

*{box-sizing:border-box;}

body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at top left,rgba(56,189,248,0.18),transparent 55%),
    radial-gradient(circle at bottom right,rgba(34,197,94,0.22),transparent 55%),
    var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:stretch;
}

main{
  width:100%;
  max-width:1200px;
  margin:0 auto;
  padding:10px 12px 18px;
}

/* ===== CARD / VIEW ===== */

.card{
  background:var(--card);
  border-radius:20px;
  padding:14px 16px 18px;
  box-shadow:0 22px 55px rgba(0,0,0,0.78);
  border:1px solid rgba(148,163,184,0.4);
}
#view-play.card,
#view-play{
  padding:10px 12px 14px;
}

.hidden{display:none !important;}

.top-row{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
}

h1{
  margin:0 0 6px;
  font-size:1.7rem;
  display:flex;
  align-items:center;
  gap:8px;
}
h1 .icon{font-size:1.9rem;}

.subtitle{
  margin-bottom:8px;
  color:#9ca3af;
  font-size:.9rem;
}

.pill{
  border-radius:999px;
  padding:3px 10px;
  font-size:.78rem;
  background:rgba(15,23,42,0.96);
  border:1px solid rgba(148,163,184,0.7);
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.pill .dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--accent);
}

/* ===== SMALL BUTTON (link) ===== */

.btn-small{
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.75);
  padding:6px 10px;
  font-size:.8rem;
  background:rgba(15,23,42,0.98);
  color:#e5e7eb;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:5px;
  cursor:pointer;
}
.btn-small:hover{
  box-shadow:0 8px 20px rgba(15,23,42,0.9);
  transform:translateY(-1px);
}

/* ===== BUTTONS ===== */

.btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:4px 0 12px;
}
button{
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.7);
  padding:8px 14px;
  font:inherit;
  cursor:pointer;
  background:rgba(15,23,42,0.98);
  color:var(--text);
  display:inline-flex;
  align-items:center;
  gap:6px;
  transition:background .15s,transform .1s,box-shadow .1s,border-color .12s;
}
button.primary{
  border-color:var(--accent);
  background:linear-gradient(135deg,#22c55e,#a3e635);
  color:#022c22;
  box-shadow:0 12px 30px rgba(34,197,94,0.65);
}
button:hover{
  transform:translateY(-1px);
  box-shadow:0 10px 24px rgba(15,23,42,0.8);
}
button:active{
  transform:translateY(0);
  box-shadow:none;
}

/* ===== FORM ===== */

.row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-top:10px;
}
.col{
  flex:1 1 220px;
}
label{
  display:block;
  font-size:.85rem;
  margin-bottom:4px;
  color:#9ca3af;
}
input,select{
  width:100%;
  padding:7px 9px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,0.7);
  background:rgba(15,23,42,0.98);
  color:var(--text);
  font:inherit;
}
.help{
  font-size:.8rem;
  color:#9ca3af;
  margin-top:4px;
}

/* ===== PLAY HUD TOP ===== */

#view-play{margin-top:6px;}

.play-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  font-size:.86rem;
  margin-bottom:6px;
}
.play-top .stats{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.tag{
  padding:3px 9px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.55);
  background:rgba(15,23,42,0.98);
  font-size:.78rem;
}
.timer{
  font-weight:600;
  letter-spacing:.05em;
}

/* ===== PLAY AREA / THEMES ===== */

.play-area{
  position:relative;
  width:100%;
  aspect-ratio:21/9;
  border-radius:22px;
  border:1px solid rgba(15,118,110,0.5);
  background:
    radial-gradient(circle at top,rgba(37,99,235,0.35),transparent 60%),
    radial-gradient(circle at bottom,rgba(6,95,70,0.4),transparent 65%),
    #020617;
  overflow:hidden;
  touch-action:manipulation;
  box-shadow:
    0 22px 52px rgba(0,0,0,0.9),
    0 0 32px rgba(34,197,94,0.55);
  margin-top:4px;
}

/* theme per boss */
.play-area.theme-boss-0{
  background:
    radial-gradient(circle at top,rgba(59,130,246,0.4),transparent 60%),
    radial-gradient(circle at bottom,rgba(196,181,253,0.36),transparent 65%),
    #020617;
}
.play-area.theme-boss-1{
  background:
    radial-gradient(circle at top,rgba(250,204,21,0.45),transparent 60%),
    radial-gradient(circle at bottom,rgba(37,99,235,0.42),transparent 65%),
    #020617;
}
.play-area.theme-boss-2{
  background:
    radial-gradient(circle at top,rgba(15,23,42,0.9),transparent 60%),
    radial-gradient(circle at bottom,rgba(153,27,27,0.55),transparent 70%),
    #020617;
}
.play-area.theme-boss-3{
  background:
    radial-gradient(circle at top,rgba(244,63,94,0.6),transparent 55%),
    radial-gradient(circle at center,rgba(129,140,248,0.6),transparent 70%),
    radial-gradient(circle at bottom,rgba(34,197,94,0.5),transparent 70%),
    #020617;
  animation:final-bg-pulse 3s ease-in-out infinite;
}

@keyframes final-bg-pulse{
  0%{box-shadow:0 22px 52px rgba(0,0,0,0.9),0 0 32px rgba(34,197,94,0.55);}
  50%{box-shadow:0 22px 60px rgba(236,72,153,0.85),0 0 42px rgba(129,140,248,0.95);}
  100%{box-shadow:0 22px 52px rgba(0,0,0,0.9),0 0 32px rgba(34,197,94,0.55);}
}

.play-area.shake{
  animation:sb-shake .16s ease-out;
}
@keyframes sb-shake{
  0%{transform:translate(0,0);}
  25%{transform:translate(-3px,2px);}
  50%{transform:translate(3px,-2px);}
  75%{transform:translate(-2px,1px);}
  100%{transform:translate(0,0);}
}

#target-layer{
  position:absolute;
  inset:0;
}

/* ===== TARGET ===== */

.sb-target{
  position:absolute;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2.2rem;
  box-shadow:0 12px 26px rgba(15,23,42,0.96);
  background:radial-gradient(circle at 30% 30%,rgba(248,250,252,0.96),rgba(15,23,42,0.75));
  border:2px solid rgba(148,163,184,0.85);
  color:#020617;
  cursor:pointer;
  transform:translate(-50%,-50%) scale(.1);
  opacity:0;
  animation:sb-pop-in .14s forwards;
}
.sb-target-decoy{
  border-color:rgba(248,113,113,0.95);
  box-shadow:0 10px 26px rgba(248,113,113,0.75);
}
@keyframes sb-pop-in{
  to{transform:translate(-50%,-50%) scale(1);opacity:1;}
}

/* เป้าโดน */
.sb-target.target-hit{
  animation:sb-hit-burst .2s forwards;
}
@keyframes sb-hit-burst{
  to{
    transform:translate(-50%,-50%) scale(1.45);
    opacity:0;
    box-shadow:0 0 32px rgba(250,250,250,1);
  }
}

/* เป้าพลาด */
.sb-target.miss{
  opacity:.35;
  filter:saturate(.4);
}

/* particle popup + score */
.sb-hit-particle{
  position:absolute;
  font-size:2rem;
  pointer-events:none;
  animation:sb-particle .4s ease-out forwards;
}
@keyframes sb-particle{
  0%{opacity:1;transform:translate(-50%,-50%) translateY(0) scale(1);}
  100%{opacity:0;transform:translate(-50%,-50%) translateY(-40px) scale(1.25);}
}

.sb-hit-score{
  position:absolute;
  font-size:.9rem;
  font-weight:600;
  color:#bbf7d0;
  text-shadow:0 0 10px rgba(34,197,94,0.9);
  pointer-events:none;
  animation:sb-score-pop .45s ease-out forwards;
}
@keyframes sb-score-pop{
  0%{opacity:0;transform:translate(-50%,-50%) translateY(10px) scale(.8);}
  20%{opacity:1;transform:translate(-50%,-50%) translateY(0) scale(1);}
  100%{opacity:0;transform:translate(-50%,-50%) translateY(-26px) scale(1.05);}
}

/* ===== FEVER BAR ===== */

.fever-wrap{
  margin-top:8px;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:.8rem;
}
.fever-label{
  font-weight:600;
  letter-spacing:.12em;
  color:#facc15;
}
.fever-bar{
  flex:1;
  height:8px;
  border-radius:999px;
  background:rgba(15,23,42,0.98);
  border:1px solid rgba(234,179,8,0.55);
  overflow:hidden;
}
.fever-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background:linear-gradient(90deg,#22c55e,#facc15,#f97316);
  box-shadow:0 0 14px rgba(250,204,21,0.9);
  transition:width .18s ease-out;
}
.fever-status{
  min-width:62px;
  text-align:center;
  font-size:.72rem;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(234,179,8,0.7);
  background:rgba(15,23,42,0.98);
  color:#eab308;
}
.fever-status.active{
  background:linear-gradient(135deg,#f97316,#facc15);
  color:#022c22;
  box-shadow:0 0 18px rgba(248,250,252,0.9);
}

/* ===== BOSS HUD & PORTRAIT ===== */

.boss-hud{
  margin-top:8px;
}
.boss-text{
  font-size:.8rem;
  color:#e5e7eb;
  margin-bottom:3px;
}
.boss-bar{
  width:100%;
  height:10px;
  border-radius:999px;
  background:rgba(15,23,42,0.98);
  border:1px solid rgba(248,113,113,0.72);
  overflow:hidden;
}
.boss-fill{
  height:100%;
  width:100%;
  border-radius:999px;
  background:linear-gradient(90deg,#ef4444,#f97316);
  box-shadow:0 0 16px rgba(239,68,68,0.9);
  transition:width .18s ease-out;
}
.boss-bar.hit-flash .boss-fill{
  box-shadow:0 0 20px rgba(252,211,77,1);
  filter:brightness(1.3);
}

.boss-portrait{
  margin-top:8px;
  opacity:0;
  transform:scale(.9) translateY(4px);
  transition:opacity .22s ease-out,transform .22s ease-out;
  pointer-events:none;
}
.boss-portrait.visible{
  opacity:1;
  transform:scale(1) translateY(0);
}
.boss-portrait-inner{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 9px;
  border-radius:999px;
  background:rgba(15,23,42,0.98);
  border:1px solid rgba(248,250,252,0.4);
  box-shadow:0 10px 22px rgba(15,23,42,0.9);
}
.boss-portrait-emoji{
  font-size:1.6rem;
  filter:drop-shadow(0 2px 6px rgba(15,23,42,0.95));
}
.boss-portrait-text{
  display:flex;
  flex-direction:column;
}
.boss-portrait-name{
  font-size:.85rem;
  font-weight:600;
}
.boss-portrait-hint{
  font-size:.75rem;
  color:#facc15;
}

/* shake เมื่อ HP ต่ำ */
.boss-portrait.shake .boss-portrait-inner{
  animation:boss-shake 0.35s ease-in-out infinite;
}
@keyframes boss-shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-2px);}
  50%{transform:translateX(2px);}
  75%{transform:translateX(-1px);}
  100%{transform:translateX(0);}
}

/* ===== COACH BUBBLE ===== */

.coach-bubble{
  margin-top:8px;
  display:flex;
  align-items:flex-start;
  gap:8px;
  max-width:100%;
  padding:6px 9px;
  border-radius:12px;
  background:rgba(15,23,42,0.98);
  border:1px solid rgba(148,163,184,0.5);
  font-size:.8rem;
  box-shadow:0 10px 24px rgba(15,23,42,0.9);
  opacity:0;
  transform:translateY(4px);
  transition:opacity .18s ease-out,transform .18s ease-out;
}
.coach-bubble.visible{
  opacity:1;
  transform:translateY(0);
}
.coach-avatar{
  font-size:1.4rem;
  filter:drop-shadow(0 2px 6px rgba(0,0,0,0.8));
}
.coach-text-wrap{
  display:flex;
  flex-direction:column;
}
.coach-role{
  font-weight:600;
  margin-bottom:2px;
  color:#e5e7eb;
}
.coach-text{
  color:#e5e7eb;
}

/* ===== BANNER HOW-TO ===== */

.banner{
  margin-top:8px;
  font-size:.8rem;
  color:#9ca3af;
  display:flex;
  align-items:center;
  gap:6px;
}
.banner strong{color:#fde68a;}

/* ===== RESULT VIEW ===== */

#view-result .summary{
  margin-top:10px;
  font-size:.9rem;
}
#view-result table{
  width:100%;
  border-collapse:collapse;
  margin-top:6px;
  font-size:.85rem;
}
#view-result th,
#view-result td{
  padding:6px 8px;
  border-bottom:1px solid rgba(148,163,184,0.4);
  text-align:left;
}
#view-result td.label{
  color:#9ca3af;
  width:40%;
}

/* ===== RESPONSIVE ===== */

@media(max-width:900px){
  .play-area{aspect-ratio:9/14;}
}

@media(max-width:768px){
  .card{
    border-radius:16px;
    padding:12px 12px 16px;
  }
  h1{font-size:1.45rem;}
  .play-top{
    flex-direction:column;
    align-items:flex-start;
  }
}

@media(max-width:480px){
  main{padding:8px 8px 14px;}
  .play-area{
    border-radius:18px;
    box-shadow:0 16px 40px rgba(0,0,0,0.9);
  }
  .btn-row button{min-width:100%;}
}
/* ===== Shadow Breaker — extra FX ===== */

/* พื้นหลังธีมตามบอส */
body.theme-boss-1 {
  background:
    radial-gradient(circle at top left, rgba(56,189,248,0.24), transparent 55%),
    radial-gradient(circle at bottom right, rgba(34,197,94,0.2), transparent 55%),
    #020617;
}

body.theme-boss-2 {
  background:
    radial-gradient(circle at top left, rgba(236,72,153,0.25), transparent 55%),
    radial-gradient(circle at bottom right, rgba(129,140,248,0.25), transparent 55%),
    #020617;
}

body.theme-boss-3 {
  background:
    radial-gradient(circle at top left, rgba(251,191,36,0.25), transparent 55%),
    radial-gradient(circle at bottom right, rgba(59,130,246,0.25), transparent 55%),
    #020617;
}

body.theme-boss-4 {
  background:
    radial-gradient(circle at top left, rgba(244,63,94,0.25), transparent 55%),
    radial-gradient(circle at bottom right, rgba(37,99,235,0.35), transparent 55%),
    #020617;
}

/* บอสใกล้ตาย: จอสั่น/โทนแดงนิด ๆ */
body.boss-lowhp .boss-portrait-inner {
  animation: bossShake 0.25s infinite;
  box-shadow: 0 0 0 2px rgba(248,113,113,0.8);
}

@keyframes bossShake {
  0%   { transform: translateX(0); }
  25%  { transform: translateX(-2px); }
  50%  { transform: translateX(2px); }
  75%  { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

/* บอสสุดท้าย: portrait มี pulse */
body.boss-final .boss-portrait-inner {
  animation: bossPulse 1.2s ease-in-out infinite;
}

@keyframes bossPulse {
  0%,100% { transform: scale(1); }
  50%     { transform: scale(1.06); }
}

/* FEVER bar */
.fever-wrap {
  transition: box-shadow 0.2s, transform 0.2s;
}

.fever-wrap.fever-active {
  box-shadow: 0 0 15px rgba(251,191,36,0.9);
  transform: translateY(-2px);
}

.fever-fill {
  transition: width 0.15s linear;
}

/* เป้า emoji */
.target {
  position: absolute;
  left: 50%;
  top: 50%;
  font-size: min(56px, 10vw);
  line-height: 1;
  cursor: pointer;
  user-select: none;
  transform: translate(-50%, -50%);
  text-shadow: 0 0 8px rgba(0,0,0,0.5);
  transition: transform 0.1s ease-out;
}

.target:active {
  transform: translate(-50%, -50%) scale(0.9);
}

.target-decoy {
  filter: grayscale(0.1) drop-shadow(0 0 6px rgba(248,113,113,0.8));
}

.target-gold {
  text-shadow: 0 0 12px rgba(250,204,21,0.9);
}
