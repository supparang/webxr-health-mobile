/* === /fitness/css/shadow-breaker.css ===
   PATCH: less cramped layout + HUD-safe playfield + reliable clicks + nicer expiry
*/

:root{
  --bg:#040610;
  --panel: rgba(4,6,16,.78);
  --panel2: rgba(10,16,36,.55);
  --stroke: rgba(148,163,184,.18);

  --text:#e5e7eb;
  --muted:#94a3b8;

  --good:#22c55e;
  --bad:#ef4444;
  --cyan:#22d3ee;
  --violet:#a78bfa;
  --amber:#f59e0b;

  /* ===== SAFE AREAS ===== */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);

  /* ===== HUD SIZE BUDGET (tweak here) ===== */
  --sb-hud-top: 104px;   /* top HUD height budget */
  --sb-hud-bottom: 86px; /* bottom HUD height budget */

  /* Engine/renderer reads these for spawn safe-zone */
  --sb-safe-top: calc(var(--safe-top) + var(--sb-hud-top) + 10px);
  --sb-safe-bottom: calc(var(--safe-bottom) + var(--sb-hud-bottom) + 10px);
  --sb-safe-left: calc(var(--safe-left) + 12px);
  --sb-safe-right: calc(var(--safe-right) + 12px);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  background: radial-gradient(1200px 900px at 30% 10%, #0b1638 0%, var(--bg) 52%, #02030a 100%);
  color:var(--text);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  overflow:hidden;
}

/* wrapper */
#sb-wrap{
  position:relative;
  height:100%;
  width:100%;
}

/* views */
.sb-view{ display:none; height:100%; width:100%; }
.sb-view.is-active{ display:block; }

/* ===== MENU ===== */
#sb-view-menu{
  padding: calc(var(--safe-top) + 14px) calc(var(--safe-right) + 14px) calc(var(--safe-bottom) + 14px) calc(var(--safe-left) + 14px);
  display:flex;
  flex-direction:column;
  gap:12px;
}
.sb-card{
  background: var(--panel);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:14px;
  box-shadow: 0 18px 55px rgba(0,0,0,.35);
}
.sb-row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.sb-btn{
  appearance:none;
  border:1px solid var(--stroke);
  background: rgba(15,23,42,.55);
  color:var(--text);
  border-radius:16px;
  padding:12px 14px;
  font-weight:800;
  cursor:pointer;
}
.sb-btn:active{ transform: translateY(1px); }
.sb-btn.primary{
  background: linear-gradient(135deg, rgba(34,197,94,.20), rgba(34,211,238,.12));
  border-color: rgba(34,197,94,.35);
}
.sb-btn.ghost{
  background: rgba(15,23,42,.28);
}
#sb-howto{
  display:none;
  margin-top:10px;
  color:var(--muted);
  line-height:1.45;
}
#sb-howto.is-on{ display:block; }

/* ===== PLAY VIEW LAYOUT (FIX cramped) ===== */
#sb-view-play{
  position:relative;
  height:100%;
  width:100%;
}

/* TOP HUD */
#sb-top-hud{
  position:absolute;
  z-index:30;
  left: calc(var(--safe-left) + 10px);
  right: calc(var(--safe-right) + 10px);
  top: calc(var(--safe-top) + 10px);

  height: var(--sb-hud-top);
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;

  pointer-events:none; /* ✅ IMPORTANT: HUD never blocks hits */
}
.sb-hud-panel{
  pointer-events:none;
  background: var(--panel);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:10px;
  overflow:hidden;
}
.sb-hud-title{
  font-weight:900;
  font-size:13px;
  opacity:.9;
  margin-bottom:6px;
}
.sb-hud-metrics{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  font-size:12px;
  color:var(--muted);
}
.sb-pill{
  border:1px solid var(--stroke);
  border-radius:999px;
  padding:4px 8px;
  background: rgba(2,6,23,.35);
  color:var(--text);
  font-weight:800;
}

/* BOTTOM HUD */
#sb-bottom-hud{
  position:absolute;
  z-index:30;
  left: calc(var(--safe-left) + 10px);
  right: calc(var(--safe-right) + 10px);
  bottom: calc(var(--safe-bottom) + 10px);
  height: var(--sb-hud-bottom);

  display:grid;
  grid-template-columns: 1fr auto;
  gap:10px;

  pointer-events:none; /* ✅ IMPORTANT */
}
#sb-bottom-hud .sb-hud-panel{ pointer-events:none; }

/* Buttons row (pause/back) - allow pointer events */
#sb-controls{
  position:absolute;
  z-index:40;
  top: calc(var(--safe-top) + 12px);
  right: calc(var(--safe-right) + 12px);
  display:flex;
  gap:8px;
  pointer-events:auto;
}
.sb-iconbtn{
  border:1px solid var(--stroke);
  background: rgba(2,6,23,.58);
  color:var(--text);
  border-radius:14px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
}
.sb-iconbtn:active{ transform: translateY(1px); }

/* ===== PLAYFIELD (TARGET LAYER) ===== */
#sb-target-layer{
  position:absolute;
  z-index:10;
  left:0; right:0; top:0; bottom:0;
  overflow:hidden;
  pointer-events:auto;

  /* Make sure targets can be hit anywhere */
  touch-action:none;
}

/* Main message */
#sb-msg-main{
  position:absolute;
  z-index:35;
  left: calc(var(--safe-left) + 14px);
  right: calc(var(--safe-right) + 14px);
  top: calc(var(--sb-safe-top) + 8px); /* beneath top safe zone */
  font-weight:900;
  font-size:14px;
  text-shadow: 0 10px 28px rgba(0,0,0,.55);
  pointer-events:none;
}
.sb-msg-main.good{ color: var(--good); }
.sb-msg-main.bad{ color: var(--bad); }
.sb-msg-main.perfect{ color: var(--cyan); }
.sb-msg-main.miss{ color: var(--amber); }

/* ===== TARGETS ===== */
.sb-target{
  border-radius: 999px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), rgba(255,255,255,.05) 45%, rgba(2,6,23,.55) 75%);
  border: 1px solid rgba(148,163,184,.25);
  box-shadow: 0 18px 45px rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  justify-content:center;
  transform: scale(.88);
  opacity:0;
  transition: transform .14s ease, opacity .14s ease, filter .14s ease;
  user-select:none;
}
.sb-target.is-on{
  transform: scale(1);
  opacity:1;
}
.sb-target__face{
  font-size: clamp(26px, 3.4vw, 44px);
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
}

/* types */
.sb-target--decoy{ outline: 2px dashed rgba(239,68,68,.35); }
.sb-target--bomb{ outline: 2px solid rgba(245,158,11,.28); }
.sb-target--heal{ outline: 2px solid rgba(34,197,94,.30); }
.sb-target--shield{ outline: 2px solid rgba(34,211,238,.30); }
.sb-target--bossface{ outline: 2px solid rgba(167,139,250,.35); }

/* hit/remove */
.sb-target.is-hit{
  transform: scale(1.12);
  opacity:0;
  filter: blur(1px);
}
.sb-target.is-off{
  transform: scale(.86);
  opacity:0;
}

/* ✅ expiry animation (smooth, not "hard disappear") */
.sb-target.is-expire{
  transform: scale(.78);
  opacity:0;
  filter: blur(1.4px);
}

/* ===== FX ===== */
.sb-fx{
  position:absolute;
  width: 10px;
  height: 10px;
  border-radius:999px;
  transform: translate(-50%,-50%) scale(.8);
  opacity:0;
  pointer-events:none;
  z-index:25;
  background: rgba(34,197,94,.0);
}
.sb-fx.is-on{
  opacity:1;
  animation: sb-pop .42s ease forwards;
}
.sb-fx[data-grade="good"]{ box-shadow: 0 0 0 0 rgba(34,197,94,.55); }
.sb-fx[data-grade="perfect"]{ box-shadow: 0 0 0 0 rgba(34,211,238,.55); }
.sb-fx[data-grade="bad"],
.sb-fx[data-grade="bomb"]{ box-shadow: 0 0 0 0 rgba(239,68,68,.55); }
.sb-fx[data-grade="expire"]{ box-shadow: 0 0 0 0 rgba(245,158,11,.45); }

@keyframes sb-pop{
  0%   { transform: translate(-50%,-50%) scale(.7); opacity:0; }
  18%  { opacity:1; }
  100% { transform: translate(-50%,-50%) scale(10); opacity:0; }
}

/* ===== RESULT ===== */
#sb-view-result{
  padding: calc(var(--safe-top) + 14px) calc(var(--safe-right) + 14px) calc(var(--safe-bottom) + 14px) calc(var(--safe-left) + 14px);
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* ===== small screens tune ===== */
@media (max-width: 420px){
  :root{
    --sb-hud-top: 96px;
    --sb-hud-bottom: 78px;
  }
  .sb-hud-panel{ padding:9px; border-radius:16px; }
  .sb-btn{ border-radius:14px; }
}