/* === /fitness/css/rhythm-boxer.css ===
Rhythm Boxer — PRODUCTION-ish (multi platform)
✅ Menu / Play / Result layout
✅ HUD + FEVER + PROGRESS bars
✅ Lane field: 5 lanes (tap/click)
✅ FX: flash + feedback + score particles
✅ Modal: Calibration (offset ms)
✅ cVR safe: bigger touch targets on small screens
*/

:root{
  color-scheme: dark;
  --bg: #020617;
  --panel: rgba(15,23,42,0.94);
  --panel2: rgba(2,6,23,0.70);
  --stroke: rgba(148,163,184,0.26);
  --text: #e5e7eb;
  --muted: #9ca3af;

  --accent: #a855f7;
  --accent2:#38bdf8;
  --good: #22c55e;
  --warn: #facc15;
  --bad:  #fb7185;

  --radius: 18px;
  --shadow: 0 18px 60px rgba(0,0,0,0.55);

  --laneH: 340px;
  --hitLineY: 72px;            /* visual line from bottom (used by CSS only) */
  --noteW: 58px;
  --noteH: 22px;
  --noteTailH: 112px;          /* “note tail” length visual */
}

*{box-sizing:border-box;}
html,body{
  margin:0; padding:0; height:100%;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at top left,rgba(168,85,247,0.20),transparent 55%),
    radial-gradient(circle at bottom right,rgba(56,189,248,0.20),transparent 55%),
    var(--bg);
  color:var(--text);
}

a{color:#bae6fd; text-decoration:none;}
a:hover{text-decoration:underline;}

#rb-wrap{
  min-height:100vh;
  width:100%;
  display:flex;
  justify-content:center;
  align-items:stretch;
  padding:14px 12px 26px;
}

.rb-view{
  width:100%;
  max-width:1100px;
  margin:0 auto;
}

.hidden{display:none !important;}

.rb-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding:10px 8px 6px;
}
.rb-head-main{max-width:760px;}

.rb-pill{
  display:inline-block;
  font-size:.78rem;
  padding:3px 10px;
  border:1px solid var(--stroke);
  border-radius:999px;
  background:rgba(15,23,42,0.72);
  color:#cbd5e1;
}
.rb-title{
  margin:8px 0 2px;
  font-size:2rem;
  letter-spacing:.2px;
}
.rb-sub{
  margin:0;
  color:var(--muted);
  font-size:.95rem;
}
.rb-sub-small{
  display:inline-block;
  margin-top:6px;
  color:#cbd5e1;
  font-size:.82rem;
  opacity:.9;
}

.rb-back{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background:rgba(15,23,42,0.70);
  color:var(--text);
  font-size:.9rem;
}

.rb-section{margin-top:12px;}
.rb-grid-2{
  display:grid;
  grid-template-columns: 1.05fr .95fr;
  gap:14px;
}

.rb-research-box{
  border-radius:var(--radius);
  background:var(--panel);
  border:1px solid var(--stroke);
  box-shadow:var(--shadow);
  padding:14px 14px 16px;
}

.rb-section-title{
  margin:0 0 8px;
  font-size:1.1rem;
}
.rb-section-subtitle{
  margin:0 0 10px;
  color:#cbd5e1;
  font-size:.9rem;
  opacity:.9;
}
.rb-section-title-sm{
  margin:0 0 6px;
  font-size:1rem;
  color:#e2e8f0;
}

.rb-mode-toggle{
  display:flex;
  gap:8px;
  padding:4px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background:rgba(2,6,23,0.55);
  width:fit-content;
}
.rb-mode-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  cursor:pointer;
  user-select:none;
  padding:7px 12px;
  border-radius:999px;
  border:1px solid transparent;
  color:#cbd5e1;
  background:transparent;
  font-size:.88rem;
}
.rb-mode-btn input{display:none;}
.rb-mode-btn:has(input:checked){
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  color:#020617;
  font-weight:650;
  box-shadow:0 0 14px rgba(56,189,248,0.35);
}

.rb-mode-desc{
  margin:10px 0 0;
  color:var(--muted);
  font-size:.88rem;
}

.rb-field{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.rb-field label{
  font-size:.82rem;
  color:#cbd5e1;
}
.rb-field input{
  border-radius:12px;
  border:1px solid rgba(148,163,184,0.35);
  background:rgba(2,6,23,0.55);
  color:var(--text);
  padding:10px 12px;
  font-size:.92rem;
  outline:none;
}
.rb-field input:focus{
  border-color:rgba(56,189,248,0.75);
  box-shadow:0 0 0 3px rgba(56,189,248,0.15);
}

.rb-hint-inline{
  margin:10px 0 0;
  color:var(--muted);
  font-size:.84rem;
  line-height:1.35;
}

.rb-hint-block{
  margin-top:10px;
  border-radius:14px;
  border:1px dashed rgba(148,163,184,0.35);
  background:rgba(2,6,23,0.35);
  padding:10px 12px;
}
.rb-hint-title{
  margin:0 0 6px;
  font-size:.9rem;
  color:#e2e8f0;
}
.rb-hint-list{
  margin:0;
  padding-left:18px;
  color:#cbd5e1;
  font-size:.86rem;
  line-height:1.35;
}

.rb-btn{
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.45);
  background:rgba(2,6,23,0.62);
  color:var(--text);
  padding:9px 14px;
  font-size:.92rem;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  text-decoration:none;
  transition:transform .12s, filter .12s, box-shadow .12s, background .12s;
}
.rb-btn:hover{
  filter:brightness(1.04);
  transform:translateY(-1px);
}
.rb-btn-primary{
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  color:#020617;
  border-color:transparent;
  font-weight:700;
  box-shadow:0 16px 36px rgba(0,0,0,0.5);
}
.rb-btn-ghost{
  background:rgba(2,6,23,0.35);
}
.rb-btn-sm{
  padding:7px 12px;
  font-size:.86rem;
}
.rb-btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}

/* ===== PLAY view ===== */

.rb-play-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding:10px 8px 6px;
}
.rb-title-sm{ margin:0; font-size:1.4rem; }
.rb-sub-sm{ margin:2px 0 0; color:var(--muted); font-size:.9rem; }

.rb-hud{
  margin-top:10px;
}
.rb-hud-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
.rb-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.35);
  background:rgba(2,6,23,0.40);
  font-size:.86rem;
  color:#cbd5e1;
}
.rb-chip b{ color:var(--text); font-weight:750; }

.rb-chip-ai{
  border-color: rgba(56,189,248,0.35);
  background: rgba(56,189,248,0.08);
}
.rb-chip-tip{
  width:100%;
  border-style:dashed;
}
.rb-chip-tip-label{
  opacity:.85;
  color:#bae6fd;
}
.rb-hud-judge-row .rb-chip{
  border-color: rgba(148,163,184,0.30);
}

.rb-bars{
  margin-top:10px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}
.rb-bar-block{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:8px;
  align-items:center;
}
.rb-bar-label{
  font-size:.84rem;
  color:#cbd5e1;
  opacity:.9;
}
.rb-bar{
  position:relative;
  height:12px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.35);
  background:rgba(2,6,23,0.55);
  overflow:hidden;
}
.rb-bar-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  transition: width .12s linear;
}
.rb-bar-fever{ background:linear-gradient(90deg,#facc15,#fb7185); }
.rb-bar-progress{ background:linear-gradient(90deg,#38bdf8,#22c55e); }

.rb-bar-status{
  font-size:.82rem;
  color:#cbd5e1;
  opacity:.95;
}

/* ===== Field & Lanes ===== */

.rb-field-wrap{
  margin-top:12px;
}
#rb-field{
  position:relative;
  border-radius:24px;
  border:1px solid rgba(148,163,184,0.22);
  background:
    radial-gradient(circle at 20% 10%, rgba(168,85,247,0.18), transparent 45%),
    radial-gradient(circle at 80% 80%, rgba(56,189,248,0.14), transparent 50%),
    rgba(2,6,23,0.65);
  box-shadow: 0 18px 60px rgba(0,0,0,0.65);
  padding:16px 12px 18px;
  overflow:hidden;
}

.rb-feedback{
  position:absolute;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.25);
  background:rgba(2,6,23,0.55);
  color:#e2e8f0;
  font-weight:800;
  letter-spacing:.3px;
  text-shadow:0 1px 0 rgba(0,0,0,0.4);
  z-index:8;
  pointer-events:none;
}
.rb-feedback.perfect{ color:#facc15; }
.rb-feedback.great{ color:#38bdf8; }
.rb-feedback.good{ color:#22c55e; }
.rb-feedback.miss{ color:#fb7185; }

.rb-lanes{
  height:var(--laneH);
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:10px;
  align-items:stretch;
  margin-top:52px;
}
.rb-lane{
  position:relative;
  border-radius:18px;
  border:1px solid rgba(148,163,184,0.22);
  background:rgba(15,23,42,0.55);
  overflow:hidden;
  cursor:pointer;
  touch-action:manipulation;
}
.rb-lane::before{
  content:'';
  position:absolute;
  left:0; right:0;
  bottom:var(--hitLineY);
  height:2px;
  background:linear-gradient(90deg,transparent,rgba(250,204,21,0.95),transparent);
  opacity:.9;
}
.rb-lane::after{
  content:'';
  position:absolute;
  left:0; right:0;
  bottom:0;
  height:62px;
  background:linear-gradient(180deg,transparent,rgba(2,6,23,0.55));
  pointer-events:none;
}
.rb-lane-label{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:10px;
  width:max-content;
  font-weight:800;
  letter-spacing:.3px;
  font-size:.9rem;
  color:#e2e8f0;
  opacity:.92;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.20);
  background:rgba(2,6,23,0.45);
}

/* Notes */
.rb-note{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:var(--noteW);
  height:var(--noteH);
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(56,189,248,0.90);
  box-shadow:0 10px 22px rgba(0,0,0,0.35);
  z-index:4;
  pointer-events:none;
}
.rb-note.lane-0{ background:rgba(168,85,247,0.90); }
.rb-note.lane-1{ background:rgba(56,189,248,0.92); }
.rb-note.lane-2{ background:rgba(34,197,94,0.92); }
.rb-note.lane-3{ background:rgba(250,204,21,0.92); }
.rb-note.lane-4{ background:rgba(251,113,133,0.92); }

.rb-note::after{
  content:'';
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:100%;
  width:12px;
  height:var(--noteTailH);
  border-radius:999px;
  background:rgba(255,255,255,0.22);
  filter:blur(.1px);
  opacity:.9;
}

/* FX: score + frags */
.rb-score-fx{
  position:fixed;
  z-index:999;
  font-weight:900;
  font-size:1rem;
  transform:translate(-50%,-50%) scale(0.95);
  opacity:0;
  pointer-events:none;
  text-shadow:0 2px 0 rgba(0,0,0,0.35);
}
.rb-score-fx.is-live{
  opacity:1;
  transform:translate(-50%,-70%) scale(1.0);
  transition: transform .42s ease, opacity .42s ease;
}
.rb-score-perfect{ color:#facc15; }
.rb-score-great{ color:#38bdf8; }
.rb-score-good{ color:#22c55e; }
.rb-score-miss{ color:#fb7185; }

.rb-frag{
  position:fixed;
  z-index:998;
  border-radius:999px;
  pointer-events:none;
  opacity:.95;
  transform:translate(-50%,-50%);
  animation: rbFrag var(--life,520ms) ease-out forwards;
  box-shadow:0 8px 16px rgba(0,0,0,0.25);
}
.rb-frag-perfect{ background:rgba(250,204,21,0.98); }
.rb-frag-great{ background:rgba(56,189,248,0.98); }
.rb-frag-good{ background:rgba(34,197,94,0.98); }
.rb-frag-miss{ background:rgba(251,113,133,0.95); }

@keyframes rbFrag{
  0%{ transform:translate(-50%,-50%) translate(0,0) scale(1); opacity:1; }
  100%{ transform:translate(-50%,-50%) translate(var(--dx,0px),var(--dy,22px)) scale(.35); opacity:0; }
}

/* flash layer */
#rb-flash{
  position:fixed;
  inset:0;
  background:rgba(251,113,133,0.18);
  opacity:0;
  pointer-events:none;
  z-index:9999;
}
#rb-flash.active{
  opacity:1;
  transition:opacity .12s;
}

/* inline howto */
.rb-howto-inline{
  margin:10px 4px 0;
  color:var(--muted);
  font-size:.88rem;
}

/* ===== RESULT ===== */

.rb-result-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:14px;
}
.rb-result-card{
  border-radius:var(--radius);
  background:var(--panel);
  border:1px solid var(--stroke);
  box-shadow:var(--shadow);
  padding:14px 14px 16px;
}
.rb-result-title{
  margin:0 0 10px;
  font-size:1.05rem;
}
.rb-result-row{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:7px 0;
  border-bottom:1px dashed rgba(148,163,184,0.20);
  color:#cbd5e1;
  font-size:.92rem;
}
.rb-result-row b{
  color:var(--text);
  font-weight:800;
}
.rb-quality-note{
  margin:12px 6px 0;
  padding:10px 12px;
  border-radius:14px;
  border:1px dashed rgba(251,113,133,0.35);
  background:rgba(251,113,133,0.08);
  color:#fecdd3;
  font-size:.9rem;
}

/* ===== MODAL (Calibration) ===== */

.rb-modal{
  position:fixed;
  inset:0;
  z-index:20000;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:14px;
  background:rgba(2,6,23,0.66);
  backdrop-filter: blur(6px);
}
.rb-modal-card{
  width:min(720px, 96vw);
  border-radius:22px;
  background:rgba(15,23,42,0.96);
  border:1px solid rgba(148,163,184,0.28);
  box-shadow: 0 22px 80px rgba(0,0,0,0.65);
  padding:16px 16px 14px;
}
.rb-modal-title{
  margin:0 0 6px;
  font-size:1.2rem;
}
.rb-modal-sub{
  margin:0 0 12px;
  color:var(--muted);
  font-size:.92rem;
  line-height:1.35;
}
.rb-modal-meter{
  display:flex;
  gap:12px;
  align-items:center;
  padding:12px;
  border-radius:16px;
  border:1px dashed rgba(148,163,184,0.24);
  background:rgba(2,6,23,0.35);
}
.rb-beat-dot{
  width:16px; height:16px;
  border-radius:999px;
  background:rgba(56,189,248,0.30);
  border:1px solid rgba(56,189,248,0.55);
  box-shadow:0 0 16px rgba(56,189,248,0.25);
}
.rb-beat-dot.is-beat{
  background:rgba(250,204,21,0.95);
  border-color:rgba(250,204,21,0.85);
  box-shadow:0 0 18px rgba(250,204,21,0.35);
  transform:scale(1.25);
  transition: transform .08s ease;
}
.rb-modal-text{
  display:grid;
  gap:6px;
  color:#cbd5e1;
  font-size:.92rem;
}
.rb-modal-actions{
  margin-top:12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.rb-modal-foot{
  margin:10px 0 0;
  color:#cbd5e1;
  opacity:.85;
  font-size:.86rem;
}

/* ===== Responsive ===== */
@media (max-width: 920px){
  .rb-grid-2{ grid-template-columns: 1fr; }
  .rb-result-grid{ grid-template-columns: 1fr; }
  :root{ --laneH: 320px; }
}
@media (max-width: 520px){
  :root{
    --laneH: 300px;
    --noteW: 52px;
    --noteH: 20px;
    --noteTailH: 118px;
  }
  .rb-title{ font-size:1.7rem; }
  .rb-lanes{ gap:8px; }
  .rb-lane{ border-radius:16px; }
  .rb-chip{ font-size:.82rem; }
}