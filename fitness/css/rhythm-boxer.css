/* === /fitness/css/rhythm-boxer.css === */
/* Rhythm Boxer — FULL CSS (hitline-bottom fix + note-tail + tap fix + HUD/AI/result) */

:root{
  color-scheme: dark;

  --bg:#020617;
  --panel: rgba(15,23,42,.90);
  --panel2: rgba(15,23,42,.72);
  --line: rgba(148,163,184,.18);
  --line2: rgba(148,163,184,.28);

  --txt:#e5e7eb;
  --mut:#9ca3af;
  --mut2:#cbd5e1;

  --cyan:#38bdf8;
  --vio:#a855f7;
  --green:#22c55e;
  --gold:#facc15;
  --red:#fb7185;
  --orange:#fb923c;

  --good:#22c55e;
  --great:#38bdf8;
  --perfect:#a855f7;
  --miss:#fb7185;

  --radius:18px;
  --shadow: 0 18px 44px rgba(0,0,0,.45);
}

/* ===== Base ===== */
*{ box-sizing:border-box; }

html,body{
  margin:0;
  padding:0;
  min-height:100%;
  background:
    radial-gradient(1000px 700px at 10% 0%, rgba(56,189,248,.10), transparent 60%),
    radial-gradient(900px 700px at 100% 20%, rgba(168,85,247,.12), transparent 58%),
    linear-gradient(180deg, #020617, #030712 55%, #020617);
  color:var(--txt);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans Thai", sans-serif;
}

body{
  padding: 12px;
}

/* ===== Utility ===== */
.hidden{ display:none !important; }

.rb-view{
  width:min(1100px, 100%);
  margin:0 auto;
}

#rb-wrap{
  width:min(1100px, 100%);
  margin:0 auto;
  position:relative;
}

#rb-flash{
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:0;
  background: radial-gradient(circle at 50% 70%, rgba(251,113,133,.12), transparent 55%);
  transition: opacity .10s ease;
  z-index: 60;
}
#rb-flash.active{ opacity:1; }

/* ===== Generic Cards / Sections ===== */
.rb-section{
  margin-top: 14px;
}

.rb-grid-2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}

.rb-research-box{
  border-radius: var(--radius);
  background:
    radial-gradient(90% 100% at 0% 0%, rgba(56,189,248,.08), transparent 65%),
    radial-gradient(90% 100% at 100% 100%, rgba(168,85,247,.08), transparent 65%),
    var(--panel);
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  padding:14px;
  backdrop-filter: blur(8px);
}

.rb-section-title{
  margin:0 0 8px;
  font-size:1rem;
  font-weight:800;
  letter-spacing:.2px;
}
.rb-section-title-sm{
  margin:0 0 6px;
  font-size:.95rem;
  font-weight:800;
}
.rb-section-subtitle{
  margin:0 0 10px;
  color:var(--mut);
  font-size:.88rem;
}
.rb-section-subtitle,
.rb-mode-desc,
.rb-hint-inline{
  line-height:1.45;
}

/* ===== Header ===== */
.rb-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  border-radius: var(--radius);
  background: var(--panel2);
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  padding:14px;
  backdrop-filter: blur(8px);
}

.rb-head-main{ min-width:0; }

.rb-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  border-radius:999px;
  border:1px solid rgba(56,189,248,.25);
  background: rgba(56,189,248,.08);
  color:#bae6fd;
  padding:4px 10px;
  font-size:.78rem;
  font-weight:700;
}

.rb-title{
  margin:8px 0 4px;
  font-size:1.65rem;
  line-height:1.15;
  letter-spacing:.2px;
}
.rb-title-sm{
  margin:0;
  font-size:1.05rem;
}
.rb-sub{
  margin:0;
  color:var(--mut2);
  font-size:.92rem;
}
.rb-sub-sm{
  margin:4px 0 0;
  color:var(--mut);
  font-size:.83rem;
}
.rb-sub-small{
  display:block;
  margin-top:6px;
  color:var(--mut);
  font-size:.8rem;
}

.rb-back{
  color:#cbd5e1;
  text-decoration:none;
  border:1px solid var(--line2);
  background: rgba(15,23,42,.65);
  border-radius:999px;
  padding:8px 12px;
  font-size:.85rem;
  white-space:nowrap;
}
.rb-back:hover{
  border-color: rgba(56,189,248,.35);
  color:#e0f2fe;
}

/* ===== Mode Toggle / Radio Buttons ===== */
.rb-mode-toggle{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.rb-mode-btn{
  display:flex;
  align-items:center;
  gap:8px;
  border:1px solid var(--line2);
  background: rgba(15,23,42,.60);
  border-radius: 12px;
  padding:8px 10px;
  cursor:pointer;
  transition: .15s ease;
  user-select:none;
}
.rb-mode-btn:hover{
  border-color: rgba(56,189,248,.35);
  background: rgba(15,23,42,.85);
}
.rb-mode-btn input{
  margin:0;
  accent-color: var(--cyan);
}
.rb-mode-btn span{
  font-size:.88rem;
  color:var(--txt);
}

#rb-track-options{
  display:grid;
  gap:8px;
}

.rb-mode-desc{
  margin:10px 0 0;
  color:var(--mut);
  font-size:.85rem;
}

.rb-field{
  display:grid;
  gap:4px;
  margin-bottom:10px;
}
.rb-field label{
  font-size:.82rem;
  color:var(--mut2);
}
.rb-field input{
  height:38px;
  border-radius:10px;
  border:1px solid var(--line2);
  background: rgba(2,6,23,.70);
  color:var(--txt);
  padding:0 10px;
  outline:none;
}
.rb-field input:focus{
  border-color: rgba(56,189,248,.55);
  box-shadow: 0 0 0 3px rgba(56,189,248,.12);
}

.rb-hint-inline{
  margin:8px 0 0;
  color:var(--mut);
  font-size:.8rem;
}

.rb-hint-block{
  margin-top:10px;
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  background: rgba(2,6,23,.35);
}
.rb-hint-title{
  margin:0 0 6px;
  font-weight:700;
  font-size:.85rem;
  color:#e2e8f0;
}
.rb-hint-list{
  margin:0;
  padding-left:18px;
  color:var(--mut2);
  font-size:.82rem;
  line-height:1.45;
}

/* ===== Buttons ===== */
.rb-btn{
  border:1px solid var(--line2);
  background: rgba(15,23,42,.78);
  color:var(--txt);
  border-radius: 12px;
  padding:10px 14px;
  font-weight:700;
  font-size:.88rem;
  cursor:pointer;
  transition: .15s ease;
}
.rb-btn:hover{
  border-color: rgba(56,189,248,.45);
  transform: translateY(-1px);
}
.rb-btn:active{ transform: translateY(0); }

.rb-btn-primary{
  background:
    linear-gradient(135deg, rgba(56,189,248,.95), rgba(168,85,247,.95));
  color:#020617;
  border-color: transparent;
  box-shadow: 0 10px 22px rgba(56,189,248,.18);
}
.rb-btn-primary:hover{
  filter: brightness(1.05);
  box-shadow: 0 12px 26px rgba(56,189,248,.25);
}
.rb-btn-ghost{
  background: rgba(15,23,42,.50);
}
.rb-btn-sm{
  padding:8px 10px;
  font-size:.82rem;
}
.rb-btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

/* ===== PLAY Header ===== */
.rb-play-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
  margin-bottom:10px;
}

/* ===== HUD ===== */
.rb-hud{
  margin-bottom:12px;
  padding:12px;
}

.rb-hud-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
.rb-hud-row:last-child{ margin-bottom:0; }

.rb-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.55);
  padding:6px 10px;
  font-size:.8rem;
  color:#dbeafe;
}
.rb-chip b{
  color:#fff;
  font-weight:800;
}

.rb-chip-ai{
  border-color: rgba(56,189,248,.22);
  background:
    linear-gradient(180deg, rgba(56,189,248,.08), rgba(15,23,42,.5));
}
.rb-chip-tip{
  width:100%;
  justify-content:flex-start;
  white-space:normal;
  border-color: rgba(168,85,247,.25);
  background:
    linear-gradient(180deg, rgba(168,85,247,.07), rgba(15,23,42,.50));
}
.rb-chip-tip-label{
  color:#ddd6fe;
  font-weight:700;
}

.rb-hud-judge-row .rb-chip{
  min-width: 110px;
  justify-content:center;
}

.rb-bars{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:8px;
}
.rb-bar-block{
  border:1px solid var(--line);
  border-radius:12px;
  padding:8px 10px;
  background: rgba(2,6,23,.35);
}
.rb-bar-label{
  display:block;
  font-size:.75rem;
  color:var(--mut);
  margin-bottom:4px;
}
.rb-bar{
  height:10px;
  border-radius:999px;
  background: rgba(148,163,184,.10);
  border:1px solid rgba(148,163,184,.12);
  overflow:hidden;
}
.rb-bar-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  transition: width .12s linear;
}
.rb-bar-fever{
  background: linear-gradient(90deg, #f59e0b, #facc15, #fb7185);
  box-shadow: 0 0 10px rgba(250,204,21,.25);
}
.rb-bar-progress{
  background: linear-gradient(90deg, #38bdf8, #22d3ee, #a855f7);
  box-shadow: 0 0 10px rgba(56,189,248,.20);
}
.rb-bar-status{
  display:block;
  margin-top:5px;
  font-size:.74rem;
  color:var(--mut2);
}

/* ===== Field Wrap ===== */
.rb-field-wrap{
  border-radius: var(--radius);
  background: var(--panel);
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  padding:12px;
}

.rb-howto-inline{
  margin:10px 2px 0;
  color:var(--mut);
  font-size:.8rem;
}

/* ===== Rhythm Field / Lanes (IMPORTANT HITLINE FIX) ===== */
#rb-field{
  position: relative;
  min-height: 460px;
  border-radius: 18px;
  overflow: hidden;
  background:
    radial-gradient(120% 85% at 50% 0%, rgba(56,189,248,.10), transparent 60%),
    radial-gradient(90% 80% at 50% 100%, rgba(168,85,247,.08), transparent 60%),
    linear-gradient(180deg, rgba(15,23,42,.96), rgba(2,6,23,.98));
  border: 1px solid rgba(148,163,184,.14);
}

/* จุดอ้างอิงเดียวกันทั้ง "เส้นตี" และ "ฐานโน้ต" */
#rb-lanes{
  --rb-hitline-y: 72px; /* ระยะจากล่างของ lane ขึ้นมา */
  position:absolute;
  inset:0;
  display:grid;
  grid-template-columns: repeat(5, minmax(0,1fr));
  gap:10px;
  padding:14px 12px 10px;
}

.rb-lane{
  position:relative;
  min-height: 360px;
  border-radius:14px;
  overflow:hidden;
  background:
    linear-gradient(180deg, rgba(30,41,59,.52), rgba(15,23,42,.82));
  border:1px solid rgba(148,163,184,.12);
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* lane grid texture */
.rb-lane::before{
  content:'';
  position:absolute;
  inset:0;
  z-index:0;
  pointer-events:none;
  background:
    linear-gradient(180deg, rgba(255,255,255,.04), transparent 20%),
    repeating-linear-gradient(
      180deg,
      transparent 0 42px,
      rgba(148,163,184,.035) 42px 43px
    );
}

/* HIT LINE (เส้นทองล่าง) */
.rb-lane::after{
  content:'';
  position:absolute;
  left:8px;
  right:8px;
  bottom: var(--rb-hitline-y);
  height:4px;
  border-radius:999px;
  z-index:2;
  pointer-events:none;
  background: linear-gradient(90deg,#f59e0b,#facc15,#fde68a,#facc15,#f59e0b);
  box-shadow:
    0 0 0 1px rgba(250,204,21,.20),
    0 0 12px rgba(250,204,21,.50),
    0 0 24px rgba(250,204,21,.22);
}

/* lane labels */
.rb-lane-label{
  position:absolute;
  left:8px;
  right:8px;
  bottom:10px;
  z-index:3;
  pointer-events:none;
  text-align:center;
  font-weight:800;
  color:#e5e7eb;
  font-size:.82rem;
  border-radius:10px;
  padding:6px 4px;
  background: rgba(2,6,23,.70);
  border:1px solid rgba(148,163,184,.14);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
}

/* ===== Notes (IMPORTANT TAP FIX + HITLINE ALIGN) ===== */
.rb-note{
  position:absolute;
  left:50%;
  bottom: var(--rb-hitline-y);  /* หัวโน้ตจบที่เส้นตี */
  width: 44px;
  height: var(--rb-note-len, 180px);
  transform: translate(-50%, -9999px);
  transform-origin: 50% 100%;
  z-index:4;
  opacity:0;
  will-change: transform, opacity;
  pointer-events:none;          /* สำคัญ: แตะทะลุไปที่ lane */
}

/* Tail */
.rb-note::before{
  content:'';
  position:absolute;
  left:50%;
  top:8px;
  bottom:22px;
  width:10px;
  transform: translateX(-50%);
  border-radius:999px;
  background:
    linear-gradient(180deg,
      rgba(56,189,248,.12) 0%,
      rgba(56,189,248,.38) 28%,
      rgba(168,85,247,.55) 70%,
      rgba(168,85,247,.15) 100%);
  box-shadow:
    0 0 10px rgba(56,189,248,.18),
    0 0 20px rgba(168,85,247,.10);
}

/* Head (music note) */
.rb-note-ico{
  position:absolute;
  left:50%;
  bottom:0;
  width:44px;
  height:44px;
  transform:translateX(-50%);
  display:grid;
  place-items:center;
  border-radius:999px;
  font-size:22px;
  line-height:1;
  color:#020617;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.40), transparent 55%),
    linear-gradient(180deg, rgba(56,189,248,.95), rgba(168,85,247,.92));
  border:1px solid rgba(255,255,255,.25);
  box-shadow:
    0 0 0 1px rgba(56,189,248,.15),
    0 6px 18px rgba(0,0,0,.35),
    0 0 18px rgba(56,189,248,.28);
}

/* lane tap active (optional if JS toggles class later) */
.rb-lane.is-hit{
  border-color: rgba(250,204,21,.45);
  box-shadow: inset 0 0 0 1px rgba(250,204,21,.20), 0 0 20px rgba(250,204,21,.12);
}

/* ===== Feedback text ===== */
.rb-feedback{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  z-index:10;
  pointer-events:none;
  min-width:120px;
  text-align:center;
  font-weight:900;
  letter-spacing:.4px;
  font-size:1rem;
  color:#e5e7eb;
  background: rgba(2,6,23,.55);
  border:1px solid rgba(148,163,184,.18);
  border-radius:999px;
  padding:6px 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,.24);
  text-transform:uppercase;
}
.rb-feedback.perfect{
  color:#ede9fe;
  border-color: rgba(168,85,247,.35);
  box-shadow: 0 0 0 1px rgba(168,85,247,.15), 0 0 16px rgba(168,85,247,.20);
}
.rb-feedback.great{
  color:#e0f2fe;
  border-color: rgba(56,189,248,.35);
  box-shadow: 0 0 0 1px rgba(56,189,248,.15), 0 0 16px rgba(56,189,248,.20);
}
.rb-feedback.good{
  color:#dcfce7;
  border-color: rgba(34,197,94,.30);
  box-shadow: 0 0 0 1px rgba(34,197,94,.12), 0 0 16px rgba(34,197,94,.18);
}
.rb-feedback.miss{
  color:#ffe4e6;
  border-color: rgba(251,113,133,.35);
  box-shadow: 0 0 0 1px rgba(251,113,133,.12), 0 0 16px rgba(251,113,133,.20);
}

/* ===== DOM Renderer FX (score text / particles) ===== */
.rb-score-fx{
  position:fixed;
  transform: translate(-50%, -50%);
  z-index:100;
  pointer-events:none;
  font-weight:900;
  letter-spacing:.2px;
  opacity:0;
  transition:
    transform .42s cubic-bezier(.18,.8,.2,1),
    opacity .42s ease;
  text-shadow: 0 2px 10px rgba(0,0,0,.35);
}
.rb-score-fx.is-live{
  opacity:1;
  transform: translate(-50%, -88px) scale(1.04);
}
.rb-score-perfect{ color:#ddd6fe; }
.rb-score-great{ color:#bae6fd; }
.rb-score-good{ color:#dcfce7; }
.rb-score-miss{ color:#fecdd3; }

.rb-frag{
  position:fixed;
  transform: translate(-50%, -50%);
  border-radius:999px;
  pointer-events:none;
  z-index:99;
  opacity:.95;
  animation: rbFragFly var(--life, .45s) ease-out forwards;
}
.rb-frag-perfect{
  background: radial-gradient(circle, rgba(196,181,253,.95), rgba(168,85,247,.35));
  box-shadow: 0 0 12px rgba(168,85,247,.35);
}
.rb-frag-great{
  background: radial-gradient(circle, rgba(125,211,252,.95), rgba(56,189,248,.35));
  box-shadow: 0 0 12px rgba(56,189,248,.35);
}
.rb-frag-good{
  background: radial-gradient(circle, rgba(134,239,172,.95), rgba(34,197,94,.35));
  box-shadow: 0 0 12px rgba(34,197,94,.35);
}
.rb-frag-miss{
  background: radial-gradient(circle, rgba(251,113,133,.92), rgba(239,68,68,.30));
  box-shadow: 0 0 12px rgba(251,113,133,.32);
}
@keyframes rbFragFly{
  from{
    opacity:.95;
    transform: translate(-50%, -50%) translate(0,0) scale(1);
  }
  to{
    opacity:0;
    transform: translate(-50%, -50%) translate(var(--dx,0px), var(--dy,0px)) scale(.35);
  }
}

/* ===== Result ===== */
.rb-result-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}

.rb-result-card{
  border-radius: var(--radius);
  background: var(--panel);
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  padding:14px;
}
.rb-result-title{
  margin:0 0 10px;
  font-size:1rem;
  font-weight:800;
}
.rb-result-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  padding:7px 0;
  border-bottom:1px dashed rgba(148,163,184,.12);
  font-size:.86rem;
}
.rb-result-row:last-child{ border-bottom:none; }
.rb-result-row span{ color:var(--mut); }
.rb-result-row b{
  color:var(--txt);
  text-align:right;
  word-break:break-word;
}

.rb-quality-note{
  margin:12px 0 0;
  border-radius:12px;
  padding:10px 12px;
  border:1px solid rgba(251,113,133,.25);
  background: rgba(127,29,29,.14);
  color:#fecdd3;
  font-size:.85rem;
  line-height:1.45;
}

/* ===== Responsive ===== */
@media (max-width: 980px){
  .rb-grid-2,
  .rb-result-grid{
    grid-template-columns:1fr;
  }

  .rb-header{
    flex-direction:column;
    align-items:flex-start;
  }

  .rb-play-header{
    flex-direction:column;
    align-items:stretch;
  }

  .rb-bars{
    grid-template-columns:1fr;
  }
}

@media (max-width: 720px){
  body{ padding:8px; }

  .rb-title{ font-size:1.35rem; }
  .rb-sub{ font-size:.86rem; }

  .rb-research-box,
  .rb-header,
  .rb-field-wrap,
  .rb-result-card{
    padding:12px;
    border-radius:14px;
  }

  #rb-field{
    min-height: 420px;
    border-radius: 14px;
  }

  #rb-lanes{
    gap:8px;
    padding:10px 8px 8px;
    --rb-hitline-y: 66px;
  }

  .rb-lane-label{
    bottom:8px;
    font-size:.74rem;
    padding:5px 3px;
  }

  .rb-note{
    width:40px;
  }
  .rb-note-ico{
    width:40px;
    height:40px;
    font-size:20px;
  }

  .rb-hud-judge-row .rb-chip{
    min-width:unset;
    flex:1 1 calc(50% - 8px);
    justify-content:center;
  }

  .rb-chip{
    font-size:.76rem;
    padding:5px 8px;
  }

  .rb-feedback{
    top:8px;
    font-size:.92rem;
    padding:5px 10px;
  }
}

@media (max-width: 520px){
  #rb-field{
    min-height: 390px;
  }

  #rb-lanes{
    --rb-hitline-y: 62px;
    gap:6px;
    padding:8px 6px 6px;
  }

  .rb-note::before{
    width:8px;
  }

  .rb-note{
    width:36px;
  }
  .rb-note-ico{
    width:36px;
    height:36px;
    font-size:18px;
  }

  .rb-mode-btn{
    width:100%;
  }

  .rb-btn{
    width:100%;
    justify-content:center;
  }
  .rb-btn-row .rb-btn{
    flex:1 1 100%;
  }
}

/* ===== Optional 3-lane preset support (if HTML uses only 3 lanes) ===== */
#rb-lanes[data-lanes="3"]{
  grid-template-columns: repeat(3, minmax(0,1fr));
}