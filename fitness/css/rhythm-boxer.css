/* === /fitness/css/rhythm-boxer.css ===
Rhythm Boxer — FULL PATCH (5-lane, mobile-safe, bottom hitline sync)
- เส้นตีอยู่ "ด้านล่าง" (gold line)
- โน้ตตกลงมาหาเส้นตี
- รองรับ engine + dom-renderer-rhythm
- Mobile/PC responsive
*/

:root{
  color-scheme: dark light;

  --bg0:#050816;
  --bg1:#07122b;
  --bg2:#0b1f4a;

  --panel: rgba(7,14,32,.78);
  --panel2: rgba(11,22,46,.68);
  --line: rgba(148,163,184,.16);
  --line2: rgba(148,163,184,.24);

  --txt: rgba(241,245,249,.96);
  --mut: rgba(203,213,225,.85);

  --cyan: #38bdf8;
  --sky: #60a5fa;
  --vio: #a78bfa;
  --pink:#f472b6;
  --good:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --gold:#fbbf24;

  --shadow-lg: 0 20px 50px rgba(2,6,23,.45);
  --shadow-md: 0 8px 24px rgba(2,6,23,.32);
  --shadow-sm: 0 4px 12px rgba(2,6,23,.22);

  --radius-xl: 22px;
  --radius-lg: 18px;
  --radius-md: 14px;
  --radius-sm: 12px;

  /* Safe areas */
  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  /* ===== Rhythm field tuning ===== */
  --rb-field-h: 640px;           /* desktop default */
  --rb-field-min-h: 420px;
  --rb-lane-gap: 12px;
  --rb-lane-pad-x: 14px;
  --rb-lane-pad-top: 18px;
  --rb-lane-pad-bottom: 16px;

  /* hit line position from lane top (IMPORTANT: engine/renderer reference point) */
  --rb-hitline-y: 500px;         /* desktop fallback */
  --rb-hitline-thickness: 8px;

  /* note visuals */
  --rb-note-head-w: 60px;
  --rb-note-head-h: 60px;
  --rb-note-tail-w: 16px;
  --rb-note-tail-radius: 12px;
  --rb-note-len: 160px;         /* engine can override inline */
  --rb-note-head-font: 28px;

  /* lane label zone */
  --rb-lane-label-h: 56px;
}

*{ box-sizing:border-box; }

html,body{
  margin:0;
  padding:0;
  min-height:100%;
  background:
    radial-gradient(1200px 800px at 10% 0%, rgba(99,102,241,.18), transparent 60%),
    radial-gradient(1000px 700px at 90% 15%, rgba(34,211,238,.14), transparent 60%),
    radial-gradient(900px 650px at 50% 100%, rgba(168,85,247,.12), transparent 65%),
    linear-gradient(180deg, var(--bg0), var(--bg1) 45%, var(--bg2));
  color:var(--txt);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
}

body{
  padding:
    calc(10px + var(--sat))
    calc(12px + var(--sar))
    calc(12px + var(--sab))
    calc(12px + var(--sal));
}

a{ color:inherit; text-decoration:none; }

.hidden{ display:none !important; }

/* ===== Layout ===== */
#rb-wrap{
  width:min(1100px, 100%);
  margin:0 auto;
}

.rb-view{
  display:block;
}

.rb-header,
.rb-play-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  margin-bottom:14px;
}

.rb-head-main{ min-width:0; }

.rb-title{
  margin:8px 0 6px;
  font-size:clamp(1.45rem, 2.5vw, 2.2rem);
  line-height:1.1;
  font-weight:800;
  letter-spacing:.2px;
}

.rb-title-sm{
  margin:0 0 4px;
  font-size:clamp(1.2rem, 2.2vw, 1.9rem);
  line-height:1.1;
  font-weight:800;
}

.rb-sub{
  margin:0;
  color:var(--mut);
  line-height:1.45;
}

.rb-sub-sm{
  margin:0;
  color:var(--mut);
  line-height:1.35;
}

.rb-sub-small{
  display:inline-block;
  margin-top:8px;
  color:rgba(191,219,254,.95);
  font-size:.92rem;
}

.rb-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(56,189,248,.22);
  background:linear-gradient(180deg, rgba(14,25,49,.9), rgba(11,18,36,.84));
  color:#dbeafe;
  font-weight:700;
  font-size:.85rem;
  box-shadow: var(--shadow-sm);
}

.rb-back{
  flex:0 0 auto;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height:40px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--line2);
  background:rgba(2,6,23,.45);
  color:var(--txt);
  box-shadow: var(--shadow-sm);
}

.rb-grid-2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}

.rb-section{
  margin-top:12px;
}

.rb-research-box{
  border:1px solid var(--line);
  background:
    linear-gradient(180deg, rgba(8,16,38,.92), rgba(7,13,28,.85));
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  padding:14px;
  backdrop-filter: blur(8px);
}

.rb-section-title{
  margin:0 0 8px;
  font-size:1.02rem;
  font-weight:800;
  letter-spacing:.2px;
}

.rb-section-title-sm{
  margin:0 0 6px;
  font-size:.98rem;
  font-weight:800;
}

.rb-section-subtitle{
  margin:0 0 10px;
  color:var(--mut);
  font-size:.94rem;
}

.rb-mode-desc{
  margin:10px 0 0;
  color:var(--mut);
  line-height:1.4;
}

.rb-mode-toggle{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.rb-mode-btn{
  display:block;
  cursor:pointer;
}

.rb-mode-btn input{
  position:absolute;
  opacity:0;
  pointer-events:none;
}

.rb-mode-btn > span{
  display:block;
  border-radius:14px;
  border:1px solid var(--line2);
  background:rgba(15,23,42,.55);
  padding:10px 12px;
  line-height:1.3;
  color:var(--txt);
  transition:.15s ease;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.01);
}

.rb-mode-btn input:checked + span{
  border-color: rgba(56,189,248,.45);
  background:
    linear-gradient(180deg, rgba(5,18,44,.95), rgba(7,14,30,.88));
  box-shadow:
    inset 0 0 0 1px rgba(56,189,248,.16),
    0 0 0 2px rgba(56,189,248,.10);
}

.rb-field{
  margin-top:10px;
}

.rb-field label{
  display:block;
  margin-bottom:6px;
  color:#dbeafe;
  font-size:.9rem;
  font-weight:600;
}

.rb-field input{
  width:100%;
  border:none;
  outline:none;
  border-radius:12px;
  padding:11px 12px;
  color:var(--txt);
  background:rgba(15,23,42,.65);
  border:1px solid rgba(148,163,184,.22);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.02);
}

.rb-field input::placeholder{
  color:rgba(203,213,225,.55);
}

.rb-hint-inline{
  margin:10px 0 0;
  color:var(--mut);
  font-size:.9rem;
  line-height:1.45;
}

.rb-hint-block{
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(148,163,184,.12);
  background:rgba(2,6,23,.28);
}
.rb-hint-title{
  margin:0 0 8px;
  color:#f8fafc;
  font-weight:700;
}
.rb-hint-list{
  margin:0;
  padding-left:18px;
  color:var(--mut);
  line-height:1.45;
}

.rb-btn{
  border:none;
  outline:none;
  cursor:pointer;
  border-radius:14px;
  padding:11px 14px;
  color:var(--txt);
  background:rgba(15,23,42,.75);
  border:1px solid rgba(148,163,184,.24);
  box-shadow: var(--shadow-sm);
  font-weight:700;
}
.rb-btn:hover{ filter:brightness(1.04); }
.rb-btn:active{ transform:translateY(1px); }

.rb-btn-primary{
  background:
    linear-gradient(180deg, rgba(14,165,233,.28), rgba(99,102,241,.18)),
    rgba(15,23,42,.9);
  border-color: rgba(56,189,248,.38);
  color:#eff6ff;
}

.rb-btn-ghost{
  background:rgba(2,6,23,.35);
}

.rb-btn-sm{
  padding:10px 12px;
  border-radius:12px;
  font-size:.92rem;
}

.rb-btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

/* ===== Play HUD ===== */
.rb-hud{
  margin-top:8px;
}

.rb-hud-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
.rb-hud-row:last-child{ margin-bottom:0; }

.rb-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  min-height:40px;
  padding:7px 12px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.22);
  background:rgba(8,15,33,.62);
  color:#e5e7eb;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.02);
  font-size:.95rem;
}

.rb-chip b{
  color:#f8fafc;
  font-weight:800;
}

.rb-chip-ai{
  border-color: rgba(56,189,248,.35);
  background:
    linear-gradient(180deg, rgba(14,165,233,.08), rgba(59,130,246,.04)),
    rgba(8,15,33,.70);
}

.rb-chip-tip{
  width:100%;
  justify-content:flex-start;
  border-style:dashed;
  min-height:46px;
}
.rb-chip-tip-label{
  color:#fbbf24;
  font-weight:800;
}
#rb-hud-ai-tip.hidden{ display:none; }

.rb-hud-judge-row .rb-chip{
  min-width:110px;
  justify-content:center;
}

.rb-bars{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  margin-top:4px;
}
.rb-bar-block{
  display:grid;
  grid-template-columns: auto 1fr auto;
  align-items:center;
  gap:8px;
}
.rb-bar-label{
  color:#e5e7eb;
  font-weight:800;
  letter-spacing:.2px;
  min-width:44px;
}
.rb-bar{
  position:relative;
  height:24px;
  border-radius:999px;
  overflow:hidden;
  border:1px solid rgba(148,163,184,.18);
  background:rgba(2,6,23,.55);
  box-shadow: inset 0 2px 8px rgba(0,0,0,.25);
}
.rb-bar-fill{
  height:100%;
  width:0%;
  border-radius:inherit;
  transition: width .12s linear;
}
.rb-bar-fever{
  background:
    linear-gradient(90deg, #22d3ee, #60a5fa 45%, #a78bfa 100%);
  box-shadow: 0 0 10px rgba(96,165,250,.28);
}
.rb-bar-progress{
  background:
    linear-gradient(90deg, #38bdf8, #22c55e);
}
.rb-bar-status{
  color:#e5e7eb;
  font-weight:800;
  min-width:42px;
  text-align:right;
}

/* ===== Field / Lanes ===== */
.rb-field-wrap{
  margin-top:14px;
}

#rb-field{
  position:relative;
  border-radius:24px;
  border:1px solid rgba(148,163,184,.16);
  background:
    radial-gradient(500px 260px at 15% 12%, rgba(168,85,247,.12), transparent 65%),
    radial-gradient(620px 320px at 82% 22%, rgba(14,165,233,.10), transparent 70%),
    linear-gradient(180deg, rgba(3,10,30,.92), rgba(2,8,24,.95));
  box-shadow: var(--shadow-lg);
  padding:12px;
  overflow:hidden;
}

/* subtle lower glow (where hitline is) */
#rb-field::after{
  content:"";
  position:absolute;
  left:0; right:0;
  bottom:0;
  height:34%;
  background:
    linear-gradient(180deg, rgba(59,130,246,.04), rgba(59,130,246,.08)),
    linear-gradient(180deg, rgba(168,85,247,.05), rgba(168,85,247,.10));
  pointer-events:none;
}

.rb-feedback{
  position:absolute;
  z-index:8;
  top:12px;
  left:50%;
  transform:translateX(-50%);
  min-width:96px;
  text-align:center;
  padding:8px 14px;
  border-radius:16px;
  font-size:clamp(1rem, 2vw, 1.25rem);
  font-weight:900;
  letter-spacing:.6px;
  color:#fff;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(15,23,42,.78);
  box-shadow: var(--shadow-md);
  opacity:.95;
  transition: transform .12s ease, opacity .12s ease, filter .12s ease;
  user-select:none;
  pointer-events:none;
}
.rb-feedback.show{
  transform:translateX(-50%) scale(1.03);
}
.rb-feedback.is-perfect{
  color:#fefce8;
  background:linear-gradient(180deg, rgba(250,204,21,.85), rgba(217,119,6,.82));
}
.rb-feedback.is-great{
  color:#ecfeff;
  background:linear-gradient(180deg, rgba(34,211,238,.80), rgba(59,130,246,.72));
}
.rb-feedback.is-good{
  color:#f0fdf4;
  background:linear-gradient(180deg, rgba(34,197,94,.80), rgba(22,163,74,.72));
}
.rb-feedback.is-miss{
  color:#fff1f2;
  background:linear-gradient(180deg, rgba(239,68,68,.92), rgba(220,38,38,.86));
}

.rb-lanes{
  position:relative;
  display:grid;
  grid-template-columns: repeat(5, minmax(0,1fr));
  gap: var(--rb-lane-gap);
  min-height: clamp(var(--rb-field-min-h), 68vh, var(--rb-field-h));
  align-items:stretch;
  z-index:1;
}

.rb-lane{
  position:relative;
  border-radius:22px;
  border:1px solid rgba(148,163,184,.18);
  background:
    linear-gradient(180deg, rgba(10,20,46,.55), rgba(6,16,38,.45)),
    rgba(2,6,23,.20);
  overflow:hidden;
  min-width:0;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.02);
  touch-action:manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* lane inner glow */
.rb-lane::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(120px 220px at 50% 25%, rgba(56,189,248,.08), transparent 70%),
    linear-gradient(180deg, rgba(255,255,255,.02), transparent 30%);
  pointer-events:none;
}

/* hit line = GOLD LINE at bottom */
.rb-lane::after{
  content:"";
  position:absolute;
  left:18%;
  width:64%;
  top: var(--rb-hitline-y);
  height: var(--rb-hitline-thickness);
  transform: translateY(-50%);
  border-radius:999px;
  background:
    linear-gradient(90deg, rgba(251,191,36,.95), rgba(245,158,11,.95));
  box-shadow:
    0 0 0 1px rgba(251,191,36,.28),
    0 0 14px rgba(251,191,36,.28);
  pointer-events:none;
  z-index:2;
}

.rb-lane-label{
  position:absolute;
  z-index:4;
  left:50%;
  bottom:8px;
  transform:translateX(-50%);
  min-width:50px;
  height:44px;
  padding:0 10px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.18);
  background:rgba(8,15,33,.72);
  box-shadow: var(--shadow-sm);
  color:#e5e7eb;
  font-size: clamp(.9rem, 1.8vw, 1.05rem);
  font-weight:800;
  letter-spacing:.3px;
  user-select:none;
  pointer-events:none;
}

/* ===== Note (engine injects .rb-note into lane) =====
   Anchor system:
   - NOTE HEAD center sits at the lane "hit line" when translateY = 0
   - engine moves note using transform: translate(-50%, y)
*/
.rb-note{
  position:absolute;
  z-index:3;
  left:50%;
  top: var(--rb-hitline-y);         /* IMPORTANT: anchor to hit line */
  width: var(--rb-note-head-w);
  height: var(--rb-note-head-h);
  transform: translate(-50%, -120px); /* engine overwrites */
  pointer-events:none;
  will-change: transform, opacity;
  opacity:1;
  filter: drop-shadow(0 8px 18px rgba(0,0,0,.28));
}

/* tail extends upward from head */
.rb-note::before{
  content:"";
  position:absolute;
  left:50%;
  bottom: calc(100% - 8px);
  transform: translateX(-50%);
  width: var(--rb-note-tail-w);
  height: var(--rb-note-len);
  border-radius: var(--rb-note-tail-radius);
  background:
    linear-gradient(180deg,
      rgba(251,191,36,.95) 0%,
      rgba(245,158,11,.88) 45%,
      rgba(217,119,6,.72) 100%);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.10),
    0 0 12px rgba(251,191,36,.18);
  opacity:.95;
}

/* head */
.rb-note-ico{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size: var(--rb-note-head-font);
  line-height:1;
  user-select:none;

  color:#334155; /* emoji fallback does not use color, but icon glyph/char fallback may */
  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.35), rgba(255,255,255,0) 42%),
    linear-gradient(180deg, rgba(251,191,36,.98), rgba(245,158,11,.96));
  border:1px solid rgba(255,255,255,.14);
  box-shadow:
    inset 0 -6px 14px rgba(146,64,14,.18),
    0 8px 20px rgba(245,158,11,.20);
}

/* optional different note types (future) */
.rb-note.is-bomb .rb-note-ico{
  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.25), rgba(255,255,255,0) 42%),
    linear-gradient(180deg, rgba(239,68,68,.95), rgba(127,29,29,.92));
}
.rb-note.is-heal .rb-note-ico{
  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.25), rgba(255,255,255,0) 42%),
    linear-gradient(180deg, rgba(34,197,94,.95), rgba(21,128,61,.92));
}

/* ===== Lane touch hit feedback classes (from renderer) ===== */
.rb-lane.fx-hit-perfect{
  animation: rbLaneHitPerfect .22s ease;
}
.rb-lane.fx-hit-great{
  animation: rbLaneHitGreat .20s ease;
}
.rb-lane.fx-hit-good{
  animation: rbLaneHitGood .18s ease;
}
.rb-lane.fx-hit-miss{
  animation: rbLaneHitMiss .20s ease;
}

@keyframes rbLaneHitPerfect{
  0%   { box-shadow: inset 0 0 0 0 rgba(251,191,36,.0), 0 0 0 rgba(0,0,0,0); }
  35%  { box-shadow: inset 0 0 0 2px rgba(251,191,36,.45), 0 0 22px rgba(251,191,36,.18); }
  100% { box-shadow: inset 0 0 0 0 rgba(251,191,36,.0), 0 0 0 rgba(0,0,0,0); }
}
@keyframes rbLaneHitGreat{
  0%   { box-shadow: inset 0 0 0 0 rgba(56,189,248,.0); }
  35%  { box-shadow: inset 0 0 0 2px rgba(56,189,248,.42); }
  100% { box-shadow: inset 0 0 0 0 rgba(56,189,248,.0); }
}
@keyframes rbLaneHitGood{
  0%   { box-shadow: inset 0 0 0 0 rgba(34,197,94,.0); }
  35%  { box-shadow: inset 0 0 0 2px rgba(34,197,94,.38); }
  100% { box-shadow: inset 0 0 0 0 rgba(34,197,94,.0); }
}
@keyframes rbLaneHitMiss{
  0%   { box-shadow: inset 0 0 0 0 rgba(239,68,68,.0); }
  35%  { box-shadow: inset 0 0 0 2px rgba(239,68,68,.42); }
  100% { box-shadow: inset 0 0 0 0 rgba(239,68,68,.0); }
}

/* ===== Renderer FX (spark / float) ===== */
.rb-fx-spark{
  position:absolute;
  z-index:6;
  width:34px;
  height:34px;
  border-radius:50%;
  pointer-events:none;
  animation: rbSpark .24s ease-out forwards;
}
.rb-fx-spark::before,
.rb-fx-spark::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
}
.rb-fx-spark.is-perfect{
  background: radial-gradient(circle, rgba(251,191,36,.85), rgba(251,191,36,.15) 60%, rgba(251,191,36,0) 72%);
}
.rb-fx-spark.is-great{
  background: radial-gradient(circle, rgba(56,189,248,.85), rgba(56,189,248,.15) 60%, rgba(56,189,248,0) 72%);
}
.rb-fx-spark.is-good{
  background: radial-gradient(circle, rgba(34,197,94,.80), rgba(34,197,94,.14) 60%, rgba(34,197,94,0) 72%);
}
.rb-fx-spark.is-miss{
  background: radial-gradient(circle, rgba(239,68,68,.85), rgba(239,68,68,.16) 60%, rgba(239,68,68,0) 72%);
}

@keyframes rbSpark{
  0%   { transform:translate(-50%,-50%) scale(.55); opacity:.95; }
  100% { transform:translate(-50%,-50%) scale(1.35); opacity:0; }
}

.rb-fx-float{
  position:absolute;
  z-index:7;
  pointer-events:none;
  font-weight:900;
  font-size:.92rem;
  letter-spacing:.2px;
  text-shadow: 0 2px 10px rgba(0,0,0,.28);
  animation: rbFloat .50s ease-out forwards;
}
.rb-fx-float.is-perfect{ color:#fde68a; }
.rb-fx-float.is-great{ color:#93c5fd; }
.rb-fx-float.is-good{ color:#86efac; }
.rb-fx-float.is-miss{ color:#fca5a5; }

@keyframes rbFloat{
  0%   { transform:translate(-50%,-50%) translateY(0); opacity:.95; }
  100% { transform:translate(-50%,-50%) translateY(-20px); opacity:0; }
}

.rb-howto-inline{
  margin:10px 2px 0;
  color:var(--mut);
  line-height:1.4;
  text-align:center;
}

/* ===== Result ===== */
.rb-result-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  margin-top:12px;
}
.rb-result-card{
  border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(8,16,38,.88), rgba(7,13,28,.82));
  border-radius:18px;
  padding:12px;
  box-shadow: var(--shadow-md);
}
.rb-result-title{
  margin:0 0 10px;
  font-size:1rem;
  font-weight:800;
}
.rb-result-row{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:7px 0;
  border-bottom:1px dashed rgba(148,163,184,.10);
}
.rb-result-row:last-child{ border-bottom:none; }
.rb-result-row span{ color:var(--mut); }
.rb-result-row b{
  color:#f8fafc;
  text-align:right;
  word-break:break-word;
}

.rb-quality-note{
  margin:12px 0 0;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(245,158,11,.26);
  background:rgba(245,158,11,.10);
  color:#fde68a;
}

/* ===== Mobile / Tablet ===== */
@media (max-width: 980px){
  .rb-grid-2{
    grid-template-columns: 1fr;
  }

  .rb-result-grid{
    grid-template-columns: 1fr;
  }

  .rb-bars{
    grid-template-columns: 1fr;
    gap:8px;
  }
}

@media (max-width: 768px){
  body{
    padding:
      calc(8px + var(--sat))
      calc(8px + var(--sar))
      calc(10px + var(--sab))
      calc(8px + var(--sal));
  }

  .rb-play-header{
    flex-direction:column;
    align-items:stretch;
  }

  .rb-play-header .rb-btn{
    align-self:flex-start;
  }

  .rb-research-box{
    padding:12px;
    border-radius:18px;
  }

  .rb-chip{
    min-height:38px;
    padding:6px 11px;
    font-size:.92rem;
  }

  .rb-hud-judge-row .rb-chip{
    min-width:calc(50% - 6px);
    justify-content:center;
    flex:1 1 calc(50% - 6px);
  }

  /* ===== IMPORTANT: mobile field tuning ===== */
  :root{
    --rb-field-h: 520px;
    --rb-field-min-h: 380px;
    --rb-lane-gap: 8px;
    --rb-note-head-w: 54px;
    --rb-note-head-h: 54px;
    --rb-note-tail-w: 14px;
    --rb-note-head-font: 24px;
    --rb-hitline-y: 390px; /* mobile default, near bottom */
    --rb-lane-label-h: 52px;
  }

  #rb-field{
    padding:10px;
    border-radius:20px;
  }

  .rb-feedback{
    top:10px;
    min-width:90px;
    padding:7px 12px;
    border-radius:14px;
    font-size:1rem;
  }

  .rb-lane{
    border-radius:18px;
  }

  .rb-lane::after{
    left:14%;
    width:72%;
    height:7px;
  }

  .rb-lane-label{
    bottom:8px;
    min-width:46px;
    height:40px;
    padding:0 8px;
    font-size:.9rem;
  }

  .rb-howto-inline{
    font-size:.9rem;
    margin-top:8px;
  }
}

@media (max-width: 480px){
  .rb-title-sm{
    font-size: clamp(1.05rem, 6vw, 1.35rem);
  }
  .rb-sub-sm{
    font-size:.92rem;
  }

  .rb-chip{
    min-height:36px;
    padding:5px 10px;
    font-size:.88rem;
  }

  .rb-hud-row{
    gap:6px;
    margin-bottom:6px;
  }

  :root{
    --rb-field-h: 500px;
    --rb-field-min-h: 360px;
    --rb-lane-gap: 6px;
    --rb-note-head-w: 50px;
    --rb-note-head-h: 50px;
    --rb-note-tail-w: 12px;
    --rb-note-head-font: 22px;
    --rb-hitline-y: 374px; /* ให้ใกล้ล่างขึ้นบนจอเล็ก */
  }

  .rb-lane-label{
    min-width:42px;
    height:38px;
    font-size:.86rem;
    bottom:6px;
  }

  .rb-lane::after{
    height:6px;
  }

  /* ปรับ feedback ไม่ให้บังเลนมาก */
  .rb-feedback{
    top:8px;
    padding:6px 10px;
    min-width:84px;
    font-size:.95rem;
  }
}

/* ===== Landscape phone ===== */
@media (max-height: 560px) and (orientation: landscape){
  :root{
    --rb-field-h: 360px;
    --rb-field-min-h: 300px;
    --rb-hitline-y: 250px;
    --rb-note-head-w: 44px;
    --rb-note-head-h: 44px;
    --rb-note-head-font: 20px;
    --rb-note-tail-w: 10px;
  }

  .rb-research-box.rb-hud{
    padding:10px;
  }

  .rb-chip{
    min-height:32px;
    padding:4px 9px;
    font-size:.82rem;
  }

  .rb-feedback{
    top:6px;
    font-size:.88rem;
  }

  .rb-howto-inline{
    display:none; /* แนวนอนพื้นที่น้อย */
  }
}

/* ===== Reduced motion ===== */
@media (prefers-reduced-motion: reduce){
  *{
    animation-duration: .01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: .01ms !important;
    scroll-behavior: auto !important;
  }
}