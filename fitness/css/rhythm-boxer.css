:root{
  color-scheme: dark light;
  --rb-bg: #020617;
  --rb-card: #0b1120;
  --rb-border: #1e293b;
  --rb-text: #e5e7eb;
  --rb-muted: #9ca3af;
  --rb-accent: #38bdf8;
  --rb-accent-soft: rgba(56,189,248,0.18);
  --rb-danger: #f97373;
  --rb-success: #4ade80;
  --rb-warning: #facc15;
  --rb-rank-sss: #f97316;
}

*,
*::before,
*::after{
  box-sizing:border-box;
}

body{
  margin:0;
  min-height:100vh;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at top left, rgba(56,189,248,0.25), transparent 55%),
    radial-gradient(circle at bottom right, rgba(37,99,235,0.25), transparent 55%),
    var(--rb-bg);
  color:var(--rb-text);
}

/* Wrap + views */

#rb-wrap{
  max-width:980px;
  margin:20px auto 32px;
  padding:0 16px 32px;
}

.rb-view{
  display:block;
}

.hidden{
  display:none !important;
}

/* Header / footer */

.rb-header h1{
  margin:0 0 4px;
  font-size:1.9rem;
}
.rb-subtitle{
  margin:0 0 12px;
  color:var(--rb-muted);
  font-size:.95rem;
}
.rb-footer{
  margin-top:16px;
  font-size:.85rem;
  color:var(--rb-muted);
}

/* Cards */

.rb-card{
  background:linear-gradient(to bottom right, rgba(15,23,42,0.9), rgba(15,23,42,0.96));
  border:1px solid var(--rb-border);
  border-radius:18px;
  padding:16px 16px 18px;
  margin-top:14px;
  box-shadow:0 14px 40px rgba(0,0,0,0.35);
}

.rb-card h2{
  margin-top:0;
  margin-bottom:10px;
  font-size:1.2rem;
}

.rb-card-result{
  margin-top:10px;
}

/* Buttons */

.rb-btn{
  border-radius:999px;
  border:1px solid transparent;
  padding:6px 14px;
  font-size:.95rem;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  background:#111827;
  color:var(--rb-text);
  transition:background .16s ease, border-color .16s ease, transform .06s ease;
}
.rb-btn:hover{
  transform:translateY(-1px);
}
.rb-btn:active{
  transform:translateY(0);
}

.rb-btn-primary{
  background:linear-gradient(90deg,#0ea5e9,#22c55e);
  border-color:rgba(148,163,184,0.4);
  color:white;
}
.rb-btn-primary:hover{
  filter:brightness(1.05);
}

.rb-btn-secondary{
  background:#020617;
  border-color:#334155;
  color:var(--rb-text);
}
.rb-btn-ghost{
  background:transparent;
  border-color:#334155;
  color:var(--rb-muted);
}
.rb-btn-lg{
  padding:8px 24px;
  font-size:1.02rem;
}

/* Fields */

.rb-field-row{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-bottom:8px;
}
.rb-field-row label{
  font-size:.88rem;
  color:var(--rb-muted);
}
.rb-field-row input,
.rb-field-row select{
  border-radius:12px;
  border:1px solid #1f2933;
  background:#020617;
  color:var(--rb-text);
  padding:6px 10px;
  font-size:.95rem;
}
.rb-field-row input:focus,
.rb-field-row select:focus{
  outline:none;
  border-color:var(--rb-accent);
  box-shadow:0 0 0 1px rgba(56,189,248,0.4);
}

.rb-help{
  margin:4px 0 8px;
  font-size:.83rem;
  color:var(--rb-muted);
}

/* Mode / research fields */

.rb-mode-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:4px;
}

.rb-radio{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:.9rem;
  cursor:pointer;
}
.rb-radio input{
  accent-color:#4ade80;
}

.rb-research-fields{
  margin-top:8px;
  padding:10px;
  border-radius:12px;
  background:rgba(15,23,42,0.85);
  border:1px dashed #334155;
}

/* HUD */

.rb-hud-top{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:6px;
}
.rb-hud-group{
  flex:1 1 120px;
  min-width:110px;
  padding:6px 10px;
  background:rgba(15,23,42,0.92);
  border-radius:12px;
  border:1px solid #1f2937;
}
.rb-hud-label{
  font-size:.75rem;
  color:var(--rb-muted);
}
.rb-hud-value{
  margin-top:2px;
  font-weight:600;
  font-size:.98rem;
}

.rb-hud-mid{
  display:flex;
  gap:6px;
  margin-bottom:8px;
}
.rb-hit-box{
  flex:1 1 0;
  min-width:70px;
  padding:4px 8px;
  border-radius:10px;
  border:1px solid #1f2937;
  background:rgba(15,23,42,0.9);
  text-align:center;
  font-size:.8rem;
}
.rb-hit-box strong{
  display:block;
  margin-top:2px;
  font-size:1.05rem;
}
.rb-hit-box.miss{
  border-color:rgba(248,113,113,0.6);
}

/* Fever bar */

.rb-fever-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:6px;
}
.rb-fever-label{
  font-size:.8rem;
  color:var(--rb-muted);
}
.rb-fever-bar{
  flex:1 1 auto;
  height:10px;
  border-radius:999px;
  background:#020617;
  border:1px solid #1f2937;
  overflow:hidden;
}
.rb-fever-fill{
  height:100%;
  transform-origin:left center;
  transform:scaleX(0);
  background:linear-gradient(90deg,#22c55e,#facc15,#fb923c);
  transition:transform .15s linear;
}
.rb-fever-status{
  min-width:54px;
  text-align:center;
  font-size:.75rem;
  padding:3px 6px;
  border-radius:999px;
  border:1px solid #1f2937;
  background:rgba(15,23,42,0.9);
}
.rb-fever-status.on{
  border-color:#fb923c;
  color:#fed7aa;
  box-shadow:0 0 0 1px rgba(248,171,94,0.4);
}

/* Progress bar */

.rb-progress-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:8px;
}
.rb-progress-bar{
  flex:1;
  height:6px;
  border-radius:999px;
  background:#020617;
  border:1px solid #0f172a;
  overflow:hidden;
}
.rb-progress-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#38bdf8,#a855f7);
  transition:width .15s linear;
}
.rb-progress-text{
  font-size:.75rem;
  color:var(--rb-muted);
  min-width:34px;
  text-align:right;
}

/* Lanes */

.rb-lanes{
  position:relative;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
  width:100%;
  max-width:100%;
  height:260px;
  margin:4px 0 10px;
  padding:4px 4px 22px;
  border-radius:16px;
  background:radial-gradient(circle at top,rgba(15,23,42,0.95),#020617);
  border:1px solid #1f2937;
  overflow:hidden;
}

.rb-lane{
  position:relative;
  border-radius:12px;
  background:linear-gradient(to top,rgba(15,23,42,0.8),rgba(30,64,175,0.16));
  border:1px solid rgba(30,64,175,0.4);
  overflow:hidden;
  cursor:pointer;
}

.rb-lane::after{
  content:'';
  position:absolute;
  left:0;
  right:0;
  bottom:36px;
  height:2px;
  background:linear-gradient(90deg,rgba(148,163,184,0.2),rgba(248,250,252,0.8),rgba(148,163,184,0.2));
  pointer-events:none;
}

.rb-lane-label{
  position:absolute;
  left:4px;
  bottom:4px;
  font-size:.7rem;
  color:rgba(148,163,184,0.9);
  padding:1px 6px;
  border-radius:999px;
  background:rgba(15,23,42,0.8);
}

/* Notes */

.rb-note{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:100%;
  width:44px;
  height:44px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.5rem;
  background:radial-gradient(circle at 30% 20%,#fef9c3,#facc15,#b45309);
  box-shadow:0 0 0 1px rgba(15,23,42,0.9),0 10px 22px rgba(0,0,0,0.7);
  opacity:0;
  transition:opacity .14s ease-out;
}
.rb-note.rb-note-type-hit{
  /* base style already good */
}
.rb-note-spawned{
  opacity:1;
}
.rb-note-hit{
  animation:rb-note-hit .22s ease-out forwards;
}
.rb-note-miss{
  animation:rb-note-miss .22s ease-out forwards;
}

@keyframes rb-note-hit{
  0%{ transform:translate(-50%,0) scale(1); opacity:1; }
  100%{ transform:translate(-50%,-12px) scale(0.3); opacity:0; }
}
@keyframes rb-note-miss{
  0%{ transform:translate(-50%,0) scale(1); opacity:1; }
  100%{ transform:translate(-50%,12px) scale(0.3); opacity:0; }
}

/* Score popup */

.rb-score-popup{
  position:absolute;
  left:50%;
  bottom:80px;
  transform:translateX(-50%);
  font-size:.75rem;
  font-weight:600;
  padding:3px 8px;
  border-radius:999px;
  background:rgba(15,23,42,0.92);
  border:1px solid rgba(148,163,184,0.7);
  box-shadow:0 8px 20px rgba(0,0,0,0.6);
  animation:rb-score-pop .6s ease-out forwards;
}

.rb-score-perfect{
  border-color:#22c55e;
  color:#bbf7d0;
}
.rb-score-great{
  border-color:#38bdf8;
  color:#bae6fd;
}
.rb-score-good{
  border-color:#e5e7eb;
}
.rb-score-miss{
  border-color:#f97373;
  color:#fecaca;
}

@keyframes rb-score-pop{
  0%{ opacity:0; transform:translate(-50%,8px) scale(.85); }
  20%{ opacity:1; transform:translate(-50%,0) scale(1); }
  100%{ opacity:0; transform:translate(-50%,-10px) scale(.9); }
}

/* Feedback bubble */

.rb-feedback{
  position:absolute;
  left:50%;
  bottom:4px;
  transform:translateX(-50%);
  padding:4px 10px;
  border-radius:999px;
  background:rgba(15,23,42,0.94);
  border:1px solid rgba(148,163,184,0.5);
  font-size:.8rem;
  color:var(--rb-muted);
  pointer-events:none;
  max-width:90%;
  text-align:center;
}
.rb-feedback.good{
  border-color:#4ade80;
  color:#bbf7d0;
}
.rb-feedback.miss{
  border-color:#f97373;
  color:#fecaca;
}
.rb-feedback.warn{
  border-color:#facc15;
  color:#fef9c3;
}

/* Bottom bar */

.rb-bottom-bar{
  display:flex;
  justify-content:flex-end;
  margin-top:4px;
}

/* Result */

.rb-result-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:8px;
  margin-top:6px;
}
.rb-result-item{
  padding:6px 8px;
  border-radius:10px;
  border:1px solid #1f2937;
  background:rgba(15,23,42,0.9);
}
.rb-result-label{
  display:block;
  font-size:.78rem;
  color:var(--rb-muted);
}
.rb-result-value{
  display:block;
  margin-top:2px;
  font-size:.95rem;
  font-weight:500;
}

.rb-rank{
  font-weight:700;
  color:var(--rb-rank-sss);
}

.rb-quality-note{
  margin-top:8px;
  padding:6px 10px;
  font-size:.8rem;
  border-radius:10px;
  border:1px solid rgba(248,171,94,0.7);
  background:rgba(30,64,175,0.18);
}

.rb-result-actions{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

/* Overlay */

.rb-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.8);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:40;
}
.rb-overlay-box{
  background:#020617;
  border-radius:16px;
  padding:16px 18px 14px;
  border:1px solid #334155;
  max-width:320px;
  width:90%;
  text-align:center;
  box-shadow:0 18px 40px rgba(0,0,0,0.8);
}
.rb-overlay-message{
  font-size:.9rem;
  margin-bottom:10px;
}

/* Responsive */

@media (max-width:640px){
  #rb-wrap{
    padding:0 10px 24px;
  }
  .rb-lanes{
    height:230px;
  }
}
