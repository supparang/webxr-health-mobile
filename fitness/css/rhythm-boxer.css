:root{
  color-scheme: dark;
  --rb-bg: #020617;
  --rb-card: #020617;
  --rb-border: #1f2937;
  --rb-accent: #38bdf8;
  --rb-accent-soft: rgba(56,189,248,0.2);
  --rb-danger: #f97373;
  --rb-good: #4ade80;
  --rb-text: #e5e7eb;
  --rb-muted: #9ca3af;
}

*,
*::before,
*::after{
  box-sizing:border-box;
}

body{
  margin:0;
  min-height:100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:
    radial-gradient(circle at top left, rgba(56,189,248,.18), transparent 55%),
    radial-gradient(circle at bottom right, rgba(59,130,246,.18), transparent 55%),
    var(--rb-bg);
  color:var(--rb-text);
}

/* Wrapper */
#rb-wrap{
  max-width:1100px;
  margin:16px auto 32px;
  padding:0 16px 32px;
}

/* Header */
.rb-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:12px 4px 18px;
}

.rb-header h1{
  margin:0;
  font-size:1.5rem;
}

.rb-sub{
  margin:2px 0 0;
  color:var(--rb-muted);
  font-size:.9rem;
}

.rb-header-left,
.rb-header-right{
  min-width:120px;
}

.rb-header-center{
  text-align:center;
}

/* Button */
.rb-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:6px 14px;
  border-radius:999px;
  border:1px solid transparent;
  font-size:.9rem;
  cursor:pointer;
  text-decoration:none;
  transition:background .15s, border-color .15s, transform .05s;
  color:var(--rb-text);
}

.rb-btn-primary{
  background:linear-gradient(135deg,#38bdf8,#22c55e);
  border-color:#0ea5e9;
}

.rb-btn-primary:hover{
  filter:brightness(1.05);
  transform:translateY(-1px);
}

.rb-btn-secondary{
  background:#111827;
  border-color:#1f2937;
}

.rb-btn-secondary:hover{
  background:#111827;
  border-color:#38bdf8;
}

.rb-btn-ghost{
  background:transparent;
  border-color:#374151;
}

.rb-btn-ghost:hover{
  background:#020617;
  border-color:#38bdf8;
}

.rb-badge{
  display:inline-flex;
  padding:3px 10px;
  border-radius:12px;
  border:1px solid #22c55e;
  font-size:.75rem;
  color:#bbf7d0;
  background:rgba(21,128,61,.15);
}

/* Views + cards */
.rb-view{
  margin-top:8px;
}

.hidden{
  display:none !important;
}

.rb-card{
  border-radius:16px;
  border:1px solid var(--rb-border);
  background:
    radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent 60%),
    radial-gradient(circle at bottom right, rgba(59,130,246,0.12), transparent 60%),
    #020617ee;
  padding:18px 18px 20px;
}

.rb-card-menu{
  display:flex;
  flex-direction:column;
  gap:14px;
}

.rb-card-result{
  display:flex;
  flex-direction:column;
  gap:16px;
}

/* Form / menu */
.rb-radio-group{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-top:4px;
}

.rb-radio{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:.92rem;
  color:var(--rb-text);
}

.rb-radio input{
  accent-color:#22c55e;
}

.rb-field-row{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-top:8px;
  font-size:.9rem;
}

.rb-field-row label{
  color:var(--rb-muted);
}

.rb-field-row input,
.rb-field-row select{
  border-radius:10px;
  border:1px solid #1f2937;
  background:#020617;
  padding:6px 10px;
  color:var(--rb-text);
  font-size:.9rem;
}

.rb-field-row input:focus,
.rb-field-row select:focus{
  outline:none;
  border-color:#38bdf8;
}

.rb-research-fields{
  margin-top:8px;
  padding:10px;
  border-radius:14px;
  border:1px dashed #374151;
  background:#020617;
}

.rb-menu-actions{
  margin-top:12px;
  display:flex;
  justify-content:center;
}

/* HUD */
.rb-hud-top{
  display:flex;
  flex-wrap:wrap;
  gap:6px 16px;
  align-items:flex-start;
  justify-content:space-between;
  font-size:.85rem;
  margin-bottom:6px;
}

.rb-hud-group{
  display:flex;
  flex-wrap:wrap;
  gap:6px 10px;
}

.rb-hud-group span{
  padding:2px 8px;
  border-radius:999px;
  background:rgba(15,23,42,.9);
  border:1px solid #1f2937;
}

.rb-hud-group strong{
  color:#e5e7eb;
}

/* HP style */
.rb-hud-hp span{
  border-color:#22c55e;
}

/* Bars */
.rb-bars{
  margin:4px 0 8px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

.rb-bar{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:.82rem;
}

.rb-bar-label{
  min-width:60px;
  color:var(--rb-muted);
}

.rb-bar-track{
  flex:1;
  height:8px;
  border-radius:999px;
  background:#020617;
  border:1px solid #1f2937;
  overflow:hidden;
}

.rb-bar-fill{
  height:100%;
  transform-origin:left center;
  transform:scaleX(0);
  background:linear-gradient(90deg,#38bdf8,#22c55e);
  transition:transform .18s ease-out;
}

.rb-fever-status{
  min-width:50px;
  text-align:center;
  font-size:.78rem;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid #1f2937;
}

.rb-fever-status.on{
  border-color:#f97316;
  color:#fed7aa;
  box-shadow:0 0 12px rgba(249,115,22,.75);
}

.rb-progress-text{
  min-width:32px;
  text-align:right;
}

/* Play field */
#rb-field{
  position:relative;
  margin-top:8px;
  border-radius:18px;
  border:1px solid #111827;
  padding:8px 10px 12px;
  background:radial-gradient(circle at top,#0f172a,#020617 70%);
  overflow:hidden;
  height:310px;
}

/* 8-beat guide */
#rb-beat-guide{
  position:absolute;
  inset:16px 10px 40px 10px;
  display:flex;
  justify-content:space-between;
  pointer-events:none;
  opacity:.2;
}

#rb-beat-guide .bg-line{
  width:2px;
  border-radius:999px;
  background:linear-gradient(to bottom,#38bdf8,#22c55e);
}

/* Lanes */
#rb-lanes{
  position:absolute;
  inset:16px 10px 40px 10px;
  display:flex;
  gap:4px;
}

.rb-lane{
  flex:1;
  position:relative;
  border-radius:10px;
  background:linear-gradient(to bottom,rgba(15,23,42,.8),rgba(15,23,42,.95));
  border:1px solid rgba(31,41,55,.9);
  overflow:hidden;
}

/* Hit line */
#rb-hit-line{
  position:absolute;
  left:10px;
  right:10px;
  bottom:40px;
  height:0;
  border-top:2px dashed rgba(148,163,184,.8);
  box-shadow:0 0 10px rgba(148,163,184,.8);
}

/* Notes */
.rb-note{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:42px;
  height:42px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  filter:
    drop-shadow(0 0 8px rgba(56,189,248,.85))
    drop-shadow(0 0 16px rgba(59,130,246,.75));
  opacity:0;
  transition:opacity .12s linear, transform .12s linear;
}

.rb-note-spawned{
  opacity:1;
}

.rb-note-hit{
  transform:translateX(-50%) scale(1.2);
  opacity:0;
}

.rb-note-miss{
  opacity:0;
}

/* Difficulty scaling via data attribute */
#rb-wrap[data-diff="easy"] .rb-note{
  width:50px;height:50px;font-size:32px;
}
#rb-wrap[data-diff="normal"] .rb-note{
  width:44px;height:44px;font-size:30px;
}
#rb-wrap[data-diff="hard"] .rb-note{
  width:40px;height:40px;font-size:28px;
}

/* Score popup */
.rb-score-popup{
  position:absolute;
  left:50%;
  bottom:46px;
  transform:translateX(-50%);
  font-size:.75rem;
  padding:2px 8px;
  border-radius:999px;
  background:#020617;
  border:1px solid #1f2937;
  white-space:nowrap;
  opacity:0;
  animation:rbPopup .55s ease-out forwards;
}

.rb-score-perfect{
  border-color:#facc15;
  color:#fef9c3;
}
.rb-score-great{
  border-color:#22c55e;
  color:#bbf7d0;
}
.rb-score-good{
  border-color:#38bdf8;
  color:#bae6fd;
}
.rb-score-miss{
  border-color:#f97373;
  color:#fecaca;
}
.rb-score-bomb{
  border-color:#f97316;
  color:#fed7aa;
}
.rb-score-shield{
  border-color:#22c55e;
  color:#bbf7d0;
}

@keyframes rbPopup{
  0%{transform:translate(-50%,4px);opacity:0;}
  30%{transform:translate(-50%,-4px);opacity:1;}
  100%{transform:translate(-50%,-14px);opacity:0;}
}

/* Feedback */
.rb-feedback{
  position:absolute;
  left:50%;
  bottom:8px;
  transform:translateX(-50%);
  padding:4px 10px;
  border-radius:999px;
  background:rgba(15,23,42,.95);
  border:1px solid #1f2937;
  font-size:.8rem;
  white-space:nowrap;
  color:var(--rb-muted);
}

.rb-feedback.perfect{
  border-color:#facc15;
  color:#fef9c3;
}
.rb-feedback.good{
  border-color:#22c55e;
  color:#bbf7d0;
}
.rb-feedback.miss{
  border-color:#f97373;
  color:#fecaca;
}
.rb-feedback.bomb{
  border-color:#f97316;
  color:#fed7aa;
}

/* Camera shake */
.rb-shake{
  animation:rbShake .24s ease-in-out;
}

@keyframes rbShake{
  0%{transform:translateX(0);}
  20%{transform:translateX(-4px);}
  40%{transform:translateX(4px);}
  60%{transform:translateX(-3px);}
  80%{transform:translateX(3px);}
  100%{transform:translateX(0);}
}

/* Play actions */
.rb-play-actions{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
}

/* Result */
.rb-result-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:10px 14px;
  font-size:.85rem;
}

.rb-result-label{
  color:var(--rb-muted);
  margin-bottom:2px;
}

.rb-result-value{
  font-weight:500;
}

.rb-result-rank{
  font-size:1.4rem;
  font-weight:700;
  color:#facc15;
}

.rb-result-actions{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.rb-quality-note{
  margin-top:6px;
  font-size:.8rem;
  color:#fbbf24;
}

/* Flash (bomb) */
#rb-flash{
  position:fixed;
  inset:0;
  background:red;
  opacity:0;
  pointer-events:none;
  transition:opacity .18s ease-out;
  z-index:9999;
}
#rb-flash.active{
  opacity:.35;
}

/* Small screen */
@media (max-width:600px){
  #rb-field{
    height:270px;
  }
  .rb-hud-top{
    font-size:.8rem;
  }
}