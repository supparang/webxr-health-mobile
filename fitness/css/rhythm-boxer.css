/* === /fitness/css/rhythm-boxer.css ===
   Rhythm Boxer UI — Production
   ✅ 5-lane default (L2 L1 C R1 R2)
   ✅ Hit line is GOLD line near bottom (above lane label)
   ✅ Notes fall DOWN to hit line (engine positions to lane bottom)
*/

:root{
  --rb-bg0:#040610;
  --rb-bg1:#070a18;
  --rb-panel: rgba(10,14,32,.72);
  --rb-panel2: rgba(12,18,44,.55);
  --rb-stroke: rgba(148,163,184,.18);
  --rb-text:#e5e7eb;
  --rb-muted:#94a3b8;

  --rb-good:#22c55e;
  --rb-cyan:#22d3ee;
  --rb-violet:#a78bfa;
  --rb-amber:#f59e0b;
  --rb-red:#ef4444;
  --rb-pink:#ff4fd8;

  --rb-radius:22px;

  /* safe-area */
  --sat: env(safe-area-inset-top, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
  --sar: env(safe-area-inset-right, 0px);

  /* lane/hitline */
  --rb-lane-h: 420px;
  --rb-hitline-y: 86px; /* distance from lane bottom */
  --rb-lane-pad-top: 14px;
  --rb-lane-pad-bot: 22px;

  /* note */
  --rb-note-w: 120px;
  --rb-note-h: 44px;
  --rb-note-radius: 18px;
  --rb-note-glow: 0 10px 30px rgba(34,211,238,.18);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial;
  color: var(--rb-text);
  background:
    radial-gradient(1200px 800px at 30% 10%, rgba(167,139,250,.14), transparent 60%),
    radial-gradient(900px 700px at 70% 20%, rgba(34,211,238,.10), transparent 55%),
    radial-gradient(900px 700px at 50% 80%, rgba(255,79,216,.08), transparent 55%),
    linear-gradient(180deg, var(--rb-bg1), var(--rb-bg0));
}

a{ color:inherit; text-decoration:none; }
.hidden{ display:none !important; }

#rb-wrap{
  min-height:100vh;
  padding: calc(16px + var(--sat)) calc(16px + var(--sar)) calc(18px + var(--sab)) calc(16px + var(--sal));
  max-width: 980px;
  margin: 0 auto;
}

#rb-flash{
  position:fixed; inset:0;
  pointer-events:none;
  opacity:0;
  background: radial-gradient(800px 420px at 50% 70%, rgba(34,211,238,.22), transparent 65%);
  transition: opacity 180ms ease;
}

.rb-view{ width:100%; }

/* ----- header ----- */
.rb-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
  margin-bottom: 14px;
}
.rb-head-main{ max-width: 740px; }
.rb-pill{
  display:inline-flex;
  padding: 6px 10px;
  border-radius:999px;
  border: 1px solid var(--rb-stroke);
  background: rgba(2,6,23,.35);
  color: var(--rb-muted);
  font-size: 12px;
}
.rb-title{
  margin: 10px 0 4px;
  font-size: 44px;
  letter-spacing:-.6px;
}
.rb-sub{
  margin:0;
  color: var(--rb-muted);
  font-size: 15px;
  line-height: 1.5;
}
.rb-sub-small{
  display:inline-block;
  margin-top:8px;
  color: rgba(226,232,240,.85);
  font-size: 12px;
}
.rb-back{
  padding: 10px 12px;
  border: 1px solid var(--rb-stroke);
  border-radius: 14px;
  background: rgba(2,6,23,.30);
  color: rgba(226,232,240,.9);
  white-space:nowrap;
}

/* ----- sections/cards ----- */
.rb-section{ margin-top: 14px; }
.rb-section-title{
  margin: 0 0 10px;
  font-size: 18px;
}
.rb-section-subtitle{
  margin: -2px 0 12px;
  color: var(--rb-muted);
  font-size: 13px;
}
.rb-section-title-sm{
  margin: 0 0 8px;
  font-size: 16px;
}
.rb-grid-2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
@media (max-width: 860px){
  .rb-grid-2{ grid-template-columns: 1fr; }
  .rb-title{ font-size: 36px; }
}

.rb-research-box{
  border: 1px solid var(--rb-stroke);
  border-radius: 22px;
  background: linear-gradient(180deg, rgba(2,6,23,.72), rgba(10,14,32,.55));
  box-shadow: 0 18px 50px rgba(0,0,0,.35);
  padding: 14px;
}

.rb-mode-toggle{
  display:flex;
  gap: 10px;
  margin-bottom: 10px;
}
.rb-mode-btn{
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid var(--rb-stroke);
  background: rgba(2,6,23,.35);
  cursor:pointer;
  user-select:none;
}
.rb-mode-btn input{ accent-color: var(--rb-cyan); }

.rb-mode-desc{
  margin: 8px 0 0;
  color: var(--rb-muted);
  font-size: 13px;
  line-height: 1.45;
}

.rb-field{ margin-top: 10px; }
.rb-field label{
  display:block;
  font-size: 12px;
  color: rgba(226,232,240,.88);
  margin-bottom: 6px;
}
.rb-field input{
  width:100%;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.35);
  color: var(--rb-text);
  outline: none;
}
.rb-field input:focus{
  border-color: rgba(34,211,238,.55);
  box-shadow: 0 0 0 3px rgba(34,211,238,.10);
}

.rb-hint-block{
  margin-top: 12px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px dashed rgba(148,163,184,.25);
  background: rgba(2,6,23,.25);
}
.rb-hint-title{ margin:0 0 6px; font-size: 13px; color: rgba(226,232,240,.92); }
.rb-hint-list{ margin:0; padding-left: 18px; color: var(--rb-muted); font-size: 13px; }
.rb-hint-inline{ margin: 8px 0 0; color: var(--rb-muted); font-size: 13px; }
.rb-hint-inline .b{ color: rgba(226,232,240,.9); }
.rb-hint-inline{ line-height: 1.45; }
.rb-hint-inline{ display:block; }

.rb-btn-row{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
}
.rb-btn{
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.35);
  color: rgba(226,232,240,.92);
  padding: 10px 12px;
  border-radius: 16px;
  cursor:pointer;
}
.rb-btn:hover{ border-color: rgba(34,211,238,.45); }
.rb-btn-primary{
  background: linear-gradient(135deg, rgba(34,211,238,.20), rgba(167,139,250,.16));
  border-color: rgba(34,211,238,.35);
}
.rb-btn-ghost{
  background: rgba(2,6,23,.20);
}
.rb-btn-sm{ padding: 9px 10px; border-radius: 14px; }

/* ===== PLAY VIEW ===== */
.rb-play-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: 12px;
  margin-bottom: 10px;
}
.rb-title-sm{
  margin:0;
  font-size: 30px;
  letter-spacing:-.3px;
}
.rb-sub-sm{
  margin:4px 0 0;
  color: var(--rb-muted);
  font-size: 13px;
}

.rb-hud{ padding: 12px 12px 10px; }
.rb-hud-row{
  display:flex;
  flex-wrap:wrap;
  gap: 10px;
  margin-bottom: 10px;
}
.rb-chip{
  display:inline-flex;
  align-items:center;
  gap: 6px;
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.28);
  color: rgba(226,232,240,.92);
  font-size: 13px;
}
.rb-chip-ai{
  border-color: rgba(34,211,238,.24);
}
.rb-chip-tip{
  width: 100%;
  justify-content:flex-start;
  border-style:dashed;
}
.rb-chip-tip-label{ color: rgba(226,232,240,.86); margin-right: 6px; }

.rb-hud-judge-row .rb-chip{ border-color: rgba(148,163,184,.16); }

.rb-bars{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
@media (max-width: 640px){
  .rb-bars{ grid-template-columns: 1fr; }
}
.rb-bar-block{
  display:grid;
  grid-template-columns: 64px 1fr 56px;
  align-items:center;
  gap: 10px;
}
.rb-bar-label{ color: rgba(226,232,240,.86); font-size: 12px; letter-spacing:.8px; }
.rb-bar{
  height: 12px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.18);
  background: rgba(2,6,23,.20);
  overflow:hidden;
}
.rb-bar-fill{
  height:100%;
  width:0%;
  border-radius: 999px;
  transition: width 120ms linear;
}
.rb-bar-fever{
  background: linear-gradient(90deg, rgba(34,211,238,.9), rgba(255,79,216,.9));
}
.rb-bar-progress{
  background: linear-gradient(90deg, rgba(34,197,94,.9), rgba(34,211,238,.9));
}
.rb-bar-status{ color: rgba(226,232,240,.84); font-size: 12px; text-align:right; }

/* ===== Field / lanes ===== */
.rb-field-wrap{ margin-top: 14px; }
#rb-field{
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 26px;
  background: radial-gradient(900px 500px at 50% 0%, rgba(34,211,238,.10), transparent 55%),
              radial-gradient(800px 520px at 50% 80%, rgba(167,139,250,.10), transparent 60%),
              rgba(2,6,23,.25);
  padding: 14px;
  box-shadow: 0 18px 55px rgba(0,0,0,.35);
}

.rb-feedback{
  display:inline-flex;
  padding: 8px 12px;
  border-radius: 14px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.25);
  color: rgba(226,232,240,.92);
  margin-bottom: 12px;
  font-size: 13px;
}

.rb-lanes{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  align-items: stretch;
}

.rb-lane{
  position:relative;
  height: var(--rb-lane-h);
  border-radius: 22px;
  border: 1px solid rgba(148,163,184,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.06));
  overflow:hidden;
  touch-action: manipulation;
}

.rb-lane::before{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(340px 160px at 50% 0%, rgba(34,211,238,.10), transparent 60%),
    linear-gradient(180deg, rgba(2,6,23,.15), rgba(2,6,23,.0));
  pointer-events:none;
}

/* center guide (subtle) */
.rb-lane::after{
  content:"";
  position:absolute;
  left:50%;
  top: var(--rb-lane-pad-top);
  bottom: calc(var(--rb-lane-pad-bot) + 54px);
  width: 18%;
  transform: translateX(-50%);
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(148,163,184,.24), rgba(148,163,184,.05));
  opacity: .75;
  pointer-events:none;
}

/* HIT LINE (GOLD) — near bottom */
.rb-hitline{
  position:absolute;
  left: 10%;
  right: 10%;
  bottom: calc(var(--rb-hitline-y) - 6px);
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(245,158,11,.9), rgba(255,215,90,.95));
  box-shadow: 0 10px 26px rgba(245,158,11,.22);
  opacity: .92;
  pointer-events:none;
}

/* lane label (bottom) */
.rb-lane-label{
  position:absolute;
  left: 50%;
  bottom: 14px;
  transform: translateX(-50%);
  padding: 8px 12px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.40);
  font-size: 13px;
  color: rgba(226,232,240,.92);
}

/* Make hit line exist in each lane via pseudo element */
.rb-lane .rb-lane-label{ z-index: 5; }
.rb-lane .rb-hitline{ z-index: 4; }

.rb-lane{ --_hit: calc(var(--rb-hitline-y) - 6px); }
.rb-lane:has(.rb-lane-label)::marker{ content:""; } /* no-op */

/* inject hit line using :before? We'll use an extra element created by JS renderer if missing.
   Fallback: create it via CSS using ::after is already used for guide, so we keep .rb-hitline element in DOM.
*/

/* ===== Notes =====
   Engine sets transform: translate(-50%, ypx).
   We anchor the note at BOTTOM (so y=0 => bottom at hit line area).
*/
.rb-note{
  position:absolute;
  left: 50%;
  bottom: calc(var(--rb-hitline-y) + 6px); /* anchor near hit line */
  width: var(--rb-note-w);
  height: var(--rb-note-h);
  transform: translate(-50%, -999px);
  border-radius: var(--rb-note-radius);
  border: 1px solid rgba(34,211,238,.28);
  background: linear-gradient(135deg, rgba(34,211,238,.22), rgba(167,139,250,.16));
  box-shadow: var(--rb-note-glow);
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
  pointer-events:none; /* taps are on lane */
}

/* tail (visual) */
.rb-note::before{
  content:"";
  position:absolute;
  left:50%;
  transform: translateX(-50%);
  bottom: calc(var(--rb-note-h) - 6px);
  width: 18px;
  height: var(--rb-note-len, 160px);
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(34,211,238,.55), rgba(255,79,216,.18));
  opacity:.75;
  filter: blur(.0px);
}

.rb-note-ico{
  font-size: 22px;
  line-height: 1;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));
}

/* feedback pulses */
.rb-lane.rb-pulse-perfect{ outline: 2px solid rgba(34,197,94,.50); }
.rb-lane.rb-pulse-great{   outline: 2px solid rgba(34,211,238,.55); }
.rb-lane.rb-pulse-good{    outline: 2px solid rgba(167,139,250,.55); }
.rb-lane.rb-pulse-miss{    outline: 2px solid rgba(239,68,68,.55); }

.rb-howto-inline{
  margin: 10px 4px 0;
  color: var(--rb-muted);
  font-size: 13px;
  line-height: 1.5;
}

/* ===== Result view ===== */
.rb-result-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
@media (max-width: 860px){
  .rb-result-grid{ grid-template-columns: 1fr; }
}
.rb-result-card{
  border: 1px solid rgba(148,163,184,.18);
  border-radius: 22px;
  background: rgba(2,6,23,.35);
  padding: 14px;
}
.rb-result-title{ margin:0 0 10px; font-size: 16px; }
.rb-result-row{
  display:flex;
  justify-content:space-between;
  gap: 12px;
  padding: 7px 0;
  border-bottom: 1px dashed rgba(148,163,184,.14);
  color: rgba(226,232,240,.92);
}
.rb-result-row:last-child{ border-bottom:none; }
.rb-result-row span{ color: var(--rb-muted); }
.rb-quality-note{
  margin-top: 12px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px dashed rgba(239,68,68,.30);
  background: rgba(239,68,68,.10);
  color: rgba(226,232,240,.92);
}