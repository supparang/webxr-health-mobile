:root{
  color-scheme: dark;
  --rb-bg: #020617;
  --rb-panel: #020617cc;
  --rb-border: rgba(148,163,184,0.4);
  --rb-accent: #22c55e;
  --rb-accent2:#38bdf8;
  --rb-text: #e5e7eb;
  --rb-muted:#94a3b8;
  --rb-danger:#fb7185;
}

/* ===== GLOBAL ===== */
*,
*::before,
*::after{
  box-sizing:border-box;
}

html,body{
  margin:0;
  padding:0;
  height:100%;
}

body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:
    radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 60%),
    radial-gradient(circle at bottom right, rgba(34,197,94,0.16), transparent 60%),
    var(--rb-bg);
  color: var(--rb-text);
}

.hidden{ display:none !important; }

/* ===== WRAP / VIEW ===== */
#rb-wrap{
  min-height:100vh;
  max-width:980px;
  margin:0 auto;
  padding:12px 10px 24px;
}

.rb-view{
  background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.92));
  border-radius:22px;
  border:1px solid rgba(148,163,184,0.45);
  box-shadow:
    0 20px 45px rgba(15,23,42,0.85),
    0 0 0 1px rgba(15,23,42,0.9);
  padding:16px 16px 18px;
}

/* ===== HEADER ===== */
.rb-header{
  margin-bottom:10px;
}
.rb-title-main{
  margin:0;
  font-size: clamp(22px,4.4vw,30px);
  font-weight:700;
  letter-spacing:.03em;
}
.rb-title-sub{
  margin:4px 0 0;
  color: var(--rb-muted);
  font-size:13px;
}

/* ===== CARD / MENU ===== */
.rb-card{
  margin-top:10px;
  padding:14px 14px 16px;
  border-radius:18px;
  background:
    radial-gradient(circle at top left, rgba(59,130,246,0.2), transparent 55%),
    rgba(15,23,42,0.96);
  border:1px solid rgba(51,65,85,0.9);
}
.rb-card-menu{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* fields */
.rb-field-group{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.rb-field-label{
  font-size:13px;
  font-weight:600;
  color:var(--rb-muted);
}
.rb-field-row{
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:13px;
}
.rb-field-row label{
  display:flex;
  flex-direction:column;
  gap:2px;
}

/* inputs */
input[type="text"],
select{
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.6);
  background:#020617;
  padding:6px 10px;
  color:var(--rb-text);
  font-size:13px;
  outline:none;
}
input[type="text"]:focus,
select:focus{
  border-color: var(--rb-accent2);
  box-shadow:0 0 0 1px rgba(56,189,248,0.9);
}

/* radio */
.rb-radio{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:14px;
  margin-right:14px;
}
.rb-radio input{
  accent-color: var(--rb-accent2);
}

/* ===== BUTTONS ===== */
.rb-btn{
  border-radius:999px;
  border:1px solid transparent;
  padding:7px 16px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  background:#0f172a;
  color:var(--rb-text);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  text-decoration:none;
}
.rb-btn-primary{
  background:linear-gradient(90deg,#22c55e,#22c55e,#06b6d4);
  color:#022c22;
  border-color: rgba(34,197,94,0.9);
}
.rb-btn-primary:hover{
  filter:brightness(1.08);
}
.rb-btn-secondary{
  border-color: rgba(148,163,184,0.7);
  background:#020617;
}
.rb-btn-ghost{
  border-color:rgba(148,163,184,0.5);
  background:transparent;
}
.rb-btn:active{
  transform:translateY(1px);
}

.rb-menu-actions{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.rb-hint{
  margin:4px 2px 0;
  font-size:12px;
  color:var(--rb-muted);
}

/* ===== HUD ===== */
.rb-hud{
  display:flex;
  justify-content:space-between;
  gap:10px;
  font-size:13px;
  margin-bottom:6px;
}
.rb-hud-col{
  display:flex;
  flex-direction:column;
  gap:2px;
}

/* ===== PROGRESS BAR ===== */
.rb-progress-wrap{
  margin:4px auto 6px;
  max-width:560px;
  display:flex;
  align-items:center;
  gap:8px;
}
.rb-progress-bar{
  position:relative;
  flex:1;
  height:13px;
  border-radius:999px;
  background:rgba(15,23,42,0.96);
  box-shadow:
    inset 0 0 0 1px rgba(30,64,175,0.6),
    0 0 25px rgba(56,189,248,0.35);
  overflow:hidden;
}
.rb-progress-fill{
  position:absolute;
  inset:0;
  transform-origin:left center;
  transform:scaleX(0);
  background:linear-gradient(90deg,#22c55e,#22c55e,#06b6d4,#38bdf8);
  transition:transform 0.18s ease-out;
}
.rb-progress-text{
  min-width:40px;
  font-size:13px;
  text-align:right;
  color:#e5e7eb;
}

/* ===== LANES & NOTES ===== */
.rb-lanes{
  position:relative;
  max-width:560px;
  margin:10px auto 4px;
  padding:4px 4px 10px;
  display:flex;
  gap:6px;
}
.rb-lane{
  flex:1 1 0;
  min-width:0;
  height:260px;
  border-radius:30px;
  background:radial-gradient(circle at top,rgba(15,23,42,0.6),rgba(15,23,42,0.98));
  border:1px solid rgba(30,64,175,0.75);
  box-shadow:
    inset 0 0 0 1px rgba(15,23,42,0.9),
    0 15px 25px rgba(15,23,42,0.9);
  overflow:hidden;
  position:relative;
}

/* note (emoji) */
.rb-note{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:64px;
  height:64px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  filter:drop-shadow(0 6px 8px rgba(15,23,42,0.9));
  opacity:0;
  bottom:100%;
  transition:transform 0.08s linear;
}
.rb-note.rb-note-type-hit{
  color:#a855f7;
}
.rb-note-spawned{
  opacity:1;
}

/* score popup */
.rb-score-popup{
  position:absolute;
  left:50%;
  bottom:64px;
  transform:translateX(-50%);
  padding:3px 9px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
  border:1px solid transparent;
  background:rgba(15,23,42,0.95);
}
.rb-score-perfect{
  border-color:#22c55e;
  color:#bbf7d0;
}
.rb-score-great{
  border-color:#38bdf8;
  color:#bae6fd;
}
.rb-score-good{
  border-color:#a855f7;
  color:#e9d5ff;
}
.rb-score-miss{
  border-color:#fb7185;
  color:#fecaca;
}

/* ===== FEVER BAR ===== */
.rb-fever-wrap{
  max-width:560px;
  margin:10px auto 4px;
  padding:4px 10px 0;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:12px;
  color:#cbd5f5;
}
.rb-fever-label{
  font-weight:500;
  opacity:0.9;
}
.rb-fever-bar{
  position:relative;
  flex:1;
  height:10px;
  border-radius:999px;
  background:rgba(15,23,42,0.96);
  box-shadow:
    inset 0 0 0 1px rgba(148,163,184,0.35),
    0 0 16px rgba(34,197,94,0.4);
  overflow:hidden;
}
.rb-fever-fill{
  position:absolute;
  inset:0;
  transform-origin:left center;
  transform:scaleX(0);
  background:linear-gradient(90deg,#22c55e,#22c55e,#06b6d4,#38bdf8,#a855f7);
  transition:transform 0.18s ease-out;
}
#rb-fever-status{
  min-width:60px;
  text-align:right;
  font-weight:600;
  font-size:11px;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#e5e7eb;
}

/* เมื่อ Fever ON: ใช้ class ใส่ที่ #rb-wrap จาก JS */
#rb-wrap.rb-fever-on .rb-fever-fill{
  animation:rb-fever-bar-pulse .85s ease-in-out infinite alternate;
}
#rb-wrap.rb-fever-on #rb-fever-status{
  color:#fb923c;
}

/* glow รอบ lanes เฉพาะตอน FEVER (ไม่เต็มจอ) */
#rb-wrap.rb-fever-on .rb-lanes::before{
  content:'';
  position:absolute;
  inset:6px 3%;
  border-radius:40px;
  background:radial-gradient(circle at center,rgba(56,189,248,0.45),transparent 60%);
  opacity:.9;
  pointer-events:none;
  mix-blend-mode:screen;
  filter:blur(10px);
  animation:rb-fever-glow 1.4s ease-in-out infinite alternate;
}

/* ปิด overlay แบบเต็มจอเก่าที่เคยใช้ pseudo-element */
#rb-wrap.rb-fever-on::before,
#rb-wrap.rb-fever-on::after{
  content:none !important;
}

/* ===== FEEDBACK & CONTROLS ===== */
.rb-feedback{
  margin:6px auto 10px;
  max-width:560px;
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  text-align:center;
  background:rgba(15,23,42,0.95);
  border:1px solid rgba(148,163,184,0.5);
  color:#e5e7eb;
}
.rb-feedback.good{
  border-color:#22c55e;
  color:#bbf7d0;
}
.rb-feedback.miss{
  border-color:#fb7185;
  color:#fecaca;
}
.rb-feedback.warn{
  border-color:#facc15;
  color:#fef9c3;
}

.rb-play-actions{
  display:flex;
  justify-content:center;
  margin-top:4px;
}

/* ===== AUDIO HELPER ===== */
.rb-audio-helper{
  margin:10px auto 0;
  max-width:560px;
  padding:8px 12px 10px;
  border-radius:16px;
  border:1px dashed rgba(148,163,184,0.6);
  background:rgba(15,23,42,0.96);
  font-size:13px;
  text-align:center;
}

/* ===== RESULT VIEW ===== */
.rb-card-result{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.rb-result-row{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  padding:3px 0;
}
.rb-result-row span{
  color:var(--rb-muted);
}
.rb-result-row strong{
  font-weight:600;
}
.rb-result-actions{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.rb-quality-note{
  margin-top:8px;
  font-size:12px;
  color:#fde68a;
}

/* ===== ANIMATIONS ===== */
@keyframes rb-fever-bar-pulse{
  from{ filter:brightness(1); }
  to{ filter:brightness(1.35); }
}
@keyframes rb-fever-glow{
  from{ opacity:.6; }
  to{ opacity:1; }
}

/* ===== RESPONSIVE ===== */
@media (max-width:700px){
  #rb-wrap{
    padding:10px 6px 18px;
  }
  .rb-view{
    padding:12px 10px 14px;
  }
  .rb-lane{
    height:230px;
  }
}
@media (max-width:480px){
  .rb-lane{
    height:210px;
  }
  .rb-note{
    width:56px;
    height:56px;
    font-size:36px;
  }
}