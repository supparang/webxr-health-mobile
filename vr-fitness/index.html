<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>VR Fitness ‚Äî Hub</title>
  <meta name="color-scheme" content="dark light"/>
  <style>
    :root{--bg:#0f1220;--fg:#e9ecf1;--muted:#a9afc1;--card:#171a2b;--accent:#76e1ff}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:#000;color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Inter,Arial}
    .topbar{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid #22263a;position:sticky;top:0;background:linear-gradient(180deg,#0f1220 0%,#0f1220ee 100%);z-index:5}
    .brand{margin:0;font-size:20px;letter-spacing:.3px}
    .hub{padding:20px;background:var(--bg)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #22263a;border-radius:16px;padding:16px;box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .card h2{margin:0 0 6px 0;font-size:18px}
    .desc{margin:0 0 10px 0;color:var(--muted)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:8px 0}
    .row label{color:var(--muted)}
    select,input[type=number]{width:130px;background:#0f1220;color:var(--fg);border:1px solid #2a2f4a;border-radius:10px;padding:8px}
    .btn{background:var(--accent);color:#001018;border:0;padding:12px 16px;border-radius:999px;font-weight:700;cursor:pointer}
    .fallback{margin-top:8px;font-size:13px;color:#ddd}
    .links a{color:#bde3ff}
  </style>
</head>
<body>
  <header class="topbar">
    <h1 class="brand">VR Fitness ‚Äî Hub</h1>
  </header>

  <main id="hub" class="hub">
    <section class="grid">

      <article class="card">
        <h2>ü•ä Shadow Breaker</h2>
        <p class="desc">‡∏ä‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‚Äî‡∏ü‡∏¥‡∏ï‡πÅ‡∏£‡∏á ‡πÅ‡∏Ç‡πà‡∏á‡πÄ‡∏ß‡∏•‡∏≤</p>
        <div class="row"><label>Difficulty</label>
          <select data-name="diff-sb"><option>easy</option><option selected>normal</option><option>hard</option><option>final</option></select>
        </div>
        <div class="row"><label>Time (sec)</label><input data-name="time-sb" type="number" min="30" max="180" step="5" value="90"/></div>
        <div class="row">
          <button class="btn" data-action="play" data-game="shadow-breaker">Play</button>
          <span class="fallback links"><a data-action="direct" data-game="shadow-breaker" href="#">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á</a></span>
        </div>
      </article>

      <article class="card">
        <h2>üéµ Rhythm Boxer</h2>
        <p class="desc">‡∏ï‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‚Äî‡πÅ‡∏°‡πà‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö</p>
        <div class="row"><label>Difficulty</label>
          <select data-name="diff-rb"><option>easy</option><option selected>normal</option><option>hard</option></select>
        </div>
        <div class="row"><label>Time (sec)</label><input data-name="time-rb" type="number" min="45" max="180" step="5" value="85"/></div>
        <div class="row">
          <button class="btn" data-action="play" data-game="rhythm-boxer">Play</button>
          <span class="fallback links"><a data-action="direct" data-game="rhythm-boxer" href="#">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á</a></span>
        </div>
      </article>

      <article class="card">
        <h2>üèÉ Jump‚ÄìDuck</h2>
        <p class="desc">‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‚Äì‡∏Å‡πâ‡∏° ‡∏´‡∏•‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á (low-impact)</p>
        <div class="row"><label>Difficulty</label>
          <select data-name="diff-jd"><option selected>easy</option><option>normal</option><option>hard</option></select>
        </div>
        <div class="row"><label>Time (sec)</label><input data-name="time-jd" type="number" min="45" max="180" step="5" value="80"/></div>
        <div class="row">
          <button class="btn" data-action="play" data-game="jump-duck">Play</button>
          <span class="fallback links"><a data-action="direct" data-game="jump-duck" href="#">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á</a></span>
        </div>
      </article>

      <article class="card">
        <h2>üßò Balance‚ÄìHold</h2>
        <p class="desc">‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß ‡∏ô‡∏¥‡πà‡∏á ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏Å‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
        <div class="row"><label>Difficulty</label>
          <select data-name="diff-bh"><option>easy</option><option selected>normal</option><option>hard</option></select>
        </div>
        <div class="row"><label>Time (sec)</label><input data-name="time-bh" type="number" min="30" max="180" step="5" value="75"/></div>
        <div class="row">
          <button class="btn" data-action="play" data-game="balance-hold">Play</button>
          <span class="fallback links"><a data-action="direct" data-game="balance-hold" href="#">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á</a></span>
        </div>
      </article>

    </section>
  </main>

  <script>
    // HeroHealth-style: launcher -> redirect (no iframe)
    const qs = (k,d=null)=>{ try{return new URL(location.href).searchParams.get(k) ?? d;}catch{return d;} };
    const clamp=(n,a,b)=>{ n=+n; if(Number.isNaN(n)) return a; return Math.max(a,Math.min(b,n)); };

    const CANDIDATES = (g)=>[
      `/webxr-health-mobile/vr-fitness/${g}/play.html`,
      `/webxr-health-mobile/vr-fitness/games/${g}/play.html`,
      `/vr-fitness/${g}/play.html`,
      `/vr-fitness/games/${g}/play.html`
    ];

    function defaults(g){
      if(g==="shadow-breaker") return {min:30, time:90, diff:"normal"};
      if(g==="rhythm-boxer")   return {min:45, time:85, diff:"normal"};
      if(g==="jump-duck")      return {min:45, time:80, diff:"easy"};
      if(g==="balance-hold")   return {min:30, time:75, diff:"normal"};
      return {min:30, time:90, diff:"normal"};
    }

    function v(sel){ return (document.querySelector(sel)||{}).value || ""; }
    function vn(sel){ return +(document.querySelector(sel)||{}).value || 0; }

    function getControls(g){
      const d = defaults(g);
      if(g==="shadow-breaker") return { diff: v('[data-name="diff-sb"]')||d.diff, time: clamp(vn('[data-name="time-sb"]'),30,180) };
      if(g==="rhythm-boxer")   return { diff: v('[data-name="diff-rb"]')||d.diff, time: clamp(vn('[data-name="time-rb"]'),45,180) };
      if(g==="jump-duck")      return { diff: v('[data-name="diff-jd"]')||d.diff, time: clamp(vn('[data-name="time-jd"]'),45,180) };
      if(g==="balance-hold")   return { diff: v('[data-name="diff-bh"]')||d.diff, time: clamp(vn('[data-name="time-bh"]'),30,180) };
      return {diff:d.diff, time:d.time};
    }

    function buildParams(game){
      const d = defaults(game);
      const c = getControls(game);

      // Pass-through like HeroHealth (don't override if already in URL where relevant)
      const params = new URLSearchParams();
      params.set("game", game);
      params.set("run", qs("run","play"));          // default play
      params.set("mode", qs("mode","timed"));
      params.set("diff", (c.diff||d.diff));
      params.set("time", String(c.time||d.time));

      // research / hub / logging passthrough
      const passthru = ["hub","view","seed","studyId","phase","conditionGroup","ts","log","style"];
      for(const k of passthru){
        const val = qs(k, "");
        if(val) params.set(k, val);
      }

      // ensure hub back-link exists
      if(!params.get("hub")){
        params.set("hub", location.href.split("#")[0]);
      }

      // seed default (only if absent) ‚Äî helpful for reproducibility
      if(!params.get("seed")){
        params.set("seed", String(Date.now()));
      }
      return params.toString();
    }

    async function resolveBase(game){
      // Prefer GET (GitHub Pages sometimes rejects HEAD)
      for(const base of CANDIDATES(game)){
        try{
          const r = await fetch(base + "?v=live", {method:"GET", cache:"no-store"});
          if(r.ok) return base;
        }catch(e){}
      }
      // fallback to first candidate (might still work)
      return CANDIDATES(game)[0];
    }

    document.addEventListener("click", async (ev)=>{
      const el = ev.target.closest("[data-action]");
      if(!el) return;

      const game = el.dataset.game;
      if(!game) return;

      const base = await resolveBase(game);
      const url  = `${base}?${buildParams(game)}`;

      if(el.dataset.action==="direct"){
        ev.preventDefault();
        location.href = url;   // direct open same as Play
        return;
      }
      if(el.dataset.action==="play"){
        location.href = url;   // HeroHealth-style redirect
        return;
      }
    });
  </script>
</body>
</html>