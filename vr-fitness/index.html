<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VR Fitness Academy ¬∑ Hub</title>

  <!-- Inline Sport Tech theme (‡∏•‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 404) -->
  <style>
    :root{
      --bg:#0b1119; --ink:#e6f1ff; --mut:#8aa2b2; --line:#1a2532; --card:#0e1622; --accent:#00d0ff; --accent2:#00ffa3;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial}
    .header,.footer{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid var(--line);background:#0c131d}
    .footer{border-top:1px solid var(--line);border-bottom:none;justify-content:center;gap:10px;color:var(--mut)}
    .brand{font-weight:800;letter-spacing:.3px}
    .toolbar{display:flex;gap:8px;align-items:center}
    .btn,.select{background:#0e1622;border:1px solid var(--line);border-radius:10px;color:var(--ink);padding:8px 10px;cursor:pointer}
    .select{appearance:none}
    .btn:hover{background:#13202d}
    .small{color:var(--mut);font-size:12px}
    .container{max-width:1100px;margin:0 auto;padding:12px}
    h1{margin:14px 0 6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{height:120px;background:linear-gradient(135deg,#0d1b2a,#0f2435);display:flex;align-items:center;justify-content:center;font-weight:700;color:#96d0ff}
    .meta{padding:10px;display:flex;flex-direction:column;gap:6px}
    .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .pill{background:rgba(255,255,255,.06);border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:12px;color:#b9d1e6}
    .mut{color:var(--mut)}
    .kbd{display:inline-block;background:#0e1622;border:1px solid var(--line);border-radius:6px;padding:1px 6px}
    a.card-link{color:inherit;text-decoration:none}
    .soon{opacity:.65}
    /* Recent results */
    #lbCard > .row{border-bottom:1px dashed var(--line);padding:6px 0}
    #lbCard > .row:last-child{border-bottom:none}
    @media (hover:hover){ .card:hover{transform:translateY(-1px);transition:transform .12s ease;} }
  </style>
</head>
<body>
  <header class="header">
    <div class="brand">VR Fitness Academy</div>
    <div class="toolbar">
      <label class="small" for="langSel" data-i18n="language">Language</label>
      <select id="langSel" class="select">
        <option value="en">English</option>
        <option value="th">‡πÑ‡∏ó‡∏¢</option>
      </select>
      <button class="btn" id="muteBtn" title="Mute/Unmute">üîä</button>
    </div>
  </header>

  <main class="container">
    <h1 data-i18n="hub_title">Choose your workout</h1>
    <div class="small" data-i18n="hub_sub">Mini-games ¬∑ scoring ¬∑ BGM ¬∑ results</div>

    <div class="grid" id="gameGrid" aria-live="polite"></div>
  </main>

  <!-- Recent Results -->
  <section class="container" id="lbSection">
    <h2 style="margin:10px 0 10px">Recent Results</h2>
    <div class="card" id="lbCard"><div class="small" style="padding:10px">No scores yet</div></div>
  </section>

  <footer class="footer">
    <span>Sport Tech UI ¬∑ <span class="kbd">ESC</span> to exit VR</span>
  </footer>

  <!-- Core helpers (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏° ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) -->
  <script src="core/i18n.js"></script>
  <script src="core/audio.js"></script>
  <script src="core/engine.js"></script>
  <script src="core/ui.js"></script>
  <script src="core/leaderboard.js"></script>

  <script>
  // --- Config: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏°‡∏ö‡∏ô Hub ---
  const GAMES = [
    {
      id: 'shadow-breaker',
      title: 'Shadow Breaker',
      sub: 'Boss phases ¬∑ slash/parry ¬∑ leaderboard',
      path: 'games/shadow-breaker/index.html',
      tags: ['Combat','HIIT','Boss'],
      thumb: 'SB'
    },
    {
      id: 'rhythm-punch',
      title: 'Rhythm Punch',
      sub: 'Beat timing ¬∑ jab/cross ¬∑ streak',
      path: null, // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‚Üí Coming Soon
      tags: ['Rhythm','Arms'],
      thumb: 'RP',
      soon: true
    },
    {
      id: 'target-sprint',
      title: 'Target Sprint',
      sub: 'Aim + move ¬∑ accuracy gates',
      path: null,
      tags: ['Cardio','Accuracy'],
      thumb: 'TS',
      soon: true
    },
    {
      id: 'calorie-dodge',
      title: 'Calorie Dodge',
      sub: 'Dodge lanes ¬∑ burn meter',
      path: null,
      tags: ['Dodge','Core'],
      thumb: 'CD',
      soon: true
    }
  ];

  // --- ‡πÅ‡∏õ‡∏•‡∏™‡∏≠‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏•‡πá‡∏Å ‡πÜ ---
  const I18N = {
    en: { language:'Language', hub_title:'Choose your workout', hub_sub:'Mini-games ¬∑ scoring ¬∑ BGM ¬∑ results', coming:'Coming soon' },
    th: { language:'‡∏†‡∏≤‡∏©‡∏≤', hub_title:'‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', hub_sub:'‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ¬∑ ‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ¬∑ ‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ¬∑ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•', coming:'‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ' }
  };

  // ‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏≤‡∏Å ?lang= ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å select
  function getLang(){
    const q = new URLSearchParams(location.search);
    return q.get('lang') || localStorage.getItem('hub_lang') || 'en';
  }
  function applyI18n(lang){
    const dict = I18N[lang] || I18N.en;
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n');
      if (dict[k]) el.textContent = dict[k];
    });
  }

  // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á Grid ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏° ---
  function renderGrid(){
    const grid = document.getElementById('gameGrid');
    const lang = getLang();
    const comingLabel = (I18N[lang]||I18N.en).coming;
    grid.innerHTML = GAMES.map(g=>{
      const tags = (g.tags||[]).map(t=>`<span class="pill">${t}</span>`).join(' ');
      const soon = g.soon || !g.path;
      const cardInner = `
        <div class="thumb">${g.thumb||''}</div>
        <div class="meta">
          <div class="row"><b>${g.title}</b>${soon? `<span class="pill soon">${comingLabel}</span>`:''}</div>
          <div class="small mut">${g.sub||''}</div>
          <div class="row"><div class="mut small">#${g.id}</div><div>${tags}</div></div>
        </div>`;
      if (soon){
        return `<div class="card soon" role="button" aria-disabled="true" tabindex="-1" title="${comingLabel}">${cardInner}</div>`;
      } else {
        return `<a class="card card-link" href="${g.path}" role="link" aria-label="${g.title}">${cardInner}</a>`;
      }
    }).join('');
  }

  // --- Recent Results ‡∏à‡∏≤‡∏Å Leaderboard (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ---
  function renderRecent(){
    const card = document.getElementById('lbCard');
    try{
      if (!window.Leaderboard || !Leaderboard.recent) throw 0;
      const list = Leaderboard.recent(8);
      if (!list || list.length===0){ card.innerHTML = '<div class="small" style="padding:10px">No scores yet</div>'; return; }
      card.innerHTML = list.map(e=>{
        const when = new Date(e.ts).toLocaleString();
        const game = e.gameId || 'unknown';
        const acc  = (e.accuracy!=null ? (e.accuracy + '%') : '-');
        return `<div class="row"><div><b>${game}</b> ¬∑ ${when}</div><div>Score <b>${e.score||0}</b> ¬∑ MaxCombo <b>${e.maxCombo||0}</b> ¬∑ Acc ${acc}</div></div>`;
      }).join('');
    }catch(e){
      card.innerHTML = '<div class="small" style="padding:10px">No scores yet</div>';
    }
  }

  // --- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á / ‡∏õ‡∏∏‡πà‡∏° mute ---
  function tryAudioInit(){
    if (!window.AudioBus) return;
    // default unmuted; click = toggle
    const btn = document.getElementById('muteBtn');
    btn.addEventListener('click', ()=>{
      const muted = AudioBus.toggleMute ? AudioBus.toggleMute() : AudioBus.mute(true);
      btn.textContent = (muted ? 'üîá' : 'üîä');
    });
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ state mute ‡πÉ‡∏ô localStorage ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á
    try{
      const muted = localStorage.getItem('audio_muted') === '1';
      if (muted && AudioBus.mute) AudioBus.mute(true);
      btn.textContent = (muted ? 'üîá' : 'üîä');
    }catch(e){}
  }

  // --- Main ---
  document.addEventListener('DOMContentLoaded', ()=>{
    // I18N
    const lang = getLang();
    const sel = document.getElementById('langSel');
    sel.value = lang;
    sel.addEventListener('change', ()=>{
      localStorage.setItem('hub_lang', sel.value);
      applyI18n(sel.value);
      renderGrid();
    });
    applyI18n(lang);

    // Render games & recent
    renderGrid();
    renderRecent();

    // Audio button
    tryAudioInit();
  });
  </script>
</body>
</html>
