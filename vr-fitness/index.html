<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VR Fitness Academy Â· Sport Tech</title>
  <link rel="stylesheet" href="core/themes/sport-tech.css"/>
</head>
<body>
  <header class="header">
    <div class="brand">VR Fitness Academy</div>
    <div class="toolbar">
      <label class="small" for="langSel" data-i18n="language">Language</label>
      <select id="langSel" class="btn">
        <option value="en">English</option>
        <option value="th">à¹„à¸—à¸¢</option>
      </select>
      <button class="btn" id="muteBtn">ðŸ”Š</button>
    </div>
  </header>

  <main class="container">
    <h1 style="margin:12px 0 6px" data-i18n="hub_title">Choose your workout</h1>
    <div class="small" data-i18n="hub_sub">4 mini-games â€¢ scoring â€¢ BGM â€¢ results</div>
    <div class="grid" id="gameGrid" aria-live="polite"></div>
  </main>

  <!-- Recent Results (central leaderboard preview) -->
  <section class="container" id="lbSection">
    <h2 style="margin:4px 0 10px">Recent Results</h2>
    <div class="card" id="lbCard"><div class="small">No scores yet</div></div>
  </section>

  <footer class="footer">
    <span>Sport Tech UI Â· <span class="kbd">ESC</span> to exit VR</span>
  </footer>

  <!-- Core scripts -->
  <script src="core/i18n.js"></script>
  <script src="core/audio.js"></script>
  <script src="core/engine.js"></script>
  <script src="core/ui.js"></script>
  <script src="core/leaderboard.js"></script>

  <!-- Fallback: à¸–à¹‰à¸² config.json à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¹ƒà¸«à¹‰à¹€à¸£à¸™à¹€à¸”à¸­à¸£à¹Œà¸à¸²à¸£à¹Œà¸”à¹€à¸à¸¡à¸ˆà¸²à¸ DEFAULT_CFG à¸—à¸µà¹ˆà¸à¸±à¸‡à¹„à¸§à¹‰ -->
  <script>
    const DEFAULT_CFG = {
      projectName: "VR Fitness Academy",
      theme: "sport-tech",
      languages: ["en","th"],
      defaultLang: "en",
      games: [
        {id:"shadow-breaker", name:{en:"Shadow Breaker", th:"à¸Šà¸²à¹‚à¸”à¸§à¹Œà¹€à¸šà¸£à¸à¹€à¸à¸­à¸£à¹Œ"}, desc:{en:"Slash or punch targets in time.", th:"à¸Ÿà¸²à¸”/à¸Šà¸à¹€à¸›à¹‰à¸²à¸•à¸²à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸°"}},
        {id:"rhythm-boxer",  name:{en:"Rhythm Boxer",    th:"à¸£à¸´à¸—à¸¶à¸¡à¸šà¹‡à¸­à¸à¹€à¸‹à¸­à¸£à¹Œ"}, desc:{en:"Box to the beat and rack up combos.", th:"à¸Šà¸à¸•à¸²à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸° à¹€à¸à¹‡à¸šà¸„à¸­à¸¡à¹‚à¸š"}},
        {id:"jump-duck",     name:{en:"Jump & Duck",      th:"à¸à¸£à¸°à¹‚à¸”à¸”à¹à¸¥à¸°à¸à¹‰à¸¡"}, desc:{en:"Move your body to dodge barriers.", th:"à¸‚à¸¢à¸±à¸šà¸•à¸±à¸§à¸«à¸¥à¸šà¸ªà¸´à¹ˆà¸‡à¸à¸µà¸”à¸‚à¸§à¸²à¸‡"}},
        {id:"balance-hold",  name:{en:"Balance Hold",     th:"à¸—à¸£à¸‡à¸•à¸±à¸§à¸„à¹‰à¸²à¸‡"},    desc:{en:"Hold steady poses for points.", th:"à¸—à¸£à¸‡à¸—à¹ˆà¸²à¸„à¹‰à¸²à¸‡ à¸£à¸±à¸šà¸„à¸°à¹à¸™à¸™"}}
      ],
      audio: { bgm: "assets/sfx/bgm.wav", click: "assets/sfx/click.wav" }
    };

    // à¸›à¸¸à¹ˆà¸¡à¹€à¸ªà¸µà¸¢à¸‡
    document.getElementById('muteBtn').addEventListener('click', ()=>{ try { AudioBus.mute(true); } catch(e){} });

    // Leaderboard preview
    (function(){
      try {
        const list = Leaderboard.recent(8);
        const card = document.getElementById('lbCard');
        if (!list || list.length === 0) {
          card.innerHTML = '<div class="small">No scores yet</div>';
        } else {
          const rows = list.map(e => {
            const when = new Date(e.ts).toLocaleString();
            const game = e.gameId || 'unknown';
            const acc  = (e.accuracy != null ? (e.accuracy + '%') : '-');
            return `<div style="display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #1a2532">
              <div><b>${game}</b> Â· ${when}</div>
              <div>Score <b>${e.score || 0}</b> Â· MaxCombo <b>${e.maxCombo || 0}</b> Â· Acc ${acc}</div>
            </div>`;
          }).join('');
          card.innerHTML = rows;
        }
      } catch (e) {}
    })();

    // Fallback renderer: à¸–à¹‰à¸²à¸œà¹ˆà¸²à¸™ 600ms à¹à¸¥à¹‰à¸§à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¹Œà¸”à¹€à¸à¸¡ à¹ƒà¸«à¹‰à¹€à¸£à¸™à¹€à¸”à¸­à¸£à¹Œà¸ˆà¸²à¸ DEFAULT_CFG à¸—à¸±à¸™à¸—à¸µ
    (function fallbackRender(){
      setTimeout(() => {
        const grid = document.getElementById('gameGrid');
        if (grid && grid.children.length === 0) {
          // à¸à¸³à¸«à¸™à¸”à¸ à¸²à¸©à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
          const langSel = document.getElementById('langSel');
          const LANG = (localStorage.getItem('lang') || DEFAULT_CFG.defaultLang || 'en');
          if (langSel) langSel.value = LANG;

          // à¹à¸ªà¸”à¸‡à¸à¸²à¸£à¹Œà¸”à¹€à¸à¸¡
          grid.innerHTML = DEFAULT_CFG.games.map(g => `
            <div class="card">
              <h3>${(g.name[LANG] || g.name.en)}</h3>
              <p>${(g.desc[LANG] || g.desc.en)}</p>
              <div style="margin-top:12px; display:flex; gap:8px">
                <button class="btn accent" data-game="${g.id}">${LANG==='th'?'à¹€à¸¥à¹ˆà¸™':'Play'}</button>
                <a class="btn" href="games/${g.id}/index.html" target="_blank">${LANG==='th'?'à¹€à¸›à¸´à¸”':'Open'}</a>
              </div>
            </div>
          `).join('');

          // à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ Play â†’ à¹„à¸›à¸—à¸µà¹ˆà¸«à¸™à¹‰à¸²à¹€à¸à¸¡
          grid.querySelectorAll('button[data-game]').forEach(btn=>{
            btn.addEventListener('click', e=>{
              try { AudioBus.tap(); } catch(e){}
              const id = e.currentTarget.dataset.game;
              window.location.href = `games/${id}/index.html?mode=timed&diff=normal`;
            });
          });

          // à¹€à¸¥à¹ˆà¸™ BGM à¸–à¹‰à¸²à¸¡à¸µ
          try { AudioBus.load(DEFAULT_CFG); AudioBus.playBgm(); } catch(e){}
        }
      }, 600);
    })();
  </script>
</body>
</html>
