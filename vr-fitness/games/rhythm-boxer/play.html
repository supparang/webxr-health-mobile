<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Rhythm Boxer</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root {
      color-scheme: dark;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, #020617, #020617 40%, #000 100%);
      color: #e5e7eb;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Top bar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 40;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: linear-gradient(to bottom, rgba(15,23,42,0.95), rgba(15,23,42,0.7));
      backdrop-filter: blur(10px);
    }
    .topbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }
    .topbar-title {
      font-size: 16px;
    }
    .topbar-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 14px;
      font-weight: 600;
      background: #38bdf8;
      color: #02131f;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .topbar-btn span {
      font-size: 16px;
    }

    .hud-right {
      display: flex;
      gap: 10px;
      font-size: 13px;
      align-items: center;
    }
    .hud-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 6px 14px rgba(15,23,42,0.8);
    }

    /* Main HUD area */
    .hud-wrap {
      padding: 10px 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .btn-pause {
      border-radius: 8px;
      border: none;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      background: #f97316;
      color: #111827;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
    }
    .btn-pause-icon {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:18px;
      height:18px;
      border-radius:4px;
      background:#020617;
      color:#f97316;
      font-size:13px;
    }
    .btn-stats {
      width:32px;
      height:32px;
      border-radius:10px;
      border:none;
      background:#38bdf8;
      color:#02131f;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(8,47,73,0.75);
    }
    .hud-msg {
      flex:1;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.6);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Stage host */
    #rbStageHost {
      position: fixed;
      inset: 0;
      z-index: 10;
      pointer-events: none; /* lane ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î pointer ‡πÄ‡∏≠‡∏á */
    }

    /* lane + note */
    .rb-lane {
      backdrop-filter: blur(10px);
    }
    .rb-note {
      transition: bottom 0.08s linear;
    }

    /* float score */
    .float {
      font-weight: 700;
      text-shadow: 0 4px 10px rgba(15,23,42,.7);
      animation: rbFloatUp 0.6s ease-out forwards;
      pointer-events: none;
      font-size: 18px;
    }
    @keyframes rbFloatUp {
      0% { opacity:1; transform:translate(-50%,-50%) translateY(0); }
      100%{ opacity:0; transform:translate(-50%,-50%) translateY(-24px); }
    }

    /* HADO ripple + scan */
    .rb-ripple {
      position: fixed;
      left:50%; top:50%;
      width:40vmin; height:40vmin;
      border-radius:999px;
      border:3px solid rgba(56,189,248,.9);
      transform:translate(-50%,-50%);
      animation: rbRipple 0.8s ease-out forwards;
      pointer-events:none;
    }
    @keyframes rbRipple {
      0% { opacity:0.8; transform:translate(-50%,-50%) scale(0.2); }
      100%{ opacity:0;   transform:translate(-50%,-50%) scale(2.2); }
    }

    .rb-scan {
      position:fixed;
      left:0; right:0;
      height:24vh;
      top:-24vh;
      background:linear-gradient(to bottom,
        rgba(125,211,252,0) 0%,
        rgba(125,211,252,0.25) 40%,
        rgba(125,211,252,0) 100%);
      animation: rbScan 0.9s ease-out forwards;
      pointer-events:none;
    }
    @keyframes rbScan {
      0% { top:-24vh; opacity:0; }
      10%{ opacity:0.9; }
      100%{ top:100vh; opacity:0; }
    }

    /* Result card */
    #rbResultCard {
      display:none;           /* ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
      position:fixed;
      inset:0;
      z-index:60;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.82), rgba(15,23,42,0.96));
      backdrop-filter: blur(10px);
    }
    #rbResultCard.hidden {
      display:none;
    }
    .rb-result-inner {
      max-width:480px;
      width:100%;
      background:rgba(15,23,42,.96);
      border-radius:24px;
      box-shadow:0 24px 60px rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.8);
      padding:24px 24px 20px;
    }
    .rb-result-inner h2 {
      margin:0 0 12px;
      font-size:20px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .rb-result-inner dl {
      margin:0;
      font-size:14px;
    }
    .rb-result-inner dt {
      float:left;
      width:120px;
      color:#9ca3af;
    }
    .rb-result-inner dd {
      margin:0 0 6px 120px;
    }
    .rb-result-actions {
      margin-top:18px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .rb-btn {
      flex:1;
      border-radius:999px;
      padding:10px 16px;
      border:none;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
    }
    .rb-btn-primary {
      background:#22c55e;
      color:#022c22;
    }
    .rb-btn-ghost {
      background:#e5e7eb;
      color:#111827;
    }
    .rb-btn-outline {
      background:transparent;
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.9);
    }

    /* Leaderboard placeholder */
    #rbLeaderboard {
      position: relative;
      z-index: 20;
      margin: 0 auto;
      margin-top: 72vh;
      padding: 8px 12px 16px;
      max-width: 520px;
      font-size: 13px;
    }
    #rbLeaderboard h4 {
      margin: 8px 0 4px;
      font-size: 14px;
    }
    #rbLeaderboard table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      background: rgba(15,23,42,0.9);
      border-radius: 12px;
      overflow: hidden;
    }
    #rbLeaderboard th,
    #rbLeaderboard td {
      padding: 4px 6px;
      border-bottom: 1px solid rgba(30,64,175,0.35);
      text-align:left;
    }
    #rbLeaderboard tr:last-child td {
      border-bottom:none;
    }

    /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏Å‡∏°: ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô lane / track ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    body.rb-finished .rb-lane,
    body.rb-finished .track,
    body.rb-finished .rb-note {
      display:none !important;
    }

    @media (max-width:600px){
      .topbar-title { font-size:14px; }
      .hud-msg { font-size:13px; }
    }
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="topbar-left">
      <button class="topbar-btn" type="button" onclick="history.back()">
        <span>‚Üê</span> Back to Hub
      </button>
      <div class="topbar-title">VR Fitness ‚Äî Rhythm Boxer</div>
    </div>
    <div class="hud-right">
      <div class="hud-pill">‚è± <span id="hudTime">60</span>s</div>
      <div class="hud-pill">üèÜ <span id="hudScore">0</span></div>
      <div class="hud-pill">üî• <span id="hudCombo">x0</span></div>
    </div>
  </header>

  <!-- HUD row -->
  <section class="hud-wrap">
    <button class="btn-pause" id="btnPause" type="button">
      <span class="btn-pause-icon">‚Äñ</span> ‡∏û‡∏±‡∏Å
    </button>
    <button class="btn-stats" id="btnDownload" type="button" title="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô">
      üìä
    </button>
    <div class="hud-msg" id="hudMessage">
      ‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏° ‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡∏ö‡∏ï‡πà‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞!
    </div>
  </section>

  <!-- Stage host (lane ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å inject ‡∏ú‡πà‡∏≤‡∏ô JS) -->
  <div id="rbStageHost"></div>

  <!-- Result card -->
  <div id="rbResultCard" class="hidden">
    <div class="rb-result-inner">
      <h2>üèÅ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô Rhythm Boxer</h2>
      <dl>
        <dt>Score:</dt>        <dd><span id="rbScore">0</span></dd>
        <dt>‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / ‡∏û‡∏•‡∏≤‡∏î:</dt><dd><span id="rbHits">0</span> / <span id="rbMiss">0</span></dd>
        <dt>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥:</dt>  <dd><span id="rbAcc">0%</span></dd>
        <dt>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</dt> <dd><span id="rbBest">x0</span></dd>
        <dt>‡∏£‡∏∞‡∏î‡∏±‡∏ö (Rank):</dt><dd><span id="rbRank">C</span></dd>
      </dl>

      <div class="rb-result-actions">
        <button class="rb-btn rb-btn-outline" id="rbPdfBtn" type="button">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
        <button class="rb-btn rb-btn-primary" id="rbReplay" type="button">üîÅ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="rb-btn rb-btn-ghost" id="rbBack" type="button">üè† ‡πÄ‡∏°‡∏ô‡∏π</button>
      </div>
    </div>
  </div>

  <!-- Leaderboard (optional; JS ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡πâ‡∏≤‡∏°‡∏µ LB_API) -->
  <section id="rbLeaderboard"></section>

  <!-- Script -->
  <script type="module">
    import { RhythmBoxer } from './rhythm-boxer.js';

    const stage = document.getElementById('rbStageHost');

    const game = new RhythmBoxer({
      stage,
      hud: {
        time:  document.getElementById('hudTime'),
        score: document.getElementById('hudScore'),
        combo: document.getElementById('hudCombo')
      },
      result: {
        box:   document.getElementById('rbResultCard'),
        score: document.getElementById('rbScore'),
        hits:  document.getElementById('rbHits'),
        miss:  document.getElementById('rbMiss'),
        acc:   document.getElementById('rbAcc'),
        best:  document.getElementById('rbBest'),
        rank:  document.getElementById('rbRank')
      },
      msgBox: document.getElementById('hudMessage'),
      lbBox:  document.getElementById('rbLeaderboard'),
      pdfBtn: document.getElementById('rbPdfBtn')
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô logic ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
    let started = false;
    function startIfNeeded(){
      if (!started) {
        started = true;
        game.start();
      }
    }
    startIfNeeded();

    // ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏±‡∏Å / resume
    const btnPause = document.getElementById('btnPause');
    let paused = false;
    btnPause.addEventListener('click', () => {
      paused = !paused;
      if (paused){
        game.pause(true);
        btnPause.innerHTML = '<span class="btn-pause-icon">‚ñ∂</span> ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠';
      } else {
        game.pause(false);
        btnPause.innerHTML = '<span class="btn-pause-icon">‚Äñ</span> ‡∏û‡∏±‡∏Å';
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏• (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å PDF API ‡∏ú‡πà‡∏≤‡∏ô game.pdfBtn ‡πÉ‡∏ô _showResult)
    const btnDownload = document.getElementById('btnDownload');
    btnDownload.addEventListener('click', () => {
      alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üôÇ');
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô result card
    document.getElementById('rbReplay').addEventListener('click', () => {
      // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°
      location.reload();
    });
    document.getElementById('rbBack').addEventListener('click', () => {
      history.back();
    });
  </script>
</body>
</html>