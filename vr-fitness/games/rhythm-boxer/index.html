<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Rhythm Boxer · VR Fitness</title>

  <!-- เป้าหมายพาธหลักของแอสเซ็ต -->
  <meta name="asset-base" content="/webxr-health-mobile/vr-fitness">

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/webxr-health-mobile/vr-fitness/core/themes/sport-tech.css"/>
  <style>
    body{background:#05090f;color:#e6f7ff;font-family:system-ui,Segoe UI,Arial}
    /* แถบควบคุมด้านบน */
    #topbar{
      position:fixed;left:12px;right:12px;top:10px;z-index:9999;
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      background:rgba(10,16,24,.75);backdrop-filter:saturate(1.1) blur(4px);
      border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px 10px;
    }
    #topbar label{opacity:.9;font-weight:700;font-size:12px;letter-spacing:.3px}
    .sel, .btn{
      appearance:none;-webkit-appearance:none;-moz-appearance:none;
      background:#0e2233;color:#e6f7ff;border:1px solid rgba(255,255,255,.12);
      border-radius:10px;padding:8px 12px;font-weight:700;font-size:12px;cursor:pointer;
    }
    .btn{border:0}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    /* HUD */
    #hud{
      position:fixed;right:12px;top:10px;z-index:9998;
      background:rgba(0,0,0,.35);padding:6px 10px;border-radius:10px;
      font-weight:700;font-size:13px;line-height:1.2;pointer-events:none;
    }
    /* เส้น Hit line */
    #hitline{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:22%;width:70%;height:2px;background:linear-gradient(90deg,#203446,transparent,#203446);
      opacity:.75;pointer-events:none;
    }
    /* พื้นที่แสดงผลเกม ไม่บังคลิก */
    #overlay{position:fixed;inset:0;pointer-events:none}
    /* Toast */
    #toast{
      position:fixed;left:50%;transform:translateX(-50%);
      top:52px;background:rgba(10,12,16,.9);color:#ffcc00;padding:8px 12px;border-radius:10px;
      font:600 14px/1.1 system-ui,Arial;z-index:10000;letter-spacing:.4px;opacity:0;transition:.2s;
    }
    /* Enter VR ให้อยู่กลางล่าง */
    #enterVRBtn{
      position:fixed;left:50%;bottom:12px;transform:translateX(-50%);
      z-index:9999;padding:10px 14px;border-radius:12px;border:0;background:#0e2233;color:#e6f7ff;cursor:pointer;
      font-weight:800
    }
  </style>
</head>
<body>
  <!-- แถบควบคุม -->
  <div id="topbar">
    <label for="songSel">Song</label>
    <select id="songSel" class="sel">
      <option value="intro">Intro Groove (60s)</option>
      <option value="rush">Rush Combo (60s)</option>
      <option value="boss">Boss Drive (60s)</option>
    </select>

    <label for="diffSel">Difficulty</label>
    <select id="diffSel" class="sel">
      <option value="easy">Easy</option>
      <option value="normal" selected>Normal</option>
      <option value="hard">Hard</option>
      <option value="final">Final</option>
    </select>

    <button id="startBtn" class="btn">Start</button>
    <button id="pauseBtn" class="btn" disabled>Pause</button>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div>Score: <span id="sc">0</span></div>
    <div>Combo: <span id="cb">0</span></div>
    <div>Time: <span id="tm">60</span>s</div>
  </div>

  <!-- เส้น hit line อิงตำแหน่ง y -->
  <div id="hitline"></div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- A-Frame Scene -->
  <a-scene renderer="colorManagement: true">
    <a-entity id="rig" position="0 1.6 0">
      <a-entity camera look-controls="enabled:false"></a-entity>
    </a-entity>

    <!-- เวที -->
    <a-plane position="0 1.2 -2.2" width="3.2" height="2.2" color="#0a0f14" opacity="0.75"></a-plane>

    <!-- ลู่ซ้าย กลาง ขวา -->
    <a-entity id="lanes" position="0 0 -2.2"></a-entity>
    <a-entity position="-0.9 0 -2.2"><a-box width="0.02" height="1.6" depth="0.01" color="#163042"></a-box></a-entity>
    <a-entity position="0 0 -2.2"><a-box width="0.02" height="1.6" depth="0.01" color="#163042"></a-box></a-entity>
    <a-entity position="0.9 0 -2.2"><a-box width="0.02" height="1.6" depth="0.01" color="#163042"></a-box></a-entity>
  </a-scene>

  <!-- ปุ่ม Enter VR (กลางล่าง) -->
  <button id="enterVRBtn">Enter VR</button>

  <!-- Core (optional) -->
  <script src="/webxr-health-mobile/vr-fitness/core/audio.js" defer></script>

  <!-- Game -->
  <script src="/webxr-health-mobile/vr-fitness/games/rhythm-boxer/game.js" defer></script>

  <!-- Error overlay แบบละเอียด -->
  <script>
    window.addEventListener('error', function(e){
      const t=document.getElementById('toast');
      t.textContent = (e.message||'Script error') + (e.filename? (' @ '+e.filename+':'+(e.lineno||0)+':'+(e.colno||0)):'');
      t.style.opacity='1'; t.style.transform='translateX(-50%) scale(1.02)';
      setTimeout(()=>{t.style.opacity='0'; t.style.transform='translateX(-50%) scale(1)';}, 2000);
    });
  </script>
</body>
</html>
