<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Rhythm Boxer · VR Fitness</title>

  <!-- บอกสคริปต์ว่าฐาน asset อยู่ไหน -->
  <meta name="asset-base" content="/webxr-health-mobile/vr-fitness">

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/webxr-health-mobile/vr-fitness/core/themes/sport-tech.css"/>
  <style>
    :root{
      --ui-bg: rgba(10,16,24,.75);
      --ui-br: 12px;
      --ui-bd: 1px solid rgba(255,255,255,.08);
      --ui-fg: #e6f7ff;
      --btn-bg:#0e2233;
    }
    body{background:#000;}
    /* HUD มุมขวาบน (ลอยเหนือฉากแน่นอน) */
    #hud{position:fixed;right:8px;top:8px;z-index:2147483000;
      background:rgba(0,0,0,.35);color:var(--ui-fg);padding:8px 10px;border-radius:10px;
      font:600 13px system-ui;pointer-events:none}
    #hud b{font-weight:800}

    /* เส้น hit line แสดงด้านหน้า */
    .hitline{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:22%; width:min(620px,84vw); height:4px;
      background:linear-gradient(90deg, transparent, #2cff88 20%, #2cff88 80%, transparent);
      box-shadow: 0 0 10px #2cff88, 0 0 20px #2cff88;
      opacity:.95; z-index:2147482000; pointer-events:none;
      border-radius:4px;
    }

    /* Dock ควบคุม + ตัวเลือกเพลง/ความเร็ว (ซ้ายล่าง) */
    .ui-dock{
      position:fixed; left:12px; bottom:12px; z-index:2147483647;
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      padding:8px; background:var(--ui-bg); border:var(--ui-bd); border-radius:var(--ui-br);
      backdrop-filter:saturate(1.1) blur(4px);
    }
    .ui-dock .btn{
      padding:8px 12px; border:0; border-radius:10px; background:var(--btn-bg); color:var(--ui-fg);
      font:600 13px system-ui; cursor:pointer;
    }
    .ui-dock select{
      appearance:none; background:#0b2233; color:var(--ui-fg);
      border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:6px 10px; font:600 12px system-ui;
    }

    /* ปุ่ม Enter VR กลางล่าง */
    #enterVRBtn{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:12px; z-index:2147483200; padding:10px 14px;
      border:0; border-radius:10px; background:#0e2233; color:#e6f7ff; cursor:pointer; font:600 14px system-ui;
    }

    /* หน้าผลลัพธ์ */
    #results{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);color:#e6f7ff;z-index:2147483001}
    .card{background:#0b1118;border:1px solid #203446;border-radius:12px;padding:14px 16px;min-width:300px}
    .btn{padding:8px 12px;border:0;border-radius:10px;background:#0e2233;color:#e6f7ff;cursor:pointer}

    /* ข้อความลอย GOOD/PERFECT/MISS */
    .float{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(22% + 18px); z-index:2147482100;
      font:800 28px system-ui; letter-spacing:.4px; text-shadow:0 0 14px rgba(0,0,0,.6);
      animation:floatUp .9s ease-out forwards;
    }
    @keyframes floatUp { from{opacity:0; transform:translate(-50%,18px)} to{opacity:1; transform:translate(-50%,-10px)} }
  </style>
</head>
<body>
  <a-scene renderer="colorManagement:true">
    <a-entity id="arena" position="0 0 0"></a-entity>

    <!-- กล้อง -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity camera look-controls wasd-controls position="0 0 0"></a-entity>
    </a-entity>

    <!-- เส้นเลน (แนวนอนด้านหน้า, ใช้ช่วยเล็งในฉากด้วย) -->
    <a-entity id="laneLines" position="0 1.0 -3">
      <a-plane width="3.2" height="0.02" color="#2cff88" opacity="0.9"></a-plane>
    </a-entity>
  </a-scene>

  <!-- HUD -->
  <div id="hud">
    <div>Song: <b id="hudSong">—</b></div>
    <div>Speed: <b id="hudSpeed">Standard</b> · Score: <b id="hudScore">0</b></div>
    <div>Combo: <b id="hudCombo">0</b> · Time: <b id="hudTime">60</b>s</div>
  </div>

  <!-- เส้น HIT LINE เรืองแสง (หน้าจอ) -->
  <div id="hitline" class="hitline" aria-hidden="true"></div>

  <!-- Results -->
  <section id="results">
    <div class="card">
      <h3 style="margin:0 0 8px">RESULTS</h3>
      <div>Song: <b id="rSong">—</b></div>
      <div>Score: <b id="rScore">0</b></div>
      <div>Max Combo: <b id="rMaxCombo">0</b></div>
      <div>Accuracy: <b id="rAcc">0%</b></div>
      <div style="margin-top:10px; display:flex; gap:8px">
        <button class="btn" id="replayBtn">Replay</button>
        <button class="btn" id="backBtn">Back to Hub</button>
      </div>
    </div>
  </section>

  <!-- UI Dock -->
  <div id="uiDock" class="ui-dock" aria-label="Rhythm Boxer Controls">
    <label style="color:#9bd1ff;font:600 12px system-ui">Song</label>
    <select id="songSel">
      <option value="none">— Select —</option>
      <!-- สมมุติไฟล์ในโปรเจกต์ (เปลี่ยนชื่อไฟล์ให้ตรงของจริง) -->
      <option value="assets/music/track1.mp3" data-title="Training Day" data-bpm="110" data-offset="0.15">Training Day (110 BPM)</option>
      <option value="assets/music/track2.mp3" data-title="Sprint Jam"   data-bpm="128" data-offset="0.12">Sprint Jam (128 BPM)</option>
      <option value="assets/music/track3.mp3" data-title="Final Push"   data-bpm="142" data-offset="0.10">Final Push (142 BPM)</option>
    </select>

    <label style="color:#9bd1ff;font:600 12px system-ui">Speed</label>
    <select id="speedSel">
      <option value="beginner">Beginner</option>
      <option value="standard" selected>Standard</option>
      <option value="challenge">Challenge</option>
    </select>

    <button id="btnStart" class="btn" type="button">Start</button>
    <button id="btnPause" class="btn" type="button">Pause</button>
    <button id="btnEnd"   class="btn" type="button">End</button>
  </div>

  <!-- ปุ่ม Enter VR กลางล่าง -->
  <button id="enterVRBtn" type="button">Enter VR</button>

  <!-- Core (ถ้ามีในโปรเจกต์) -->
  <script src="/webxr-health-mobile/vr-fitness/core/audio.js" defer></script>

  <!-- Game -->
  <script src="/webxr-health-mobile/vr-fitness/games/rhythm-boxer/game.js" defer></script>
</body>
</html>
