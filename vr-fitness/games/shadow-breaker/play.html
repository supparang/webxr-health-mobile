<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Shadow Breaker</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      color-scheme: dark;
      --bg-main: #020617;
      --bg-card: rgba(15,23,42,0.96);
      --border-soft: rgba(148,163,184,0.6);
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.18);
      --accent-2: #a855f7;
      --danger: #fb7185;
      --good: #22c55e;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129,140,248,0.18), transparent 55%),
        var(--bg-main);
      color:#e5e7eb;
      padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0)
               env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
    }
    .page{
      max-width: 1080px;
      margin: 12px auto 20px;
      padding: 0 12px 20px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    header.top-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:10px 12px;
      background: linear-gradient(90deg, rgba(15,23,42,0.96), rgba(15,23,42,0.86));
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.65);
      box-shadow:0 18px 40px rgba(15,23,42,0.7);
      position:sticky;
      top:8px;
      z-index:20;
      backdrop-filter: blur(12px);
    }
    .top-bar-title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .top-bar-title strong{
      font-size:15px;
      letter-spacing:.05em;
      text-transform:uppercase;
      color:#e5e7eb;
    }
    .top-bar-title span{
      font-size:12px;
      color:#9ca3af;
    }
    .chip{
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(148,163,184,0.7);
      color:#e5e7eb;
      display:inline-flex;
      align-items:center;
      gap:4px;
      background:rgba(15,23,42,0.9);
    }
    .chip b{color:var(--accent);}

    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.8);
      transition: background .12s ease, transform .12s ease, box-shadow .12s ease;
    }
    .btn-primary{
      background:linear-gradient(135deg,#38bdf8,#4ade80);
      color:#0b1120;
      border:none;
      box-shadow:0 12px 30px rgba(56,189,248,0.45);
    }
    .btn-danger{
      background:linear-gradient(135deg,#fb7185,#f97316);
      color:#0b1120;
      border:none;
      box-shadow:0 12px 30px rgba(248,113,113,0.45);
    }
    .btn:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:none;
    }

    main.main{
      display:grid;
      grid-template-columns: minmax(0,1.2fr) minmax(0,1.4fr);
      gap:12px;
    }
    @media (max-width: 900px){
      main.main{
        grid-template-columns: minmax(0,1fr);
      }
      header.top-bar{
        position:static;
      }
    }

    .panel{
      background: var(--bg-card);
      border-radius:20px;
      border:1px solid var(--border-soft);
      padding:10px 12px 12px;
      box-shadow:0 18px 40px rgba(15,23,42,0.7);
    }
    .panel h2{
      margin:0 0 8px;
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#e5e7eb;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .panel h2 span.emoji{font-size:17px;}
    .panel p{
      margin:2px 0;
      font-size:13px;
      color:#9ca3af;
    }

    .stats-row{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .stat-pill{
      flex:1 1 80px;
      min-width:80px;
      background:rgba(15,23,42,0.9);
      border-radius:14px;
      padding:6px 8px;
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .stat-pill label{
      font-size:11px;
      color:#9ca3af;
    }
    .stat-pill span{
      font-size:13px;
      font-weight:600;
      color:#e5e7eb;
    }

    /* GAME PANEL */
    .hud-bar{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
    }
    .hud-chip{
      flex:1 1 70px;
      min-width:70px;
      border-radius:12px;
      padding:4px 8px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:1px;
    }
    .hud-chip label{
      font-size:11px;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .hud-chip span{
      font-size:15px;
      font-weight:700;
      color:#e5e7eb;
    }

    .sb-arena-wrap{
      position:relative;
      margin-top:2px;
    }
    .sb-arena{
      position:relative;
      width:100%;
      height:min(460px, 62vh);
      border-radius:22px;
      background:
        radial-gradient(circle at 20% 0%, rgba(56,189,248,0.28), transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(52,211,153,0.32), transparent 60%),
        radial-gradient(circle at 50% 40%, rgba(30,64,175,0.92), #020617);
      border:1px solid rgba(148,163,184,0.75);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 16px 40px rgba(15,23,42,0.9);
      overflow:hidden;
    }
    .status-line{
      margin:4px 2px 0;
      font-size:13px;
      color:#cbd5f5;
      min-height:20px;
    }

    .control-row{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    /* Result card */
    .sb-result-card{
      margin-top:6px;
      padding:10px 12px;
      border-radius:18px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%), rgba(15,23,42,0.98);
      border:1px solid rgba(129,140,248,0.9);
      display:none;
      flex-direction:column;
      gap:8px;
    }
    .sb-result-head{
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    .sb-rank-badge{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(250,204,21,0.9);
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .sb-rank-badge span.rank{
      font-size:17px;
      font-weight:800;
      color:#facc15;
    }
    .sb-result-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:6px;
      margin-top:4px;
    }
    .sb-result-item{
      background:rgba(15,23,42,0.96);
      border-radius:14px;
      padding:6px 8px;
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .sb-result-item label{
      font-size:11px;
      color:#9ca3af;
    }
    .sb-result-item span{
      font-size:14px;
      font-weight:600;
    }
    .sb-result-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* FX for floating text / fever / finish ripple */
    @keyframes sbHitFloat{
      from{ transform:translate(-50%,-50%) translateY(0); opacity:1; }
      to{ transform:translate(-50%,-50%) translateY(-32px); opacity:0; }
    }
    @keyframes feverFlash{
      0%{   transform:translate(-50%,-50%) scale(0.8); opacity:0; }
      40%{  transform:translate(-50%,-50%) scale(1.1); opacity:1; }
      100%{ transform:translate(-50%,-50%) scale(1);   opacity:0; }
    }
    .sb-finish-ripple{
      position:fixed;
      left:50%;
      top:50%;
      width:10px;
      height:10px;
      border-radius:999px;
      border:2px solid rgba(248,250,252,0.8);
      transform:translate(-50%,-50%);
      pointer-events:none;
      animation:sbRipple 0.6s ease-out forwards;
      z-index:9999;
    }
    @keyframes sbRipple{
      from{
        opacity:.7;
        transform:translate(-50%,-50%) scale(1);
      }
      to{
        opacity:0;
        transform:translate(-50%,-50%) scale(18);
      }
    }

    /* === VR MODE LAYOUT === */
    body.vr-mode .page{
      max-width: 880px;
    }
    body.vr-mode .main{
      grid-template-columns: minmax(0,1fr);
    }
    body.vr-mode .main .panel:first-of-type{
      display:none;
    }
    body.vr-mode .sb-arena{
      height: min(80vh, 560px);
    }
    body.vr-mode header.top-bar{
      transform:scale(0.96);
      opacity:0.94;
    }

    /* Language toggle */
    .lang-toggle{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding-left:4px;
      border-left:1px solid rgba(148,163,184,0.5);
    }
    .btn-lang{
      padding:4px 10px;
      font-size:11px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.8);
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
    }
    .btn-lang-active{
      background:linear-gradient(135deg,#38bdf8,#a855f7);
      color:#0b1120;
      border:none;
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="top-bar">
      <div class="top-bar-title">
        <strong id="uiHeaderTitle">VR FITNESS ‚Ä¢ SHADOW BREAKER</strong>
        <span id="uiHeaderTagline">‡∏ï‡πà‡∏≠‡∏¢‡∏°‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤ ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‚Ä¢ ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™ 4 ‡∏î‡πà‡∏≤‡∏ô</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
        <span class="chip" id="uiChipResearch">üéØ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢</span>
        <span class="chip" id="uiChipDevices">üì± PC ¬∑ Mobile ¬∑ VR</span>
        <div class="lang-toggle">
          <button class="btn btn-lang btn-lang-active" data-lang="th">‡πÑ‡∏ó‡∏¢</button>
          <button class="btn btn-lang" data-lang="en">EN</button>
        </div>
      </div>
    </header>

    <main class="main">
      <!-- LEFT: Info / instructions -->
      <section class="panel">
        <h2>
          <span class="emoji">üìò</span>
          <span id="uiGuideTitle">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Notes</span>
        </h2>
        <p id="uiGuideGoal">
          ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ ‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏±‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢.
        </p>
        <p id="uiGuideHowTitle">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡πÜ:</p>
        <ul style="margin:4px 0 4px 18px;padding:0;font-size:13px;color:#9ca3af;">
          <li id="uiGuideHow1">‡∏Å‡∏î <b>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö</b> ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏ä‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</li>
          <li id="uiGuideHow2">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡∏ñ‡∏∂‡∏á <b>5</b> ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î <b>FEVER</b> (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏π‡∏ì)</li>
          <li id="uiGuideHow3">‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏ö‡∏≠‡∏™ 4 ‡∏ï‡∏±‡∏ß ‡∏à‡∏≤‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡∏ï‡∏µ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß</li>
        </ul>

        <div class="stats-row" style="margin-top:8px;">
          <div class="stat-pill">
            <label id="uiInfoModeLabel">‡πÇ‡∏´‡∏°‡∏î / Mode</label>
            <span id="sbModeLabel">Timed</span>
          </div>
          <div class="stat-pill">
            <label id="uiInfoDiffLabel">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å / Difficulty</label>
            <span id="sbDiffLabel">Normal</span>
          </div>
          <div class="stat-pill">
            <label id="uiInfoDeviceLabel">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ / Device</label>
            <span id="sbDeviceLabel">‚Äî</span>
          </div>
        </div>

        <h2 style="margin-top:10px;">
          <span class="emoji">üìä</span>
          <span id="uiLiveTitle">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô / Live Stats</span>
        </h2>
        <div class="stats-row">
          <div class="stat-pill">
            <label id="uiLiveScoreLabel">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô</label>
            <span id="sbScoreLive">0</span>
          </div>
          <div class="stat-pill">
            <label id="uiLiveHitsLabel">‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits</label>
            <span id="sbHitsLive">0</span>
          </div>
          <div class="stat-pill">
            <label id="uiLiveMissLabel">‡∏û‡∏•‡∏≤‡∏î / Miss</label>
            <span id="sbMissLive">0</span>
          </div>
          <div class="stat-pill">
            <label id="uiLiveComboLabel">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</label>
            <span id="sbComboLive">x0</span>
          </div>
        </div>
      </section>

      <!-- RIGHT: Game -->
      <section class="panel">
        <h2>
          <span class="emoji">üéÆ</span>
          <span id="uiPlayTitle">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° / Play</span>
        </h2>

        <div class="hud-bar">
          <div class="hud-chip">
            <label id="uiHudTimeLabel">‡πÄ‡∏ß‡∏•‡∏≤ / Time ‚è±</label>
            <span id="sbTime">90</span>
          </div>
          <div class="hud-chip">
            <label id="uiHudScoreLabel">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / Score</label>
            <span id="sbScoreLiveHUD">0</span>
          </div>
          <div class="hud-chip">
            <label id="uiHudHitsLabel">‡πÇ‡∏î‡∏ô / Miss ü•ä</label>
            <span><span id="sbHitsLiveHUD">0</span> / <span id="sbMissLiveHUD">0</span></span>
          </div>
          <div class="hud-chip">
            <label id="uiHudComboLabel">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö / Combo</label>
            <span id="sbComboLiveHUD">x0</span>
          </div>
        </div>

        <div class="sb-arena-wrap">
          <div id="sbArena" class="sb-arena"></div>
          <p id="sbStatus" class="status-line coach-line">‡πÇ‡∏Ñ‡πâ‡∏ä‡∏û‡∏∏‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡πâ...</p>
        </div>

        <div class="control-row">
          <button id="sbStartBtn" class="btn btn-primary">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö</button>
          <button id="sbPauseBtn" class="btn">‚è∏ ‡∏û‡∏±‡∏Å</button>
          <button id="sbExitBtn" class="btn btn-danger">‚èÆ ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
        </div>

        <!-- Result card -->
        <div id="sbResultCard" class="sb-result-card">
          <div class="sb-result-head">
            <div>
              <div style="font-size:13px;color:#e5e7eb;font-weight:600;" id="uiResultTitle">
                ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Result
              </div>
              <div style="font-size:12px;color:#9ca3af;" id="sbResultMeta">Shadow Breaker ‚Ä¢ 90s</div>
            </div>
            <div class="sb-rank-badge">
              <span>RANK</span>
              <span id="sbRank" class="rank">C</span>
            </div>
          </div>

          <div class="sb-result-grid">
            <div class="sb-result-item">
              <label id="uiResultScoreLabel">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° / Score</label>
              <span id="sbScore">0</span>
            </div>
            <div class="sb-result-item">
              <label id="uiResultHitsLabel">‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits</label>
              <span id="sbHits">0</span>
            </div>
            <div class="sb-result-item">
              <label id="uiResultMissLabel">‡∏û‡∏•‡∏≤‡∏î / Miss</label>
              <span id="sbMiss">0</span>
            </div>
            <div class="sb-result-item">
              <label id="uiResultAccLabel">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ / Accuracy</label>
              <span id="sbAcc">0%</span>
            </div>
            <div class="sb-result-item">
              <label id="uiResultBestLabel">‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î / Best Combo</label>
              <span id="sbBest">x0</span>
            </div>
            <div class="sb-result-item">
              <label id="uiResultNpmLabel">‡πÇ‡∏ô‡πâ‡∏ï‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ / Notes per min</label>
              <span id="sbNPM">0</span>
            </div>
          </div>

          <div class="sb-result-actions">
            <button id="sbCsvBtn" class="btn"  >‚¨á Export CSV</button>
            <button id="sbPdfBtn" class="btn"  >üìÑ Export PDF</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    import { ShadowBreaker } from './shadow-breaker.js';

    // ======= TEXT DICTIONARY: UI (TH/EN) =======
    const UI_STR = {
      th: {
        headerTitle   : 'VR FITNESS ‚Ä¢ SHADOW BREAKER',
        headerTagline : '‡∏ï‡πà‡∏≠‡∏¢‡∏°‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤ ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‚Ä¢ ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™ 4 ‡∏î‡πà‡∏≤‡∏ô',
        chipResearch  : 'üéØ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢',
        chipDevices   : 'üì± PC ¬∑ Mobile ¬∑ VR',

        guideTitle    : '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Notes',
        guideGoal     : '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ ‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏±‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢.',
        guideHowTitle : '‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡πÜ:',
        guideHow1     : '‡∏Å‡∏î ‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏ä‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',
        guideHow2     : '‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡∏ñ‡∏∂‡∏á 5 ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î FEVER (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏π‡∏ì)',
        guideHow3     : '‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏ö‡∏≠‡∏™ 4 ‡∏ï‡∏±‡∏ß ‡∏à‡∏≤‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡∏ï‡∏µ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß',

        infoModeLabel : '‡πÇ‡∏´‡∏°‡∏î / Mode',
        infoDiffLabel : '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å / Difficulty',
        infoDeviceLabel:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ / Device',

        liveTitle     : '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô / Live Stats',
        liveScoreLabel: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô',
        liveHitsLabel : '‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits',
        liveMissLabel : '‡∏û‡∏•‡∏≤‡∏î / Miss',
        liveComboLabel: '‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',

        playTitle     : '‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° / Play',
        hudTimeLabel  : '‡πÄ‡∏ß‡∏•‡∏≤ / Time ‚è±',
        hudScoreLabel : '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / Score',
        hudHitsLabel  : '‡πÇ‡∏î‡∏ô / Miss ü•ä',
        hudComboLabel : '‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö / Combo',

        resultTitle   : '‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Result',
        resultScoreLabel: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° / Score',
        resultHitsLabel : '‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits',
        resultMissLabel : '‡∏û‡∏•‡∏≤‡∏î / Miss',
        resultAccLabel  : '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ / Accuracy',
        resultBestLabel : '‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î / Best Combo',
        resultNpmLabel  : '‡πÇ‡∏ô‡πâ‡∏ï‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ / Notes per min',

        csvBtn        : '‚¨á ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV',
        pdfBtn        : 'üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF',

        btnStart      : '‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö',
        btnPause      : '‚è∏ ‡∏û‡∏±‡∏Å',
        btnResume     : '‚ñ∂ ‡∏ï‡πà‡∏≠',
        btnExit       : '‚èÆ ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π'
      },
      en: {
        headerTitle   : 'VR FITNESS ‚Ä¢ SHADOW BREAKER',
        headerTagline : 'Punch targets ‚Ä¢ Build combos ‚Ä¢ Fight 4 bosses',
        chipResearch  : 'üéØ Research-ready',
        chipDevices   : 'üì± PC ¬∑ Mobile ¬∑ VR',

        guideTitle    : 'Session Guide / Notes',
        guideGoal     : 'Goal: Train eye‚Äìhand reaction speed and punching accuracy, with data ready for research use.',
        guideHowTitle : 'How to play:',
        guideHow1     : 'Press ‚ñ∂ Start, then tap/punch the emoji targets as fast as you can.',
        guideHow2     : 'Keep combo ‚â• 5 to enter FEVER mode (bonus score).',
        guideHow3     : 'Four bosses will appear from easy to hard ‚Äî try to beat them all.',

        infoModeLabel : 'Mode',
        infoDiffLabel : 'Difficulty',
        infoDeviceLabel:'Device',

        liveTitle     : 'Live Stats',
        liveScoreLabel: 'Live score',
        liveHitsLabel : 'Hits',
        liveMissLabel : 'Misses',
        liveComboLabel: 'Last combo',

        playTitle     : 'Play',
        hudTimeLabel  : 'Time ‚è±',
        hudScoreLabel : 'Score',
        hudHitsLabel  : 'Hits / Miss',
        hudComboLabel : 'Combo',

        resultTitle   : 'Session Result',
        resultScoreLabel: 'Total score',
        resultHitsLabel : 'Hits',
        resultMissLabel : 'Misses',
        resultAccLabel  : 'Accuracy',
        resultBestLabel : 'Best combo',
        resultNpmLabel  : 'Notes per min',

        csvBtn        : '‚¨á Export CSV',
        pdfBtn        : 'üìÑ Export PDF',

        btnStart      : '‚ñ∂ Start',
        btnPause      : '‚è∏ Pause',
        btnResume     : '‚ñ∂ Resume',
        btnExit       : '‚èÆ Back to hub'
      }
    };

    function applyUILang(lang, game){
      const d = UI_STR[lang] || UI_STR.th;
      const map = [
        ['uiHeaderTitle',    'headerTitle'],
        ['uiHeaderTagline',  'headerTagline'],
        ['uiChipResearch',   'chipResearch'],
        ['uiChipDevices',    'chipDevices'],

        ['uiGuideTitle',     'guideTitle'],
        ['uiGuideGoal',      'guideGoal'],
        ['uiGuideHowTitle',  'guideHowTitle'],
        ['uiGuideHow1',      'guideHow1'],
        ['uiGuideHow2',      'guideHow2'],
        ['uiGuideHow3',      'guideHow3'],

        ['uiInfoModeLabel',  'infoModeLabel'],
        ['uiInfoDiffLabel',  'infoDiffLabel'],
        ['uiInfoDeviceLabel','infoDeviceLabel'],

        ['uiLiveTitle',      'liveTitle'],
        ['uiLiveScoreLabel', 'liveScoreLabel'],
        ['uiLiveHitsLabel',  'liveHitsLabel'],
        ['uiLiveMissLabel',  'liveMissLabel'],
        ['uiLiveComboLabel', 'liveComboLabel'],

        ['uiPlayTitle',      'playTitle'],
        ['uiHudTimeLabel',   'hudTimeLabel'],
        ['uiHudScoreLabel',  'hudScoreLabel'],
        ['uiHudHitsLabel',   'hudHitsLabel'],
        ['uiHudComboLabel',  'hudComboLabel'],

        ['uiResultTitle',       'resultTitle'],
        ['uiResultScoreLabel',  'resultScoreLabel'],
        ['uiResultHitsLabel',   'resultHitsLabel'],
        ['uiResultMissLabel',   'resultMissLabel'],
        ['uiResultAccLabel',    'resultAccLabel'],
        ['uiResultBestLabel',   'resultBestLabel'],
        ['uiResultNpmLabel',    'resultNpmLabel']
      ];

      for (const [id,key] of map){
        const el = document.getElementById(id);
        if (el && d[key]) el.textContent = d[key];
      }

      const csvBtn = document.getElementById('sbCsvBtn');
      if (csvBtn) csvBtn.textContent = d.csvBtn || csvBtn.textContent;

      const pdfBtn = document.getElementById('sbPdfBtn');
      if (pdfBtn) pdfBtn.textContent = d.pdfBtn || pdfBtn.textContent;

      const startBtn = document.getElementById('sbStartBtn');
      const pauseBtn = document.getElementById('sbPauseBtn');
      const exitBtn  = document.getElementById('sbExitBtn');

      if (startBtn) startBtn.textContent = d.btnStart || startBtn.textContent;
      if (exitBtn)  exitBtn.textContent  = d.btnExit  || exitBtn.textContent;

      if (pauseBtn){
        const running = game && game.state && game.state.running && !game.state.paused;
        pauseBtn.textContent = running ? (d.btnPause || pauseBtn.textContent)
                                       : (d.btnResume|| pauseBtn.textContent);
      }

      const statusEl = document.getElementById('sbStatus');
      if (statusEl && game && game.str && game.str.msgReady){
        statusEl.textContent = game.str.msgReady;
      }
    }

    // ======= CONFIG ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ / ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á =======
    window.__SB_CONFIG = Object.assign({
      siteId    : 'DemoSite',
      roomId    : 'P5-ShadowLab',
      sessionTag: 'pilot-1'
    }, window.__SB_CONFIG || {});

    window.addEventListener('DOMContentLoaded', () => {
      const qs = new URLSearchParams(location.search);
      const diff = qs.get('diff') || 'normal';
      const mode = qs.get('mode') || 'timed';
      const time = parseInt(qs.get('time') || '90', 10);

      const ua = navigator.userAgent || '';
      const isVRHeadset = /Quest|Oculus|Pico|Vive|VR/i.test(ua);
      const forceVR = qs.get('view') === 'vr';

      if (isVRHeadset || forceVR) {
        document.body.classList.add('vr-mode');
      }

      let device = 'PC';
      if (isVRHeadset) device = 'VR';
      else if (/Mobile|Android|iPhone/i.test(ua)) device = 'Mobile';

      const diffLabel = document.getElementById('sbDiffLabel');
      const modeLabel = document.getElementById('sbModeLabel');
      if (diffLabel) diffLabel.textContent = diff.charAt(0).toUpperCase() + diff.slice(1);
      if (modeLabel) modeLabel.textContent = mode === 'timed' ? 'Timed' : mode;

      const deviceLabel = document.getElementById('sbDeviceLabel');
      if (deviceLabel) deviceLabel.textContent = device;

      const arena = document.getElementById('sbArena');

      const game = new ShadowBreaker({
        arena,
        hud: {
          time : document.getElementById('sbTime'),
          score: document.getElementById('sbScoreLiveHUD'),
          hits : document.getElementById('sbHitsLiveHUD'),
          miss : document.getElementById('sbMissLiveHUD'),
          combo: document.getElementById('sbComboLiveHUD')
        },
        msgBox: document.getElementById('sbStatus'),
        result: {
          box : document.getElementById('sbResultCard'),
          score: document.getElementById('sbScore'),
          hits : document.getElementById('sbHits'),
          miss : document.getElementById('sbMiss'),
          acc  : document.getElementById('sbAcc'),
          best : document.getElementById('sbBest'),
          rank : document.getElementById('sbRank')
        },
        csvBtn: document.getElementById('sbCsvBtn'),
        pdfBtn: document.getElementById('sbPdfBtn'),
        onExit(summary){
          window.location.href = './index.html';
        }
      });

      // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ applyUILang ‡πÉ‡∏ä‡πâ
      window.__sbGameInstance = game;

      const $ = (id)=>document.getElementById(id);
      const mirror = () => {
        if (!game || !game.state) return;
        const s = game.state;
        if ($('sbScoreLive'))     $('sbScoreLive').textContent = s.score;
        if ($('sbHitsLive'))      $('sbHitsLive').textContent = s.hits;
        if ($('sbMissLive'))      $('sbMissLive').textContent = s.miss;
        if ($('sbComboLive'))     $('sbComboLive').textContent = 'x'+s.combo;
      };
      setInterval(mirror, 200);

      const startBtn = document.getElementById('sbStartBtn');
      const pauseBtn = document.getElementById('sbPauseBtn');
      const exitBtn  = document.getElementById('sbExitBtn');

      if (startBtn){
        startBtn.addEventListener('click', () => {
          game.start();
          const langNow = game.lang || 'th';
          const d = UI_STR[langNow] || UI_STR.th;
          if (pauseBtn) pauseBtn.textContent = d.btnPause || pauseBtn.textContent;
        });
      }
      if (pauseBtn){
        pauseBtn.addEventListener('click', () => {
          if (!game.state.running) return;
          const wantPause = !game.state.paused;
          game.pause(wantPause);
          const langNow = game.lang || 'th';
          const d = UI_STR[langNow] || UI_STR.th;
          pauseBtn.textContent = wantPause ? (d.btnResume || '‚ñ∂ ‡∏ï‡πà‡∏≠') : (d.btnPause || '‚è∏ ‡∏û‡∏±‡∏Å');
        });
      }
      if (exitBtn){
        exitBtn.addEventListener('click', () => {
          game.exitToHub();
        });
      }

      const metaEl = document.getElementById('sbResultMeta');
      if (metaEl){
        metaEl.textContent = `Shadow Breaker ‚Ä¢ ${time || 90}s ‚Ä¢ diff: ${diff}`;
      }

      const langButtons = document.querySelectorAll('.btn-lang');
      langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.dataset.lang;
          game.setLanguage(lang);
          applyUILang(lang, game);
          langButtons.forEach(b => b.classList.remove('btn-lang-active'));
          btn.classList.add('btn-lang-active');
        });
      });

      // sync ‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏° game.lang
      const initialLang = game.lang || 'th';
      langButtons.forEach(btn => {
        if (btn.dataset.lang === initialLang) {
          btn.classList.add('btn-lang-active');
        } else {
          btn.classList.remove('btn-lang-active');
        }
      });
      applyUILang(initialLang, game);
    });
  </script>
</body>
</html>