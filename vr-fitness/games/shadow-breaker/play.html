<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Shadow Breaker</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      color-scheme: dark;
      --bg-main: #020617;
      --bg-card: rgba(15,23,42,0.96);
      --border-soft: rgba(148,163,184,0.6);
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.18);
      --accent-2: #a855f7;
      --danger: #fb7185;
      --good: #22c55e;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129,140,248,0.18), transparent 55%),
        var(--bg-main);
      color:#e5e7eb;
      padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0)
               env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
    }
    .page{
      max-width: 1080px;
      margin: 12px auto 20px;
      padding: 0 12px 20px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    header.top-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:10px 12px;
      background: linear-gradient(90deg, rgba(15,23,42,0.96), rgba(15,23,42,0.86));
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.65);
      box-shadow:0 18px 40px rgba(15,23,42,0.7);
      position:sticky;
      top:8px;
      z-index:20;
      backdrop-filter: blur(12px);
    }
    .top-bar-title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .top-bar-title strong{
      font-size:15px;
      letter-spacing:.05em;
      text-transform:uppercase;
      color:#e5e7eb;
    }
    .top-bar-title span{
      font-size:12px;
      color:#9ca3af;
    }
    .chip{
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(148,163,184,0.7);
      color:#e5e7eb;
      display:inline-flex;
      align-items:center;
      gap:4px;
      background:rgba(15,23,42,0.9);
    }
    .chip b{color:var(--accent);}

    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.8);
      transition: background .12s ease, transform .12s ease, box-shadow .12s ease;
    }
    .btn-primary{
      background:linear-gradient(135deg,#38bdf8,#4ade80);
      color:#0b1120;
      border:none;
      box-shadow:0 12px 30px rgba(56,189,248,0.45);
    }
    .btn-danger{
      background:linear-gradient(135deg,#fb7185,#f97316);
      color:#0b1120;
      border:none;
      box-shadow:0 12px 30px rgba(248,113,113,0.45);
    }
    .btn:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:none;
    }

    main.main{
      display:grid;
      grid-template-columns: minmax(0,1.2fr) minmax(0,1.4fr);
      gap:12px;
    }
    @media (max-width: 900px){
      main.main{
        grid-template-columns: minmax(0,1fr);
      }
      header.top-bar{
        position:static;
      }
    }

    .panel{
      background: var(--bg-card);
      border-radius:20px;
      border:1px solid var(--border-soft);
      padding:10px 12px 12px;
      box-shadow:0 18px 40px rgba(15,23,42,0.7);
    }
    .panel h2{
      margin:0 0 8px;
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#e5e7eb;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .panel h2 span.emoji{font-size:17px;}
    .panel p{
      margin:2px 0;
      font-size:13px;
      color:#9ca3af;
    }

    .stats-row{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .stat-pill{
      flex:1 1 80px;
      min-width:80px;
      background:rgba(15,23,42,0.9);
      border-radius:14px;
      padding:6px 8px;
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .stat-pill label{
      font-size:11px;
      color:#9ca3af;
    }
    .stat-pill span{
      font-size:13px;
      font-weight:600;
      color:#e5e7eb;
    }

    /* GAME PANEL */
    .hud-bar{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
    }
    .hud-chip{
      flex:1 1 70px;
      min-width:70px;
      border-radius:12px;
      padding:4px 8px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:1px;
    }
    .hud-chip label{
      font-size:11px;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .hud-chip span{
      font-size:15px;
      font-weight:700;
      color:#e5e7eb;
    }

    .sb-arena-wrap{
      position:relative;
      margin-top:2px;
    }
    .sb-arena{
      position:relative;
      width:100%;
      height:min(460px, 62vh);
      border-radius:22px;
      background:
        radial-gradient(circle at 20% 0%, rgba(56,189,248,0.28), transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(52,211,153,0.32), transparent 60%),
        radial-gradient(circle at 50% 40%, rgba(30,64,175,0.92), #020617);
      border:1px solid rgba(148,163,184,0.75);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 16px 40px rgba(15,23,42,0.9);
      overflow:hidden;
    }
    .status-line{
      margin:4px 2px 0;
      font-size:13px;
      color:#cbd5f5;
      min-height:20px;
    }

    .control-row{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    /* Result card */
    .sb-result-card{
      margin-top:6px;
      padding:10px 12px;
      border-radius:18px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%), rgba(15,23,42,0.98);
      border:1px solid rgba(129,140,248,0.9);
      display:none;
      flex-direction:column;
      gap:8px;
    }
    .sb-result-head{
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    .sb-rank-badge{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(250,204,21,0.9);
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .sb-rank-badge span.rank{
      font-size:17px;
      font-weight:800;
      color:#facc15;
    }
    .sb-result-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:6px;
      margin-top:4px;
    }
    .sb-result-item{
      background:rgba(15,23,42,0.96);
      border-radius:14px;
      padding:6px 8px;
      border:1px solid rgba(148,163,184,0.7);
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .sb-result-item label{
      font-size:11px;
      color:#9ca3af;
    }
    .sb-result-item span{
      font-size:14px;
      font-weight:600;
    }
    .sb-result-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* FX for floating text / fever / finish ripple */
    @keyframes sbHitFloat{
      from{ transform:translate(-50%,-50%) translateY(0); opacity:1; }
      to{ transform:translate(-50%,-50%) translateY(-32px); opacity:0; }
    }
    @keyframes feverFlash{
      0%{   transform:translate(-50%,-50%) scale(0.8); opacity:0; }
      40%{  transform:translate(-50%,-50%) scale(1.1); opacity:1; }
      100%{ transform:translate(-50%,-50%) scale(1);   opacity:0; }
    }
    .sb-finish-ripple{
      position:fixed;
      left:50%;
      top:50%;
      width:10px;
      height:10px;
      border-radius:999px;
      border:2px solid rgba(248,250,252,0.8);
      transform:translate(-50%,-50%);
      pointer-events:none;
      animation:sbRipple 0.6s ease-out forwards;
      z-index:9999;
    }
    @keyframes sbRipple{
      from{
        opacity:.7;
        transform:translate(-50%,-50%) scale(1);
      }
      to{
        opacity:0;
        transform:translate(-50%,-50%) scale(18);
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="top-bar">
      <div class="top-bar-title">
        <strong>VR FITNESS ‚Ä¢ SHADOW BREAKER</strong>
        <span>‡∏ï‡πà‡∏≠‡∏¢‡∏°‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤ ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‚Ä¢ ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™ 4 ‡∏î‡πà‡∏≤‡∏ô</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
        <span class="chip">üéØ <b>Research-ready</b></span>
        <span class="chip">üì± PC ¬∑ Mobile ¬∑ VR</span>
      </div>
    </header>

    <main class="main">
      <!-- LEFT: Info / instructions -->
      <section class="panel">
        <h2><span class="emoji">üìò</span> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Notes</h2>
        <p>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ ‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏±‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢.</p>
        <p>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡πÜ:</p>
        <ul style="margin:4px 0 4px 18px;padding:0;font-size:13px;color:#9ca3af;">
          <li>‡∏Å‡∏î <b>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö</b> ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏ä‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</li>
          <li>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡∏ñ‡∏∂‡∏á <b>5</b> ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î <b>FEVER</b> (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏π‡∏ì)</li>
          <li>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏ö‡∏≠‡∏™ 4 ‡∏ï‡∏±‡∏ß ‡∏à‡∏≤‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡∏ï‡∏µ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß</li>
        </ul>

        <div class="stats-row" style="margin-top:8px;">
          <div class="stat-pill">
            <label>‡πÇ‡∏´‡∏°‡∏î / Mode</label>
            <span id="sbModeLabel">Timed</span>
          </div>
          <div class="stat-pill">
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å / Difficulty</label>
            <span id="sbDiffLabel">Normal</span>
          </div>
          <div class="stat-pill">
            <label>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ / Device</label>
            <span id="sbDeviceLabel">‚Äî</span>
          </div>
        </div>

        <h2 style="margin-top:10px;"><span class="emoji">üìä</span> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô / Live Stats</h2>
        <div class="stats-row">
          <div class="stat-pill">
            <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô</label>
            <span id="sbScoreLive">0</span>
          </div>
          <div class="stat-pill">
            <label>‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits</label>
            <span id="sbHitsLive">0</span>
          </div>
          <div class="stat-pill">
            <label>‡∏û‡∏•‡∏≤‡∏î / Miss</label>
            <span id="sbMissLive">0</span>
          </div>
          <div class="stat-pill">
            <label>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</label>
            <span id="sbComboLive">x0</span>
          </div>
        </div>
      </section>

      <!-- RIGHT: Game -->
      <section class="panel">
        <h2><span class="emoji">üéÆ</span> ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° / Play</h2>

        <div class="hud-bar">
          <div class="hud-chip">
            <label>‡πÄ‡∏ß‡∏•‡∏≤ / Time ‚è±</label>
            <span id="sbTime">90</span>
          </div>
          <div class="hud-chip">
            <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô / Score</label>
            <span id="sbScoreLiveHUD">0</span>
          </div>
          <div class="hud-chip">
            <label>‡πÇ‡∏î‡∏ô / Miss ü•ä</label>
            <span><span id="sbHitsLiveHUD">0</span> / <span id="sbMissLiveHUD">0</span></span>
          </div>
          <div class="hud-chip">
            <label>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö / Combo</label>
            <span id="sbComboLiveHUD">x0</span>
          </div>
        </div>

        <div class="sb-arena-wrap">
          <div id="sbArena" class="sb-arena"></div>
          <p id="sbStatus" class="status-line coach-line">‡πÇ‡∏Ñ‡πâ‡∏ä‡∏û‡∏∏‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡πÉ‡∏´‡πâ...</p>
        </div>

        <div class="control-row">
          <button id="sbStartBtn" class="btn btn-primary">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö</button>
          <button id="sbPauseBtn" class="btn">‚è∏ ‡∏û‡∏±‡∏Å</button>
          <button id="sbExitBtn" class="btn btn-danger">‚èÆ ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
        </div>

        <!-- Result card -->
        <div id="sbResultCard" class="sb-result-card">
          <div class="sb-result-head">
            <div>
              <div style="font-size:13px;color:#e5e7eb;font-weight:600;">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ / Session Result</div>
              <div style="font-size:12px;color:#9ca3af;" id="sbResultMeta">Shadow Breaker ‚Ä¢ 90s</div>
            </div>
            <div class="sb-rank-badge">
              <span>RANK</span>
              <span id="sbRank" class="rank">C</span>
            </div>
          </div>

          <div class="sb-result-grid">
            <div class="sb-result-item">
              <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° / Score</label>
              <span id="sbScore">0</span>
            </div>
            <div class="sb-result-item">
              <label>‡πÇ‡∏î‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ / Hits</label>
              <span id="sbHits">0</span>
            </div>
            <div class="sb-result-item">
              <label>‡∏û‡∏•‡∏≤‡∏î / Miss</label>
              <span id="sbMiss">0</span>
            </div>
            <div class="sb-result-item">
              <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ / Accuracy</label>
              <span id="sbAcc">0%</span>
            </div>
            <div class="sb-result-item">
              <label>‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î / Best Combo</label>
              <span id="sbBest">x0</span>
            </div>
            <div class="sb-result-item">
              <label>‡πÇ‡∏ô‡πâ‡∏ï‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ / Notes per min</label>
              <span id="sbNPM">0</span>
            </div>
          </div>

          <div class="sb-result-actions">
            <button id="sbCsvBtn" class="btn">‚¨á Export CSV</button>
            <button id="sbPdfBtn" class="btn">üìÑ Export PDF</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    import { ShadowBreaker } from './shadow-breaker.js';

    // ======= CONFIG ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ / ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á =======
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ override ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å script ‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
    window.__SB_CONFIG = Object.assign({
      siteId    : 'DemoSite',
      roomId    : 'P5-ShadowLab',
      sessionTag: 'pilot-1'
      // firebaseApi   : 'https://example.com/firebase',
      // sheetApi      : 'https://example.com/sheet',
      // pdfApi        : 'https://example.com/pdf',
      // leaderboardApi: 'https://example.com/leaderboard'
    }, window.__SB_CONFIG || {});

    window.addEventListener('DOMContentLoaded', () => {
      const qs = new URLSearchParams(location.search);
      const diff = qs.get('diff') || 'normal';
      const mode = qs.get('mode') || 'timed';
      const time = parseInt(qs.get('time') || '90', 10);

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô info panel
      const diffLabel = document.getElementById('sbDiffLabel');
      const modeLabel = document.getElementById('sbModeLabel');
      if (diffLabel) diffLabel.textContent = diff.charAt(0).toUpperCase() + diff.slice(1);
      if (modeLabel) modeLabel.textContent = mode === 'timed' ? 'Timed' : mode;

      // Device label
      const deviceLabel = document.getElementById('sbDeviceLabel');
      const ua = navigator.userAgent || '';
      let device = 'PC';
      if (/Quest|Oculus|Pico|Vive|VR/i.test(ua)) device = 'VR';
      else if (/Mobile|Android|iPhone/i.test(ua)) device = 'Mobile';
      if (deviceLabel) deviceLabel.textContent = device;

      const arena = document.getElementById('sbArena');

      const game = new ShadowBreaker({
        arena,
        hud: {
          time : document.getElementById('sbTime'),
          score: document.getElementById('sbScoreLiveHUD'),
          hits : document.getElementById('sbHitsLiveHUD'),
          miss : document.getElementById('sbMissLiveHUD'),
          combo: document.getElementById('sbComboLiveHUD')
        },
        msgBox: document.getElementById('sbStatus'),
        result: {
          box : document.getElementById('sbResultCard'),
          score: document.getElementById('sbScore'),
          hits : document.getElementById('sbHits'),
          miss : document.getElementById('sbMiss'),
          acc  : document.getElementById('sbAcc'),
          best : document.getElementById('sbBest'),
          rank : document.getElementById('sbRank')
        },
        csvBtn: document.getElementById('sbCsvBtn'),
        pdfBtn: document.getElementById('sbPdfBtn'),
        onExit(summary){
          // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á summary ‡∏Å‡∏•‡∏±‡∏ö Hub ‡∏ú‡πà‡∏≤‡∏ô postMessage ‡∏Å‡πá‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÑ‡∏î‡πâ
          // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö index ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô
          window.location.href = './index.html';
        }
      });

      // mirror live HUD -> left info card (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
      const $ = (id)=>document.getElementById(id);
      const mirror = () => {
        if (!game || !game.state) return;
        const s = game.state;
        if ($('sbScoreLive'))     $('sbScoreLive').textContent = s.score;
        if ($('sbHitsLive'))      $('sbHitsLive').textContent = s.hits;
        if ($('sbMissLive'))      $('sbMissLive').textContent = s.miss;
        if ($('sbComboLive'))     $('sbComboLive').textContent = 'x'+s.combo;
      };
      // hook ‡πÄ‡∏Ç‡πâ‡∏≤ requestAnimationFrame ‡∏ú‡πà‡∏≤‡∏ô interval ‡πÄ‡∏ö‡∏≤‡πÜ
      setInterval(mirror, 200);

      // ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
      const startBtn = document.getElementById('sbStartBtn');
      const pauseBtn = document.getElementById('sbPauseBtn');
      const exitBtn  = document.getElementById('sbExitBtn');

      if (startBtn){
        startBtn.addEventListener('click', () => {
          game.start();
        });
      }
      if (pauseBtn){
        pauseBtn.addEventListener('click', () => {
          if (!game.state.running) return;
          const wantPause = !game.state.paused;
          game.pause(wantPause);
          pauseBtn.textContent = wantPause ? '‚ñ∂ ‡∏ï‡πà‡∏≠' : '‚è∏ ‡∏û‡∏±‡∏Å';
        });
      }
      if (exitBtn){
        exitBtn.addEventListener('click', () => {
          game.exitToHub();
        });
      }

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï meta ‡πÉ‡∏ô result card ‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡∏£‡∏≠‡∏ö (‡πÉ‡∏ä‡πâ observer ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)
      const metaEl = document.getElementById('sbResultMeta');
      const timeLabel = document.getElementById('sbTime');
      if (metaEl && timeLabel){
        metaEl.textContent = `Shadow Breaker ‚Ä¢ ${time || 90}s ‚Ä¢ diff: ${diff}`;
      }
    });
  </script>
</body>
</html>