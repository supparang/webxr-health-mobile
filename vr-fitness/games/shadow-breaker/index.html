<!-- === vr-fitness/games/shadow-breaker/index.html ===
Shadow Breaker ‚Äî RUN (Production v1.1.0)
‚úÖ PC/Mobile/VR friendly
‚úÖ Includes /herohealth/vr/vr-ui.js (Enter VR/Exit/Recenter + crosshair/tap-to-shoot => hha:shoot)
‚úÖ Supports query passthrough: hub/view/seed/research/studyId/log/phase/mode/diff/time
‚úÖ Research form shown only when research=1 OR studyId/log exists
‚úÖ HUD + GameArea + Result overlay + CSV download
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Shadow Breaker</title>
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#020617" />
  <link rel="icon" href="../../favicon.ico" />

  <!-- ‚úÖ Shadow Breaker CSS -->
  <link rel="stylesheet" href="./shadow-breaker.css" />
</head>

<body>
  <div class="page">

    <!-- =========================
         Top / Meta (Research)
    ========================== -->
    <div class="card top-panel">
      <div class="card-header">
        <div class="title">
          <div class="icon">ü•ä</div>
          <div>
            <h1>Shadow Breaker</h1>
            <p id="tagGoal">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ï‡πà‡∏≠‡∏¢/‡∏¢‡∏¥‡∏á‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ö‡∏≠‡∏™‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ï‡∏±‡∏ß.</p>
          </div>
        </div>

        <!-- Language toggle -->
        <div class="lang-toggle" role="group" aria-label="Language">
          <button class="lang-btn active" data-lang="th" type="button">TH</button>
          <button class="lang-btn" data-lang="en" type="button">EN</button>
        </div>
      </div>

      <!-- Research meta card (hidden in play mode by JS/body class) -->
      <div class="card meta-panel research-card" id="researchCard">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <div style="font-weight:900;">Research / Session Meta</div>
          <div style="font-size:.72rem; color:#94a3b8;">(‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏à‡∏±‡∏¢)</div>
        </div>

        <div class="research-grid">
          <label>
            <span>Student ID</span>
            <input id="studentId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65001" />
          </label>

          <label>
            <span>School</span>
            <input id="schoolName" placeholder="‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." />
          </label>

          <label>
            <span>Class</span>
            <input id="classRoom" placeholder="‡∏õ.5/1" />
          </label>

          <label>
            <span>Group Code</span>
            <input id="groupCode" placeholder="A / B / C" />
          </label>

          <label>
            <span>Device</span>
            <select id="deviceType">
              <option value="auto">auto-detect</option>
              <option value="pc">pc</option>
              <option value="mobile">mobile</option>
              <option value="vrHeadset">vrHeadset</option>
            </select>
          </label>

          <label>
            <span>Note</span>
            <input id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." />
          </label>
        </div>

        <div class="hint small" id="metaPDPA">
          * ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Apps Script ‡∏ñ‡∏π‡∏Å‡∏û‡∏±‡∏Å‡πÑ‡∏ß‡πâ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage + CSV)
        </div>
      </div>

      <div class="hint">
        Query: <code>?hub=...&amp;mode=timed|endless&amp;diff=easy|normal|hard&amp;time=60&amp;seed=...</code>
      </div>
    </div>

    <!-- =========================
         Game Card
    ========================== -->
    <div class="card game-card">
      <!-- HUD -->
      <div class="hud" id="hud">
        <div class="hud-block">
          <span class="label">TIME</span>
          <span class="value" id="timeVal">60</span>
        </div>
        <div class="hud-block">
          <span class="label">SCORE</span>
          <span class="value" id="scoreVal">0</span>
        </div>
        <div class="hud-block">
          <span class="label">HIT</span>
          <span class="value" id="hitVal">0</span>
        </div>
        <div class="hud-block">
          <span class="label">MISS</span>
          <span class="value" id="missVal">0</span>
        </div>
        <div class="hud-block">
          <span class="label">COMBO</span>
          <span class="value" id="comboVal">x0</span>
        </div>
      </div>

      <!-- Start -->
      <div class="start-row">
        <button class="btn btn-main" id="startBtn" type="button">
          <span>‚ñ∂</span> <span id="startLabel">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</span>
        </button>
      </div>

      <!-- Coach -->
      <div class="coach" id="coachLine">‡πÇ‡∏Ñ‡πâ‡∏ä‡∏û‡∏∏‡πà‡∏á: ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏¢‡∏¥‡∏á‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏ô! üëä</div>

      <!-- Game Panel -->
      <div class="game-panel">
        <div id="gameArea" aria-label="Game Area"></div>

        <!-- Feedback -->
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </div>

      <!-- Controls / how to play -->
      <div class="controls">
        <h2>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h2>
        <ul>
          <li>‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô (PC/Mobile)</li>
          <li>‡πÇ‡∏´‡∏°‡∏î cVR/VR: ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏¢‡∏¥‡∏á‚Äù ‡∏ú‡πà‡∏≤‡∏ô crosshair (‡∏à‡∏≤‡∏Å vr-ui.js)</li>
          <li>‡∏£‡∏±‡∏Å‡∏©‡∏≤ COMBO ‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á 5 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤ FEVER üî•</li>
          <li>‡∏ö‡∏≠‡∏™‡∏à‡∏∞‡πÇ‡∏ú‡∏•‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á ‡πÜ ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏ö‡∏à‡∏ô HP ‡∏´‡∏°‡∏î</li>
        </ul>
        <div class="hint small">Tip: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô Cardboard ‡πÉ‡∏´‡πâ‡∏Å‡∏î ENTER VR ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ crosshair ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠</div>
      </div>
    </div>
  </div>

  <!-- =========================
       Result Overlay
  ========================== -->
  <div id="resultOverlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div class="overlay-box">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>

      <div class="result-grid">
        <div><span class="label">Score</span><span class="value" id="rScore">0</span></div>
        <div><span class="label">Accuracy</span><span class="value" id="rAcc">0%</span></div>

        <div><span class="label">Hit</span><span class="value" id="rHit">0</span></div>
        <div><span class="label">Miss</span><span class="value" id="rMiss">0</span></div>

        <div><span class="label">Perfect</span><span class="value" id="rPerfect">0</span></div>
        <div><span class="label">Good</span><span class="value" id="rGood">0</span></div>

        <div><span class="label">Max Combo</span><span class="value" id="rCombo">x0</span></div>
        <div><span class="label">Time Used</span><span class="value" id="rTimeUsed">0s</span></div>
      </div>

      <div class="overlay-actions">
        <button class="btn btn-main btn-full" id="playAgainBtn" type="button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn btn-secondary btn-full" id="downloadCsvBtn" type="button">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
        <button class="btn btn-secondary btn-full" id="backHubBtn" type="button">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ HUB</button>
      </div>

      <div class="hint small" style="margin-top:8px;">
        CSV ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å localStorage (Apps Script ‡∏û‡∏±‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô)
      </div>
    </div>
  </div>

  <!-- =========================
       VR UI (Universal)
       IMPORTANT: adjust path if your folder differs
  ========================== -->
  <script>
    // Optional config for vr-ui.js
    window.HHA_VRUI_CONFIG = { lockPx: 28, cooldownMs: 90 };
  </script>

  <!-- ‚úÖ If this Shadow Breaker is inside /vr-fitness/... and vr-ui.js is in /herohealth/vr/ -->
  <script src="../../../herohealth/vr/vr-ui.js"></script>

  <!-- =========================
       Mode auto class (play vs research)
  ========================== -->
  <script>
    (function(){
      function qs(k,d){ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch{ return d; } }
      const r = (qs('research','')||'').toLowerCase();
      const isResearch = (r==='1'||r==='true'||r==='on'||!!qs('studyId','')||!!qs('log',''));

      document.body.classList.toggle('mode-play', !isResearch);

      // hide research card if not research
      const rc = document.getElementById('researchCard');
      if(rc) rc.style.display = isResearch ? '' : 'none';
    })();
  </script>

  <!-- ‚úÖ Game engine -->
  <script src="./shadow-breaker.js"></script>
</body>
</html>