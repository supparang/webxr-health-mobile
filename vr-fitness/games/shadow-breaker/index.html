<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Shadow Breaker</title>
  <meta name="description" content="VR Fitness — Shadow Breaker"/>

  <style>
    :root{
      --bg:#0b1322; --panel:#0f1a30; --panel-2:#0b1730;
      --txt:#eaf2ff; --muted:#9bb1d6; --accent:#4da3ff; --danger:#ff5e7a;
      --good:#6cff9c; --warn:#ffd36c;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    header{display:flex;gap:.75rem;align-items:center;padding:.75rem 1rem;background:linear-gradient(180deg,#0c1528,#0a1221);position:sticky;top:0;z-index:10}
    header h1{font-size:1.2rem;margin:0}
    main{display:grid;grid-template-columns:1fr 320px;gap:12px;padding:12px}
    @media (max-width:900px){ main{grid-template-columns:1fr} }
    .stage{background:radial-gradient(1200px 500px at 50% -50%,#17305e20,#0000), linear-gradient(180deg,#0d1b35,#0a1326); border:1px solid #1b2a48; border-radius:16px; min-height:60vh; position:relative; overflow:hidden}
    canvas#gameCanvas{position:absolute;inset:0; display:block; width:100%; height:100%}
    .hud{position:absolute;inset:0; pointer-events:none}
    .hud .bar{position:absolute;left:12px;right:12px;display:flex;flex-wrap:wrap;justify-content:space-between;gap:8px}
    .hud .top{top:10px}
    .hud .bot{bottom:10px}
    .chip{pointer-events:auto; background:var(--panel); border:1px solid #1e2d4f; border-radius:12px; padding:.45rem .65rem; display:inline-flex; gap:.5rem; align-items:center; color:var(--txt)}
    .muted{color:var(--muted)}
    .controls{display:grid;gap:10px; background:var(--panel-2); border:1px solid #1b2a48; border-radius:16px; padding:12px}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    label{font-size:.9rem}
    select,button{appearance:none; background:#132245; color:var(--txt); border:1px solid #1e2d4f; border-radius:10px; padding:.55rem .7rem; font-size:.95rem}
    button{cursor:pointer}
    button.primary{background:linear-gradient(180deg,#2a6be8,#1b4db5); border-color:#2a6be8}
    button.warn{background:linear-gradient(180deg,#e86b6b,#b51b34); border-color:#e86b6b}
    button.ghost{background:#0d1c3a}
    button:disabled{opacity:.55; pointer-events:none}
    .card{background:var(--panel-2); border:1px solid #1b2a48; border-radius:16px; padding:12px}

    /* RESULT PANEL */
    .result-panel{ display:none; position:absolute; inset:0; backdrop-filter:blur(6px);
      background:linear-gradient(180deg,#0a1122dd,#0a1122ee); padding:24px; align-content:center; justify-items:center; text-align:center}
    .result-panel.is-visible{ display:grid }
    .result-panel h2{margin:.2rem 0 1rem 0}
    .stars span{font-size:1.4rem; margin:0 .1rem}
    .grid{display:grid; gap:6px; grid-template-columns:1fr 1fr; max-width:520px; width:100%}
    .grid .cell{background:#0e1a34; border:1px solid #1a2a4e; border-radius:12px; padding:.6rem .8rem; display:flex; justify-content:space-between}
    .note{font-size:.9rem; color:var(--muted)}

    /* helper */
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:.9rem; background:#0a1a36; border:1px solid #1e2d4f; padding:.15rem .4rem; border-radius:6px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Shadow Breaker</h1>
    <span class="muted">VR/PC/Mobile</span>
  </header>

  <main>
    <!-- ===== Game Stage ===== -->
    <section class="stage card">
      <canvas id="gameCanvas"></canvas>

      <!-- HUD -->
      <div class="hud">
        <div class="bar top">
          <div class="chip">Time: <strong id="lblTime">60</strong>s</div>
          <div class="chip">Score: <strong id="lblScore">0</strong></div>
          <div class="chip">Combo: <strong id="lblCombo">0</strong></div>
          <div class="chip">MaxCombo: <strong id="lblMaxCombo">0</strong></div>
          <div class="chip">Acc: <strong id="lblAccuracy">0%</strong></div>
        </div>
        <div class="bar bot">
          <div class="chip muted">Tips: Hit pads. Avoid <span style="color:var(--danger)">Bombs</span>.</div>
          <div class="chip muted">Pause: <span class="kbd">P</span></div>
        </div>
      </div>

      <!-- RESULT -->
      <div id="resultPanel" class="result-panel" aria-hidden="true">
        <h2>RESULTS</h2>
        <div class="stars" id="starWrap">☆☆☆☆☆</div>
        <div class="grid" style="margin:10px 0 16px">
          <div class="cell"><span>Score</span><strong id="resScore">0</strong></div>
          <div class="cell"><span>Max Combo</span><strong id="resMaxCombo">0</strong></div>
          <div class="cell"><span>Accuracy</span><strong id="resAcc">0%</strong></div>
          <div class="cell"><span>Difficulty</span><strong id="resDiff">NORMAL</strong></div>
        </div>
        <div class="note">Press <span class="kbd">R</span> to Restart or use the buttons.</div>
      </div>
    </section>

    <!-- ===== Controls / Side Panel ===== -->
    <aside class="controls">
      <div class="row">
        <label for="selDiff">Difficulty</label>
        <select id="selDiff">
          <option value="easy">Easy</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
          <option value="final">Final</option>
        </select>
      </div>

      <div class="row">
        <button id="btnStart" class="primary">Start</button>
        <button id="btnPause" class="ghost">Pause / Resume</button>
        <button id="btnEnd"   class="warn">End</button>
      </div>

      <div class="card">
        <div style="font-weight:600;margin-bottom:6px">Controls</div>
        <div class="muted" style="line-height:1.6">
          • Mouse/Touch: Click pads<br/>
          • Keyboard: <span class="kbd">P</span> Pause, <span class="kbd">R</span> Restart<br/>
          • VR: Trigger to hit pads
        </div>
      </div>
    </aside>
  </main>

  <footer style="padding:10px 12px;color:var(--muted)">
    Shadow Breaker — part of VR Fitness Academy
  </footer>
</div>

<!-- ===== Script ===== -->
<script src="./game.js"></script>
<script>
  // Hotkeys
  window.addEventListener('keydown', (e)=>{
    const k = e.key.toLowerCase();
    if(k==='p') document.getElementById('btnPause')?.click();
    if(k==='r') document.getElementById('btnStart')?.click();
  });

  // Hook ตัวอย่างสำหรับสะท้อนค่าตอนจบเกม (ถ้า game.js dispatch อีเวนต์)
  document.addEventListener('shadowbreaker:finished', (ev)=>{
    const d = ev.detail || {};
    const byId = (id)=>document.getElementById(id);
    byId('resScore') && (byId('resScore').textContent = d.score ?? 0);
    byId('resMaxCombo') && (byId('resMaxCombo').textContent = d.maxCombo ?? 0);
    byId('resAcc') && (byId('resAcc').textContent = (d.accuracy!=null? Math.round(d.accuracy*100)+'%' : '0%'));
    const sel = document.getElementById('selDiff');
    if (sel && byId('resDiff')) byId('resDiff').textContent = (sel.value||'normal').toUpperCase();
  });
</script>
</body>
</html>
