<!-- === VR Fitness ‚Äî Shadow Breaker (Production HTML v1.1.0) ===
     ‚úÖ Works with shadow-breaker.js v1.1.0-prod
     ‚úÖ Supports vr-ui.js (hha:shoot crosshair/tap-to-shoot)
     ‚úÖ HUD ids: timeVal/scoreVal/hitVal/missVal/comboVal + coachLine
     ‚úÖ Overlay ids: resultOverlay + rScore/rHit/... + downloadCsvBtn/playAgainBtn/backHubBtn
     ‚úÖ Research meta (optional): hidden automatically when not research
     ‚úÖ Pass-through hub/view/seed/research/studyId/log etc.
-->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>VR Fitness ‚Äî Shadow Breaker</title>

  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#020617" />

  <!-- CSS (‡∏ï‡πà‡∏≠ 3) -->
  <link rel="stylesheet" href="./shadow-breaker.css" />

  <!-- (Optional) Favicon -->
  <!-- <link rel="icon" href="./icon.png" /> -->
</head>
<body>

  <!-- =========================
       HUD (fixed, pointer-events none)
       ========================= -->
  <div class="hud sb-hud" id="hud">
    <div class="card" style="flex:1; min-width:260px;">
      <div style="display:flex; gap:14px; flex-wrap:wrap; align-items:center;">
        <div style="display:flex; gap:10px; align-items:baseline;">
          <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">TIME</div>
          <div style="font-size:18px; font-weight:1000;">
            <span id="timeVal">60</span><span style="opacity:.8;">s</span>
          </div>
        </div>

        <div style="display:flex; gap:10px; align-items:baseline;">
          <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">SCORE</div>
          <div id="scoreVal" style="font-size:18px; font-weight:1000;">0</div>
        </div>

        <div style="display:flex; gap:10px; align-items:baseline;">
          <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">HIT</div>
          <div id="hitVal" style="font-size:18px; font-weight:1000;">0</div>
        </div>

        <div style="display:flex; gap:10px; align-items:baseline;">
          <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">MISS</div>
          <div id="missVal" style="font-size:18px; font-weight:1000;">0</div>
        </div>

        <div style="display:flex; gap:10px; align-items:baseline;">
          <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">COMBO</div>
          <div id="comboVal" style="font-size:18px; font-weight:1000;">x0</div>
        </div>
      </div>

      <div id="coachLine" style="margin-top:8px; font-weight:900; color:#22d3ee;">
        ‡πÇ‡∏Ñ‡πâ‡∏ä‡∏û‡∏∏‡πà‡∏á: ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞/‡∏¢‡∏¥‡∏á‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏ô! üëä
      </div>
    </div>

    <div class="card" style="width:min(220px, 40vw); text-align:right;">
      <div style="font-weight:1000; font-size:12px; color:rgba(148,163,184,.95); letter-spacing:.14em;">LANG</div>
      <div class="lang-toggle" style="display:flex; justify-content:flex-end; gap:8px; margin-top:8px; pointer-events:auto;">
        <button type="button" class="lang-btn active" data-lang="th">TH</button>
        <button type="button" class="lang-btn" data-lang="en">EN</button>
      </div>

      <div style="margin-top:10px; font-size:12px; color:rgba(148,163,184,.92);">
        <span id="tagGoal">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ï‡πà‡∏≠‡∏¢/‡∏¢‡∏¥‡∏á‡πÄ‡∏õ‡πâ‡∏≤ emoji ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏≠‡∏°‡πÇ‡∏ö ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ö‡∏≠‡∏™‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ï‡∏±‡∏ß.</span>
      </div>
    </div>
  </div>

  <!-- =========================
       (Optional) Research meta panel
       - Hidden automatically when not research
       ========================= -->
  <div class="meta-panel top-panel" style="
      position:fixed;
      left: calc(env(safe-area-inset-left,0px) + 10px);
      right: calc(env(safe-area-inset-right,0px) + 10px);
      top: calc(env(safe-area-inset-top,0px) + 132px);
      z-index: 40;
      display:flex;
      justify-content:center;
      pointer-events:none;
    ">
    <div style="
      width:min(840px, calc(100vw - 20px));
      background:rgba(2,6,23,.70);
      border:1px solid rgba(148,163,184,.18);
      border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.35);
      padding:12px 12px 10px;
      backdrop-filter: blur(10px);
      pointer-events:auto;
    ">
      <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
        <div style="display:flex; gap:10px; align-items:center;">
          <div style="
              width:34px; height:34px; border-radius:14px;
              display:grid; place-items:center;
              background: radial-gradient(circle at 30% 20%, rgba(34,211,238,.35), rgba(14,165,233,.22));
              border:1px solid rgba(34,211,238,.18);
            ">üìä</div>
          <div>
            <div id="metaTitle" style="font-weight:1000;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢</div>
            <div id="metaHint" style="font-size:12px; color:rgba(148,163,184,.95);">
              ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô 1 session)
            </div>
          </div>
        </div>

        <div style="font-size:12px; color:rgba(148,163,184,.92);">
          <span id="metaPDPA">* ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</span>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px; margin-top:10px;">
        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          Student ID
          <input id="studentId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65001" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;" />
        </label>

        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          Device
          <select id="deviceType" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;">
            <option value="auto" selected>Auto detect</option>
            <option value="pc">PC / Notebook</option>
            <option value="mobile">Mobile / Tablet</option>
            <option value="vrHeadset">VR Headset</option>
          </select>
        </label>

        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          Group / Code
          <input id="groupCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô EXP / CTRL" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;" />
        </label>

        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          School / Institution
          <input id="schoolName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;" />
        </label>

        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          Class / Room
          <input id="classRoom" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.5/1" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;" />
        </label>

        <label style="display:flex; flex-direction:column; gap:4px; font-size:12px; color:rgba(148,163,184,.95);">
          Note
          <input id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (optional)" style="padding:10px 12px; border-radius:999px; border:1px solid rgba(148,163,184,.2); background:rgba(15,23,42,.75); color:#e5e7eb; outline:none;" />
        </label>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px;">
        <button id="startBtn" class="btn primary" style="flex:1;">‚ñ∂ <span id="startLabel">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</span></button>
        <button id="downloadCsvBtn" class="btn" style="flex:1;">üì• <span id="downloadCsvLabel">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</span></button>
      </div>

      <div style="margin-top:8px; font-size:12px; color:rgba(148,163,184,.92);">
        PC: ‡∏Ñ‡∏•‡∏¥‡∏Å / Space | Mobile: ‡πÅ‡∏ï‡∏∞ | VR/cVR: ‡πÄ‡∏•‡πá‡∏á crosshair ‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏¢‡∏¥‡∏á‚Äù (‡∏ú‡πà‡∏≤‡∏ô vr-ui.js)
      </div>
    </div>
  </div>

  <!-- =========================
       Game area (targets live here)
       ========================= -->
  <div id="gameArea"></div>

  <!-- Feedback floating -->
  <div id="feedback" class="feedback"></div>

  <!-- =========================
       Result Overlay
       ========================= -->
  <div id="resultOverlay" class="hidden">
    <div>
      <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
        <div style="font-weight:1000; font-size:18px;" id="resultTitle">üèÅ Shadow Breaker Result</div>
        <div style="font-size:12px; color:rgba(148,163,184,.92);">session summary</div>
      </div>

      <div style="display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:10px; margin-top:14px;">
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rScoreLabel">Total Score</div>
          <div style="font-size:20px; font-weight:1000;" id="rScore">0</div>
        </div>
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rAccLabel">Accuracy</div>
          <div style="font-size:20px; font-weight:1000;" id="rAcc">0%</div>
        </div>
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rHitLabel">Hits</div>
          <div style="font-size:20px; font-weight:1000;" id="rHit">0</div>
        </div>
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rMissLabel">Miss</div>
          <div style="font-size:20px; font-weight:1000;" id="rMiss">0</div>
        </div>
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rPerfectLabel">Perfect</div>
          <div style="font-size:20px; font-weight:1000;" id="rPerfect">0</div>
        </div>
        <div class="card">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rGoodLabel">Good</div>
          <div style="font-size:20px; font-weight:1000;" id="rGood">0</div>
        </div>
        <div class="card" style="grid-column:1 / -1;">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rComboLabel">Best Combo</div>
          <div style="font-size:20px; font-weight:1000;" id="rCombo">x0</div>
        </div>
        <div class="card" style="grid-column:1 / -1;">
          <div style="font-size:12px; color:rgba(148,163,184,.92);" id="rTimeUsedLabel">Played Time</div>
          <div style="font-size:20px; font-weight:1000;" id="rTimeUsed">0s</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;">
        <button id="playAgainBtn" class="btn primary" style="flex:1;">‚ñ∂ <span id="playAgainLabel">Play again</span></button>
        <button id="backHubBtn" class="btn" style="flex:1;">üè† <span id="backHubLabel">Back to Hub</span></button>
      </div>
    </div>
  </div>

  <!-- =========================
       Scripts
       ========================= -->

  <!-- Universal VR UI (crosshair + tap-to-shoot => emits hha:shoot {x,y,lockPx}) -->
  <!-- ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏µ‡πâ path ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì /herohealth/vr/vr-ui.js ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á vr-fitness -->
  <script>
    // lockPx ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ‚Äú‡∏î‡∏π‡∏î‡πÄ‡∏õ‡πâ‡∏≤‚Äù ‡∏Ç‡∏≠‡∏á crosshair (‡πÄ‡∏î‡πá‡∏Å ‡∏õ.5 ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 30-34)
    window.HHA_VRUI_CONFIG = { lockPx: 32, cooldownMs: 90 };
  </script>
  <script src="../../herohealth/vr/vr-ui.js"></script>

  <!-- Shadow Breaker logic -->
  <script src="./shadow-breaker.js"></script>

  <!-- Auto-mode toggles: hide research form when not research -->
  <script>
    (function(){
      function qs(k,d){ try{ return new URL(location.href).searchParams.get(k) ?? d; }catch(_){ return d; } }
      const r = (qs('research','')||'').toLowerCase();
      const isResearch = (r==='1'||r==='true'||r==='on'||!!qs('studyId','')||!!qs('log',''));

      if(!isResearch){
        document.body.classList.add('mode-play');
        // hide csv button if exists
        var b = document.getElementById('downloadCsvBtn');
        if(b) b.style.display = 'none';
        var pd = document.getElementById('metaPDPA');
        if(pd) pd.style.display = 'none';
      }
    })();
  </script>

</body>
</html>